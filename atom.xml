<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tianyao&#39; s BLOG</title>
  
  <subtitle>Tianyao</subtitle>
  <link href="https://atffang.github.io/atom.xml" rel="self"/>
  
  <link href="https://atffang.github.io/"/>
  <updated>2026-01-10T14:29:24.501Z</updated>
  <id>https://atffang.github.io/</id>
  
  <author>
    <name>Fang Tianyao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>LangChainå­¦ä¹ æ—¥å¿—: Agent</title>
    <link href="https://atffang.github.io/2026/01/10/langchainAgent/"/>
    <id>https://atffang.github.io/2026/01/10/langchainAgent/</id>
    <published>2026-01-10T07:33:25.000Z</published>
    <updated>2026-01-10T14:29:24.501Z</updated>
    
    <content type="html"><![CDATA[<p>å°è¯•ä½¿ç”¨LangChainçš„AgentsåŠŸèƒ½ã€‚</p><span id="more"></span><h3 id="intro"><a class="markdownIt-Anchor" href="#intro"></a> Intro</h3><p>LangChain å®˜æ–¹æ–‡æ¡£çš„ Core components ç¬¬ä¸€é¡¹å°±æ˜¯ <span style="color: #BB8ED0; font-weight: bold;">Agents </span> ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<a href="https://docs.langchain.com/oss/python/langchain/agents">å®˜æ–¹æ˜¯å¦‚ä½•ä»‹ç»çš„</a> ï¼š</p><p>Agents combine language models withÂ toolsÂ to create systems that can reason about tasks, decide which tools to use, and iteratively work towards solutions.</p><p><code>create_agent</code>Â provides a production-ready agent implementation.</p><p>An LLM Agent runs tools in a loop to achieve a goal. An agent runs until a stop condition is met - i.e., when the model emits a final output or an iteration limit is reached.</p><p>è¿™æ®µè¯å‘Šè¯‰æˆ‘ä»¬ä¸‰ä¸ªä¿¡æ¯ï¼š</p><ul><li>Agent æ˜¯å°†<span style="color: #BB8ED0; font-weight: bold;">è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</span>ä¸<span style="color: #BB8ED0; font-weight: bold;">å·¥å…·ï¼ˆToolsï¼‰</span>ç»“åˆçš„ç³»ç»Ÿã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å…·å¤‡æ¨ç†èƒ½åŠ›ï¼Œèƒ½è‡ªä¸»å†³å®šè¯¥ç”¨ä»€ä¹ˆå·¥å…·ï¼Œå¹¶é€šè¿‡åå¤è¿­ä»£æ¥è§£å†³ä»»åŠ¡ã€‚</li><li>å¯ä»¥ä½¿ç”¨ <code>create_agent</code> å‡½æ•°å®ç°</li><li>Agent çš„è¿è¡Œæ˜¯ä¸€ä¸ª<strong>å¾ªç¯è¿‡ç¨‹</strong>ï¼šå®ƒä¼šä¸æ–­è¿è¡Œå·¥å…·ï¼Œç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ä¸ºæ­¢ã€‚</li></ul><p>å¹¶ä¸”ç»™å‡ºäº†ç®€å•çš„å·¥ä½œæµç¨‹ï¼š</p><img src="/2026/01/10/langchainAgent/agent01.png" class="" title="sucessful"><h3 id="core-components"><a class="markdownIt-Anchor" href="#core-components"></a> Core components</h3><h4 id="model"><a class="markdownIt-Anchor" href="#model"></a> Model</h4><p><span style="color: #89986D; font-weight: bold;">Model å°±æ˜¯ Agent çš„æ¨ç†å¼•æ“ï¼Œè´Ÿè´£æ€è€ƒã€å†³ç­–å’Œç”Ÿæˆå›å¤ã€‚</span><br />å¯¹äº LLM æ¨¡å‹çš„è°ƒç”¨åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><strong>Static Model</strong>ï¼šæœ€å¸¸ç”¨çš„æ–¹å¼ã€‚åœ¨åˆ›å»º Agent æ—¶å°±å›ºå®šå¥½ï¼ˆä¾‹å¦‚æŒ‡å®šç”¨ <code>gpt-4o</code>ï¼‰ï¼Œæ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šå˜ã€‚</li><li><strong>Dynamic Model</strong>ï¼šä¸€ç§é«˜çº§ç”¨æ³•ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€é€‰æ‹©æ¨¡å‹ã€‚æ¯”å¦‚åœ¨ç®€å•çš„é—®é¢˜ä¸Šä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ã€‚</li></ul><h4 id="tools"><a class="markdownIt-Anchor" href="#tools"></a> Tools</h4><p><span style="color: #89986D; font-weight: bold;">Tools å°±æ˜¯ Agent ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„å·¥å…·ã€‚</span>é€šå¸¸æ˜¯æ ‡å‡†çš„ Python å‡½æ•°ï¼ŒåŠ ä¸Š <code>@tool</code> è£…é¥°å™¨ã€‚æ ¹æ®æ–‡æ¡£çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>create_agent</code>ç®€å•å®šä¹‰ä¸€ä¸ª Tool ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Search for information.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Results for: <span class="subst">&#123;query&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">location: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get weather information for a location.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Weather in <span class="subst">&#123;location&#125;</span>: Sunny, 72Â°F&quot;</span></span><br><span class="line"></span><br><span class="line">agent = create_agent(model, tools=[search, get_weather])</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœè¦è‡ªå®šä¹‰Toolé”™è¯¯çš„å¤„ç†æ–¹å¼ï¼Œå°±ä½¿ç”¨ <code>@wrap_tool_call</code> è£…é¥°å™¨åˆ›å»ºä¸­é—´ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_agent</span><br><span class="line"><span class="keyword">from</span> langchain.agents.middleware <span class="keyword">import</span> wrap_tool_call</span><br><span class="line"><span class="keyword">from</span> langchain.messages <span class="keyword">import</span> ToolMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrap_tool_call</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_tool_errors</span>(<span class="params">request, handler</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Handle tool execution errors with custom messages.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> handler(request)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># Return a custom error message to the model</span></span><br><span class="line">        <span class="keyword">return</span> ToolMessage(</span><br><span class="line">            content=<span class="string">f&quot;Tool error: Please check your input and try again. (<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>)&quot;</span>,</span><br><span class="line">            tool_call_id=request.tool_call[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">agent = create_agent(</span><br><span class="line">    model=<span class="string">&quot;gpt-4o&quot;</span>,</span><br><span class="line">    tools=[search, get_weather],</span><br><span class="line">    middleware=[handle_tool_errors]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="system-prompt"><a class="markdownIt-Anchor" href="#system-prompt"></a> System Prompt</h4><p>é¡¾åæ€ä¹‰ï¼ŒSystem Prompt å°±æ˜¯ç³»ç»Ÿå±‚é¢çš„æç¤ºè¯ï¼Œ<span style="color: #89986D; font-weight: bold;">ç”¨äºè®¾å®š Agent çš„è¡Œä¸ºè§„èŒƒå’Œè§’è‰²ã€‚</span><br />æœ€ç®€å•çš„å®šä¹‰æ–¹å¼å°±æ˜¯åœ¨æ„å»ºagentç¤ºä¾‹æ—¶ä¼ å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">agent = create_agent(</span><br><span class="line">    model,</span><br><span class="line">    tools,</span><br><span class="line">    system_prompt=<span class="string">&quot;You are a helpful assistant. Be concise and accurate.&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¼ å…¥Strï¼Œå¤æ‚ä¸€äº›ï¼Œå¯ä»¥ä¼ å…¥LangChainçš„ Â <a href="https://reference.langchain.com/python/langchain/messages/?_gl=1*njhwp7*_gcl_au*MzYwNTQyNDYwLjE3Njc5MjM3MTU.*_ga*MTQ2MjI5MjY5MC4xNzY3OTIzNzE2*_ga_47WX3HKKY2*czE3NjgwMzAwNzkkbzQkZzEkdDE3NjgwMzAzMjQkajYwJGwwJGgw#langchain.messages.SystemMessage"><code>SystemMessage</code></a>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_agent</span><br><span class="line"><span class="keyword">from</span> langchain.messages <span class="keyword">import</span> SystemMessage, HumanMessage</span><br><span class="line"></span><br><span class="line">literary_agent = create_agent(</span><br><span class="line">    model=<span class="string">&quot;anthropic:claude-sonnet-4-5&quot;</span>,</span><br><span class="line">    system_prompt=SystemMessage(</span><br><span class="line">        content=[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="string">&quot;text&quot;</span>: <span class="string">&quot;You are an AI assistant tasked with analyzing literary works.&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="string">&quot;text&quot;</span>: <span class="string">&quot;&lt;the entire contents of &#x27;Pride and Prejudice&#x27;&gt;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;cache_control&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;ephemeral&quot;</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">result = literary_agent.invoke(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(<span class="string">&quot;Analyze the major themes in &#x27;Pride and Prejudice&#x27;.&quot;</span>)]&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="invocation"><a class="markdownIt-Anchor" href="#invocation"></a> Invocation</h4><p><span style="color: #89986D; font-weight: bold;">å¯åŠ¨ Agentã€‚</span></p><p>Agent çš„è¿è¡Œæ˜¯åŸºäº <strong>State (çŠ¶æ€)</strong> çš„æ›´æ–°ï¼Œé€šå¸¸åªéœ€è¦ç»™å®ƒä¼ å…¥ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ï¼ˆMessageï¼‰ï¼Œå®ƒå°±ä¼šå¼€å§‹æ ¹æ®å›¾ï¼ˆGraphï¼‰çš„é€»è¾‘è¿è¡Œï¼Œç›´åˆ°å¾—å‡ºç»“æœã€‚æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = agent.invoke(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;What&#x27;s the weather in San Francisco?&quot;</span>&#125;]&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>é™¤äº†ä»¥ä¸ŠåŸºç¡€çš„å¿…è¦çš„æ­¥éª¤ï¼ŒLangChain è¿˜ä¸º Agents æä¾›äº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚æˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹ï¼š<br /><span style="color: #89986D; font-weight: bold;">Structured Output (ç»“æ„åŒ–è¾“å‡º)</span><br />å¯ä»¥å¼ºåˆ¶è¿”å› JSON æ•°æ®ï¼ˆæ¯”å¦‚æå–å‡ºçš„å§“åã€æ—¥æœŸã€è®¢å•å·ï¼‰ï¼Œæ–¹ä¾¿ç¨‹åºç›´æ¥åç»­å¤„ç†ã€‚</p><p><span style="color: #89986D; font-weight: bold;">Memory (è®°å¿†æœºåˆ¶)</span></p><ul><li><strong>çŸ­æœŸè®°å¿†ï¼š</strong> é€šè¿‡ State å®ç°è®°ä½è¿™è½®å¯¹è¯é‡Œä½ åˆšæ‰è¯´äº†ä»€ä¹ˆã€‚</li><li><strong>é•¿æœŸè®°å¿†ï¼š</strong> é€šè¿‡æ•°æ®åº“å®ç°å†å²è®°å¿†ã€‚</li></ul><p><span style="color: #89986D; font-weight: bold;">Streaming (æµå¼è¾“å‡º)</span><br />Agent å¯ä»¥ä¸€è¾¹è°ƒç”¨å·¥å…·ï¼Œä¸€è¾¹å°±åœ¨å±å¹•ä¸Šå³æ—¶æ‰“å°å‡ºå®ƒçš„æ€è€ƒè¿‡ç¨‹ã€‚</p><p><span style="color: #89986D; font-weight: bold;">Middleware (ä¸­é—´ä»¶)</span><br />å®ƒå¯ä»¥åœ¨ Agent è¯´è¯å‰ã€è¯´è¯åï¼Œæˆ–è€…å·¥å…·æŠ¥é”™æ—¶å·¥ä½œã€‚æ¯”å¦‚åœ¨å·¥å…·æŠ¥é”™æ—¶ï¼Œè‡ªåŠ¨è®© Agent é‡è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥è®©ç¨‹åºå´©æºƒã€‚</p><p>è¿™äº›Agentsçš„åŠŸèƒ½ä¼¼ä¹å°è£…çš„è¿˜ä¸é”™ï¼Œé‚£æˆ‘ä»¬æ¥å®é™…å°è¯•ä¸€ä¸‹ã€‚</p><h3 id="å®æˆ˜"><a class="markdownIt-Anchor" href="#å®æˆ˜"></a> å®æˆ˜</h3><p>åœ¨å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæ—¥å¸¸å°åŠ©æ‰‹ï¼Œä»–æœ‰ä»¥ä¸‹ä¸¤ä¸ªå°åŠŸèƒ½ï¼š</p><div style="background-color: #f7f9fc; border: 1px solid #e1e4e8; border-radius: 15px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;"> <p style="margin-top: 0; margin-bottom: 12px; color: #333; border-bottom: 2px solid #5aa9e6; padding-bottom: 8px; display: inline-block; font-size: 1.1em;">ğŸ¤–Daily Assistant</p> <p style="color: #666; font-size: 0.9em; margin: 6px 0; line-height: 1.4;">WeatherTool: æŸ¥è¯¢æŸåœ°å¤©æ°”</p> <p style="color: #666; font-size: 0.9em; margin: 6px 0; line-height: 1.4;">Loan Calculator: è®¡ç®—ç­‰é¢æœ¬æ¯</p> </div><h4 id="weathertool"><a class="markdownIt-Anchor" href="#weathertool"></a> WeatherTool</h4><p>è¿™æ˜¯ä¸€ä¸ª<span style="color: #BB8ED0; font-weight: bold;">å¤©æ°”æŸ¥è¯¢å·¥å…·</span>ã€‚ä¸ºäº†æŸ¥è¯¢çœŸå®çš„å¤©æ°”ï¼Œæˆ‘ä»¬å» OpenWeatherMap å®˜ç½‘ç”³è¯·ä¸€ä¸ªå…è´¹çš„ API Keyï¼Œç„¶åä½¿ç”¨å…¶apiæŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Type</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> BaseTool</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰è¾“å…¥å‚æ•°çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    city: <span class="built_in">str</span> = Field(</span><br><span class="line">        description=<span class="string">&quot;éœ€è¦æŸ¥è¯¢å¤©æ°”çš„åŸå¸‚è‹±æ–‡åï¼Œä¾‹å¦‚ &#x27;Beijing&#x27;, &#x27;London&#x27;, &#x27;New York&#x27;&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®šä¹‰å·¥å…·ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealWeatherTool</span>(<span class="title class_ inherited__">BaseTool</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;get_real_weather&quot;</span></span><br><span class="line">    description: <span class="built_in">str</span> = (</span><br><span class="line">        <span class="string">&quot;è·å–æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”è¯¦æƒ…ã€‚åŒ…å«æ¸©åº¦ã€å¤©æ°”çŠ¶å†µã€æ¹¿åº¦ç­‰ä¿¡æ¯ã€‚&quot;</span></span><br><span class="line">        <span class="string">&quot;å½“ç”¨æˆ·è¯¢é—®&#x27;ä»Šå¤©å¤©æ°”å¦‚ä½•&#x27;æˆ–&#x27;ä¸‹é›¨å—&#x27;æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚&quot;</span></span><br><span class="line">    )</span><br><span class="line">    args_schema: <span class="type">Type</span>[BaseModel] = WeatherInput</span><br><span class="line">    api_key: <span class="built_in">str</span> = os.getenv(<span class="string">&quot;OPENWEATHER_API_KEY&quot;</span>, <span class="string">&quot;******&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_run</span>(<span class="params">self, city: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        base_url = <span class="string">&quot;http://api.openweathermap.org/data/2.5/weather&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;q&quot;</span>: city,</span><br><span class="line">            <span class="string">&quot;appid&quot;</span>: self.api_key,</span><br><span class="line">            <span class="string">&quot;units&quot;</span>: <span class="string">&quot;metric&quot;</span>,</span><br><span class="line">            <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;zh_cn&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(base_url, params=params)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            </span><br><span class="line">            data = response.json()</span><br><span class="line">            </span><br><span class="line">            weather_desc = data[<span class="string">&quot;weather&quot;</span>][<span class="number">0</span>][<span class="string">&quot;description&quot;</span>]</span><br><span class="line">            temp = data[<span class="string">&quot;main&quot;</span>][<span class="string">&quot;temp&quot;</span>]</span><br><span class="line">            humidity = data[<span class="string">&quot;main&quot;</span>][<span class="string">&quot;humidity&quot;</span>]</span><br><span class="line">            wind_speed = data[<span class="string">&quot;wind&quot;</span>][<span class="string">&quot;speed&quot;</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="string">f&quot;ã€<span class="subst">&#123;city&#125;</span> å®æ—¶å¤©æ°”ã€‘\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;- çŠ¶å†µ: <span class="subst">&#123;weather_desc&#125;</span>\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;- æ¸©åº¦: <span class="subst">&#123;temp&#125;</span>Â°C\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;- æ¹¿åº¦: <span class="subst">&#123;humidity&#125;</span>%\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;- é£é€Ÿ: <span class="subst">&#123;wind_speed&#125;</span> m/s&quot;</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">404</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Error: æ‰¾ä¸åˆ°åŸå¸‚ &#x27;<span class="subst">&#123;city&#125;</span>&#x27;ï¼Œè¯·æ£€æŸ¥æ‹¼å†™ã€‚&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> response.status_code == <span class="number">401</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Error: API Key æ— æ•ˆã€‚&quot;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error: è¯·æ±‚å¤±è´¥ (<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>)&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error: æŸ¥è¯¢è¿‡ç¨‹ä¸­å‘ç”ŸæœªçŸ¥é”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰äº†è¾“å…¥å‚æ•°çš„ç»“æ„<code>WeatherInput</code>ï¼Œå…¶å®å°±æ˜¯è¾“å…¥ä¸€ä¸ªåŸå¸‚åå­—ç¬¦ä¸²ã€‚éšåï¼Œç»§æ‰¿<code>BaseTool</code>ç±»å®šä¹‰ä¸€ä¸ª<code>RealWeatherTool</code>ç±»ï¼Œå®šä¹‰å†…éƒ¨å­—æ®µå¹¶é‡å†™<code>_run</code>æ–¹æ³•ã€‚</p><p>å’Œä¸Šä¸€ç¯‡ç¬”è®°ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨é˜¿é‡Œçš„ qwen æ¨¡å‹ï¼Œåˆ›å»ºä¸€ä¸ªagentï¼Œå¹¶æŠŠè‡ªå®šä¹‰çš„tooläº¤ç»™ä»–æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models <span class="keyword">import</span> ChatTongyi</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_agent</span><br><span class="line"><span class="keyword">from</span> tools.weathertool <span class="keyword">import</span> RealWeatherTool</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>] = <span class="string">&quot;******&quot;</span></span><br><span class="line">llm = ChatTongyi(model_name=<span class="string">&quot;qwen-max&quot;</span>)</span><br><span class="line"></span><br><span class="line">weather_tool = RealWeatherTool()</span><br><span class="line">tools = [weather_tool]</span><br><span class="line"></span><br><span class="line">agent = create_agent(llm, tools=tools)</span><br><span class="line"></span><br><span class="line">query = <span class="string">&quot;å¸®æˆ‘æŸ¥æŸ¥æ­å·çš„å¤©æ°”ã€‚&quot;</span></span><br><span class="line">result = agent.invoke(&#123;</span><br><span class="line">    <span class="string">&quot;messages&quot;</span>: [HumanMessage(content=query)]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> message <span class="keyword">in</span> result[<span class="string">&quot;messages&quot;</span>]:</span><br><span class="line">    message.pretty_print()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰“å°å®Œæ•´çš„è¾“å‡ºï¼Œè®°å½•äº†å¤§æ¨¡å‹è°ƒç”¨å·¥å…·çš„è¿‡ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">=============== Human Message ===============</span><br><span class="line">å¸®æˆ‘æŸ¥æŸ¥æ­å·çš„å¤©æ°”ã€‚</span><br><span class="line">=============== Ai Message ================</span><br><span class="line">Tool Calls:</span><br><span class="line">  get_real_weather (call_9a7740f492704862b7ae77)</span><br><span class="line"> Call ID: call_9a7740f492704862b7ae77</span><br><span class="line">  Args:</span><br><span class="line">    city: Hangzhou</span><br><span class="line">================ Tool Message ===============</span><br><span class="line">Name: get_real_weather</span><br><span class="line">ã€Hangzhou å®æ—¶å¤©æ°”ã€‘</span><br><span class="line">- çŠ¶å†µ: æ™´</span><br><span class="line">- æ¸©åº¦: 8.95Â°C</span><br><span class="line">- æ¹¿åº¦: 28%</span><br><span class="line">- é£é€Ÿ: 3.94 m/s</span><br><span class="line">================= Ai Message ===============</span><br><span class="line">æ­å·ç°åœ¨çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š</span><br><span class="line">- çŠ¶å†µ: æ™´</span><br><span class="line">- æ¸©åº¦: 8.95Â°C</span><br><span class="line">- æ¹¿åº¦: 28%</span><br><span class="line">- é£é€Ÿ: 3.94 m/s</span><br><span class="line">å¤©æ°”æ™´æœ—ï¼Œå¤–å‡ºæ³¨æ„é˜²æ™’å“¦ï¼</span><br></pre></td></tr></table></figure><h4 id="loan-calculator"><a class="markdownIt-Anchor" href="#loan-calculator"></a> Loan Calculator</h4><p>è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„<span style="color: #BB8ED0; font-weight: bold;">è´·æ¬¾è®¡ç®—å™¨</span>ï¼Œä»¥å®ç°ç²¾å‡†çš„è®¡ç®—ï¼Œè¿™æ˜¯ LLM ä¸å…·æœ‰çš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Type</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> BaseTool</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰è¾“å…¥æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoanInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    principal: <span class="built_in">float</span> = Field(description=<span class="string">&quot;è´·æ¬¾æœ¬é‡‘æ€»é¢ï¼Œå•ä½ä¸ºå…ƒã€‚ä¾‹å¦‚ 1000000&quot;</span>)</span><br><span class="line">    annual_rate_percent: <span class="built_in">float</span> = Field(description=<span class="string">&quot;å¹´åˆ©ç‡ç™¾åˆ†æ¯”ã€‚ä¾‹å¦‚ 3.5 ä»£è¡¨ 3.5%&quot;</span>)</span><br><span class="line">    years: <span class="built_in">int</span> = Field(description=<span class="string">&quot;è´·æ¬¾æœŸé™ï¼ˆå¹´ï¼‰ã€‚ä¾‹å¦‚ 30&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®šä¹‰è´·æ¬¾è®¡ç®—å·¥å…·</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoanCalculatorTool</span>(<span class="title class_ inherited__">BaseTool</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;calculate_loan_payment&quot;</span></span><br><span class="line">    description: <span class="built_in">str</span> = (</span><br><span class="line">        <span class="string">&quot;ä¸“ä¸šçš„è´·æ¬¾è®¡ç®—å™¨ï¼ˆç­‰é¢æœ¬æ¯æ–¹å¼ï¼‰ã€‚&quot;</span></span><br><span class="line">        <span class="string">&quot;å½“ç”¨æˆ·è¯¢é—®&#x27;æˆ¿è´·æœˆä¾›&#x27;ã€&#x27;è½¦è´·è®¡ç®—&#x27;ã€&#x27;åˆ†æœŸä»˜æ¬¾åˆ©æ¯&#x27;æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚&quot;</span></span><br><span class="line">        <span class="string">&quot;å¿…é¡»ä½¿ç”¨æ­¤å·¥å…·è¿›è¡Œè®¡ç®—ï¼Œç¦æ­¢æ¨¡å‹è‡ªè¡Œä¼°ç®—ã€‚&quot;</span></span><br><span class="line">    )</span><br><span class="line">    args_schema: <span class="type">Type</span>[BaseModel] = LoanInput</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_run</span>(<span class="params">self, principal: <span class="built_in">float</span>, annual_rate_percent: <span class="built_in">float</span>, years: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ•°æ®é¢„å¤„ç†</span></span><br><span class="line">            monthly_rate = annual_rate_percent / <span class="number">100</span> / <span class="number">12</span></span><br><span class="line">            total_months = years * <span class="number">12</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ ¸å¿ƒè®¡ç®—é€»è¾‘ (æŒ‡æ•°è¿ç®—ï¼ŒLLM çš„æ­»ç©´)</span></span><br><span class="line">            <span class="keyword">if</span> monthly_rate == <span class="number">0</span>:</span><br><span class="line">                monthly_payment = principal / total_months</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                numerator = principal * monthly_rate * math.<span class="built_in">pow</span>(<span class="number">1</span> + monthly_rate, total_months)</span><br><span class="line">                denominator = math.<span class="built_in">pow</span>(<span class="number">1</span> + monthly_rate, total_months) - <span class="number">1</span></span><br><span class="line">                monthly_payment = numerator / denominator</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è®¡ç®—æ€»é¢</span></span><br><span class="line">            total_payment = monthly_payment * total_months</span><br><span class="line">            total_interest = total_payment - principal</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="string">f&quot; è´·æ¬¾æœ¬é‡‘: <span class="subst">&#123;principal:,<span class="number">.2</span>f&#125;</span> å…ƒ\n&quot;</span></span><br><span class="line">                <span class="string">f&quot; å¹´åˆ©ç‡: <span class="subst">&#123;annual_rate_percent&#125;</span>%\n&quot;</span></span><br><span class="line">                <span class="string">f&quot; è´·æ¬¾æœŸé™: <span class="subst">&#123;years&#125;</span> å¹´ (<span class="subst">&#123;total_months&#125;</span> æœŸ)\n&quot;</span></span><br><span class="line">                <span class="string">f&quot; æ¯æœˆæœˆä¾›: <span class="subst">&#123;monthly_payment:,<span class="number">.2</span>f&#125;</span> å…ƒ\n&quot;</span></span><br><span class="line">                <span class="string">f&quot; æ€»åˆ©æ¯: <span class="subst">&#123;total_interest:,<span class="number">.2</span>f&#125;</span> å…ƒ\n&quot;</span></span><br><span class="line">                <span class="string">f&quot; æœ¬æ¯åˆè®¡: <span class="subst">&#123;total_payment:,<span class="number">.2</span>f&#125;</span> å…ƒ&quot;</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;è®¡ç®—å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>åªè¦åœ¨è°ƒç”¨æ—¶ç¤ºä¾‹åŒ–å¹¶åŠ å…¥ Tool åˆ—è¡¨å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">calculator_tool = LoanCalculatorTool()</span><br><span class="line">tools = [weather_tool, calculator_tool]</span><br></pre></td></tr></table></figure><h4 id="test"><a class="markdownIt-Anchor" href="#test"></a> Test</h4><p>æˆ‘ä»¬å¯¹ä¸Šè¿° Agent è¿›è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">================ Human Message ===============</span><br><span class="line"></span><br><span class="line">è´· 100 ä¸‡ï¼Œ30 å¹´ï¼Œåˆ©ç‡ 3.25%ï¼Œæ¯æœˆæœˆä¾›å¤šå°‘ï¼Ÿå¦å¤–ï¼ŒåŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ</span><br><span class="line">================ Ai Message ===============</span><br><span class="line">Tool Calls:</span><br><span class="line">  calculate_loan_payment (call_2f9e1a62ae0f42cab0eabd)</span><br><span class="line"> Call ID: call_2f9e1a62ae0f42cab0eabd</span><br><span class="line">  Args:</span><br><span class="line">    principal: 1000000</span><br><span class="line">    annual_rate_percent: 3.25</span><br><span class="line">    years: 30</span><br><span class="line">  get_real_weather (call_05f08c54e13747b4b6513d)</span><br><span class="line"> Call ID: call_05f08c54e13747b4b6513d</span><br><span class="line">  Args:</span><br><span class="line">    city: Beijing</span><br><span class="line">================ Tool Message ================</span><br><span class="line">Name: calculate_loan_payment</span><br><span class="line"></span><br><span class="line"> è´·æ¬¾æœ¬é‡‘: 1,000,000.00 å…ƒ</span><br><span class="line"> å¹´åˆ©ç‡: 3.25%</span><br><span class="line"> è´·æ¬¾æœŸé™: 30 å¹´ (360 æœŸ)</span><br><span class="line"> æ¯æœˆæœˆä¾›: 4,352.06 å…ƒ</span><br><span class="line"> æ€»åˆ©æ¯: 566,742.75 å…ƒ</span><br><span class="line"> æœ¬æ¯åˆè®¡: 1,566,742.75 å…ƒ</span><br><span class="line">================ Tool Message ================</span><br><span class="line">Name: get_real_weather</span><br><span class="line"></span><br><span class="line">ã€Beijing å®æ—¶å¤©æ°”ã€‘</span><br><span class="line">- çŠ¶å†µ: æ™´</span><br><span class="line">- æ¸©åº¦: -4.06Â°C</span><br><span class="line">- æ¹¿åº¦: 17%</span><br><span class="line">- é£é€Ÿ: 7.74 m/s</span><br><span class="line">================= Ai Message ================</span><br><span class="line"></span><br><span class="line">æ‚¨çš„è´·æ¬¾æ¯æœˆæœˆä¾›ä¸º 4,352.06 å…ƒã€‚ä¸‹é¢æ˜¯è¯¦ç»†ä¿¡æ¯ï¼š</span><br><span class="line">- è´·æ¬¾æœ¬é‡‘: 1,000,000.00 å…ƒ</span><br><span class="line">- å¹´åˆ©ç‡: 3.25%</span><br><span class="line">- è´·æ¬¾æœŸé™: 30 å¹´ (360 æœŸ)</span><br><span class="line">- æ€»åˆ©æ¯: 566,742.75 å…ƒ</span><br><span class="line">- æœ¬æ¯åˆè®¡: 1,566,742.75 å…ƒ</span><br><span class="line"></span><br><span class="line">åŒ—äº¬ä»Šå¤©çš„å®æ—¶å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š</span><br><span class="line">- çŠ¶å†µ: æ™´</span><br><span class="line">- æ¸©åº¦: -4.06Â°C</span><br><span class="line">- æ¹¿åº¦: 17%</span><br><span class="line">- é£é€Ÿ: 7.74 m/s</span><br><span class="line"></span><br><span class="line">è¯·æ³¨æ„ä¿æš–ï¼Œå¤–å‡ºæ—¶å¯èƒ½éœ€è¦æºå¸¦å¤–å¥—ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;å°è¯•ä½¿ç”¨LangChainçš„AgentsåŠŸèƒ½ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ -Python" scheme="https://atffang.github.io/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-Python/"/>
    
    
  </entry>
  
  <entry>
    <title>LangChainå­¦ä¹ æ—¥å¿—: RAG</title>
    <link href="https://atffang.github.io/2026/01/09/langchainRAG/"/>
    <id>https://atffang.github.io/2026/01/09/langchainRAG/</id>
    <published>2026-01-09T02:12:47.000Z</published>
    <updated>2026-01-10T14:29:32.001Z</updated>
    
    <content type="html"><![CDATA[<p>å°è¯•ä½¿ç”¨LangChainæ¥å®ç°RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰åŠŸèƒ½ã€‚</p><span id="more"></span><h3 id="ragç®€ä»‹"><a class="markdownIt-Anchor" href="#ragç®€ä»‹"></a> RAGç®€ä»‹</h3><p>æœ¬æ–‡å°†ç®€å•ä»‹ç»<span style="color: #BB8ED0; font-weight: bold;">RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</span>åœ¨LangChainä¸­çš„å®ç°</p><p>RAGæ˜¯ä¸€ç§å°†<strong>æ£€ç´¢æŠ€æœ¯</strong>ä¸<strong>ç”ŸæˆæŠ€æœ¯</strong>ç›¸ç»“åˆçš„æ¶æ„ï¼Œå½“ç”¨æˆ·æå‡ºé—®é¢˜æ—¶ï¼ŒRAG ç³»ç»Ÿé¦–å…ˆä»å¤–éƒ¨çŸ¥è¯†åº“ä¸­æ£€ç´¢å‡ºä¸é—®é¢˜ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µï¼Œç„¶åå°†è¿™äº›ç‰‡æ®µä¸ç”¨æˆ·çš„é—®é¢˜ä¸€èµ·å–‚ç»™å¤§æ¨¡å‹ï¼Œä»¥åŸºäºå‚è€ƒèµ„æ–™ç»™å‡ºæ›´å‡†ç¡®ã€æ›´å®æ—¶çš„å›ç­”ã€‚</p><p>åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„è§†è§’ä¸‹ï¼Œäººç±»çŸ¥è¯†è¢«åˆ†ä¸ºä¸¤ç§å½¢æ€ï¼š</p><ol><li><p><span style="color: #89986D; font-weight: bold;">å‚æ•°åŒ–è®°å¿†ï¼ˆParametric Memoryï¼‰ï¼šæŒ‡æ¨¡å‹åœ¨é¢„è®­ç»ƒé˜¶æ®µé€šè¿‡æµ·é‡æ–‡æœ¬å­¦ä¹ åˆ°çš„ã€å›ºåŒ–åœ¨ç¥ç»å…ƒæƒé‡ï¼ˆParametersï¼‰ä¸­çš„çŸ¥è¯†ã€‚</span></p></li><li><p><span style="color: #89986D; font-weight: bold;">éå‚æ•°åŒ–è®°å¿†ï¼ˆNon-parametric Memoryï¼‰ï¼šæŒ‡æ¨¡å‹ä¹‹å¤–çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–çŸ¥è¯†åº“ï¼ˆå¦‚ç»´åŸºç™¾ç§‘ã€ä¼ä¸šç§æœ‰æ–‡æ¡£ï¼‰ã€‚</span></p></li></ol><p><strong>RAG</strong>çš„æœ¬è´¨ï¼Œå°±æ˜¯å°†è¿™ä¸¤ç§è®°å¿†ç»“åˆï¼Œé€šè¿‡ä¸€ä¸ª<strong>å¾®åˆ†è®¿é—®æœºåˆ¶ï¼ˆDifferentiable Access Mechanismï¼‰</strong>ï¼Œè®©æ¨¡å‹åœ¨ç”Ÿæˆå›ç­”å‰ï¼Œå…ˆå»â€œç¿»é˜…â€å¤–éƒ¨çš„éå‚æ•°åŒ–è®°å¿†ã€‚</p><h4 id="rag-çš„æ•°å­¦å½¢å¼åŒ–å®šä¹‰"><a class="markdownIt-Anchor" href="#rag-çš„æ•°å­¦å½¢å¼åŒ–å®šä¹‰"></a> RAG çš„æ•°å­¦å½¢å¼åŒ–å®šä¹‰</h4><p>åœ¨åŸå§‹è®ºæ–‡ä¸­ï¼ˆå³æ¥è‡ªçš„ NeurIPS2020 çš„è‘—åè®ºæ–‡<span style="color: #BB8ED0;">Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks</span>ï¼‰ï¼ŒRAG è¢«å®šä¹‰ä¸ºä¸€ä¸ª<strong>éšå˜é‡æ¨¡å‹ï¼ˆLatent Variable Modelï¼‰</strong>ã€‚</p><p>å‡è®¾ç”¨æˆ·è¾“å…¥ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œç³»ç»Ÿæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>ï¼ˆä½œä¸ºéšå˜é‡ï¼‰ï¼Œæœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>ã€‚RAG çš„æ ¸å¿ƒç›®æ ‡æ˜¯è®¡ç®—åœ¨ç»™å®šè¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> çš„æƒ…å†µä¸‹ï¼Œç”Ÿæˆè¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> çš„æ¡ä»¶æ¦‚ç‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(y|x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ã€‚è¿™ä¸€è¿‡ç¨‹ç”±<span style="color: #BB8ED0; font-weight: bold;">æ£€ç´¢ç»„ä»¶ï¼ˆRetrieverï¼‰</span>å’Œ<span style="color: #BB8ED0; font-weight: bold;">ç”Ÿæˆç»„ä»¶ï¼ˆGeneratorï¼‰</span>ç»„æˆã€‚</p><h5 id="retriever"><a class="markdownIt-Anchor" href="#retriever"></a> Retriever</h5><p>æ£€ç´¢å™¨çš„ä»»åŠ¡æ˜¯è®¡ç®—ç»™å®šè¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> æ—¶ï¼Œæ–‡æ¡£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> çš„è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>Î·</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo>âˆ</mo><mi>exp</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">(</mo><mi>z</mi><msup><mo stretchy="false">)</mo><mi mathvariant="normal">âŠ¤</mi></msup><mi>q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_\eta(z|x) \propto \exp(d(z)^\top q(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Î·</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.149108em;vertical-align:-0.25em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">âŠ¤</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">q(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ï¼šæ˜¯ç”± BERT æ„å»ºçš„æŸ¥è¯¢ç¼–ç å™¨ï¼ˆQuery Encoderï¼‰ç”Ÿæˆçš„ç¨ å¯†å‘é‡ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span>ï¼šæ˜¯ç”± BERT æ„å»ºçš„æ–‡æ¡£ç¼–ç å™¨ï¼ˆDocument Encoderï¼‰ç”Ÿæˆçš„æ–‡æ¡£å‘é‡ã€‚</li><li>æ­¤å…¬å¼æœ¬è´¨ä¸Šæ˜¯è®¡ç®—ä¸¤ä¸ªå‘é‡çš„<strong>ç‚¹ç§¯ç›¸ä¼¼åº¦</strong>ã€‚</li></ul><h5 id="generator"><a class="markdownIt-Anchor" href="#generator"></a> Generator</h5><p>ç”Ÿæˆå™¨çš„ä»»åŠ¡æ˜¯æ ¹æ®è¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> å’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>ï¼Œè®¡ç®—ç”Ÿæˆ token <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ¦‚ç‡ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">,</mo><mi>z</mi><mo separator="true">,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>:</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_\theta(y_i | x, z, y_{1:i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">:</span><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>è¿™é€šå¸¸ç”±ä¸€ä¸ªé¢„è®­ç»ƒçš„ Seq2Seq æ¨¡å‹ï¼ˆå¦‚è®ºæ–‡ä¸­çš„ BARTï¼‰æ¥å®Œæˆã€‚</p><h4 id="ä¸¤ç§-rag-å»ºæ¨¡èŒƒå¼"><a class="markdownIt-Anchor" href="#ä¸¤ç§-rag-å»ºæ¨¡èŒƒå¼"></a> ä¸¤ç§ RAG å»ºæ¨¡èŒƒå¼</h4><p>è®ºæ–‡æå‡ºäº†ä¸¤ç§å¤„ç†éšå˜é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> çš„æ–¹å¼ï¼Œè¿™ç›´æ¥å†³å®šäº† RAG ç³»ç»Ÿçš„è¿è¡Œé€»è¾‘ã€‚</p><h5 id="rag-sequenceåºåˆ—åŒ–æ£€ç´¢å¢å¼º"><a class="markdownIt-Anchor" href="#rag-sequenceåºåˆ—åŒ–æ£€ç´¢å¢å¼º"></a> RAG-Sequenceï¼šåºåˆ—åŒ–æ£€ç´¢å¢å¼º</h5><p>è¯¥æ¨¡å‹å‡è®¾ä¸€æ•´ä¸ªåºåˆ—çš„ç”Ÿæˆåªä¾èµ–äºåŒä¸€ç¯‡æ–‡æ¡£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>ã€‚æ¨¡å‹ä¼šå…ˆä¸ºæ¯ä¸ªæ£€ç´¢åˆ°çš„æ–‡æ¡£è®¡ç®—å®Œæ•´çš„ç”Ÿæˆæ¦‚ç‡ï¼Œæœ€åè¿›è¡ŒåŠ æƒæ±‚å’Œã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mtext>RAG-Sequence</mtext></msub><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo>â‰ˆ</mo><munder><mo>âˆ‘</mo><mrow><mi>z</mi><mo>âˆˆ</mo><mtext>top-k</mtext><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mo>â‹…</mo><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></munder><msub><mi>p</mi><mi>Î·</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><munderover><mo>âˆ</mo><mi>i</mi><mi>N</mi></munderover><msub><mi>p</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">,</mo><mi>z</mi><mo separator="true">,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>:</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_{\text{RAG-Sequence}}(y|x) \approx \sum_{z \in \text{top-k}(p(\cdot|x))} p_\eta(z|x) \prod_i^N p_\theta(y_i|x, z, y_{1:i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">RAG-Sequence</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.344341em;vertical-align:-1.516005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="mrel mtight">âˆˆ</span><span class="mord text mtight"><span class="mord mtight">top-k</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight">â‹…</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Î·</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">:</span><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><h5 id="rag-tokentoken-çº§æ£€ç´¢å¢å¼º"><a class="markdownIt-Anchor" href="#rag-tokentoken-çº§æ£€ç´¢å¢å¼º"></a> RAG-Tokenï¼šToken çº§æ£€ç´¢å¢å¼º</h5><p>è¯¥æ¨¡å‹æ›´åŠ çµæ´»ï¼Œå…è®¸åœ¨ç”Ÿæˆæ¯ä¸€ä¸ªè¯ï¼ˆTokenï¼‰æ—¶ï¼Œéƒ½å‚è€ƒä¸åŒçš„æ–‡æ¡£ã€‚è¿™æ„å‘³ç€æœ€ç»ˆç”Ÿæˆçš„å¥å­å¯èƒ½æ˜¯ç”±å¤šç¯‡æ–‡æ¡£å…±åŒæ”¯æ’‘çš„ã€‚</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mtext>RAG-Token</mtext></msub><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo>â‰ˆ</mo><munderover><mo>âˆ</mo><mi>i</mi><mi>N</mi></munderover><munder><mo>âˆ‘</mo><mrow><mi>z</mi><mo>âˆˆ</mo><mtext>top-k</mtext><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">(</mo><mo>â‹…</mo><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></munder><msub><mi>p</mi><mi>Î·</mi></msub><mo stretchy="false">(</mo><mi>z</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo><msub><mi>p</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">,</mo><mi>z</mi><mo separator="true">,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>:</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_{\text{RAG-Token}}(y|x) \approx \prod_i^N \sum_{z \in \text{top-k}(p(\cdot|x))} p_\eta(z|x) p_\theta(y_i|x, z, y_{1:i-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">RAG-Token</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.344341em;vertical-align:-1.516005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="mrel mtight">âˆˆ</span><span class="mord text mtight"><span class="mord mtight">top-k</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight">â‹…</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Î·</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">:</span><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><h4 id="æŠ€æœ¯æµç¨‹"><a class="markdownIt-Anchor" href="#æŠ€æœ¯æµç¨‹"></a> æŠ€æœ¯æµç¨‹</h4><p>åŸºäºä¸Šè¿°åŸç†ï¼Œä¸€ä¸ªæ ‡å‡†çš„ RAG å·¥ä½œæµå¯ä»¥è¢«æ‹†è§£ä¸ºä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œè¿™ä¹Ÿæ˜¯åç»­ç« èŠ‚æˆ‘ä»¬å°†ä½¿ç”¨ LangChain å®ç°çš„æ ¸å¿ƒæµç¨‹ï¼š</p><ol><li><span style="color: #BB8ED0; font-weight: bold;">ç´¢å¼•ï¼ˆIndexingï¼‰</span>ï¼šå°†éå‚æ•°åŒ–è®°å¿†ï¼ˆæ–‡æ¡£ï¼‰åˆ‡å—å¹¶è½¬åŒ–ä¸ºå‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span>ã€‚</li><li><span style="color: #BB8ED0; font-weight: bold;">æ£€ç´¢ï¼ˆRetrievalï¼‰</span>ï¼šæ ¹æ®ç”¨æˆ·æŸ¥è¯¢ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">q(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>ï¼Œåœ¨å‘é‡ç©ºé—´ä¸­å¯»æ‰¾æœ€ç›¸ä¼¼çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>o</mi><mi>p</mi><mo>âˆ’</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">Top-K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªæ–‡æ¡£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>ã€‚</li><li><span style="color: #BB8ED0; font-weight: bold;">å¢å¼ºï¼ˆAugmentationï¼‰</span>ï¼šå°† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> ä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> æ‹¼æ¥ï¼Œæ„å»ºå‡ºå†…å®¹ä¸°å¯Œçš„ Promptã€‚</li><li><span style="color: #BB8ED0; font-weight: bold;">ç”Ÿæˆï¼ˆGenerationï¼‰</span>ï¼šLLM åŸºäºå¢å¼ºåçš„ä¿¡æ¯ï¼Œè®¡ç®— <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(y|x, z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">âˆ£</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> å¹¶è¾“å‡ºç­”æ¡ˆã€‚</li><li><span style="color: #BB8ED0; font-weight: bold;">å¼•ç”¨ï¼ˆCitationï¼‰</span>ï¼šç”±äºæˆ‘ä»¬å¯ä»¥è¿½è¸ªåˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>ï¼Œç³»ç»Ÿå¯ä»¥ç»™å‡ºç­”æ¡ˆçš„å‡ºå¤„ï¼Œæ˜¾è‘—æå‡å¯ä¿¡åº¦ã€‚</li></ol><p>å¤§æ¦‚äº†è§£RAGä¹‹åï¼Œæˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªæœ€æœ€ç®€å•çš„åŸºäºLangChainçš„RAGåº”ç”¨çš„ä¾‹å­â¬‡ï¸</p><h3 id="infra"><a class="markdownIt-Anchor" href="#infra"></a> Infra</h3><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Python + Postgresqlè¿›è¡Œæ„å»ºã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦ä¸€ä¸ªå®‰è£…äº† <code>pgvector</code> æ‰©å±•çš„ PostgreSQL å®ä¾‹ã€‚å…ˆå®‰è£…<code>pgvector</code>ï¼Œä»¥æˆ‘çš„macä¸ºä¾‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install pgvector</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹æˆ‘ä»¬çš„ç›®æ ‡æ•°æ®åº“æ·»åŠ æ‹“å±•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> EXTENSION IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> vector;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å®‰è£… LangChain çš„æ ¸å¿ƒåŒ…ã€PostgreSQL é©±åŠ¨ä»¥åŠé˜¿é‡Œé€šä¹‰çš„ SDKã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install langchain langchain-community langchain-postgres </span><br><span class="line">pip install psycopg2-binary dashscope</span><br></pre></td></tr></table></figure><p>å¤–åŠ ä¸€äº›æ–‡æ¡£åŠ è½½åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pypdf docx2txt</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®é¢„å¤„ç†å…¥åº“"><a class="markdownIt-Anchor" href="#æ•°æ®é¢„å¤„ç†å…¥åº“"></a> æ•°æ®é¢„å¤„ç†å…¥åº“</h3><p>è¿™ä¸€æ­¥å®ç°äº† RAG åŸç†ä¸­çš„éå‚æ•°åŒ–è®°å¿†ï¼ˆNon-parametric Memoryï¼‰æ„å»ºè¿‡ç¨‹ã€‚æˆ‘ä»¬éœ€è¦å°†åŸå§‹æ–‡æ¡£è½¬åŒ–ä¸ºæ£€ç´¢å™¨ï¼ˆRetrieverï¼‰å¯ä»¥è¯†åˆ«çš„å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span>ã€‚</p><p>LangChain æä¾›äº†ä¸°å¯Œçš„ <code>document_loaders</code>ï¼Œä»¥æœ€å¸¸è§çš„txtã€pdfã€wordä¸ºä¾‹ï¼š</p><p><span style="color: #89986D; font-weight: bold;">txt</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> TextLoader</span><br><span class="line"></span><br><span class="line">loader = TextLoader(<span class="string">&quot;./data/example.txt&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">txt_docs = loader.load()</span><br></pre></td></tr></table></figure><p><span style="color: #89986D; font-weight: bold;">pdf</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> PyPDFLoader</span><br><span class="line"></span><br><span class="line">loader = PyPDFLoader(<span class="string">&quot;./data/example.pdf&quot;</span>)</span><br><span class="line">pdf_docs = loader.load()</span><br></pre></td></tr></table></figure><p><span style="color: #89986D; font-weight: bold;">word</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> Docx2txtLoader</span><br><span class="line"></span><br><span class="line">loader = Docx2txtLoader(<span class="string">&quot;./data/example.docx&quot;</span>)</span><br><span class="line">word_docs = loader.load()</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†æœ¬ç²¾ç¾çš„å®¶ç”¨èœè°±å¤§å…¨pdfï¼š</p><img src="/2026/01/09/langchainRAG/pdf.png" class="" title="sucessful"><p>çœ‹é¥¿äº†ã€‚</p><p>å¯¹äºä¸­æ–‡ RAGï¼Œæˆ‘ä»¬ä½¿ç”¨<span style="color: #BB8ED0; font-weight: bold;">BGE (BAAI General Embedding)</span>å¼€æºæ¨¡å‹ï¼Œå…ˆä¸‹è½½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install sentence-transformers</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ langchain åŠ è½½pdfæ–‡æ¡£ï¼Œåˆ‡åˆ†ï¼Œå¹¶å­˜å…¥æ•°æ®åº“ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> PyPDFLoader</span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_postgres.vectorstores <span class="keyword">import</span> PGVector</span><br><span class="line"></span><br><span class="line">FILE_PATH = <span class="string">&quot;/Users/fangtianyao/Downloads/å®¶åº­å®ç”¨èœè°±å¤§å…¨.pdf&quot;</span></span><br><span class="line">CONNECTION_STRING = <span class="string">&quot;postgresql+psycopg2://postgres:postgres@localhost:5432/rag&quot;</span></span><br><span class="line">COLLECTION_NAME = <span class="string">&quot;recipe_collection_bge&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. åŠ è½½æœ¬åœ° Embedding æ¨¡å‹ (BGE-small-zh)</span></span><br><span class="line">    embeddings = HuggingFaceEmbeddings(</span><br><span class="line">        model_name=<span class="string">&quot;BAAI/bge-small-zh-v1.5&quot;</span>,</span><br><span class="line">        model_kwargs=&#123;<span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;cpu&#x27;</span>&#125;,</span><br><span class="line">        encode_kwargs=&#123;<span class="string">&#x27;normalize_embeddings&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. åŠ è½½ PDF</span></span><br><span class="line">    loader = PyPDFLoader(FILE_PATH)</span><br><span class="line">    documents = loader.load()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. åˆ‡åˆ†æ–‡æ¡£</span></span><br><span class="line">    text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">600</span>, chunk_overlap=<span class="number">50</span>)</span><br><span class="line">    chunks = text_splitter.split_documents(documents)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. å­˜å…¥ PostgreSQL</span></span><br><span class="line">    vector_store = PGVector.from_documents(</span><br><span class="line">        embedding=embeddings,</span><br><span class="line">        documents=chunks,</span><br><span class="line">        collection_name=COLLECTION_NAME,</span><br><span class="line">        connection=CONNECTION_STRING,</span><br><span class="line">        use_jsonb=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>LangChainä¼šè‡ªåŠ¨åˆ›å»º <code>langchain_pg_embedding</code> å’Œ <code>langchain_pg_collection</code> ä¸¤ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­ <code>embedding</code> å­—æ®µä¼šè¢«å®šä¹‰ä¸º <code>vector</code> ç±»å‹ã€‚</p><h3 id="ç®€å•çš„ragå¯¹è¯"><a class="markdownIt-Anchor" href="#ç®€å•çš„ragå¯¹è¯"></a> ç®€å•çš„RAGå¯¹è¯</h3><p>æˆ‘ä»¬å‚è€ƒæ–‡æ¡£<a href="https://docs.langchain.com/oss/python/integrations/chat/tongyi">https://docs.langchain.com/oss/python/integrations/chat/tongyi</a> ï¼ŒåŸºäºé˜¿é‡Œäº‘çš„ <span style="color: #BB8ED0; font-weight: bold;">ChatTongyi</span> æ„å»ºRAGæœåŠ¡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé˜¿é‡Œäº‘çš„æ¨¡å‹å¯é€‰æ‹©æ€§å¾ˆé«˜ã€‚</p><img src="/2026/01/09/langchainRAG/aliyun.png" class="" title="sucessful"><p>ç”³è¯·ä¸€ä¸ªé˜¿é‡Œäº‘ç™¾ç‚¼çš„ API-Key ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚æˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹LangChainè°ƒç”¨é˜¿é‡Œäº‘APIçš„èƒ½åŠ›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models <span class="keyword">import</span> ChatTongyi</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® API Key</span></span><br><span class="line">os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>] = <span class="string">&quot;********&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">llm = ChatTongyi(model_name=<span class="string">&quot;qwen-max&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•çš„æµ‹è¯•é“¾è·¯</span></span><br><span class="line">prompt = ChatPromptTemplate.from_template(<span class="string">&quot;è®²ä¸ªå…³äº&#123;topic&#125;çš„ç¬‘è¯&quot;</span>)</span><br><span class="line">chain = prompt | llm | StrOutputParser()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(chain.invoke(&#123;<span class="string">&quot;topic&quot;</span>: <span class="string">&quot;ç¨‹åºå‘˜&quot;</span>&#125;))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å½“ç„¶å¯ä»¥ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç¨‹åºå‘˜å¯èƒ½ä¼šä¼šå¿ƒä¸€ç¬‘çš„ç¬‘è¯ï¼š</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆç¨‹åºå‘˜ä¸å–œæ¬¢åœ¨æˆ·å¤–å·¥ä½œï¼Ÿ</span><br><span class="line">å› ä¸ºé‚£é‡Œæœ‰å¤ªå¤šçš„ bugsï¼ˆè™«å­/é”™è¯¯ï¼‰ï¼</span><br><span class="line"></span><br><span class="line">è¿™é‡Œçš„â€œbugsâ€ä¸€è¯åŒå…³ï¼Œæ—¢æŒ‡è‡ªç„¶ç•Œä¸­çš„æ˜†è™«ï¼Œä¹ŸæŒ‡ç¼–ç¨‹ä¸­é‡åˆ°çš„ç¨‹åºé”™è¯¯ã€‚å¸Œæœ›è¿™ä¸ªå°ç¬‘è¯èƒ½ç»™ä½ å¸¦æ¥ä¸€ä¸è½»æ¾å’Œå¿«ä¹ï¼</span><br></pre></td></tr></table></figure><p>å¥½æ— èŠçš„ç¬‘è¯â€¦â€¦ï¼Œä¸è¿‡è‡³å°‘è¯æ˜æˆ‘ä»¬æµ‹è¯•æˆåŠŸäº†ï¼é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¹‹å‰æ„å»ºçš„å‘é‡æ•°æ®åº“ã€‚å¯¼å…¥åŒ…ï¼Œè¿æ¥æ•°æ®åº“ï¼Œå¹¶åˆå§‹åŒ–å’Œå…¥åº“æ—¶ä¸€è‡´çš„ Embedding æ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models <span class="keyword">import</span> ChatTongyi</span><br><span class="line"><span class="keyword">from</span> langchain_postgres.vectorstores <span class="keyword">import</span> PGVector</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnablePassthrough</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>] = <span class="string">&quot;******&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“é…ç½®</span></span><br><span class="line">CONNECTION_STRING = <span class="string">&quot;postgresql+psycopg2://postgres:postgres@localhost:5432/rag&quot;</span></span><br><span class="line">COLLECTION_NAME = <span class="string">&quot;recipe_collection_bge&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– Embedding æ¨¡å‹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨åŠ è½½æœ¬åœ° BGE æ¨¡å‹...&quot;</span>)</span><br><span class="line">embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;BAAI/bge-small-zh-v1.5&quot;</span>,</span><br><span class="line">    model_kwargs=&#123;<span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;cpu&#x27;</span>&#125;,</span><br><span class="line">    encode_kwargs=&#123;<span class="string">&#x27;normalize_embeddings&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥ç°æœ‰çš„å‘é‡æ•°æ®åº“</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨è¿æ¥æ•°æ®åº“é›†åˆ: <span class="subst">&#123;COLLECTION_NAME&#125;</span>...&quot;</span>)</span><br><span class="line">vector_store = PGVector(</span><br><span class="line">    connection=CONNECTION_STRING,</span><br><span class="line">    embeddings=embeddings,</span><br><span class="line">    collection_name=COLLECTION_NAME,</span><br><span class="line">    use_jsonb=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ£€ç´¢å™¨ (Retriever)</span></span><br><span class="line">retriever = vector_store.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>retriever = vector_store.as_retriever(search_kwargs=&#123;&quot;k&quot;: 3&#125;)</code> åˆ›å»ºäº†æ£€ç´¢å™¨ï¼Œè€Œå‚æ•° <code>&quot;k&quot;: 3</code> ä»£è¡¨äº†è¡¨ç¤ºæ¯æ¬¡æ£€ç´¢æœ€ç›¸ä¼¼çš„ 3 æ¡è®°å½•ã€‚éšåï¼Œå®šä¹‰ LLM å’Œ Promptï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ LLM å’Œ Prompt (LCEL é£æ ¼) </span></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–é€šä¹‰åƒé—® (Qwen-Max)</span></span><br><span class="line">llm = ChatTongyi(model_name=<span class="string">&quot;qwen-max&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™æç¤ºè¯æ¨¡æ¿</span></span><br><span class="line">template = <span class="string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½å¤§å¨ã€‚è¯·åŸºäºä¸‹é¢çš„ã€å‚è€ƒèµ„æ–™ã€‘å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚</span></span><br><span class="line"><span class="string">å¦‚æœå‚è€ƒèµ„æ–™é‡Œæ²¡æœ‰æåˆ°çš„å†…å®¹ï¼Œè¯·è¯šå®åœ°è¯´â€œèµ„æ–™ä¸­æœªæåŠâ€ï¼Œä¸è¦ç¼–é€ ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ã€å‚è€ƒèµ„æ–™ã€‘ï¼š</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ã€ç”¨æˆ·é—®é¢˜ã€‘ï¼š</span></span><br><span class="line"><span class="string">&#123;question&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">prompt = ChatPromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾…åŠ©å‡½æ•°ï¼šå°†æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ—è¡¨åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_docs</span>(<span class="params">docs</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n\n&quot;</span>.join([doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs])</span><br></pre></td></tr></table></figure><p>æ„å»º RAG é“¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rag_chain = (</span><br><span class="line">    &#123;<span class="string">&quot;context&quot;</span>: retriever | format_docs, <span class="string">&quot;question&quot;</span>: RunnablePassthrough()&#125;</span><br><span class="line">    | prompt</span><br><span class="line">    | llm</span><br><span class="line">    | StrOutputParser()</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ã€‚ä¸Šè¿°ä»£ç ä½¿ç”¨çš„æ˜¯ <strong>LCELï¼ˆLangChain Expression Languageï¼Œè¡¨è¾¾å¼è¯­è¨€ï¼‰</strong>ï¼Œ<code>|</code> ç¬¦å·pipelineä¸­æ¯ä¸€é“å·¥åºçš„é—´éš”ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªé“¾æ‹†è§£æˆä¸‰ä¸ªé˜¶æ®µï¼š</p><p><span style="color: #89986D; font-weight: bold;">STEP1 æ•°æ®å¹¶è¡Œå¤„ç†</span>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;context&quot;</span>: retriever | format_docs, <span class="string">&quot;question&quot;</span>: RunnablePassthrough()&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªå­—å…¸ã€‚å½“ä½ è°ƒç”¨ <code>rag_chain.invoke(&quot;å¦‚ä½•åšçº¢çƒ§è‚‰ï¼Ÿ&quot;)</code> æ—¶ï¼Œè¿™ä¸ªåˆå§‹å­—ç¬¦ä¸²ä¼š<strong>åŒæ—¶</strong>å–‚ç»™ä¸¤ä¸ªåˆ†æ”¯ï¼š</p><ul><li><strong><code>question</code> åˆ†æ”¯</strong>ï¼š<ul><li><code>RunnablePassthrough()</code> ä¸å¯¹è¾“å…¥åšä»»ä½•å¤„ç†ï¼Œç›´æ¥æŠŠâ€œå¦‚ä½•åšçº¢çƒ§è‚‰ï¼Ÿâ€åŸæ ·ä¼ ç»™ <code>question</code> å­—æ®µã€‚</li></ul></li><li><strong><code>context</code> åˆ†æ”¯</strong>ï¼ˆè¿™æ˜¯ä¸€ä¸ªå­é“¾ï¼‰ï¼š<ul><li><strong>ç¬¬ä¸€æ­¥</strong>ï¼š<code>retriever</code> æ¥æ”¶åˆ°é—®é¢˜ï¼Œå» PostgreSQL å‘é‡åº“é‡Œå¯»æ‰¾æœ€ç›¸ä¼¼çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªæ–‡æ¡£ç‰‡æ®µï¼ˆæ­¤æ—¶è¾“å‡ºçš„æ˜¯ä¸€ä¸ª <code>Document</code> å¯¹è±¡åˆ—è¡¨ï¼‰ã€‚</li><li><strong>ç¬¬äºŒæ­¥</strong>ï¼šé€šè¿‡ <code>|</code> ä¼ ç»™ <code>format_docs</code> å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æŠŠå¤šä¸ªæ–‡æ¡£å¯¹è±¡é‡Œçš„æ–‡å­—æç‚¼å‡ºæ¥ï¼Œæ‹¼æ¥æˆä¸€ä¸ªå¤§å­—ç¬¦ä¸²ã€‚</li><li>æœ€ç»ˆ <code>context</code> å­—æ®µå¾—åˆ°äº†åº“é‡Œçš„èœè°±çŸ¥è¯†ã€‚</li></ul></li></ul><p><span style="color: #89986D; font-weight: bold;">STEP2 æ¨ç†</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">... </span>| prompt | llm</span><br></pre></td></tr></table></figure><ul><li><strong>æ³¨å…¥ Prompt (<code>| prompt</code>)</strong>ï¼š<ul><li>æ­¤æ—¶ï¼Œå‰é¢çš„è¾“å‡ºæ˜¯ä¸€ä¸ªå­—å…¸ï¼š<code>&#123;&quot;context&quot;: &quot;...&quot;, &quot;question&quot;: &quot;å¦‚ä½•åšçº¢çƒ§è‚‰ï¼Ÿ&quot;&#125;</code>ã€‚<code>ChatPromptTemplate</code> ä¼šè‡ªåŠ¨å¯»æ‰¾å¯¹åº”çš„å˜é‡ï¼ŒæŠŠå®ƒä»¬å¡«å…¥ä½ å®šä¹‰çš„æ¨¡æ¿ä¸­ï¼Œç”Ÿæˆä¸€æ®µå‘ç»™ AI çš„å®Œæ•´æŒ‡ä»¤ã€‚</li></ul></li><li><strong>è°ƒç”¨å¤§æ¨¡å‹ (<code>| llm</code>)</strong>ï¼š<ul><li>å°†å¡«å……å¥½çš„æŒ‡ä»¤ä¼ ç»™é€šä¹‰åƒé—® <code>ChatTongyi</code>ã€‚</li></ul></li></ul><p><span style="color: #89986D; font-weight: bold;">STEP3 è¾“å‡ºè§£æ</span>ï¼š</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">... </span>| StrOutputParser()</span><br></pre></td></tr></table></figure><p><code>StrOutputParser()</code> ä¼šä»LLMè¿”å›çš„ <code>AIMessage</code> å¯¹è±¡ä¸­æå– <code>content</code> å±æ€§ã€‚</p><p>æœ€åï¼Œåªè¦è°ƒç”¨ <code>rag_chain.stream()</code>ï¼Œå°±èƒ½è·å¾—æµå¼è¾“å‡ºçš„å›ç­”ã€‚ç»™å‡ºå®Œæ•´çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain_community.chat_models <span class="keyword">import</span> ChatTongyi</span><br><span class="line"><span class="keyword">from</span> langchain_postgres.vectorstores <span class="keyword">import</span> PGVector</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnablePassthrough</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;DASHSCOPE_API_KEY&quot;</span>] = <span class="string">&quot;sk-873463eacac84219b830314fb5f10992&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®åº“é…ç½®</span></span><br><span class="line">CONNECTION_STRING = <span class="string">&quot;postgresql+psycopg2://postgres:postgres@localhost:5432/rag&quot;</span></span><br><span class="line">COLLECTION_NAME = <span class="string">&quot;recipe_collection_bge&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– Embedding æ¨¡å‹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨åŠ è½½æœ¬åœ° BGE æ¨¡å‹...&quot;</span>)</span><br><span class="line">embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;BAAI/bge-small-zh-v1.5&quot;</span>,</span><br><span class="line">    model_kwargs=&#123;<span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;cpu&#x27;</span>&#125;,</span><br><span class="line">    encode_kwargs=&#123;<span class="string">&#x27;normalize_embeddings&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥ç°æœ‰çš„å‘é‡æ•°æ®åº“</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨è¿æ¥æ•°æ®åº“é›†åˆ: <span class="subst">&#123;COLLECTION_NAME&#125;</span>...&quot;</span>)</span><br><span class="line">vector_store = PGVector(</span><br><span class="line">    connection=CONNECTION_STRING,</span><br><span class="line">    embeddings=embeddings,</span><br><span class="line">    collection_name=COLLECTION_NAME,</span><br><span class="line">    use_jsonb=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ£€ç´¢å™¨ (Retriever)</span></span><br><span class="line"><span class="comment"># k=3 è¡¨ç¤ºæ¯æ¬¡æ£€ç´¢æœ€ç›¸ä¼¼çš„ 3 æ¡èœè°±</span></span><br><span class="line">retriever = vector_store.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ LLM å’Œ Prompt (LCEL é£æ ¼) </span></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–é€šä¹‰åƒé—® (Qwen-Max)</span></span><br><span class="line">llm = ChatTongyi(model_name=<span class="string">&quot;qwen-max&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™æç¤ºè¯æ¨¡æ¿</span></span><br><span class="line">template = <span class="string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½å¤§å¨ã€‚è¯·åŸºäºä¸‹é¢çš„ã€å‚è€ƒèµ„æ–™ã€‘å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚</span></span><br><span class="line"><span class="string">å¦‚æœå‚è€ƒèµ„æ–™é‡Œæ²¡æœ‰æåˆ°çš„å†…å®¹ï¼Œè¯·è¯šå®åœ°è¯´â€œèµ„æ–™ä¸­æœªæåŠâ€ï¼Œä¸è¦ç¼–é€ ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ã€å‚è€ƒèµ„æ–™ã€‘ï¼š</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ã€ç”¨æˆ·é—®é¢˜ã€‘ï¼š</span></span><br><span class="line"><span class="string">&#123;question&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">prompt = ChatPromptTemplate.from_template(template)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾…åŠ©å‡½æ•°ï¼šå°†æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ—è¡¨åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_docs</span>(<span class="params">docs</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n\n&quot;</span>.join([doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»º RAG é“¾ (The Chain) </span></span><br><span class="line">rag_chain = (</span><br><span class="line">    &#123;<span class="string">&quot;context&quot;</span>: retriever | format_docs, <span class="string">&quot;question&quot;</span>: RunnablePassthrough()&#125;</span><br><span class="line">    | prompt</span><br><span class="line">    | llm</span><br><span class="line">    | StrOutputParser()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå¯¹è¯</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        question = <span class="built_in">input</span>(<span class="string">&quot;\nè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> question.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\næ­£åœ¨æ€è€ƒå¹¶æ£€ç´¢æ•°æ®åº“...&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># ä½¿ç”¨æµå¼è¾“å‡º (Stream) æå‡ä½“éªŒ</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nå›ç­”: &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> rag_chain.stream(question):</span><br><span class="line">                <span class="built_in">print</span>(chunk, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\nå‘ç”Ÿé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¯¢é—®ä»–èœè°±ä¸­çš„èœâ€œæ¯›è›¤æ‹Œè èœâ€æ€ä¹ˆåšï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨: æˆ‘æƒ³åˆ¶ä½œæ¯›è›¤æ‹Œè èœ</span><br><span class="line"></span><br><span class="line">æ­£åœ¨æ€è€ƒå¹¶æ£€ç´¢æ•°æ®åº“...</span><br><span class="line">å›ç­”: æ‚¨æƒ³åˆ¶ä½œçš„æ˜¯â€œæ¯›è›¤æ‹Œè èœâ€ã€‚æ ¹æ®æä¾›çš„å‚è€ƒèµ„æ–™ï¼Œä¸‹é¢æ˜¯å…·ä½“çš„æ­¥éª¤ï¼š</span><br><span class="line"></span><br><span class="line">### ææ–™</span><br><span class="line">- æ¯›è›¤Â·250å…‹</span><br><span class="line">- è èœÂ·250å…‹</span><br><span class="line">- ç”Ÿå§œÂ·1å°å—</span><br><span class="line">- å¤§è’œÂ·4ç“£</span><br><span class="line"></span><br><span class="line">### è°ƒæ–™</span><br><span class="line">- é¦™æ²¹Â·2å°åŒ™</span><br><span class="line">- é¦™é†‹Â·1å°åŒ™</span><br><span class="line">- ç²¾ç›Â·1å°åŒ™</span><br><span class="line">- å‘³ç²¾Â· å°åŒ™</span><br><span class="line"></span><br><span class="line">### åšæ³•</span><br><span class="line">1. **å‡†å¤‡ææ–™**ï¼šé¦–å…ˆå°†æ¯›è›¤ç…®ç†Ÿåå–å‡ºè‚‰å¤‡ç”¨ï¼›åŒæ—¶å°†ç”Ÿå§œå’Œå¤§è’œæ¸…æ´—å¹²å‡€ååˆ‡æˆæœ«ã€‚</span><br><span class="line">2. **å¤„ç†è èœ**ï¼šå°†è èœæ‹©æ´—å¹²å‡€ï¼Œç„¶åæ”¾å…¥æ²¸æ°´ä¸­ç„¯çƒ«ç‰‡åˆ»ã€‚ä¹‹åç”¨å‡‰æ°´å†²å‡‰ä»¥å»é™¤å¤šä½™çš„çƒ­é‡ï¼Œå¹¶ä¸”æ²¥å¹²æ°´åˆ†ååˆ‡æˆæ®µã€‚</span><br><span class="line">3. **è°ƒæ‹Œ**ï¼šå°†å¤„ç†å¥½çš„æ¯›è›¤ã€åˆ‡å¥½çš„è èœä»¥åŠä¹‹å‰å‡†å¤‡çš„è°ƒæ–™ï¼ˆåŒ…æ‹¬ç›ã€é¦™é†‹ã€å‘³ç²¾ã€é¦™æ²¹ã€å§œæœ«å’Œè’œæœ«ï¼‰æ··åˆåœ¨ä¸€èµ·å……åˆ†æ…æ‹Œå‡åŒ€ã€‚</span><br><span class="line">4. **å®Œæˆ**ï¼šæœ€åå°†è°ƒæ‹Œå¥½çš„é£Ÿæè£…ç›˜å³å¯äº«ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œï¼Œæ‚¨å°±èƒ½åšå‡ºä¸€é“å‘³é“é²œç¾ã€æ¸…æ·¡çˆ½å£çš„æ¯›è›¤æ‹Œè èœäº†ã€‚å¸Œæœ›è¿™å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”èœè°±ä¸­çš„åšæ³•ï¼š</p><img src="/2026/01/09/langchainRAG/maoge.png" class="" title="sucessful"><p>éå¸¸æˆåŠŸâœŒï¸</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å°è¯•ä½¿ç”¨LangChainæ¥å®ç°RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰åŠŸèƒ½ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ -Python" scheme="https://atffang.github.io/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-Python/"/>
    
    
  </entry>
  
  <entry>
    <title>è®ºæ–‡ç²¾è¯» DyGLIP: A Dynamic Graph Model with Link Prediction forAccurate Multi-Camera Multiple Object Tracking</title>
    <link href="https://atffang.github.io/2025/12/29/DyGLIP/"/>
    <id>https://atffang.github.io/2025/12/29/DyGLIP/</id>
    <published>2025-12-29T06:53:15.000Z</published>
    <updated>2025-12-29T07:10:15.387Z</updated>
    
    <content type="html"><![CDATA[<p>è®ºæ–‡ç²¾è¯» DyGLIP: A Dynamic Graph Model with Link Prediction forAccurate Multi-Camera Multiple Object Tracking</p><span id="more"></span><h1 id="dyglip-a-dynamic-graph-model-with-link-prediction-for-accurate-multi-camera-multiple-object-tracking"><a class="markdownIt-Anchor" href="#dyglip-a-dynamic-graph-model-with-link-prediction-for-accurate-multi-camera-multiple-object-tracking"></a> DyGLIP: A Dynamic Graph Model With Link Prediction for Accurate Multi-Camera Multiple Object Tracking</h1><p><strong>ä½œè€…</strong>ï¼šKha Gia Quach, Pha Nguyen, Huu Le<br />CVPR 2021</p><h2 id="ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯"><a class="markdownIt-Anchor" href="#ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯"></a> ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯</h2><h3 id="é—®é¢˜èƒŒæ™¯ä¸ä»»åŠ¡å®šä¹‰"><a class="markdownIt-Anchor" href="#é—®é¢˜èƒŒæ™¯ä¸ä»»åŠ¡å®šä¹‰"></a> é—®é¢˜èƒŒæ™¯ä¸ä»»åŠ¡å®šä¹‰</h3><p>æœ¬ç ”ç©¶èšç„¦äºè®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­çš„æ ¸å¿ƒéš¾é¢˜â€”â€”<strong>å¤šæ‘„åƒå¤´å¤šç›®æ ‡è·Ÿè¸ª (Multi-Camera Multiple Object Tracking, MC-MOT)</strong> ã€‚è¯¥ä»»åŠ¡çš„ç›®æ ‡æ˜¯åœ¨ä¸€ä¸ªç”±å¤šä¸ªæ‘„åƒå¤´ç»„æˆçš„ç›‘æ§ç½‘ç»œä¸­ï¼ŒåŒæ—¶é”å®šå¹¶è·Ÿè¸ªæ‰€æœ‰ç›®æ ‡çš„å…¨å±€è¿åŠ¨è½¨è¿¹ ã€‚åœ¨ MC-MOT çš„æµæ°´çº¿ä¸­ï¼Œå°½ç®¡å•æ‘„åƒå¤´è·Ÿè¸ªå·²ç»å–å¾—äº†é•¿è¶³è¿›æ­¥ï¼Œä½†<strong>æ•°æ®å…³è”</strong> (Data Association) ä»ç„¶æ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„ç¯èŠ‚ï¼Œç³»ç»Ÿé¢ä¸´ç€æç«¯çš„ç¯å¢ƒæŒ‘æˆ˜ï¼š</p><ul><li><strong>å¤–è§‚ä¸€è‡´æ€§ç ´å</strong>ï¼š å½“ç›®æ ‡åœ¨ä¸åŒæ‘„åƒå¤´ä¹‹é—´ç§»åŠ¨æ—¶ï¼Œå…‰ç…§æ¡ä»¶çš„ä¸ä¸€è‡´ï¼ˆå¦‚ä»å®¤å†…åˆ°å®¤å¤–ï¼‰ä¼šå¯¼è‡´åŒä¸€ç›®æ ‡çš„ç‰¹å¾å‘é‡å‘ç”Ÿå‰§çƒˆå˜åŒ– ã€‚</li><li><strong>éé‡å è§†åŸŸ (Non-overlapping FOVs)</strong>ï¼š æ‘„åƒå¤´ä¹‹é—´å¯èƒ½å­˜åœ¨ç›²åŒºï¼Œå¯¼è‡´ç›®æ ‡è½¨è¿¹ä¸­æ–­ï¼Œä¸”æ— æ³•é€šè¿‡å‡ ä½•é‡å ç›´æ¥åŒ¹é… ã€‚</li><li><strong>é®æŒ¡ä¸è¿åŠ¨æ¨¡å¼å·®å¼‚</strong>ï¼š ç›®æ ‡çš„è¿åŠ¨æ¨¡å¼å¤šå˜ï¼Œä¸”ç»å¸¸å‘ç”Ÿè½¨è¿¹é®æŒ¡ ã€‚</li></ul><p>ä¼ ç»Ÿçš„ä¾èµ–ç°æˆæ£€æµ‹å™¨æˆ– ReID æ¨¡å‹æå–é™æ€ç‰¹å¾å‘é‡çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›å¤æ‚åœºæ™¯ä¸‹å¾€å¾€å¤±æ•ˆï¼Œå¯¼è‡´èº«ä»½ï¼ˆIDï¼‰åˆ†é…é”™è¯¯ ã€‚å› æ­¤ï¼Œæœ¬ä»»åŠ¡çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p><ul><li><span style="color: #89986D; font-weight: bold;">è®¾è®¡ä¸€ç§é²æ£’çš„æ•°æ®å…³è”æœºåˆ¶ï¼Œèƒ½å¤Ÿé€‚åº”åŠ¨æ€å˜åŒ–çš„ç‰¹å¾è¡¨ç¤ºï¼Œå¹¶ä¼˜é›…åœ°è§£å†³è·¨æ‘„åƒå¤´ï¼ˆæ— è®ºæ˜¯å¦é‡å ï¼‰çš„ç›®æ ‡èº«ä»½åŒ¹é…é—®é¢˜ã€‚</span></li></ul><h3 id="æ•´ä½“è§£å†³æ€è·¯"><a class="markdownIt-Anchor" href="#æ•´ä½“è§£å†³æ€è·¯"></a> æ•´ä½“è§£å†³æ€è·¯</h3><p>DyGLIP æ‘’å¼ƒäº†ä¼ ç»Ÿæ–¹æ³•ä¸­å¸¸ç”¨çš„é™æ€èšç±»ï¼ˆClusteringï¼‰æˆ–çŸ©é˜µåˆ†è§£ï¼ˆMatrix Factorizationï¼‰æ€è·¯ ï¼Œæå‡ºäº†ä¸€ç§å…¨æ–°çš„è§†è§’ï¼š</p><ul><li><span style="color: #89986D; font-weight: bold;">å°†æ•°æ®å…³è”é—®é¢˜é‡æ„ä¸ºåŠ¨æ€å›¾ä¸Šçš„é“¾è·¯é¢„æµ‹é—®é¢˜ (Link Prediction on a Dynamic Graph) ã€‚</span><br />æˆ‘ä»¬åˆ†ä¸‰ä¸ªä¸»è¦åˆ›æ–°ç‚¹çœ‹å¾…è¿™ä¸ªè§†è§’ã€‚</li></ul><p>é¦–å…ˆæ˜¯ <span style="color: #BB8ED0; font-weight: bold;">åŠ¨æ€å›¾æ¼”åŒ–</span> ã€‚ç³»ç»Ÿä¸å†æ„å»ºä¸€ä¸ªå›ºå®šçš„å…¨å±€å›¾ï¼Œè€Œæ˜¯ç»´æŠ¤ä¸€ä¸ªéšæ—¶é—´ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> æ¼”åŒ–çš„<strong>åŠ¨æ€å›¾</strong>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi mathvariant="script">G</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi mathvariant="script">E</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{G}^{(t)}=(\mathcal{V}^{(t)},\mathcal{E}^{(t)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03522em;vertical-align:-0.09722em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.0593em;">G</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><ul><li><span style="color: #57595B; font-weight: bold;">å›¾çš„é¡¶ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{V}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> ä»£è¡¨äº†æˆªè‡³å½“å‰æ—¶åˆ»æ‰€æœ‰å·²çŸ¥çš„ Trackletsï¼ˆçŸ­è½¨è¿¹ï¼‰ã€‚åœ¨æ¯ä¸€ä¸ªæ—¶é—´æ­¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼Œå•æ‘„åƒå¤´è·Ÿè¸ªå™¨ï¼ˆå¦‚ DeepSORTï¼‰äº§ç”Ÿçš„æ–° Tracklets ä¼šä½œä¸ºæ–°èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">N</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{N}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> åŠ å…¥å›¾ä¸­ã€‚</span></li><li><span style="color: #57595B; font-weight: bold;">ä»»åŠ¡è½¬åŒ–ä¸ºé¢„æµ‹æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸å›¾ä¸­å·²æœ‰èŠ‚ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è¾¹ï¼ˆEdgeï¼‰ã€‚å¦‚æœè¾¹å­˜åœ¨ï¼Œåˆ™æ„å‘³ç€å®ƒä»¬å±äºåŒä¸€ç›®æ ‡ ã€‚</span></li></ul><p>å…¶æ¬¡æ˜¯ <span style="color: #BB8ED0; font-weight: bold;">åŠ¨æ€å›¾æ³¨æ„åŠ›æœºåˆ¶</span> ã€‚DyGLIP è®¤ä¸ºç›´æ¥ä½¿ç”¨åŸå§‹æ£€æµ‹ç‰¹å¾è¿›è¡Œå…³è”æ˜¯ä¸å¯é çš„ ã€‚è¯¥æ¨¡å‹å¼•å…¥äº†ä¸€ä¸ª<strong>åŠ¨æ€å›¾æ³¨æ„åŠ›æœºåˆ¶ (Dynamic Graph with Self-Attention)</strong>ï¼ŒåŒ…å«ä¸¤ä¸ªå…³é”®æ¨¡å—ï¼š</p><ul><li><span style="color: #57595B; font-weight: bold;">ç»“æ„æ³¨æ„åŠ› (Structural Attention)ï¼š ç»“åˆæ‘„åƒå¤´ä½ç½®ç¼–ç ï¼Œæ•æ‰åŒä¸€æ—¶åˆ»ç›®æ ‡åœ¨ç©ºé—´æ‹“æ‰‘ä¸Šçš„å…³ç³» ã€‚</span></li><li><span style="color: #57595B; font-weight: bold;">æ—¶åºæ³¨æ„åŠ› (Temporal Attention)ï¼š æ•æ‰ç›®æ ‡ç‰¹å¾éšæ—¶é—´æ¨ç§»çš„æ¼”å˜è§„å¾‹ã€‚</span></li></ul><p>æœ€åæ˜¯ <span style="color: #BB8ED0; font-weight: bold;">ç»Ÿä¸€å¤„ç†é‡å ä¸éé‡å è§†åŸŸ</span> ã€‚ä¸åŒäºéƒ¨åˆ†å‰äººå·¥ä½œä¾èµ–æ‘„åƒå¤´çš„é‡å åŒºåŸŸè¿›è¡Œå‡ ä½•åŒ¹é… ï¼ŒDyGLIP é€šè¿‡å­¦ä¹ ç‰¹å¾çš„æ—¶ç©ºæ¼”å˜ï¼Œæ— éœ€æ˜¾å¼çš„è§†åŸŸé‡å å‡è®¾ã€‚è¿™ä½¿å¾—è¯¥æ¨¡å‹èƒ½å¤Ÿé€šç”¨äºå„ç§æ‘„åƒå¤´æ‹“æ‰‘ç»“æ„ã€‚</p><h2 id="æŠ€æœ¯è·¯çº¿"><a class="markdownIt-Anchor" href="#æŠ€æœ¯è·¯çº¿"></a> æŠ€æœ¯è·¯çº¿</h2><p><strong>DyGLIP</strong> çš„æ•´ä½“æ¶æ„æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æµæ°´çº¿ï¼Œæ ¸å¿ƒåœ¨äºå°†<strong>å•æ‘„åƒå¤´è·Ÿè¸ª</strong>äº§ç”Ÿçš„æ•°æ®æµï¼Œè¾“å…¥åˆ°ä¸€ä¸ª<strong>åŠ¨æ€å›¾ç¥ç»ç½‘ç»œ</strong>ä¸­ï¼Œé€šè¿‡æ—¶ç©ºæ³¨æ„åŠ›æœºåˆ¶é‡å¡‘ç‰¹å¾ï¼Œæœ€ç»ˆè¾“å‡ºå…¨å±€ ID åˆ†é…ç»“æœã€‚</p><h3 id="å•æ‘„åƒå¤´å±€éƒ¨è·Ÿè¸ª"><a class="markdownIt-Anchor" href="#å•æ‘„åƒå¤´å±€éƒ¨è·Ÿè¸ª"></a> å•æ‘„åƒå¤´å±€éƒ¨è·Ÿè¸ª</h3><p>ä¾èµ–äºç°æœ‰çš„å•æ‘„åƒå¤´å¤šç›®æ ‡è·Ÿè¸ªï¼ˆSingle-Camera MOTï¼‰ç®—æ³•ï¼Œé€‰æ‹©äº† DeepSORT  ä½œä¸ºåŸºç¡€è·Ÿè¸ªå™¨ã€‚</p><p>åœ¨æ—¶åˆ» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼Œç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> ä¸ªæ‘„åƒå¤´ç”Ÿæˆä¸€ç»„<strong>å±€éƒ¨çŸ­è½¨è¿¹ï¼ˆTrackletsï¼‰</strong>ï¼Œè®°ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="script">L</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false">{</mo><msubsup><mi>I</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{c}^{(t)}=\{I_{j}^{(t)}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> ã€‚</p><p>æ¯ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>I</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">I_{j}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span> åŒ…å«ä¸€ä¸ª<strong>ç‰¹å¾å‘é‡ï¼ˆFeature Vectorï¼‰</strong>ï¼Œç”±æ£€æµ‹å™¨æˆ– Re-ID æ¨¡å‹æå–ã€‚</p><h3 id="åŠ¨æ€å›¾æ„å»º"><a class="markdownIt-Anchor" href="#åŠ¨æ€å›¾æ„å»º"></a> åŠ¨æ€å›¾æ„å»º</h3><p>ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªéšæ—¶é—´ä¸æ–­ç”Ÿé•¿çš„ <span style="color: #BB8ED0; font-weight: bold;">åŠ¨æ€å›¾ç»“æ„</span> ã€‚<br />å›¾çš„å®šä¹‰æ˜¯ï¼Œåœ¨æ—¶åˆ» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼Œæ„å»ºå›¾ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi mathvariant="script">G</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><mi mathvariant="script">E</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{G}^{(t)}=(\mathcal{V}^{(t)},\mathcal{E}^{(t)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03522em;vertical-align:-0.09722em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.0593em;">G</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><ul><li>é¡¶ç‚¹é›† (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">V</mi></mrow><annotation encoding="application/x-tex">\mathcal{V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span></span></span></span>)ï¼šä»£è¡¨æ‰€æœ‰å·²çŸ¥çš„ <strong>Tracklets</strong></li><li>è¾¹é›† (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">E</mi></mrow><annotation encoding="application/x-tex">\mathcal{E}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08944em;">E</span></span></span></span></span>)ï¼šä»£è¡¨ Tracklets ä¹‹é—´çš„å…³è”å…³ç³»ï¼ˆå³æ˜¯å¦ä¸ºåŒä¸€äººï¼‰</li></ul><p>ä¸æ„å»ºå›ºå®šå›¾ä¸åŒï¼ŒDyGLIP é‡‡ç”¨<strong>å¢é‡å¼æ›´æ–°</strong>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi mathvariant="script">t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>âˆª</mo><msup><mi mathvariant="script">N</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{V^{(t)}}=\mathcal{V}^{(t-1)}\cup\mathcal{N}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{V}^{(t-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> æ˜¯ä¸Šä¸€æ—¶åˆ»å·²å­˜åœ¨çš„èŠ‚ç‚¹</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">N</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{N}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> æ˜¯å½“å‰æ—¶åˆ»å„æ‘„åƒå¤´æ–°æ£€æµ‹åˆ°çš„ Tracklets é›†åˆ</li></ul><p>æ­¤å¤–ï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> åˆå§‹å…³è”ä¸€ä¸ªç‰¹å¾å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>ï¼Œè¿™ä¸€ç‰¹å¾å‘é‡é€šå¸¸ä¸º Re-ID ç‰¹å¾ã€‚</p><h3 id="æ—¶ç©ºæ³¨æ„åŠ›ç‰¹å¾å¢å¼º"><a class="markdownIt-Anchor" href="#æ—¶ç©ºæ³¨æ„åŠ›ç‰¹å¾å¢å¼º"></a> æ—¶ç©ºæ³¨æ„åŠ›ç‰¹å¾å¢å¼º</h3><p>ä¸ºäº†è§£å†³è·¨æ‘„åƒå¤´ç‰¹å¾ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒDyGLIP è®¾è®¡äº†ä¸€ä¸ª <span style="color: #BB8ED0; font-weight: bold;">åŒå±‚æ³¨æ„åŠ›æœºåˆ¶</span> ï¼š<strong>ç»“æ„æ³¨æ„åŠ› (Structural Attention)</strong> å’Œ <strong>æ—¶åºæ³¨æ„åŠ› (Temporal Attention)</strong></p><p><strong>ç»“æ„æ³¨æ„åŠ›</strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼ŒèŠ‚ç‚¹ä¸åº”è¯¥æ˜¯å­¤ç«‹çš„ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªç›®æ ‡çš„ç‰¹å¾åº”è¯¥ä¸å…¶æ‰€å¤„çš„ç¯å¢ƒï¼ˆæ‘„åƒå¤´ä½ç½®ï¼‰ä»¥åŠå‘¨å›´çš„å…¶ä»–ç›®æ ‡ç‰¹å¾è¿›è¡Œå…³è”ã€‚<span style="color: #57595B; font-weight: bold;">å› æ­¤ï¼Œæ¨¡å‹å¼•å…¥äº†æ‘„åƒå¤´ä½ç½®ç¼–ç ï¼Œå­¦ä¹ æ¯ä¸ªæ‘„åƒå¤´ç‰¹æœ‰çš„æˆåƒé£æ ¼ï¼ˆå¦‚åè‰²æˆ–ç•¸å˜ï¼‰ï¼Œå¹¶åˆ©ç”¨å‘¨å›´é‚»å±…èŠ‚ç‚¹çš„åˆ†å¸ƒæƒ…å†µï¼Œæ¶ˆé™¤å•æ‘„ç¯å¢ƒå¸¦æ¥çš„ç³»ç»Ÿæ€§åå·®ï¼Œè·å¾—æ›´å…·ä»£è¡¨æ€§çš„å±€éƒ¨æ‹“æ‰‘ç‰¹å¾ã€‚</span></p><p><strong>æ—¶åºæ³¨æ„åŠ›</strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œä¸€ä¸ªäººçš„èº«ä»½æ˜¯è¿ç»­æ¼”å˜çš„ã€‚å¦‚æœæ¨¡å‹çŸ¥é“ç›®æ ‡åœ¨å‰ä¸€ç§’çš„é•¿ç›¸ï¼Œå°±èƒ½æ›´å¥½åœ°é¢„æµ‹ä»–åœ¨åä¸€ç§’çš„é•¿ç›¸ã€‚<span style="color: #57595B; font-weight: bold;">å› æ­¤ï¼Œæ¨¡å‹é€šè¿‡ä¸€ä¸ªæ—¶é—´æ»‘åŠ¨çª—å£è§‚å¯Ÿç›®æ ‡åœ¨è¿‡å»å‡ ä¸ªæ—¶åˆ»çš„ç‰¹å¾å˜åŒ–è¶‹åŠ¿ï¼Œæ•æ‰ç›®æ ‡ç‰¹å¾éšæ—¶é—´æ¨ç§»çš„åŠ¨æ€æ¼”åŒ–è§„å¾‹ã€‚</span></p><h4 id="ç»“æ„æ³¨æ„åŠ›å±‚-structural-attention-layer-sal"><a class="markdownIt-Anchor" href="#ç»“æ„æ³¨æ„åŠ›å±‚-structural-attention-layer-sal"></a> ç»“æ„æ³¨æ„åŠ›å±‚ (Structural Attention Layer, SAL)</h4><p>åœ¨è¿›å…¥æ³¨æ„åŠ›å±‚ä¹‹å‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸ä»…æºå¸¦å¤–è§‚ç‰¹å¾ï¼Œè¿˜èåˆäº†ç©ºé—´ä¿¡æ¯ï¼Œå› æ­¤ï¼Œ<br />å¯¹äºæ—¶åˆ» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> çš„å›¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="script">G</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\mathcal{G}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9852199999999999em;vertical-align:-0.09722em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.0593em;">G</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span> ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span>ï¼Œè¾“å…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">e_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å¤–è§‚ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> ä¸ <strong>æ‘„åƒå¤´ä½ç½®ç¼–ç  (Camera Positional Encoding)</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">c_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ‹¼æ¥ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>e</mi><mi>v</mi></msub><mo>=</mo><mo stretchy="false">{</mo><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>c</mi><mi>v</mi></msub><mo stretchy="false">}</mo><mo>âˆˆ</mo><msup><mi mathvariant="double-struck">R</mi><msub><mi>D</mi><mi>E</mi></msub></msup></mrow><annotation encoding="application/x-tex">e_{v}=\{f(v)||c_{v}\}\in\mathbb{R}^{D_{E}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>âˆˆ</mo><msup><mi mathvariant="double-struck">R</mi><msub><mi>D</mi><mi>F</mi></msub></msup></mrow><annotation encoding="application/x-tex">f(v) \in \mathbb{R}^{D_F}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼šåŸå§‹ ReID ç‰¹å¾å‘é‡</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>v</mi></msub><mo>âˆˆ</mo><msup><mi mathvariant="double-struck">R</mi><msub><mi>D</mi><mi>C</mi></msub></msup></mrow><annotation encoding="application/x-tex">c_v \in \mathbb{R}^{D_C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼šæ‘„åƒå¤´çš„ç©ºé—´ä½ç½®ç¼–ç ï¼ˆCamera Positional Encodingï¼‰</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">||</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span></span>ï¼šè¡¨ç¤ºæ‹¼æ¥æ“ä½œï¼ˆConcatenationï¼‰</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>E</mi></msub><mo>=</mo><msub><mi>D</mi><mi>F</mi></msub><mo>+</mo><msub><mi>D</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">D_E = D_F + D_C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼šæ‹¼æ¥åçš„æ€»ç»´åº¦</li></ul><p>ä¸ºäº†è®¡ç®—èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å¯¹èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„é‡è¦æ€§ï¼ˆå³æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼‰ï¼ŒDyGLIP é‡‡ç”¨äº†ä¸€ç§<strong>åŸºäºé‚»åŸŸçš„æ³¨æ„åŠ›æœºåˆ¶</strong>ã€‚å¯¹äºç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> ä¸ªæ³¨æ„åŠ›å¤´ï¼ˆHeadï¼‰ï¼Œå…¶ç³»æ•°è®¡ç®—å…¬å¼ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>l</mi></msubsup><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mo stretchy="false">[</mo><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>k</mi></msub><mo>âˆˆ</mo><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow></munder><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi>W</mi><mrow><mi>k</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mo stretchy="false">[</mo><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>k</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\alpha_{ij}^{l}=\frac{exp(\sigma(W_{ij}^{T}[conv_{1\times1}^{l}(e_{v_{i}}^{t})||conv_{1\times1}^{l}(e_{v_{j}}^{t})]))}{\sum_{v_{k}\in\mathcal{V}^{(t)}}exp(\sigma(W_{kj}^{T}[conv_{1\times1}^{l}(e_{v_{i}}^{t})||conv_{1\times1}^{l}(e_{v_{k}}^{t})]))}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.282216em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.8417519999999996em;vertical-align:-1.158324em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6834279999999997em;"><span style="top:-2.279092em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.27571499999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8220357142857143em;"><span style="top:-2.8220357142857138em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.40557em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.823131em;"><span style="top:-2.3986920000000005em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3246389999999999em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7195559999999999em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3246389999999999em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7195559999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35285999999999995em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8343199999999995em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-2.451892em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30643899999999996em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-2.451892em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30643899999999996em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.158324em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>å…¶ä¸­ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup></mrow><annotation encoding="application/x-tex">conv_{1\times1}^{l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.30643899999999996em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-2.451892em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30643899999999996em;"><span></span></span></span></span></span></span></span></span></span>ï¼šä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 \times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> çš„å·ç§¯å±‚ï¼ˆç›¸å½“äºå…¨è¿æ¥å±‚ï¼‰ï¼Œç”¨äºå°†é«˜ç»´è¾“å…¥ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">e_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜ å°„åˆ°å½“å‰æ³¨æ„åŠ›å¤´ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> çš„å­ç©ºé—´</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi></mrow><annotation encoding="application/x-tex">||</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord">âˆ£</span></span></span></span>ï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">Concatenation</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>ï¼šå°†å˜æ¢åçš„æºèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œé‚»å±…èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> çš„ç‰¹å¾æ‹¼æ¥ï¼Œå½¢æˆè¾¹ç¼˜ç‰¹å¾</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">W_{ij}^{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.236103em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„æƒé‡å‘é‡ï¼Œå°†æ‹¼æ¥åçš„ç‰¹å¾æ˜ å°„ä¸ºä¸€ä¸ªæ ‡é‡ï¼ˆScalarï¼‰ï¼Œå³æœªå½’ä¸€åŒ–çš„æ³¨æ„åŠ›åˆ†æ•°</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo>â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma(\cdot)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span></span></span></span>ï¼šéçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œè®ºæ–‡ä¸­é€‰ç”¨ LeakyReLU</li><li><strong>Softmax å½’ä¸€åŒ–</strong>ï¼šåˆ†æ¯éƒ¨åˆ†å¯¹èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">v_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> è¿›è¡Œæ±‚å’Œï¼Œç¡®ä¿æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¹‹å’Œä¸º 1</li><li><strong>ç¨€ç–æ€§</strong>ï¼šä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œæ±‚å’Œä»…é’ˆå¯¹é‚»æ¥çŸ©é˜µä¸­å®šä¹‰çš„é‚»åŸŸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{N}(v_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> è¿›è¡Œï¼Œè€Œéå…¨å›¾</li></ul><p>ç†è§£ä¸Šè¿°çš„å…¬å¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£<strong>æ³¨æ„åŠ›å¤´</strong>æ˜¯ä»€ä¹ˆï¼Œå…¶æ˜¯<strong>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</strong>çš„åŸºæœ¬å•å…ƒã€‚å¤šä¸ªæ³¨æ„åŠ›å¤´å°±å¦‚åŒå¤šä¸ªå¯¹ä¸€ä¸ªç›®æ ‡è§‚å¯Ÿçš„è§‚æµ‹è€…ï¼Œæ¯ä¸ªäººå…³æ³¨ç›®æ ‡çš„æŸä¸€æ–¹é¢ï¼Œæœ€åå°†è¿™å››ä¸ªè§‚æµ‹è€…çš„è§‚å¯Ÿç»“æœæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¯¹è¿™ä¸ªç›®æ ‡éå¸¸å…¨é¢ã€ç«‹ä½“çš„æè¿°ã€‚æ¢æˆä¸“ä¸šçš„å™è¿°å°±æ˜¯ï¼š</p><ul><li><span style="color: #BB8ED0; font-weight: bold;">å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼ˆMulti-Head Attentionï¼‰</span>å…è®¸æ¨¡å‹åœ¨ä¸åŒçš„ç‰¹å¾å­ç©ºé—´ï¼ˆSubspacesï¼‰é‡Œå¹¶è¡Œåœ°å­¦ä¹ ä¿¡æ¯ï¼Œé˜²æ­¢åªå…³æ³¨æŸä¸€æ–¹é¢è€Œå¿½ç•¥äº†å…¶ä»–é‡è¦ç»†èŠ‚</li></ul><p>åœ¨æ•°å­¦å®ç°ä¸Šï¼Œæ¯ä¸€ä¸ªå¤´ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬æœ‰çš„ä¸€å¥—<strong>æŠ•å½±çŸ©é˜µ</strong>ï¼ˆæƒé‡å‚æ•°ï¼‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>W</mi><mi>l</mi></msup></mrow><annotation encoding="application/x-tex">W^l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span></span></span></span>ï¼Œç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> ä¸ªå¤´ä¼šç‹¬ç«‹è®¡ç®—å‡ºä¸€ç»„æ³¨æ„åŠ›ç³»æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>l</mi></msubsup></mrow><annotation encoding="application/x-tex">\alpha_{ij}^l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2438799999999999em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span> å’Œç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mi>l</mi></msup></mrow><annotation encoding="application/x-tex">h^l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span></span></span></span>ï¼Œæœ€åé€šè¿‡æ‹¼æ¥æ“ä½œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Concat</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span></span></span></span> æŠŠæ‰€æœ‰å¤´çš„ç»“æœåˆæˆä¸ºæœ€ç»ˆå‘é‡ã€‚</p><p>é‚£æ¯ä¸ªå¤´è®¡ç®—å‡ºæ¥çš„æ³¨æ„åŠ›ç³»æ•°åˆåº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ</p><ul><li><span style="color: #BB8ED0; font-weight: bold;">æ³¨æ„åŠ›ç³»æ•° (Attention Coefficients)</span> ï¼Œå³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¯ä»¥è¢«ç†è§£ä¸ºæ¨¡å‹åœ¨å¤„ç†ä¿¡æ¯æ—¶çš„åˆ¤åˆ«æƒé‡ã€‚</li></ul><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¯¹äºåŠ¨æ€å›¾ä¸­çš„èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œå®ƒå‘¨å›´è¿æ¥ç€å¾ˆå¤šå…¶ä»–èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>å°±æ„å‘³ç€ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å¯¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> çš„<strong>å…³æ³¨åº¦</strong>ï¼Œä»è®ºæ–‡çš„å…¬å¼æ¥çœ‹ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯é€šè¿‡ Softmax å‡½æ•°è®¡ç®—å‡ºæ¥çš„ï¼Œå› æ­¤å¯¹äºèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ‰€æœ‰é‚»å±…ï¼Œæ³¨æ„åŠ›ç³»æ•°ä¹‹å’Œå¿…é¡»ç­‰äº 1ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ‘</mo><mi>Î±</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum \alpha = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼‰ã€‚åœ¨èšåˆç‰¹å¾æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å®é™…ä¸Šæ˜¯åœ¨æ‰§è¡ŒåŠ æƒæ±‚å’Œã€‚</p><p>ç†è§£å®Œè¿™äº›ï¼Œæˆ‘ä»¬å›åˆ°ä¸Šé¢çš„æ³¨æ„åŠ›å¤´ç³»æ•°è®¡ç®—å…¬å¼ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>l</mi></msubsup><mo>=</mo><mfrac><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi>W</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mo stretchy="false">[</mo><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>k</mi></msub><mo>âˆˆ</mo><msup><mi mathvariant="script">V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow></munder><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msubsup><mi>W</mi><mrow><mi>k</mi><mi>j</mi></mrow><mi>T</mi></msubsup><mo stretchy="false">[</mo><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>k</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\alpha_{ij}^{l}=\frac{exp(\sigma(W_{ij}^{T}[conv_{1\times1}^{l}(e_{v_{i}}^{t})||conv_{1\times1}^{l}(e_{v_{j}}^{t})]))}{\sum_{v_{k}\in\mathcal{V}^{(t)}}exp(\sigma(W_{kj}^{T}[conv_{1\times1}^{l}(e_{v_{i}}^{t})||conv_{1\times1}^{l}(e_{v_{k}}^{t})]))}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.282216em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.8417519999999996em;vertical-align:-1.158324em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6834279999999997em;"><span style="top:-2.279092em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.27571499999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.08222em;">V</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8220357142857143em;"><span style="top:-2.8220357142857138em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.40557em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.823131em;"><span style="top:-2.3986920000000005em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3246389999999999em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7195559999999999em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3246389999999999em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7195559999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35285999999999995em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8343199999999995em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-2.451892em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30643899999999996em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mord">âˆ£</span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-2.451892em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30643899999999996em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.158324em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>å…¶æ„å›¾å°±æ˜¯ï¼Œè®¡ç®—ï¼š</p><ul><li><span style="color: #89986D; font-weight: bold;">æ¿€æ´»å‡½æ•°å¤„ç†åçš„ï¼Œè¯¥æ³¨æ„åŠ›å¤´æƒé‡çŸ©é˜µâœ–ï¸ä¸¤ä¸ªè½¨è¿¹èŠ‚ç‚¹ç‰¹å¾å·ç§¯ç»“æœçš„æ‹¼æ¥ï¼Œçš„softmax å½’ä¸€åŒ–ç»“æœ</span>ã€‚<br />è·å¾—æ³¨æ„åŠ›ç³»æ•°åï¼Œé€šè¿‡åŠ æƒæ±‚å’Œæ›´æ–°èŠ‚ç‚¹ç‰¹å¾ã€‚è¾“å‡º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup></mrow><annotation encoding="application/x-tex">h_{v_i}^t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.140656em;vertical-align:-0.34709999999999996em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7935559999999999em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span></span></span></span> çš„è®¡ç®—å…¬å¼ä¸ºï¼š</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>h</mi><msub><mi>v</mi><mi>i</mi></msub><mi>t</mi></msubsup><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><msubsup><mi>t</mi><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>L</mi></msubsup><mo stretchy="false">[</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>j</mi></msub><mo>âˆˆ</mo><msup><mi>V</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup></mrow></munder><msubsup><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>l</mi></msubsup><mi>c</mi><mi>o</mi><mi>n</mi><msubsup><mi>v</mi><mrow><mn>1</mn><mo>Ã—</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy="false">(</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mi>t</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">h_{v_{i}}^{t}=Concat_{l=1}^{L}[\sigma(\sum_{v_{j}\in V^{(t)}}\alpha_{ij}^{l}conv_{1\times1}^{l}(e_{v_{j}}^{t}))]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190656em;vertical-align:-0.34709999999999996em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.843556em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.638755em;vertical-align:-1.58875em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.7585699999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8220357142857143em;"><span style="top:-2.8220357142857138em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.58875em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">Ã—</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.843556em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span></p><ul><li><strong>åŠ æƒæ±‚å’Œ</strong>ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ‘</mo><msubsup><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>l</mi></msubsup><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\sum \alpha_{ij}^{l} ...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2438799999999999em;vertical-align:-0.394772em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span> è¡¨ç¤ºèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> èšåˆäº†å‘¨å›´é‚»å±… <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">v_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> çš„ä¿¡æ¯ï¼Œæƒé‡ç”± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\alpha_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> å†³å®šã€‚è¿™æ„å‘³ç€ï¼Œä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ç›¸ä¼¼åº¦é«˜æˆ–ç©ºé—´å…³ç³»ç´§å¯†çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶æ–°ç‰¹å¾çš„è´¡çŒ®æ›´å¤§ã€‚</li><li><strong>å¤šå¤´æœºåˆ¶</strong> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Concat</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span></span></span></span>)ï¼šè®ºæ–‡ä½¿ç”¨äº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> ä¸ªç‹¬ç«‹çš„æ³¨æ„åŠ›å¤´ï¼ˆå®éªŒä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">L=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>ï¼‰ã€‚è¿™å…è®¸æ¨¡å‹å…³æ³¨ä¸åŒçš„å­ç©ºé—´ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªå¤´å…³æ³¨é¢œè‰²çº¹ç†ï¼Œå¦ä¸€ä¸ªå¤´å…³æ³¨æ‘„åƒå¤´ä½ç½®å…³ç³»ï¼‰ã€‚æœ€åå°†æ‰€æœ‰å¤´çš„ç»“æœæ‹¼æ¥ä½œä¸º SAL å±‚çš„æœ€ç»ˆè¾“å‡ºã€‚</li></ul><h4 id="å›¾æ—¶åºæ³¨æ„åŠ›å±‚-graph-temporal-attention-layer-tal"><a class="markdownIt-Anchor" href="#å›¾æ—¶åºæ³¨æ„åŠ›å±‚-graph-temporal-attention-layer-tal"></a> å›¾æ—¶åºæ³¨æ„åŠ›å±‚ (Graph Temporal Attention Layer, TAL)</h4><p><span style="color: #89986D; font-weight: bold;">SAL å±‚å¤„ç†äº†å•å¸§å†…çš„ç©ºé—´å…³ç³»ï¼ŒTAL å±‚åˆ™è´Ÿè´£æ•æ‰æ—¶é—´ç»´åº¦ä¸Šçš„æ¼”åŒ–ã€‚</span> å®ƒåŸºäº Transformer çš„ Self-Attention æ¶æ„ï¼Œä½†é’ˆå¯¹åŠ¨æ€å›¾è¿›è¡Œäº†å› æœæ€§æ”¹è¿›ã€‚</p><p>TAL çš„è¾“å…¥ä¸ä»…ä»…æ˜¯ç‰¹å¾ï¼Œè¿˜éœ€è¦çŸ¥é“æ—¶é—´ç‚¹ã€‚<br />å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span>ï¼Œå–å…¶åœ¨æ—¶é—´çª—å£ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> å†…çš„ä¸€ç³»åˆ— SAL è¾“å‡ºç‰¹å¾ï¼Œå¹¶åŠ ä¸Šæ—¶é—´æˆ³ä½ç½®ç¼–ç  (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">p_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>v</mi></msub><mo>=</mo><mo stretchy="false">[</mo><msubsup><mi>h</mi><mi>v</mi><mn>1</mn></msubsup><mo>+</mo><msubsup><mi>p</mi><mi>v</mi><mn>1</mn></msubsup><mo separator="true">,</mo><mtext>Â </mtext><msubsup><mi>h</mi><mi>v</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>p</mi><mi>v</mi><mn>2</mn></msubsup><mo separator="true">,</mo><mtext>Â </mtext><mo>â‹…</mo><mo>â‹…</mo><mo>â‹…</mo><mo separator="true">,</mo><mtext>Â </mtext><msubsup><mi>h</mi><mi>v</mi><mi>W</mi></msubsup><mo>+</mo><msubsup><mi>p</mi><mi>v</mi><mi>W</mi></msubsup><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x_{v}=[h_{v}^{1}+p_{v}^{1}, \ h_{v}^{2}+p_{v}^{2}, \ \cdot\cdot\cdot, \ h_{v}^{W}+p_{v}^{W}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.138331em;vertical-align:-0.247em;"></span><span class="mord">â‹…</span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></p><p>å°†è¿™äº›å‘é‡å †å æˆä¸€ä¸ªçŸ©é˜µ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>âˆˆ</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>W</mi><mo>Ã—</mo><msub><mi>D</mi><mi>H</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">X \in \mathbb{R}^{W \times D_H}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mbin mtight">Ã—</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ã€‚</p><p>éµå¾ªæ ‡å‡† Transformer èŒƒå¼ï¼Œé€šè¿‡çº¿æ€§å˜æ¢ç”Ÿæˆ Query, Key, Value çŸ©é˜µ ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>Q</mi></msub><mo separator="true">,</mo><mspace width="1em"/><mi>K</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>K</mi></msub><mo separator="true">,</mo><mspace width="1em"/><mi>V</mi><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>V</mi></msub></mrow><annotation encoding="application/x-tex">Q = XW_Q, \quad K = XW_K, \quad V = XW_V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>Q</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>K</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>V</mi></msub></mrow><annotation encoding="application/x-tex">W_Q, W_K, W_V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯å¯å­¦ä¹ çš„æŠ•å½±çŸ©é˜µã€‚</p><p>éšåï¼Œé‡‡ç”¨<strong>æ©ç ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ› (Masked Scaled Dot-Product Attention)</strong> ï¼Œè®¡ç®—æ—¶é—´æ­¥ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>z</mi><mi>e</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mi>a</mi><mi>t</mi><mi>t</mi><msup><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>D</mi><mi>Z</mi></msub></msqrt></mfrac><mo>+</mo><mi>M</mi><mo stretchy="false">)</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">z_{e}^{(l)}=attn^{(l)}(Q,K,V)=softmax(\frac{QK^{T}}{\sqrt{D_{Z}}}+M)V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.448331em;vertical-align:-0.93em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183309999999999em;"><span style="top:-2.2583349999999998em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><p>å…¶ä¸­ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>ï¼šè®¡ç®—ä¸åŒæ—¶é—´æ­¥ä¹‹é—´çš„ç›¸ä¼¼åº¦çŸ©é˜µ</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><msub><mi>D</mi><mi>Z</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{D_Z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.18833500000000003em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span>ï¼šç¼©æ”¾å› å­ï¼Œç”¨äºé˜²æ­¢ç‚¹ç§¯ç»“æœè¿‡å¤§å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> (Mask Matrix)ï¼šè¿™æ˜¯ä¸€ä¸ªæ©ç çŸ©é˜µï¼Œç”¨äºå¼ºåˆ¶å› æœæ€§ã€‚è‹¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&gt;</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i &gt; j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>ï¼ˆå³æ—¶é—´æ­¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> æ™šäº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>ï¼‰ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">M_{ij} = -\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">âˆ</span></span></span></span>ï¼›å¦åˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M_{ij} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ã€‚åœ¨ Softmax åï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow></msup><mo>â‰ˆ</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">e^{-\infty} \approx 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ã€‚è¿™ä¿è¯äº†å½“å‰æ—¶åˆ» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> çš„ç‰¹å¾åªèƒ½èšåˆ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> æ—¶åˆ»ä¹‹å‰çš„å†å²ä¿¡æ¯ã€‚</li></ul><p>è¿™æ ·çœ‹å¯èƒ½ä¸å¤Ÿç›´è§‚ï¼Œç»“åˆ Transformer çš„ç†å¿µï¼Œä¸Šè¿°å…¬å¼ï¼Œå³ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>z</mi><mi>e</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mtext>softmax</mtext><mrow><mo fence="true">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>D</mi><mi>Z</mi></msub></msqrt></mfrac><mo>+</mo><mi>M</mi><mo fence="true">)</mo></mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">z_{e}^{(l)} = \text{softmax}\left(\frac{QK^{T}}{\sqrt{D_{Z}}} + M\right)V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.468361em;vertical-align:-0.95003em;"></span><span class="mord text"><span class="mord">softmax</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183309999999999em;"><span style="top:-2.2583349999999998em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><p>ç”±ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p><ol><li><strong>Q, K, V (æŸ¥è¯¢ã€é”®ã€å€¼çŸ©é˜µ)</strong>ï¼š è¿™äº›æ˜¯é€šè¿‡å¯¹è¾“å…¥ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>ï¼ˆèŠ‚ç‚¹åœ¨ä¸åŒæ—¶é—´æ­¥çš„ç‰¹å¾åºåˆ—ï¼‰è¿›è¡Œçº¿æ€§æŠ•å½±å¾—åˆ°çš„ã€‚<ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span></span></span></span> (Query)ï¼š ä»£è¡¨å½“å‰æ—¶åˆ»çš„èŠ‚ç‚¹æ­£åœ¨å¯»æ‰¾ä»€ä¹ˆæ ·çš„å†å²ä¿¡æ¯ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> (Key)ï¼š ä»£è¡¨è¿‡å»å„æ—¶åˆ»èŠ‚ç‚¹æ‰€èƒ½â€œæä¾›â€çš„ç‰¹å¾æ ‡ç­¾ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> (Value)ï¼š ä»£è¡¨èŠ‚ç‚¹å®é™…åŒ…å«çš„ç‰¹å¾ä¿¡æ¯å†…å®¹ã€‚</li></ul></li><li><strong>ç‚¹ç§¯æ“ä½œ</strong> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>)ï¼š é€šè¿‡è®¡ç®—æŸ¥è¯¢å‘é‡ä¸é”®å‘é‡çš„ç‚¹ç§¯ï¼Œè¡¡é‡å½“å‰æ—¶åˆ»ä¸è¿‡å»æ¯ä¸€ä¸ªæ—¶åˆ»ä¹‹é—´çš„ç›¸å…³æ€§æˆ–ç›¸ä¼¼åº¦ã€‚</li><li><strong>ç¼©æ”¾å› å­</strong> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><msqrt><msub><mi>D</mi><mi>Z</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">1/\sqrt{D_Z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span>)ï¼š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>Z</mi></msub></mrow><annotation encoding="application/x-tex">D_Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯è¾“å‡ºç‰¹å¾çš„ç»´åº¦ã€‚åœ¨è®¡ç®—ç‚¹ç§¯åï¼Œå°†å…¶é™¤ä»¥ç»´åº¦çš„å¹³æ–¹æ ¹ã€‚</li><li><strong>æ©ç çŸ©é˜µ</strong> (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>)ï¼š è¿™æ˜¯ä¸€ä¸ªä¸æ—¶é—´çª—å£å¤§å°ç›¸åŒçš„çŸ©é˜µï¼Œå…¶å…ƒç´ å–å€¼ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æˆ– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">-\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">âˆ</span></span></span></span>ã€‚</li></ol><p><strong>ç¼©æ”¾çš„ä½œç”¨æ˜¯</strong>éšç€ç‰¹å¾ç»´åº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>Z</mi></msub></mrow><annotation encoding="application/x-tex">D_Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„å¢å¤§ï¼Œç‚¹ç§¯ç»“æœ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> çš„é‡çº§ä¼šå˜å¾—éå¸¸å¤§ã€‚è¿™ä¼šå¯¼è‡´åœ¨ç»è¿‡ Softmax å‡½æ•°å¤„ç†æ—¶ï¼Œæ¢¯åº¦å˜å¾—æå°ï¼Œé€šè¿‡é™¤ä»¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><msub><mi>D</mi><mi>Z</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{D_Z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.18833500000000003em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span>ï¼Œå°†è®¡ç®—ç»“æœé‡æ–°ç¼©æ”¾åˆ°ä¸€ä¸ªæ›´åˆç†çš„èŒƒå›´ï¼Œèƒ½å¤Ÿç¡®ä¿ Softmax å‡½æ•°èƒ½å¤Ÿäº§ç”Ÿçµæ•çš„æ¢¯åº¦ã€‚</p><p>è€Œ<strong>æ©ç çš„ä½œç”¨æ˜¯</strong>ç¡®ä¿äº†æ¯ä¸ªèŠ‚ç‚¹åœ¨æ›´æ–°ç‰¹å¾æ—¶ï¼Œåªèƒ½é€šè¿‡å›é¡¾å†å²æ¥å­¦ä¹ æ¼”åŒ–è§„å¾‹ï¼Œè€Œä¸ä¼šäº§ç”Ÿç”±äºçœ‹åˆ°äº†æœªæ¥çš„è½¨è¿¹ï¼Œè€Œåå‘ä¿®æ­£å½“å‰IDçš„éå› æœè¡Œä¸ºã€‚</p><p>å¤šå¤´ TAL çš„è¾“å‡ºè¢«æ‹¼æ¥åï¼Œé€šè¿‡ä¸€ä¸ª<strong>å‰é¦ˆç¥ç»ç½‘ç»œ</strong>è¿›è¡Œéçº¿æ€§å˜æ¢ï¼Œå¾—åˆ°æœ€ç»ˆçš„èŠ‚ç‚¹åµŒå…¥åºåˆ—ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">{</mo><msup><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><msup><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msup><mo separator="true">,</mo><mo>â‹…</mo><mo>â‹…</mo><mo>â‹…</mo><mo separator="true">,</mo><msup><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mrow><mo stretchy="false">(</mo><mi>W</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ {e^{\prime}}^{(1)},{e^{\prime}}^{(2)},\cdot\cdot\cdot,{e^{\prime}}^{(W)}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.329792em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.329792em;vertical-align:-0.25em;"></span><span class="mord">â‹…</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.079792em;"><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p><p>è¿™ä¸ª <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">e&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> å³ä¸ºæœ€ç»ˆç”¨äºé“¾è·¯é¢„æµ‹çš„ç‰¹å¾ã€‚</p><h3 id="èº«ä»½å…³è”ä¸æ¨¡å‹æŸå¤±å‡½æ•°å®šä¹‰"><a class="markdownIt-Anchor" href="#èº«ä»½å…³è”ä¸æ¨¡å‹æŸå¤±å‡½æ•°å®šä¹‰"></a> èº«ä»½å…³è”ä¸æ¨¡å‹æŸå¤±å‡½æ•°å®šä¹‰</h3><p>åœ¨ DyGLIP ä¸­ï¼Œå…³è”è¢«å®šä¹‰ä¸ºåˆ¤æ–­å›¾ä¸­ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨<strong>Link</strong>ã€‚</p><h4 id="å…³è”æ¦‚ç‡è®¡ç®—-probability-scoring"><a class="markdownIt-Anchor" href="#å…³è”æ¦‚ç‡è®¡ç®—-probability-scoring"></a> å…³è”æ¦‚ç‡è®¡ç®— (Probability Scoring)</h4><p>ç»™å®šä¸€å¯¹ç»è¿‡å¢å¼ºçš„èŠ‚ç‚¹ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">e&#x27;_{v_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.098992em;vertical-align:-0.34709999999999996em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">e&#x27;_{v_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.196212em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œæ¨¡å‹éœ€è¦è®¡ç®—å®ƒä»¬å±äºåŒä¸€ç›®æ ‡çš„æ¦‚ç‡åˆ†æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">s \in [0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ï¼Œåˆ†æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆTrackletsï¼‰å±äºåŒä¸€ä¸ªäººçš„å¯èƒ½æ€§è¶Šå¤§ ã€‚</p><h4 id="åº¦é‡æ ‡å‡†ä¸åˆ†ç±»å™¨é€‰æ‹©-metrics-and-classifiers"><a class="markdownIt-Anchor" href="#åº¦é‡æ ‡å‡†ä¸åˆ†ç±»å™¨é€‰æ‹©-metrics-and-classifiers"></a> åº¦é‡æ ‡å‡†ä¸åˆ†ç±»å™¨é€‰æ‹© (Metrics and Classifiers)</h4><p>è®ºæ–‡åœ¨æ¢è®¨äº†ä¸¤ç§ä¸åŒçš„ç›¸ä¼¼åº¦åº¦é‡ä¸åˆ†ç±»ç»„åˆï¼ˆä½™å¼¦è·ç¦» + Sigmoi / å“ˆè¾¾ç›ç§¯ + Softmaxï¼‰ä¹‹åï¼Œé€‰æ‹©äº†åè€…ã€‚</p><p>å³è®¡ç®—ä¸¤ä¸ªç‰¹å¾å‘é‡çš„<strong>å“ˆè¾¾ç›ç§¯</strong>ï¼ˆHadamard productï¼Œå³å¯¹åº”å…ƒç´ ç›¸ä¹˜ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo>âŠ™</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">e_{v_{i}}^{\prime} \odot e_{v_{j}}^{\prime}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.098992em;vertical-align:-0.34709999999999996em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âŠ™</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.196212em;vertical-align:-0.44432em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span></span></span></span>ï¼‰ï¼Œéšåè¿æ¥ä¸€ä¸ª<strong>å…¨è¿æ¥å±‚</strong>ï¼Œæœ€åé€šè¿‡ Softmax å±‚è¾“å‡ºåˆ†ç±»æ¦‚ç‡ã€‚</p><p>æ¶ˆèå®éªŒè¯æ˜æ–¹æ¡ˆ B æ•ˆæœæ˜¾è‘—ä¼˜äºæ–¹æ¡ˆ A ã€‚è¿™æ˜¯å› ä¸ºå“ˆè¾¾ç›ç§¯ä¿ç•™äº†å…ƒç´ çº§åˆ«çš„äº¤äº’ç‰¹å¾ï¼Œè€Œ Softmax é…åˆå…¨è¿æ¥å±‚èƒ½å­¦ä¹ åˆ°æ›´å¤æ‚çš„éçº¿æ€§åŒ¹é…é€»è¾‘ã€‚</p><h4 id="è”åˆæŸå¤±å‡½æ•°-integrated-loss"><a class="markdownIt-Anchor" href="#è”åˆæŸå¤±å‡½æ•°-integrated-loss"></a> è”åˆæŸå¤±å‡½æ•° (Integrated Loss)</h4><p>ä¸ºäº†è®©æ³¨æ„åŠ›æ¨¡å—å’Œé“¾è·¯åˆ†ç±»å™¨ååŒå·¥ä½œï¼ŒDyGLIP é‡‡ç”¨äº†ä¸€ç§è”åˆå­¦ä¹ çš„æ–¹æ³•ã€‚å…¶ç›®æ ‡æ˜¯åŒæ—¶å­¦ä¹ èƒ½å¤Ÿæ•è·æ—¶ç©ºä¿¡æ¯çš„è¡¨ç¤ºï¼Œå¹¶å®ç°å‡†ç¡®çš„é“¾è·¯é¢„æµ‹ã€‚</p><p>æ¨¡å‹çš„æ€»ä½“ç›®æ ‡å‡½æ•°æ—¨åœ¨å¹³è¡¡<strong>ç‰¹å¾èšç±»</strong>å’Œ<strong>åˆ†ç±»å‡†ç¡®åº¦</strong>ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸º<strong>ç‰¹å¾è¡¨ç¤ºå­¦ä¹ </strong>å’Œ<strong>é“¾è·¯åˆ†ç±»å­¦ä¹ </strong>çš„è€¦åˆï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>BCEÂ LossÂ (Representation)</mtext><mo>+</mo><msub><mi>w</mi><mi>g</mi></msub><mo>â‹…</mo><mtext>ClassifierÂ Loss</mtext></mrow><annotation encoding="application/x-tex">\mathcal{L}(v_{i}) = \text{BCE Loss (Representation)} + w_g \cdot \text{Classifier Loss}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">BCEÂ LossÂ (Representation)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">ClassifierÂ Loss</span></span></span></span></span></span></p><p>å±•å¼€ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mi>t</mi><mi>T</mi></munderover><mrow><mo fence="true">(</mo><munder><munder><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>j</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">âŸ¨</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo stretchy="false">âŸ©</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo stretchy="true">âŸ</mo></munder><mtext>æ­£æ ·æœ¬ç‰¹å¾æ‹‰è¿‘</mtext></munder><mo>+</mo><munder><munder><mrow><msub><mi>w</mi><mi>g</mi></msub><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>k</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">âŸ¨</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>k</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo stretchy="false">âŸ©</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo stretchy="true">âŸ</mo></munder><mtext>è´Ÿæ ·æœ¬ç‰¹å¾æ¨å¼€</mtext></munder><mo>+</mo><munder><munder><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>j</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><msub><mi mathvariant="script">L</mi><mi>c</mi></msub><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mo stretchy="true">âŸ</mo></munder><mtext>é“¾è·¯é¢„æµ‹åˆ†ç±»æŸå¤±</mtext></munder><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(v_{i})=\sum_{t}^{T} \left( \underbrace{\sum_{v_{j}\in \mathcal{N}_{b}^{(t)}(v_{i})}-log(\sigma(\langle e_{v_{i}}^{\prime}, e_{v_{j}}^{\prime} \rangle))}_{\text{æ­£æ ·æœ¬ç‰¹å¾æ‹‰è¿‘}} + \underbrace{w_g \sum_{v_{k}\in\mathcal{N}_{g}^{(t)}(v_{i})}log(1-\sigma(\langle e_{v_{i}}^{\prime}, e_{v_{k}}^{\prime} \rangle))}_{\text{è´Ÿæ ·æœ¬ç‰¹å¾æ¨å¼€}} + \underbrace{\sum_{v_{j}\in \mathcal{N}_{a}^{(t)}(v_{i})}\mathcal{L}_{c}(v_{i}, v_{j})}_{\text{é“¾è·¯é¢„æµ‹åˆ†ç±»æŸå¤±}} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:6.676801em;vertical-align:-3.1267560000000003em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.550045em;"><span style="top:-0.7499750000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-1.8999850000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-2.4949950000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.090005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-3.6850150000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.280025em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-4.3100249999999996em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âœ</span></span></span><span style="top:-5.550045em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.050045em;"><span></span></span></span></span></span></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:0.07675100000000024em;"><span class="pstrut" style="height:3.050005em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">æ­£æ ·æœ¬ç‰¹å¾æ‹‰è¿‘</span></span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span class="svg-align" style="top:-0.6015799999999998em;"><span class="pstrut" style="height:3.050005em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.592635em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.188485714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34722857142857144em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.800425em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">âŸ¨</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mclose">âŸ©</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.4484250000000003em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.1267560000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:0.04203100000000015em;"><span class="pstrut" style="height:3.050005em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">è´Ÿæ ·æœ¬ç‰¹å¾æ¨å¼€</span></span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span class="svg-align" style="top:-0.6362999999999999em;"><span class="pstrut" style="height:3.050005em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.5926349999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.3769714285714283em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29762857142857146em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.765705em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">âŸ¨</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35285999999999995em;"><span></span></span></span></span></span></span><span class="mclose">âŸ©</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.413705em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.0920360000000002em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:0.0310109999999999em;"><span class="pstrut" style="height:3.050005em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">é“¾è·¯é¢„æµ‹åˆ†ç±»æŸå¤±</span></span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span class="svg-align" style="top:-0.6473200000000001em;"><span class="pstrut" style="height:3.050005em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.0500050000000005em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.5926349999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.3769714285714283em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15874285714285716em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.754685em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.402685em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.081016em;"><span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.550045em;"><span style="top:-0.7499750000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-1.8999850000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-2.4949950000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.090005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-3.6850150000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.280025em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-4.3100249999999996em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>âŸ</span></span></span><span style="top:-5.550045em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.050045em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå¤æ‚çš„å…¬å¼æ‹†åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š</p><ol><li><span style="color: #BB8ED0; font-weight: bold;">æ­£æ ·æœ¬è¡¨ç¤ºå­¦ä¹  (Positive Samples)</span>ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>j</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">âŸ¨</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>j</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo stretchy="false">âŸ©</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sum_{v_{j}\in \mathcal{N}_{b}^{(t)}(v_{i})}-log(\sigma(\langle e_{v_{i}}^{\prime}, e_{v_{j}}^{\prime} \rangle))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.8504300000000002em;vertical-align:-1.800425em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.592635em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.188485714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34722857142857144em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.800425em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">âŸ¨</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44432em;"><span></span></span></span></span></span></span><span class="mclose">âŸ©</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>è¿™é‡Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="script">N</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\mathcal{N}_{b}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.30130799999999996em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span style="top:-3.2197999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯é€šè¿‡å›ºå®šé•¿åº¦éšæœºæ¸¸èµ°ç¡®å®šçš„é‚»å±…èŠ‚ç‚¹é›†åˆã€‚ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">âŸ¨</mo><mo>â‹…</mo><mo separator="true">,</mo><mo>â‹…</mo><mo stretchy="false">âŸ©</mo></mrow><annotation encoding="application/x-tex">\langle \cdot, \cdot \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">âŸ¨</span><span class="mord">â‹…</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">â‹…</span><span class="mclose">âŸ©</span></span></span></span> æ˜¯ä¸¤ä¸ªç‰¹å¾å‘é‡çš„å†…ç§¯ã€‚é€šè¿‡æœ€å°åŒ–è¿™ä¸ªè´Ÿå¯¹æ•°ä¼¼ç„¶ï¼Œæ¨¡å‹åœ¨å¼ºåˆ¶è®©åŒä¸€IDçš„èŠ‚ç‚¹ç‰¹å¾åœ¨åµŒå…¥ç©ºé—´ä¸­é å¾—æ›´è¿‘ã€‚</p><ol start="2"><li><span style="color: #BB8ED0; font-weight: bold;">è´Ÿæ ·æœ¬è¡¨ç¤ºå­¦ä¹  (Negative Samples)</span>ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mi>g</mi></msub><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>k</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mo stretchy="false">âŸ¨</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>i</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><msubsup><mi>e</mi><msub><mi>v</mi><mi>k</mi></msub><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo stretchy="false">âŸ©</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_g \sum_{v_{k}\in\mathcal{N}_{g}^{(t)}(v_{i})}log(1-\sigma(\langle e_{v_{i}}^{\prime}, e_{v_{k}}^{\prime} \rangle))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.81571em;vertical-align:-1.765705em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.5926349999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.3769714285714283em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29762857142857146em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.765705em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.154752em;vertical-align:-0.35285999999999995em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mopen">âŸ¨</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34709999999999996em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.35285999999999995em;"><span></span></span></span></span></span></span><span class="mclose">âŸ©</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="script">N</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\mathcal{N}_{g}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2974999999999999em;vertical-align:-0.2526999999999999em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2526999999999999em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯éšæœºæŠ½å–çš„è´Ÿæ ·æœ¬èŠ‚ç‚¹ã€‚è¶…å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">w_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯<strong>è´Ÿé‡‡æ ·æ¯”ä¾‹</strong> (Negative Sampling Ratio)ï¼Œç”¨äºå¹³è¡¡æ­£è´Ÿæ ·æœ¬çš„æƒé‡ã€‚è¿™ä¸€é¡¹è´Ÿè´£å°†ä¸åŒ ID çš„èŠ‚ç‚¹åœ¨ç‰¹å¾ç©ºé—´ä¸­æ¨å¼€ã€‚</p><ol start="3"><li><span style="color: #BB8ED0; font-weight: bold;">åˆ†ç±»å™¨æŸå¤± (Classifier Loss)</span>ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mo>âˆ‘</mo><mrow><msub><mi>v</mi><mi>j</mi></msub><mo>âˆˆ</mo><msubsup><mi mathvariant="script">N</mi><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></munder><msub><mi mathvariant="script">L</mi><mi>c</mi></msub><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sum_{v_{j}\in \mathcal{N}_{a}^{(t)}(v_{i})}\mathcal{L}_{c}(v_{i}, v_{j})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.80469em;vertical-align:-1.754685em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.5926349999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0590857142857142em;"><span style="top:-2.3769714285714283em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.059085714285714em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5357142857142856em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15874285714285716em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.754685em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">L</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{L}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯é“¾è·¯åˆ†ç±»å™¨çš„æŸå¤± 10ã€‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="script">N</mi><mi>a</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\mathcal{N}_{a}^{(t)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯æ­£è´Ÿæ ·æœ¬çš„å¹¶é›†ã€‚è¿™ä¸€é¡¹ç›´æ¥ç›‘ç£æœ€ç»ˆçš„åˆ†ç±»ç»“æœï¼Œç¡®ä¿äº†ç»è¿‡æ³¨æ„åŠ›æœºåˆ¶å¢å¼ºåçš„ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">e&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> èƒ½å¤Ÿç›´æ¥æœåŠ¡äºæœ€åçš„ ID åŒ¹é…ä»»åŠ¡ã€‚</p><h3 id="æ¨¡å‹è®­ç»ƒ"><a class="markdownIt-Anchor" href="#æ¨¡å‹è®­ç»ƒ"></a> æ¨¡å‹è®­ç»ƒ</h3><p>æˆ‘ä»¬å…ˆå‡ç»ƒä¸€ä¸‹å‰ä¸¤ç« åšäº†ä»€ä¹ˆã€‚</p><ul><li><p><span style="color: #BB8ED0; font-weight: bold;">æ—¶ç©ºæ³¨æ„åŠ›ç‰¹å¾å¢å¼º</span>ï¼š<span style="color: #89986D; font-weight: bold;">è¯¥èŠ‚é€šè¿‡ä¸²è”ç»“æ„æ³¨æ„åŠ›ï¼ˆSALï¼‰ä¸æ—¶åºæ³¨æ„åŠ›ï¼ˆTALï¼‰ï¼Œå®ç°äº†å¯¹åŸå§‹ç‰¹å¾çš„æ·±åº¦æçº¯ã€‚SAL ç»“åˆæ‘„åƒå¤´ä½ç½®ç¼–ç ï¼Œåœ¨ç©ºé—´ç»´åº¦èšåˆé‚»åŸŸä¿¡æ¯ä»¥æ•æ‰ç›¸æœºé—´çš„æ‹“æ‰‘å…³ç³»ï¼›TAL åˆ™åœ¨æ—¶é—´ç»´åº¦åˆ©ç”¨å¸¦æ©ç çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå»ºæ¨¡ç›®æ ‡ç‰¹å¾éšæ—¶é—´æ¼”å˜çš„åŠ¨æ€è§„å¾‹å¹¶ç¡®ä¿åœ¨çº¿è·Ÿè¸ªçš„å› æœæ€§ã€‚ä¸¤è€…ååŒå°†ä¸ç¨³å®šçš„è§†è§‰å¿«ç…§è½¬åŒ–ä¸ºå…·å¤‡æ—¶ç©ºé²æ£’æ€§çš„é«˜ç»´èŠ‚ç‚¹åµŒå…¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">e&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>ã€‚</span></p></li><li><p><span style="color: #BB8ED0; font-weight: bold;">èº«ä»½å…³è”ä¸æ¨¡å‹æŸå¤±å‡½æ•°å®šä¹‰</span>ï¼š<span style="color: #89986D; font-weight: bold;">è¯¥èŠ‚å°†æ•°æ®å…³è”ä»»åŠ¡é‡æ„ä¸ºåŠ¨æ€å›¾ä¸Šçš„é“¾è·¯é¢„æµ‹é—®é¢˜ ï¼Œåˆ©ç”¨èŠ‚ç‚¹åµŒå…¥çš„å“ˆè¾¾ç›ç§¯é…åˆ Softmax åˆ†ç±»å™¨è®¡ç®—å…³è”æ¦‚ç‡ ã€‚ä¸ºé©±åŠ¨æ¨¡å‹æ¼”è¿›ï¼Œå®šä¹‰äº†è€¦åˆâ€œè¡¨ç¤ºå­¦ä¹ â€ä¸â€œåˆ†ç±»ç²¾åº¦â€çš„è”åˆæŸå¤±å‡½æ•° ï¼Œé€šè¿‡æ­£æ ·æœ¬æ‹‰è¿‘ã€è´Ÿæ ·æœ¬æ¨å¼€åŠåˆ†ç±»è¯¯å·®ç›‘ç£ä¸‰é‡çº¦æŸã€‚</span></p></li></ul><p>æœ€åæ˜¯è®­ç»ƒéƒ¨åˆ†ï¼Œæ¨¡å‹çš„æ ¸å¿ƒåœ¨äº<span style="color: #BB8ED0; font-weight: bold;">è”åˆå­¦ä¹ ï¼ˆJoint Learningï¼‰</span>ï¼Œå³åŒæ—¶è®­ç»ƒè‡ªæ³¨æ„åŠ›æ¨¡å—å’Œé“¾è·¯åˆ†ç±»å™¨ã€‚</p><p>æ¨¡å‹å°†æ•°æ®åˆ‡åˆ†ä¸ºå¤§å°ä¸º 3 çš„<strong>æ—¶ç©ºå—ï¼ˆChunksï¼‰</strong>ï¼Œæ¨¡æ‹Ÿè¿‡å»-ç°åœ¨çš„æ—¶é—´è·¨åº¦è¿›è¡Œé¢„æµ‹è®­ç»ƒã€‚æ¯ä¸€ä¸ªæ—¶ç©ºå—å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾®ç¼©çš„åŠ¨æ€å›¾æ¼”åŒ–åºåˆ—ï¼šæ¨¡å‹åˆ©ç”¨å‰ä¸¤ä¸ªæ—¶é—´æ­¥ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>âˆ’</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">t-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69841em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69841em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ï¼‰å·²å»ºç«‹çš„å›¾ç»“æ„å’ŒèŠ‚ç‚¹ç‰¹å¾ä½œä¸ºå†å²ä¸Šä¸‹æ–‡ï¼Œæ¥é¢„æµ‹å½“å‰æ­¥ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼‰æ–°åŠ å…¥èŠ‚ç‚¹çš„èº«ä»½åˆ†é…ã€‚</p><p>æœ€ç»ˆçš„æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªä»¥ <span style="color: #89986D; font-weight: bold;">2å±‚SAL + 2å±‚TAL + 1å±‚å…¨è¿æ¥åˆ†ç±»å™¨ </span>ä¸ºæ ¸å¿ƒçš„åŠ¨æ€å›¾ç¥ç»ç½‘ç»œã€‚å®ƒæ˜¯ä»¥ DeepSORT äº§ç”Ÿçš„å±€éƒ¨è½¨è¿¹ä¸ºè¾“å…¥ï¼Œåœ¨ Tensorflow ç¯å¢ƒä¸‹åˆ©ç”¨ Adam ä¼˜åŒ–å™¨å®Œæˆæœ€ç»ˆè®­ç»ƒçš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®ºæ–‡ç²¾è¯» DyGLIP: A Dynamic Graph Model with Link Prediction forAccurate Multi-Camera Multiple Object Tracking&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>åŸºäºCesiumçš„ä¸‰ç»´è§†é”¥ç»˜åˆ¶ä¸ç”»é¢æ¨¡æ‹Ÿ</title>
    <link href="https://atffang.github.io/2025/12/22/%E5%9F%BA%E4%BA%8ECesium%E7%9A%84%E4%B8%89%E7%BB%B4%E8%A7%86%E9%94%A5%E7%BB%98%E5%88%B6%E4%B8%8E%E7%94%BB%E9%9D%A2%E6%A8%A1%E6%8B%9F/"/>
    <id>https://atffang.github.io/2025/12/22/%E5%9F%BA%E4%BA%8ECesium%E7%9A%84%E4%B8%89%E7%BB%B4%E8%A7%86%E9%94%A5%E7%BB%98%E5%88%B6%E4%B8%8E%E7%94%BB%E9%9D%A2%E6%A8%A1%E6%8B%9F/</id>
    <published>2025-12-22T06:41:48.000Z</published>
    <updated>2026-01-10T14:29:05.775Z</updated>
    
    <content type="html"><![CDATA[<p>åŸºäºCesiumçš„ä¸‰ç»´è§†é”¥ç»˜åˆ¶ä¸ç”»é¢æ¨¡æ‹Ÿ</p><span id="more"></span><p>æœ‰æœ‹å‹å’¨è¯¢æˆ‘cesiumä¸‹çš„è§†é”¥ç»˜åˆ¶ä¸ç›‘æ§è§†è§’æ¨¡æ‹Ÿæ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿™é‡Œä»¥JavaScriptä¸ºä¾‹ï¼Œç»™å‡ºä¸€äº›ç¤ºä¾‹ä»£ç ã€‚å‰ç½®æ¡ä»¶æ˜¯ï¼Œåˆ›å»ºäº†Cesiumçš„Viewerï¼Œè€Œä¸ºäº†è§‚å¯Ÿæ›´åŠ çœŸå®çš„æ¨¡æ‹Ÿè§†è§’ï¼Œå¯ä»¥å‘åœ°å›¾æ·»åŠ 3dtilesã€‚<br /><img src="https://atffang.github.io/2025/12/22/åŸºäºCesiumçš„ä¸‰ç»´è§†é”¥ç»˜åˆ¶ä¸ç”»é¢æ¨¡æ‹Ÿ/è§†é”¥1.jpg"/><br /><img src="https://atffang.github.io/2025/12/22/åŸºäºCesiumçš„ä¸‰ç»´è§†é”¥ç»˜åˆ¶ä¸ç”»é¢æ¨¡æ‹Ÿ/è§†é”¥2.jpg"/></p><p><strong>ç©ºé—´å®šä½å‚æ•°</strong>ï¼šå…±åŒç¡®å®šäº†è§†é”¥ä½“çš„é¡¶ç‚¹ä½ç½®åŠå…¶åœ¨ä¸‰ç»´åœ°çƒåæ ‡ç³»ä¸­çš„æŒ‡å‘ã€‚</p><ul><li><strong>Position (Lon, Lat, Alt)</strong>ï¼šè§†é”¥ä½“çš„<strong>é¡¶ç‚¹åæ ‡</strong>ã€‚å®ƒæ˜¯ç›¸æœºçš„å…‰å¿ƒä½ç½®ï¼Œå³æ‰€æœ‰è§†çº¿çš„æ±‡èšç‚¹ã€‚åœ¨ Cesium ä¸­é€šå¸¸ä½¿ç”¨ç»çº¬åº¦å’Œé«˜åº¦</li><li><strong>Orientation (Heading, Pitch, Roll)</strong>ï¼šè§†é”¥ä½“çš„*<ul><li><strong>Heading</strong>ï¼šå†³å®šæ°´å¹³æ—‹è½¬ï¼ˆå·¦å³çœ‹ï¼‰</li><li><strong>Pitch</strong>ï¼šå†³å®šä¿¯ä»°è§’åº¦ï¼ˆä¸Šä¸‹çœ‹ï¼‰ï¼Œé€šå¸¸ç›‘æ§è§†è§’ä¸ºè´Ÿå€¼ã€‚</li><li><strong>Roll</strong>ï¼šå†³å®šç›¸æœºçš„ä¾§å€¾ï¼ˆ</li></ul></li></ul><p><strong>é•œå¤´å‡ ä½•å‚æ•°</strong>ï¼šå®šä¹‰äº†è§†é”¥ä½“æˆªé¢çš„å½¢çŠ¶ï¼Œæ¨¡æ‹Ÿäº†ä¸åŒç„¦è·é•œå¤´äº§ç”Ÿçš„è§†è§‰æ•ˆæœã€‚</p><ul><li><strong>FOV (Field of View - è§†åœºè§’)</strong>ï¼šé€šå¸¸æŒ‡<strong>å‚ç›´æ–¹å‘çš„å¼ è§’</strong>ã€‚FOV è¶Šå¤§ï¼Œç”»é¢å®¹çº³çš„å†…å®¹è¶Šå¤šï¼ˆå¹¿è§’é•œå¤´ï¼‰ï¼›FOV è¶Šå°ï¼Œç”»é¢è¶Šçª„ï¼ˆé•¿ç„¦é•œå¤´ï¼‰ã€‚</li><li><strong>Aspect Ratio (å®½é«˜æ¯”)</strong>ï¼šå³è§†é‡æˆªé¢çš„<strong>å®½åº¦ä¸é«˜åº¦ä¹‹æ¯”</strong>ã€‚å®ƒå¿…é¡»ä¸ä½ çš„æ˜¾ç¤ºç”»å¸ƒï¼ˆCanvasï¼‰æˆ–è§†é¢‘æµï¼ˆå¦‚ 16:9ï¼‰ä¸€è‡´ï¼Œå¦åˆ™ç”»é¢ä¼šäº§ç”Ÿæ‹‰ä¼¸æˆ–å‹ç¼©ã€‚</li></ul><p><strong>è£å‰ªå¹³é¢å‚æ•°</strong>ï¼šå®šä¹‰äº†è§†é”¥ä½“åœ¨è§†çº¿æ–¹å‘ä¸Šçš„æœ‰æ•ˆæ¸²æŸ“èŒƒå›´ã€‚</p><ul><li><strong>Near (è¿‘è£å‰ªé¢)</strong>ï¼šè·ç¦»ç›¸æœºçš„æœ€è¿‘å¯è§è·ç¦»ã€‚å°äºæ­¤è·ç¦»çš„ç‰©ä½“ä¼šè¢«åˆ‡æ‰ï¼ˆé˜²æ­¢ç›¸æœºç©¿æ¨¡ï¼‰ã€‚</li><li><strong>Far (è¿œè£å‰ªé¢)</strong>ï¼šè·ç¦»ç›¸æœºçš„æœ€è¿œå¯è§è·ç¦»ã€‚è¶…è¿‡æ­¤è·ç¦»çš„ç‰©ä½“å°†ä¸å†æ¸²æŸ“ï¼Œè¿™ç›´æ¥å½±å“æ¸²æŸ“æ€§èƒ½å’Œåœ°å¹³çº¿çš„å¯è§åº¦ã€‚</li></ul><p>ç»˜åˆ¶æµç¨‹é¦–å…ˆé€šè¿‡ <code>Cesium.Cartesian3.fromDegrees</code> å°†ç»çº¬åº¦é«˜åº¦è½¬æ¢ä¸ºç©ºé—´ä½ç½®ï¼Œéšååˆ©ç”¨ <code>HeadingPitchRoll</code> ç»“åˆ <strong>-90 åº¦çš„åæ ‡ç³»åç§»æ ¡å‡†</strong>ç”Ÿæˆå››å…ƒæ•°ï¼Œä»¥ç¡®å®šè§†é”¥åœ¨åœ°çƒè¡¨é¢çš„ç²¾ç¡®æŒ‡å‘ã€‚<br />æ¥ç€å®ä¾‹åŒ– <code>PerspectiveFrustum</code> æ¥å®šä¹‰é€è§†çŸ©é˜µçš„æ ¸å¿ƒå±æ€§ï¼ˆå¦‚å¼ è§’ã€å®½é«˜æ¯”åŠè¿œè¿‘å¹³é¢ï¼‰ï¼Œå¹¶åŸºäºæ­¤æ•°å­¦æ¨¡å‹åˆ†åˆ«åˆ›å»º <code>FrustumGeometry</code>ï¼ˆå¡«å……ä½“ï¼‰å’Œ <code>FrustumOutlineGeometry</code>ï¼ˆè½®å»“çº¿ï¼‰ä¸¤ä¸ªå‡ ä½•å®ä¾‹ã€‚<br />æœ€åï¼Œé€šè¿‡è®¾ç½® <code>ColorGeometryInstanceAttribute</code> å®šä¹‰é¢œè‰²ä¸é€æ˜åº¦ï¼Œå°†å®ä¾‹å°è£…è¿› <code>Primitive</code> ä¸­å¹¶åŒæ­¥æ·»åŠ åˆ°åœºæ™¯é›†åˆ <code>viewer.scene.primitives</code>ï¼Œä»è€Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­æ¸²æŸ“å‡ºä¸€ä¸ªä»£è¡¨ç›¸æœºç›‘æ§èŒƒå›´çš„åŠé€æ˜å››æ£±å°ã€‚</p><p>ç»™å‡ºå®ç°ç»˜åˆ¶è§†é”¥çš„ä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cesium è§†é”¥ä½“ï¼ˆä¼ æ„Ÿå™¨/ç›¸æœºè§†é‡ï¼‰å¯è§†åŒ–å·¥å…·</span></span><br><span class="line"><span class="comment"> * é€‚ç”¨åœºæ™¯ï¼šç›¸æœºç›‘æ§èŒƒå›´æ¨¡æ‹Ÿã€å¤šç›®æ ‡è·Ÿè¸ª(MTMC)è§†é‡å±•ç¤º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FrustumVisualizer</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªè§†é”¥ä½“åˆ°åœºæ™¯ä¸­</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Cesium.Viewer</span>&#125; <span class="variable">viewer</span> - Cesium è§†å›¾å®ä¾‹</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">params</span> - é…ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.lon - ç»åº¦ (åº¦)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.lat - çº¬åº¦ (åº¦)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.alt - é«˜åº¦ (ç±³)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.heading=0] - åèˆªè§’ (0ä¸ºæ­£åŒ—ï¼Œé¡ºæ—¶é’ˆä¸ºæ­£)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.pitch=-30] - ä¿¯ä»°è§’ (è´Ÿæ•°å‘ä¸‹çœ‹)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.vfov=60] - å‚ç›´è§†åœºè§’ (åº¦)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.aspectRatio=1.77] - å®½é«˜æ¯” (16/9 â‰ˆ 1.77)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.near=0.1] - è¿‘è£å‰ªé¢è·ç¦» (ç±³)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; [params.far=50] - è¿œè£å‰ªé¢è·ç¦» (ç±³)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Cesium.Color</span>&#125; [params.color] - è§†é”¥é¢œè‰²</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">Object</span>&#125; åŒ…å« fill å’Œ outline ä¸¤ä¸ª Primitive å¯¹è±¡çš„å®ä¾‹ï¼Œç”¨äºåç»­é”€æ¯</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">createFrustum</span>(<span class="params">viewer, params</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. æå–å‚æ•°å¹¶è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      lon, lat, alt,</span><br><span class="line">      heading = <span class="number">0</span>,</span><br><span class="line">      pitch = -<span class="number">30</span>,</span><br><span class="line">      vfov = <span class="number">60</span>,</span><br><span class="line">      aspectRatio = <span class="number">16</span> / <span class="number">9</span>,</span><br><span class="line">      near = <span class="number">0.5</span>,</span><br><span class="line">      far = <span class="number">50</span>,</span><br><span class="line">      color = <span class="title class_">Cesium</span>.<span class="property">Color</span>.<span class="property">RED</span></span><br><span class="line">    &#125; = params;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç©ºé—´ä½ç½®è®¡ç®—ï¼šå°†ç»çº¬åº¦è½¬æ¢ä¸º Cesium ç¬›å¡å°”ç©ºé—´åæ ‡ (XYZ)</span></span><br><span class="line">    <span class="keyword">const</span> position = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(lon, lat, alt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å§¿æ€è®¡ç®— (Orientation)</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šCesium é»˜è®¤ FrustumGeometry çš„æœå‘æ˜¯æ²¿å±€éƒ¨ Z è½´è´Ÿæ–¹å‘</span></span><br><span class="line">    <span class="comment">// ä¸ºäº†ç¬¦åˆåœ°å›¾å¸¸è§„ï¼ˆHeading 0æŒ‡å‘åŒ—ï¼‰ï¼Œéœ€è¦è¿›è¡Œ -90 åº¦çš„åæ ‡ç³»åç§»æ ¡å‡†</span></span><br><span class="line">    <span class="keyword">const</span> hpr = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">HeadingPitchRoll</span>(</span><br><span class="line">      <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(heading - <span class="number">90</span>), <span class="comment">// è°ƒæ•´ Heading ä½¿ 0 åº¦æŒ‡å‘åŒ—æ–¹</span></span><br><span class="line">      <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(pitch - <span class="number">90</span>),   <span class="comment">// è°ƒæ•´ Pitch ä½¿ 0 åº¦æ°´å¹³ï¼Œè´Ÿå€¼å‘ä¸‹</span></span><br><span class="line">      <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(<span class="number">0</span>)             <span class="comment">// Roll æ»šåŠ¨è§’</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä½ç½®å’Œæ—‹è½¬è§’åº¦è½¬æ¢ä¸ºå››å…ƒæ•°ï¼ˆQuaternionï¼‰ï¼Œè¿™æ˜¯ Cesium å®šä½å‡ ä½•ä½“çš„æ ‡å‡†æ–¹å¼</span></span><br><span class="line">    <span class="keyword">const</span> orientationQuat = <span class="title class_">Cesium</span>.<span class="property">Transforms</span>.<span class="title function_">headingPitchRollQuaternion</span>(position, hpr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å®šä¹‰è§†é”¥å‡ ä½•å±æ€§ (Frustum Definition)</span></span><br><span class="line">    <span class="keyword">const</span> frustum = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">PerspectiveFrustum</span>(&#123;</span><br><span class="line">      <span class="attr">fov</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(vfov), <span class="comment">// å¼§åº¦å•ä½çš„è§†åœºè§’</span></span><br><span class="line">      <span class="attr">aspectRatio</span>: <span class="number">1.0</span> / aspectRatio,   <span class="comment">// æ³¨æ„ï¼šCesium çš„å‡ ä½•å®½é«˜æ¯”é€šå¸¸å–å€’æ•°</span></span><br><span class="line">      <span class="attr">near</span>: near,</span><br><span class="line">      <span class="attr">far</span>: far</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. åˆ›å»ºâ€œå¡«å……ä½“â€å‡ ä½•å®ä¾‹</span></span><br><span class="line">    <span class="keyword">const</span> fillInstance = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">GeometryInstance</span>(&#123;</span><br><span class="line">      <span class="attr">geometry</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">FrustumGeometry</span>(&#123;</span><br><span class="line">        <span class="attr">frustum</span>: frustum,</span><br><span class="line">        <span class="attr">origin</span>: position,</span><br><span class="line">        <span class="attr">orientation</span>: orientationQuat,</span><br><span class="line">        <span class="attr">vertexFormat</span>: <span class="title class_">Cesium</span>.<span class="property">VertexFormat</span>.<span class="property">POSITION_ONLY</span> <span class="comment">// ä»…éœ€ä½ç½®ä¿¡æ¯ï¼Œæé«˜æ¸²æŸ“æ•ˆç‡</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">attributes</span>: &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®å®ä¾‹é¢œè‰²å±æ€§</span></span><br><span class="line">        <span class="attr">color</span>: <span class="title class_">Cesium</span>.<span class="property">ColorGeometryInstanceAttribute</span>.<span class="title function_">fromColor</span>(color.<span class="title function_">withAlpha</span>(<span class="number">0.25</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. åˆ›å»ºâ€œè½®å»“çº¿â€å‡ ä½•å®ä¾‹</span></span><br><span class="line">    <span class="keyword">const</span> outlineInstance = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">GeometryInstance</span>(&#123;</span><br><span class="line">      <span class="attr">geometry</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">FrustumOutlineGeometry</span>(&#123;</span><br><span class="line">        <span class="attr">frustum</span>: frustum,</span><br><span class="line">        <span class="attr">origin</span>: position,</span><br><span class="line">        <span class="attr">orientation</span>: orientationQuat</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">attributes</span>: &#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="title class_">Cesium</span>.<span class="property">ColorGeometryInstanceAttribute</span>.<span class="title function_">fromColor</span>(color.<span class="title function_">withAlpha</span>(<span class="number">0.8</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. å°†å‡ ä½•ä½“ä½œä¸º Primitive æ·»åŠ åˆ°åœºæ™¯</span></span><br><span class="line">    <span class="comment">// Primitive æ¯” Entity æ›´åº•å±‚ï¼Œé€‚åˆé«˜é¢‘åˆ›å»ºæˆ–å¤§é‡å±•ç¤º</span></span><br><span class="line">    <span class="keyword">const</span> fillPrimitive = viewer.<span class="property">scene</span>.<span class="property">primitives</span>.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Primitive</span>(&#123;</span><br><span class="line">      <span class="attr">geometryInstances</span>: fillInstance,</span><br><span class="line">      <span class="attr">appearance</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">PerInstanceColorAppearance</span>(&#123;</span><br><span class="line">        <span class="attr">closed</span>: <span class="literal">true</span>,      <span class="comment">// å°é—­å‡ ä½•ä½“</span></span><br><span class="line">        <span class="attr">translucent</span>: <span class="literal">true</span>  <span class="comment">// å¼€å¯é€æ˜æ”¯æŒ</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">asynchronous</span>: <span class="literal">false</span>  <span class="comment">// åŒæ­¥åˆ›å»ºï¼Œé˜²æ­¢ç¬¬ä¸€å¸§ä¸æ˜¾ç¤º</span></span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> outlinePrimitive = viewer.<span class="property">scene</span>.<span class="property">primitives</span>.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">Primitive</span>(&#123;</span><br><span class="line">      <span class="attr">geometryInstances</span>: outlineInstance,</span><br><span class="line">      <span class="attr">appearance</span>: <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">PerInstanceColorAppearance</span>(&#123;</span><br><span class="line">        <span class="attr">flat</span>: <span class="literal">true</span>,        <span class="comment">// çº¿æ¡ä½¿ç”¨æ‰å¹³ç€è‰²ï¼Œä¸è®¡ç®—å…‰ç…§</span></span><br><span class="line">        <span class="attr">translucent</span>: <span class="literal">true</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">asynchronous</span>: <span class="literal">false</span></span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å¯¹è±¡ï¼Œæ–¹ä¾¿å¤–éƒ¨ç®¡ç†ï¼ˆå¦‚ï¼šremovalï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">fill</span>: fillPrimitive, <span class="attr">outline</span>: outlinePrimitive &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½ çš„ä¸»é€»è¾‘æ–‡ä»¶ä¸­ï¼Œç›´æ¥ä¼ å…¥åæ ‡å’Œæ—‹è½¬å‚æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾ä½ å·²ç»åˆå§‹åŒ–äº† viewer</span></span><br><span class="line"><span class="keyword">const</span> cameraOptions = &#123;</span><br><span class="line">  <span class="attr">lon</span>: <span class="number">121.45</span>,       <span class="comment">// ç»åº¦</span></span><br><span class="line">  <span class="attr">lat</span>: <span class="number">31.22</span>,        <span class="comment">// çº¬åº¦</span></span><br><span class="line">  <span class="attr">alt</span>: <span class="number">10</span>,          <span class="comment">// ç¦»åœ°é«˜åº¦ 10 ç±³</span></span><br><span class="line">  <span class="attr">heading</span>: <span class="number">45</span>,       <span class="comment">// æœå‘ä¸œåŒ—</span></span><br><span class="line">  <span class="attr">pitch</span>: -<span class="number">45</span>,        <span class="comment">// å‘ä¸‹ä¿¯å†² 45 åº¦çœ‹åœ°é¢</span></span><br><span class="line">  <span class="attr">vfov</span>: <span class="number">50</span>,          <span class="comment">// è§†é‡èŒƒå›´</span></span><br><span class="line">  <span class="attr">color</span>: <span class="title class_">Cesium</span>.<span class="property">Color</span>.<span class="property">AQUA</span> <span class="comment">// ä¹Ÿå¯ä»¥è‡ªå®šä¹‰é¢œè‰²</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨å¹¶å­˜å‚¨è¿”å›çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> myFrustum = <span class="title class_">FrustumVisualizer</span>.<span class="title function_">createFrustum</span>(viewer, cameraOptions);</span><br></pre></td></tr></table></figure><p>æ¨¡æ‹Ÿæµç¨‹é¦–å…ˆæ ¹æ®ä¼ æ„Ÿå™¨åæ ‡è®¾å®šç›¸æœºçš„ <code>destination</code> ç›®æ ‡ä½ç½®ï¼Œéšåè°ƒç”¨ <code>viewer.camera.flyTo</code> å¹¶ä¼ å…¥åŸå§‹çš„èˆªå‘è§’ï¼ˆHeadingï¼‰ä¸ä¿¯ä»°è§’ï¼ˆPitchï¼‰ï¼Œå¯åŠ¨å¹³æ»‘é£è¡Œè¿‡æ¸¡ä»¥å¯¹å‡†è§‚å¯Ÿæ–¹å‘ã€‚<br />åœ¨ç›¸æœºé£æŠµæŒ‡å®šç‚¹åï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯<strong>æ‰‹åŠ¨è¦†ç›– <code>viewer.camera.frustum</code> å±æ€§</strong>ï¼Œé€šè¿‡ <code>new Cesium.PerspectiveFrustum</code> å¼ºåˆ¶ä¿®æ”¹ç›¸æœºçš„æŠ•å½±çŸ©é˜µã€‚é€šè¿‡åŒæ­¥å‚ç›´è§†åœºè§’ï¼ˆfovï¼‰ã€ç”»å¸ƒå®½é«˜æ¯”ï¼ˆaspectRatioï¼‰ä»¥åŠè¿œè¿‘è£å‰ªé¢ï¼Œä½¿å½“å‰å±å¹•æ˜¾ç¤ºçš„æ¸²æŸ“ç”»é¢ä¸ä¹‹å‰åœ¨åœºæ™¯ä¸­ç»˜åˆ¶çš„çº¢è‰²è§†é”¥å‡ ä½•ä½“åœ¨æ•°å­¦æŠ•å½±ä¸Šå®Œå…¨é‡åˆã€‚<br />ç»™å‡ºæ¨¡æ‹Ÿè§†é”¥è§†è§’çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†åœºæ™¯ç›¸æœºå®šä½è‡³æŒ‡å®šä¼ æ„Ÿå™¨è§†è§’ï¼Œå¹¶åŒæ­¥é•œå¤´å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Cesium.Viewer</span>&#125; <span class="variable">viewer</span> - Cesium è§†å›¾å®ä¾‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; <span class="variable">props</span> - ä¼ æ„Ÿå™¨å‚æ•°å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.lon - ç»åº¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.lat - çº¬åº¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.alt - é«˜åº¦ (ç±³)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.heading - åèˆªè§’ (åº¦)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.pitch - ä¿¯ä»°è§’ (åº¦)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.vfov - å‚ç›´è§†åœºè§’ (åº¦)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.aspectRatio - å®½é«˜æ¯”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.near - è¿‘è£å‰ªé¢è·ç¦»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; props.far - è¿œè£å‰ªé¢è·ç¦»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">goToCameraView</span>(<span class="params">viewer, props</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!viewer || !props) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. è®¡ç®—ç›¸æœºç›®æ ‡ä½ç½® (Cartesian3 ç¬›å¡å°”åæ ‡)</span></span><br><span class="line">  <span class="keyword">const</span> destination = <span class="title class_">Cesium</span>.<span class="property">Cartesian3</span>.<span class="title function_">fromDegrees</span>(</span><br><span class="line">    props.<span class="property">lon</span>, </span><br><span class="line">    props.<span class="property">lat</span>, </span><br><span class="line">    props.<span class="property">alt</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. æ‰§è¡Œç›¸æœºé£è¡Œå®šä½</span></span><br><span class="line">  viewer.<span class="property">camera</span>.<span class="title function_">flyTo</span>(&#123;</span><br><span class="line">    <span class="attr">destination</span>: destination,</span><br><span class="line">    <span class="attr">orientation</span>: &#123;</span><br><span class="line">      <span class="comment">// Cesium ç›¸æœºé»˜è®¤ 0 åº¦æŒ‡å‘æ­£åŒ—ï¼Œæ— éœ€åƒå‡ ä½•ä½“é‚£æ ·åš -90 åº¦æ ¡å‡†</span></span><br><span class="line">      <span class="attr">heading</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(props.<span class="property">heading</span>),</span><br><span class="line">      <span class="attr">pitch</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(props.<span class="property">pitch</span>),</span><br><span class="line">      <span class="attr">roll</span>: <span class="number">0.0</span> <span class="comment">// ä¿æŒæ°´å¹³ï¼Œä¸ç¿»è½¬</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">1.5</span> <span class="comment">// é£è¡ŒæŒç»­æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. åŒæ­¥ç›¸æœºçš„è§†é”¥ä½“ï¼ˆLens Parametersï¼‰</span></span><br><span class="line">  <span class="comment">// æ ¸å¿ƒé€»è¾‘ï¼šå°†è™šæ‹Ÿç›¸æœºçš„â€œé•œå¤´â€ä¿®æ”¹ä¸ºä¸ç»˜åˆ¶çš„è§†é”¥å‡ ä½•å®Œå…¨ä¸€è‡´</span></span><br><span class="line">  viewer.<span class="property">camera</span>.<span class="property">frustum</span> = <span class="keyword">new</span> <span class="title class_">Cesium</span>.<span class="title class_">PerspectiveFrustum</span>(&#123;</span><br><span class="line">    <span class="comment">// å°†å‚ç›´è§†åœºè§’ä»åº¦è½¬æ¢ä¸ºå¼§åº¦</span></span><br><span class="line">    <span class="attr">fov</span>: <span class="title class_">Cesium</span>.<span class="property">Math</span>.<span class="title function_">toRadians</span>(props.<span class="property">vfov</span>),</span><br><span class="line">    <span class="comment">// ç”»é¢å®½é«˜æ¯”ï¼Œå†³å®šäº†æ¨ªå‘è§†é‡çš„å¼€é˜”åº¦</span></span><br><span class="line">    <span class="attr">aspectRatio</span>: props.<span class="property">aspectRatio</span>,</span><br><span class="line">    <span class="comment">// å†³å®šç›¸æœºèƒ½çœ‹åˆ°çš„æœ€è¿‘å’Œæœ€è¿œè·ç¦»</span></span><br><span class="line">    <span class="attr">near</span>: props.<span class="property">near</span>,</span><br><span class="line">    <span class="attr">far</span>: props.<span class="property">far</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸºäºCesiumçš„ä¸‰ç»´è§†é”¥ç»˜åˆ¶ä¸ç”»é¢æ¨¡æ‹Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="å·¥å…·" scheme="https://atffang.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>ä»0å¼€å§‹å­¦JAVA 4 JAVAçº¿ç¨‹æ–¹æ³•æ±‡æ€»</title>
    <link href="https://atffang.github.io/2025/12/22/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/"/>
    <id>https://atffang.github.io/2025/12/22/JAVA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/</id>
    <published>2025-12-22T02:37:17.000Z</published>
    <updated>2026-01-10T14:21:39.860Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸‡å­—é•¿æ–‡æ¢³ç†JAVAçº¿ç¨‹æ–¹æ³•çš„åŸºç¡€åº”ç”¨</p><span id="more"></span><h3 id="ç¬¬ä¸€ç« å¤šçº¿ç¨‹åŸºç¡€"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€ç« å¤šçº¿ç¨‹åŸºç¡€"></a> ç¬¬ä¸€ç« ï¼šå¤šçº¿ç¨‹åŸºç¡€</h3><p>åœ¨ Java ä¸­ï¼Œçº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒã€‚ç†è§£å¤šçº¿ç¨‹ï¼Œé¦–å…ˆè¦ä»å¦‚ä½•å¯åŠ¨å®ƒã€å®ƒç»å†è¿‡å“ªäº›çŠ¶æ€ã€ä»¥åŠæˆ‘ä»¬å¦‚ä½•æ§åˆ¶å®ƒå¼€å§‹ã€‚</p><h4 id="çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼"><a class="markdownIt-Anchor" href="#çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼"></a> çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼</h4><p>è™½ç„¶æœ€ç»ˆéƒ½æ˜¯é€šè¿‡ <code>Thread.start()</code> å¯åŠ¨ï¼Œä½† Java æä¾›äº†<strong>ä¸‰ç§ä¸»è¦çš„ä»»åŠ¡å®šä¹‰æ–¹å¼</strong>ï¼š</p><ul><li><strong>ç»§æ‰¿ <code>Thread</code> ç±»</strong>ï¼š<ul><li><strong>åšæ³•</strong>ï¼šå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿ <code>Thread</code> å¹¶é‡å†™ <code>run()</code> æ–¹æ³•ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šJava æ˜¯å•ç»§æ‰¿çš„ï¼Œç»§æ‰¿äº† Thread å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ï¼ˆå¦‚ BaseServiceï¼‰ï¼Œçµæ´»æ€§å·®ã€‚</li></ul></li></ul><p>æˆ‘ä»¬ç›´æ¥newä¸€ä¸ªTreadç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>.run();  </span><br><span class="line">            System.out.println(<span class="string">&quot;run: &quot;</span> + <span class="built_in">this</span>.getState());</span><br><span class="line">              </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">  </span><br><span class="line">    System.out.println(<span class="string">&quot;main: &quot;</span> + thread.getState());  </span><br><span class="line">    thread.start();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å®ç° <code>Runnable</code> æ¥å£</strong>ï¼ˆæ¨èï¼‰ï¼š<ul><li><strong>åšæ³•</strong>ï¼šå®ç° <code>run()</code> æ–¹æ³•ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Thread</code> æ„é€ å‡½æ•°ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šè§£è€¦äº†â€œä»»åŠ¡é€»è¾‘â€ä¸â€œçº¿ç¨‹èµ„æºâ€ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒåŒä¸€ä¸ª <code>Runnable</code> å®ä¾‹ï¼Œé€‚åˆèµ„æºå…±äº«ã€‚</li></ul></li></ul><p><strong><code>Runnable</code> æ¥å£</strong>ã€‚<code>Runnable</code> æ˜¯ Java ä¸­ä¸€ä¸ªåŠŸèƒ½æ€§çš„æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª <code>run()</code> æ–¹æ³•ã€‚å®ç°è¿™ä¸ªæ¥å£çš„ç±»ï¼ˆå¦‚ <code>TaskRunnable</code>ï¼‰è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p><strong><code>Thread</code> ä¸ <code>Runnable</code></strong>ï¼š<code>Thread</code> ç±»ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹ï¼Œä½†å®ƒå¹¶ä¸ç›´æ¥å®šä¹‰è¦åšä»€ä¹ˆã€‚<code>Thread</code> éœ€è¦ä¸€ä¸ª <code>Runnable</code> å¯¹è±¡ï¼Œæ¥ç¡®å®šçº¿ç¨‹å¯åŠ¨ååº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œ<code>Thread</code> ä¼šå°†ä¸€ä¸ª <code>Runnable</code> å¯¹è±¡ä¼ ç»™å…¶æ„é€ æ–¹æ³•ï¼Œè¿™æ ·çº¿ç¨‹å°±çŸ¥é“äº†æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ã€‚</p><p>æˆ‘ä»¬å®ç°ä¸€ä¸ª<code>runnableæ¥å£</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">    <span class="type">TaskRunnable</span> <span class="variable">taskRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TaskRunnable</span>();  </span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(taskRunnable);  </span><br><span class="line">    thread.start();  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        Thread.sleep(<span class="number">10000</span>);  </span><br><span class="line">        taskRunnable.cancel();  </span><br><span class="line">          </span><br><span class="line">    &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TaskRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">boolean</span> cancel;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (cancel)&#123;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">try</span>&#123;  </span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);  </span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;  </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">            &#125;  </span><br><span class="line">  </span><br><span class="line">            System.out.println(<span class="string">&quot;running&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span> &#123;  </span><br><span class="line">        cancel = <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å®ç° <code>Callable</code> æ¥å£</strong>ï¼š<ul><li><strong>åšæ³•</strong>ï¼šå®ç° <code>call()</code> æ–¹æ³•ï¼Œé…åˆ <code>FutureTask</code> æˆ–çº¿ç¨‹æ± ä½¿ç”¨ã€‚</li><li><strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š<code>call()</code> æ–¹æ³•<strong>æœ‰è¿”å›å€¼</strong>ä¸”<strong>å…è®¸æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œè€Œ <code>run()</code> ä¸è¡Œã€‚</li></ul></li></ul><p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª<code>Callable</code> æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableBaseDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. å®šä¹‰ä»»åŠ¡ï¼šå®ç° Callable æ¥å£ï¼Œæ³›å‹ String æ˜¯è¿”å›å€¼çš„ç±»å‹</span></span><br><span class="line">        Callable&lt;String&gt; myTask = <span class="keyword">new</span> <span class="title class_">Callable</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>); <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼šè¿™æ˜¯ä»å­çº¿ç¨‹è¿”å›çš„ç»“æœï¼&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åŒ…è£…ä»»åŠ¡ï¼šç”±äº Thread æ„é€ æ–¹æ³•åªæ¥æ”¶ Runnableï¼Œ</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬éœ€è¦ç”¨ FutureTask åŒ…è£…ä¸€ä¸‹ã€‚FutureTask å®ç°äº† Runnable æ¥å£ã€‚</span></span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(myTask);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ï¼šå·²ç»å¯åŠ¨å­çº¿ç¨‹ï¼Œæˆ‘ç°åœ¨å¯ä»¥åšç‚¹åˆ«çš„äº‹...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. è·å–ç»“æœï¼šget() æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> futureTask.get(); </span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹æ”¶åˆ°çš„ç»“æœ: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œä¸‰ç§å®ç°æ–¹å¼çš„åŒºåˆ«åœ¨äºï¼š</p><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Thread</strong></th><th><strong>Runnable</strong></th><th><strong>Callable</strong></th></tr></thead><tbody><tr><td><strong>ç»§æ‰¿æ€§</strong></td><td>é™åˆ¶å•ç»§æ‰¿</td><td>æ— é™åˆ¶</td><td>æ— é™åˆ¶</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>æ— </td><td>æ— </td><td>æœ‰ (Futureè·å–)</td></tr><tr><td><strong>å¼‚å¸¸æŠ›å‡º</strong></td><td>åªèƒ½å†…éƒ¨æ•è·</td><td>åªèƒ½å†…éƒ¨æ•è·</td><td>å…è®¸ throws æŠ›å‡º</td></tr></tbody></table><h4 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€è½¬æ¢-state-machine"><a class="markdownIt-Anchor" href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€è½¬æ¢-state-machine"></a> çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€è½¬æ¢ (State Machine)</h4><p>Java çº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸå†…å¹¶ä¸æ˜¯ä¸€ç›´å ç€ CPU ä¸æ”¾ï¼Œå®ƒä¼šåœ¨å¤šç§çŠ¶æ€é—´åˆ‡æ¢ã€‚é€šè¿‡ <code>thread.getState()</code> å¯ä»¥è·å–ä»¥ä¸‹å…­ç§çŠ¶æ€ï¼š</p><ol><li><p><strong>NEW (æ–°å»º)</strong>ï¼š<code>new Thread()</code> ä¹‹åï¼Œè°ƒç”¨ <code>start()</code> ä¹‹å‰ã€‚</p></li><li><p><strong>RUNNABLE (å¯è¿è¡Œ)</strong>ï¼šè°ƒç”¨äº† <code>start()</code>ã€‚åœ¨ Java ä¸­ï¼Œå°±ç»ªï¼ˆReadyï¼‰å’Œè¿è¡Œä¸­ï¼ˆRunningï¼‰ç»Ÿç§°ä¸ºâ€œå¯è¿è¡Œâ€ã€‚</p></li><li><p><strong>BLOCKED (é˜»å¡)</strong>ï¼šç­‰å¾…è·å– <code>synchronized</code> é”ã€‚</p></li><li><p><strong>WAITING (ç­‰å¾…)</strong>ï¼šè°ƒç”¨äº† <code>wait()</code>ã€<code>join()</code> æˆ– <code>LockSupport.park()</code>ã€‚éœ€è¦è¢«å…¶ä»–çº¿ç¨‹æ˜¾å¼å”¤é†’ã€‚</p></li><li><p><strong>TIMED_WAITING (è¶…æ—¶ç­‰å¾…)</strong>ï¼šè°ƒç”¨äº† <code>sleep(ms)</code>ã€<code>wait(ms)</code> ç­‰ã€‚æ—¶é—´åˆ°äº†è‡ªåŠ¨è‹é†’ã€‚</p></li><li><p><strong>TERMINATED (ç»ˆæ­¢)</strong>ï¼š<code>run()</code> æ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–å› å¼‚å¸¸é€€å‡ºã€‚</p></li></ol><img src="https://atffang.github.io/2025/12/22/JAVAå¤šçº¿ç¨‹æ–¹æ³•æ±‡æ€»/çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ.png"/><h4 id="åŸºç¡€æ§åˆ¶æ–¹æ³•"><a class="markdownIt-Anchor" href="#åŸºç¡€æ§åˆ¶æ–¹æ³•"></a> åŸºç¡€æ§åˆ¶æ–¹æ³•</h4><p>è¿™ä¸€èŠ‚ä»‹ç»çš„æ˜¯ Java <code>Thread</code> ç±»ä¸­æä¾›çš„å‡ ä¸ªæ ¸å¿ƒæ§åˆ¶æ–¹æ³•ï¼Œå®ƒä»¬å†³å®šäº†çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¡Œä¸ºã€‚</p><h5 id="1-sleeplong-millis"><a class="markdownIt-Anchor" href="#1-sleeplong-millis"></a> 1. sleep(long millis)</h5><p><code>sleep</code> æ˜¯é™æ€æ–¹æ³•ï¼Œä½¿å½“å‰çº¿ç¨‹è¿›å…¥ <strong>TIMED_WAITING</strong> çŠ¶æ€ï¼Œæš‚åœæ‰§è¡Œä¸€æ®µæ—¶é—´ã€‚</p><ul><li><strong>é”çš„è¡Œä¸º</strong>ï¼šçº¿ç¨‹åœ¨ç¡çœ æ—¶<strong>ä¸ä¼šé‡Šæ”¾</strong>å®ƒæŒæœ‰çš„ä»»ä½•é”ï¼ˆMonitor Lockï¼‰ã€‚</li><li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šç¡çœ ä¸­çš„çº¿ç¨‹å¦‚æœè¢«ä¸­æ–­ï¼Œä¼šæŠ›å‡º <code>InterruptedException</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>); <span class="comment">// æš‚åœ1ç§’</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹åœ¨ä¼‘çœ ä¸­è¢«ä¸­æ–­æ—¶çš„å¤„ç†é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-yield"><a class="markdownIt-Anchor" href="#2-yield"></a> 2. yield()</h5><p><code>yield</code> ä¹Ÿæ˜¯é™æ€æ–¹æ³•ï¼Œå®ƒè¡¨ç¤ºå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡º CPU çš„ä½¿ç”¨æƒã€‚</p><ul><li><strong>è°ƒåº¦ç»“æœ</strong>ï¼šè°ƒç”¨åï¼Œçº¿ç¨‹ä»â€œè¿è¡Œä¸­â€å˜ä¸ºâ€œå°±ç»ªâ€çŠ¶æ€ã€‚</li><li><strong>å±€é™æ€§</strong>ï¼šè¿™åªæ˜¯ä¸€ä¸ªâ€œå»ºè®®â€ï¼Œçº¿ç¨‹è°ƒåº¦å™¨å¯èƒ½ä¼šå¿½ç•¥å®ƒã€‚å¦‚æœå½“å‰æ²¡æœ‰å…¶ä»–åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å¯èƒ½ç«‹å³å†æ¬¡è·å¾— CPUã€‚</li><li><strong>é”çš„è¡Œä¸º</strong>ï¼šåŒæ ·ä¸ä¼šé‡Šæ”¾é”ã€‚</li></ul><h5 id="3-join"><a class="markdownIt-Anchor" href="#3-join"></a> 3. join()</h5><p><code>join</code> æ˜¯æˆå‘˜æ–¹æ³•ï¼Œç”¨äºåŒæ­¥å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚</p><ul><li><strong>ä½œç”¨</strong>ï¼šå¦‚æœåœ¨çº¿ç¨‹ A ä¸­è°ƒç”¨ <code>B.join()</code>ï¼Œåˆ™ A çº¿ç¨‹ä¼šè¿›å…¥ <strong>WAITING</strong> çŠ¶æ€ï¼Œç›´åˆ° B çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</li><li><strong>åŸç†</strong>ï¼šåº•å±‚è°ƒç”¨çš„æ˜¯ <code>Object.wait()</code> æ–¹æ³•ï¼Œå› æ­¤è°ƒç”¨è€…ä¼šé‡Šæ”¾æ‰ B çº¿ç¨‹å¯¹è±¡çš„é”ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="comment">/* è€—æ—¶ä»»åŠ¡ */</span> &#125;);</span><br><span class="line">t1.start();</span><br><span class="line">t1.join(); <span class="comment">// ä¸»çº¿ç¨‹åœ¨æ­¤é˜»å¡ï¼Œç›´åˆ° t1 å½»åº•è¿è¡Œç»“æŸ</span></span><br></pre></td></tr></table></figure><h5 id="4-interrupt"><a class="markdownIt-Anchor" href="#4-interrupt"></a> 4. interrupt()</h5><p>Java é‡‡ç”¨çš„æ˜¯åä½œå¼çš„ä¸­æ–­æœºåˆ¶ï¼Œè€Œä¸æ˜¯æš´åŠ›åœæ­¢ã€‚</p><ul><li><strong>interrupt()</strong>ï¼šå°†ç›®æ ‡çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½è®¾ä¸º <code>true</code>ã€‚</li><li><strong>isInterrupted()</strong>ï¼šå®ä¾‹æ–¹æ³•ï¼Œåˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ã€‚</li><li><strong>é™æ€ interrupted()</strong>ï¼šæ£€æŸ¥å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶<strong>æ¸…é™¤</strong>æ ‡å¿—ä½ã€‚</li><li><strong>ç‰¹æ®Šæƒ…å†µ</strong>ï¼šå¦‚æœçº¿ç¨‹æ­£é˜»å¡åœ¨ <code>sleep</code>ã€<code>wait</code>ã€<code>join</code> ç­‰æ–¹æ³•ä¸Šï¼Œ<code>interrupt()</code> ä¼šä½¿è¿™äº›æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶è‡ªåŠ¨æ¸…é™¤ä¸­æ–­çŠ¶æ€ï¼ˆå˜å› <code>false</code>ï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-å®ˆæŠ¤çº¿ç¨‹-daemon-thread"><a class="markdownIt-Anchor" href="#5-å®ˆæŠ¤çº¿ç¨‹-daemon-thread"></a> 5. å®ˆæŠ¤çº¿ç¨‹ (Daemon Thread)</h5><p>Java ä¸­çš„çº¿ç¨‹åˆ†ä¸ºâ€œç”¨æˆ·çº¿ç¨‹â€å’Œâ€œå®ˆæŠ¤çº¿ç¨‹â€</p><ul><li><strong>å®šä¹‰</strong>ï¼šå®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸ºç”¨æˆ·çº¿ç¨‹æœåŠ¡çš„ï¼ˆå¦‚ GC åƒåœ¾å›æ”¶ï¼‰ã€‚</li><li><strong>é€€å‡ºæœºåˆ¶</strong>ï¼šå½“ JVM ä¸­æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹éƒ½è¿è¡Œç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šéš JVM ä¸€èµ·ç›´æ¥é€€å‡ºï¼Œæ— è®ºå…¶ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚</li><li><strong>é™åˆ¶</strong>ï¼šå¿…é¡»åœ¨ <code>thread.start()</code> ä¹‹å‰è°ƒç”¨ <code>setDaemon(true)</code>ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">    <span class="type">Thread</span> <span class="variable">daemonThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;  </span><br><span class="line">            <span class="built_in">super</span>.run();  </span><br><span class="line">                System.out.println(getName() + <span class="string">&quot; &quot;</span> + System.currentTimeMillis());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;;  </span><br><span class="line">  </span><br><span class="line">    daemonThread.setName(<span class="string">&quot;B&quot;</span>);  </span><br><span class="line">    daemonThread.setDaemon(<span class="literal">true</span>);  </span><br><span class="line">  </span><br><span class="line">    daemonThread.start();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç« çº¿ç¨‹å®‰å…¨ä¸å†…å­˜æ¨¡å‹-safety-jmm"><a class="markdownIt-Anchor" href="#ç¬¬äºŒç« çº¿ç¨‹å®‰å…¨ä¸å†…å­˜æ¨¡å‹-safety-jmm"></a> ç¬¬äºŒç« ï¼šçº¿ç¨‹å®‰å…¨ä¸å†…å­˜æ¨¡å‹ (Safety &amp; JMM)</h3><p>çº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒåœ¨äºï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£è¿™ä¸ªå¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨"></a> ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><p>è¦å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå¿…é¡»ä¿è¯å¹¶å‘ç¼–ç¨‹çš„ä¸‰å¤§ç‰¹æ€§ï¼š</p><ol><li><p><strong>åŸå­æ€§ (Atomicity)</strong>ï¼šä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œä¸”åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</p><ul><li><em>å…¸å‹é—®é¢˜</em>ï¼š<code>i++</code> åŒ…å«è¯»ã€åŠ ã€å†™ä¸‰æ­¥ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹ä¸å…·å¤‡åŸå­æ€§ã€‚</li></ul></li><li><p><strong>å¯è§æ€§ (Visibility)</strong>ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚</p><ul><li><em>åŸå› </em>ï¼šJMM è§„å®šçº¿ç¨‹æœ‰å·¥ä½œå†…å­˜ï¼Œä¿®æ”¹å˜é‡åä¸ä¼šç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ã€‚</li></ul></li><li><p><strong>æœ‰åºæ€§ (Ordering)</strong>ï¼šç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p><ul><li><em>åŸå› </em>ï¼šç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå¾€å¾€ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œ<strong>é‡æ’åº</strong>ã€‚</li></ul></li></ol><h4 id="synchronized-å…³é”®å­—"><a class="markdownIt-Anchor" href="#synchronized-å…³é”®å­—"></a> <code>synchronized</code> å…³é”®å­—</h4><p><code>synchronized</code> æ˜¯ä¸€ç§äº’æ–¥é”ï¼Œå®ƒé€šè¿‡æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä»è€ŒåŒæ—¶ä¿è¯äº†åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p><p><code>synchronized</code> åº•å±‚ä¾èµ– JVM çš„ <strong>Monitorï¼ˆç›‘è§†å™¨é”ï¼‰</strong>ã€‚ç¼–è¯‘åä¼šç”Ÿæˆ <code>monitorenter</code> å’Œ <code>monitorexit</code> æŒ‡ä»¤ã€‚æ¯ä¸ªå¯¹è±¡å¤´ä¸­éƒ½æœ‰ Mark Wordï¼Œè®°å½•äº†é”çš„çŠ¶æ€ï¼ˆåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªä¸åŒçš„åº”ç”¨ï¼š</p><p><code>synchronized</code> æ–¹æ³•<br />åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šä½¿ç”¨ <code>synchronized</code>ï¼Œå¯ä»¥ä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥æ–¹æ³•ã€‚è¿™å¯¹äºæ¶‰åŠå…±äº«èµ„æºçš„æ“ä½œå¾ˆæœ‰ç”¨ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹èµ„æºå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥çš„ä»£ç å—</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸€äº›å¯¹å…±äº«èµ„æºçš„æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>synchronized</code> ä»£ç å—<br />æœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦æ•´ä¸ªæ–¹æ³•éƒ½ä¿æŒåŒæ­¥ï¼Œè€Œæ˜¯åªéœ€è¦æŸéƒ¨åˆ†ä»£ç åœ¨æ‰§è¡Œæ—¶æ˜¯äº’æ–¥çš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong><code>synchronized</code> ä»£ç å—</strong>ã€‚é€šè¿‡æŒ‡å®šä¸€ä¸ªå¯¹è±¡é”æ¥æ§åˆ¶ä»£ç å—çš„åŒæ­¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (é”å¯¹è±¡) &#123;</span><br><span class="line">    <span class="comment">// éœ€è¦åŒæ­¥çš„ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>é”å¯¹è±¡</code>ï¼šå®ƒå¯ä»¥æ˜¯ä»»æ„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡ã€‚<code>synchronized</code> å…³é”®å­—ä¼šå°†è¯¥å¯¹è±¡ä½œä¸ºé”ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´è¿›å…¥è¯¥ä»£ç å—ã€‚</p></li><li><p>å¦‚æœå¤šä¸ªçº¿ç¨‹è¯•å›¾åŒæ—¶è¿›å…¥è¯¥åŒæ­¥ä»£ç å—ï¼Œå®ƒä»¬å¿…é¡»ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯¥é”ã€‚</p></li><li><p><strong>æ–¹æ³•çº§é”</strong>ï¼šå½“ä½ ç”¨ <code>synchronized</code> ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œé”çš„ç²’åº¦æ˜¯<strong>æ–¹æ³•çº§åˆ«</strong>çš„ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®æ–¹æ³•ä¸­çš„åŒæ­¥éƒ¨åˆ†ã€‚</p></li><li><p><strong>ä»£ç å—çº§é”</strong>ï¼šä½¿ç”¨ <code>synchronized</code> ä»£ç å—æ—¶ï¼Œé”çš„ç²’åº¦æ˜¯<strong>ä»£ç å—çº§åˆ«</strong>çš„ã€‚å®ƒåªé”å®šç‰¹å®šçš„èµ„æºï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºä¸å¿…è¦çš„ä»£ç éƒ¨åˆ†ä¸ä¼šè¢«åŒæ­¥ã€‚</p></li></ul><p><code>wait()</code> æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ <strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å‘å‡ºé€šçŸ¥ï¼ˆé€šè¿‡ <code>notify()</code> æˆ– <code>notifyAll()</code>ï¼‰ã€‚å½“çº¿ç¨‹è°ƒç”¨ <code>wait()</code> æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„å¯¹è±¡é”ï¼Œå¹¶ä¸”è¿›å…¥ <strong>ç­‰å¾…é˜Ÿåˆ—</strong>ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</p><p><code>wait()</code> å¿…é¡»åœ¨ <strong>åŒæ­¥ä»£ç å—</strong> æˆ– <strong>åŒæ­¥æ–¹æ³•</strong> ä¸­è°ƒç”¨ï¼Œå› ä¸ºå®ƒéœ€è¦è·å¾—å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆå³ <code>synchronized</code> é”ï¼‰ã€‚å½“çº¿ç¨‹åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­è°ƒç”¨ <code>wait()</code> æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾å¯¹è±¡çš„é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è·å¾—é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (someObject) &#123;</span><br><span class="line">    <span class="keyword">while</span> (conditionNotMet) &#123;</span><br><span class="line">        someObject.wait();  <span class="comment">// çº¿ç¨‹åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶ç­‰å¾…</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œåç»­æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>notify()</code> æ–¹æ³•å”¤é†’ <strong>ä¸€ä¸ªç­‰å¾…ä¸­çš„çº¿ç¨‹</strong>ã€‚å½“çº¿ç¨‹è°ƒç”¨ <code>notify()</code> æ—¶ï¼Œå®ƒä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†å…¶å”¤é†’ï¼Œå”¤é†’åçš„çº¿ç¨‹ä¼šå°è¯•é‡æ–°è·å–å¯¹è±¡é”ï¼Œè·å¾—é”åæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><ul><li><code>notify()</code> å¿…é¡»åœ¨ <strong>åŒæ­¥ä»£ç å—</strong> æˆ– <strong>åŒæ­¥æ–¹æ³•</strong> ä¸­è°ƒç”¨ã€‚</li><li>è¢«å”¤é†’çš„çº¿ç¨‹ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿›å…¥ <strong>å¯è¿è¡ŒçŠ¶æ€</strong>ï¼Œç­‰å¾…è·å–å¯¹è±¡é”ã€‚</li></ul><p><code>notifyAll()</code> æ–¹æ³•å”¤é†’ <strong>æ‰€æœ‰ç­‰å¾…ä¸­çš„çº¿ç¨‹</strong>ã€‚ä¸ <code>notify()</code> ä¸åŒçš„æ˜¯ï¼Œ<code>notifyAll()</code> ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹ã€‚æ‰€æœ‰å”¤é†’çš„çº¿ç¨‹ä¼šäº‰å¤ºé”ï¼Œåªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedBuffer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">data</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(<span class="type">int</span> value)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (data != -<span class="number">1</span>) &#123;  <span class="comment">// å¦‚æœæ•°æ®å·²å­˜åœ¨ï¼Œç”Ÿäº§è€…ç­‰å¾…</span></span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        data = value;  <span class="comment">// ç”Ÿäº§æ•°æ®</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Produced: &quot;</span> + value);</span><br><span class="line">        notify();  <span class="comment">// å”¤é†’æ¶ˆè´¹è€…</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (data == -<span class="number">1</span>) &#123;  <span class="comment">// å¦‚æœæ•°æ®ä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…</span></span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Consumed: &quot;</span> + data);</span><br><span class="line">        data = -<span class="number">1</span>;  <span class="comment">// æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">        notify();  <span class="comment">// å”¤é†’ç”Ÿäº§è€…</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitNotifyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SharedBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SharedBuffer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    buffer.produce(i);</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);  <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§çš„æ—¶é—´</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    buffer.consume();</span><br><span class="line">                    Thread.sleep(<span class="number">150</span>);  <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹çš„æ—¶é—´</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        producer.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="volatile-å…³é”®å­—"><a class="markdownIt-Anchor" href="#volatile-å…³é”®å­—"></a> <code>volatile</code> å…³é”®å­—</h4><p><code>volatile</code> æ˜¯ Java æä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œå®ƒä¿è¯äº†<strong>å¯è§æ€§</strong>å’Œ<strong>æœ‰åºæ€§</strong>ï¼Œä½†<strong>ä¸ä¿è¯åŸå­æ€§</strong>ã€‚</p><ul><li><strong>å¯è§æ€§åŸç†</strong>ï¼šå†™ä¸€ä¸ª <code>volatile</code> å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„å·¥ä½œå†…å­˜å€¼ç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼›è¯»æ—¶ï¼Œä¼šä½¿æœ¬åœ°å†…å­˜å¤±æ•ˆï¼Œç›´æ¥ä»ä¸»å†…å­˜è¯»å–ã€‚</li><li><strong>ç¦æ­¢é‡æ’åº</strong>ï¼šé€šè¿‡æ’å…¥<strong>å†…å­˜å±éšœ</strong>ï¼Œç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šä¸ºäº†ä¼˜åŒ–è€Œæ”¹å˜æŒ‡ä»¤é¡ºåºã€‚</li></ul><p>ä¸ºäº†ä¸¾ä¾‹ï¼Œæˆ‘ä»¬ä»‹ç»javaä¸­çš„<strong>åŒé‡æ£€æŸ¥é”å®š</strong>ï¼ˆDouble-Checked Locking,<strong>DCL</strong>ï¼‰,ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ€§èƒ½å’Œå®‰å…¨å¹³è¡¡é—®é¢˜ã€‚</p><p>å¦‚æœæ²¡æœ‰ DCLï¼Œæˆ‘ä»¬æœ€ç®€å•çš„åŒæ­¥å†™æ³•æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="literal">null</span>) instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡è°ƒç”¨ <code>getInstance()</code> éƒ½è¦åŠ é”ï¼Œè€Œå®é™…ä¸Šåªæœ‰ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶æ‰éœ€è¦åŒæ­¥ï¼Œåç»­è¯»å–ç›´æ¥è¿”å›å³å¯ã€‚åŠ é”æ˜¯éå¸¸é‡çš„æ“ä½œï¼Œè¿™ä¼šä¸¥é‡æ‹–æ…¢æ€§èƒ½ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸ä¸º null ç›´æ¥è¿”å›ï¼›å¦‚æœä¸º nullï¼Œå†è¿›å…¥åŒæ­¥å—åˆ›å»ºå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»åŠ  volatileï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’å¯¼è‡´æ‹¿åˆ°å°šæœªåˆå§‹åŒ–çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>(); </span><br><span class="line">                    <span class="comment">// è¿™é‡ŒåŒ…å«ä¸‰æ­¥ï¼š1.åˆ†é…ç©ºé—´ 2.åˆå§‹åŒ– 3.æŒ‡å‘åœ°å€</span></span><br><span class="line">                    <span class="comment">// é‡æ’åºå¯èƒ½å¯¼è‡´ï¼š1 -&gt; 3 -&gt; 2ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‹¿åˆ°é null ä½†æœªåˆå§‹åŒ–çš„å¯¹è±¡</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ åŸæ¥çš„<code>instance = new Singleton();</code> è¿™ä¸€è¡Œã€‚åœ¨ JVM å±‚é¢ï¼Œå®ƒå…¶å®è¢«åˆ†æˆäº† <strong>3 ä¸ªæ­¥éª¤</strong>æ‰§è¡Œï¼š</p><ol><li><strong>åˆ†é…å†…å­˜ç©ºé—´</strong>ï¼ˆç»™è¿™ä¸ªå¯¹è±¡æ‰¾å—åœ°æ–¹ï¼‰ã€‚</li><li><strong>åˆå§‹åŒ–å¯¹è±¡</strong>ï¼ˆæ‰§è¡Œæ„é€ å‡½æ•°é‡Œçš„é€»è¾‘ï¼‰ã€‚</li><li><strong>å°† instance å˜é‡æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€</strong>ï¼ˆæ­¤æ—¶ instance ä¸å†æ˜¯ null äº†ï¼‰ã€‚</li></ol><p><strong>é—®é¢˜å‡ºåœ¨ç¼–è¯‘å™¨çš„ä¼˜åŒ–ä¸Š</strong>ï¼š ç”±äºæ­¥éª¤ 2 å’Œæ­¥éª¤ 3 ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨æˆ– CPU å¯èƒ½ä¼šä¸ºäº†æé«˜æ•ˆç‡è¿›è¡Œ<strong>æŒ‡ä»¤é‡æ’åº</strong>ï¼ŒæŠŠé¡ºåºå˜æˆï¼š <strong>1ï¼ˆåˆ†é…å†…å­˜ï¼‰ -&gt; 3ï¼ˆæŒ‡å‘åœ°å€ï¼‰ -&gt; 2ï¼ˆåˆå§‹åŒ–å¯¹è±¡ï¼‰</strong>ã€‚</p><p>è¿™ä¼šå¯¼è‡´ä¸‹é¢å‘ç”Ÿçš„ç¾éš¾åœºæ™¯ï¼š</p><ol><li><strong>çº¿ç¨‹ A</strong> è¿›å…¥åŒæ­¥å—ï¼Œæ‰§è¡Œ <code>instance = new Singleton()</code>ã€‚</li><li>ç”±äºé‡æ’åºï¼Œçº¿ç¨‹ A å…ˆæ‰§è¡Œäº†æ­¥éª¤ 3ï¼ˆæŒ‡å‘åœ°å€ï¼‰ï¼Œæ­¤æ—¶ <code>instance</code> å·²ç»<strong>ä¸æ˜¯ null</strong> äº†ï¼Œä½†æ­¥éª¤ 2ï¼ˆåˆå§‹åŒ–ï¼‰<strong>è¿˜æ²¡å®Œæˆ</strong>ã€‚</li><li>å°±åœ¨è¿™ä¸€ç¬é—´ï¼Œ<strong>çº¿ç¨‹ B</strong> è°ƒç”¨ <code>getInstance()</code>ï¼Œå®ƒåˆ¤æ–­ <code>instance != null</code>ï¼Œäºæ˜¯å¼€å¿ƒåœ°ç›´æ¥æŠŠè¿™ä¸ª instance æ‹¿å»ç”¨äº†ã€‚</li><li>ç»“æœçº¿ç¨‹ B åœ¨ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œå‘ç°ç”±äºè¿˜æ²¡åˆå§‹åŒ–ï¼Œå†…éƒ¨å±æ€§å…¨æ˜¯ç©ºçš„ï¼Œç›´æ¥æŠ¥å‡º <strong>ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆNPEï¼‰</strong> æˆ–é€»è¾‘é”™è¯¯ã€‚</li></ol><p>åœ¨ <code>instance</code> å˜é‡ä¸ŠåŠ ä¸Š <code>volatile</code> å…³é”®å­—åï¼Œä¼šå‘æŒ¥ä¸¤ä¸ªæ ¸å¿ƒä½œç”¨ï¼š</p><ol><li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼šå®ƒä¼šæ’å…¥ä¸€ä¸ªâ€œå†…å­˜å±éšœâ€ï¼Œå¼ºåˆ¶ä¿è¯æ‰§è¡Œé¡ºåºå¿…é¡»æ˜¯ <code>1 -&gt; 2 -&gt; 3</code>ã€‚è¿™æ ·å½“çº¿ç¨‹ B æ‹¿åˆ°å¯¹è±¡æ—¶ï¼Œå®ƒä¸€å®šå·²ç»æ˜¯åˆå§‹åŒ–å®Œæˆçš„ã€‚</li><li><strong>ä¿è¯å¯è§æ€§</strong>ï¼šä¸€æ—¦çº¿ç¨‹ A å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œçº¿ç¨‹ B èƒ½å¤Ÿç«‹å³ä»ä¸»å†…å­˜ä¸­çœ‹åˆ° <code>instance</code> çš„æœ€æ–°å€¼ã€‚</li></ol><h4 id="åŸå­ç±»-atomic"><a class="markdownIt-Anchor" href="#åŸå­ç±»-atomic"></a> åŸå­ç±» <code>Atomic</code></h4><p>å¯¹äºç®€å•çš„æ•°å€¼è¿ç®—ï¼Œä½¿ç”¨ <code>synchronized</code> å¤ªé‡ï¼Œé¢‘ç¹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæŸè€—æ€§èƒ½ã€‚<code>Atomic</code> ç³»åˆ—å·¥å…·ç±»ï¼ˆå¦‚ <code>AtomicInteger</code>ï¼‰é‡‡ç”¨ <strong>CAS (Compare And Swap)</strong> æœºåˆ¶å®ç°ã€‚</p><ul><li><strong>CAS åŸç†</strong>ï¼šåŒ…å«ä¸‰ä¸ªå‚æ•°ï¼šå˜é‡å†…å­˜åœ°å€ (V)ã€é¢„æœŸåŸå€¼ (A) å’Œæ–°å€¼ (B)ã€‚<ul><li>åªæœ‰å½“ V çš„å®é™…å€¼ç­‰äº A æ—¶ï¼Œæ‰å°† V ä¿®æ”¹ä¸º Bã€‚å¦åˆ™è¯´æ˜å˜é‡å·²è¢«ä¿®æ”¹ï¼Œå½“å‰çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹ï¼ˆæ­»å¾ªç¯ï¼‰ä¸æ–­å°è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚</li></ul></li></ul><p>ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œ<strong>åŸå­å˜é‡ = æ“ä½œä¸å¯è¢«æ‰“æ–­çš„å˜é‡</strong><br />å¯¹å®ƒçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå®Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œï¼Œ<strong>ä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢ä¸­æ–­</strong>ï¼Œå› æ­¤å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œä¸éœ€è¦ synchronizedã€‚</p><p>å¯¹äºæ™®é€šå˜é‡æ“ä½œï¼Œå¦‚i++ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€å¥ï¼Œä½†å®é™…ä¸ŠåŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>è¯»å– i</li><li>i + 1</li><li>å†™å› i</li></ol><p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå°±å¯èƒ½å‡ºç°ï¼š</p><ul><li>ä¸¤ä¸ªçº¿ç¨‹éƒ½è¯»åˆ°æ—§å€¼</li><li>æœ€ç»ˆåªåŠ ä¸€æ¬¡</li></ul><p>è¿™å°±å‡ºç°äº†å…¸å‹çš„ <strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong><br />ä¸¾ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">    count.incrementAndGet(); <span class="comment">// ç­‰åŒäºéåŸå­çš„ count++</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="çº¿ç¨‹å°é—­-threadlocal"><a class="markdownIt-Anchor" href="#çº¿ç¨‹å°é—­-threadlocal"></a> çº¿ç¨‹å°é—­ (<code>ThreadLocal</code>)</h4><p>å¦‚æœè¯´é”æ˜¯è§£å†³â€œå¦‚ä½•åŒæ­¥è®¿é—®å…±äº«æ•°æ®â€ï¼Œé‚£ä¹ˆ <code>ThreadLocal</code> åˆ™æ˜¯â€œå¦‚ä½•ä¸å…±äº«æ•°æ®â€ã€‚å®ƒä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä»½ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°çº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»ã€‚</p><ul><li><strong>æ ¸å¿ƒç”¨é€”</strong>ï¼šè§£å†³æ•°æ®åº“è¿æ¥ã€Session ç®¡ç†ç­‰åœºæ™¯ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<br />ä¸¾ä¸ªç®€å•çš„ä¾‹å­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Integer&gt; localValue = ThreadLocal.withInitial(() -&gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            localValue.set(<span class="number">10</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + localValue.get());</span><br><span class="line">        &#125;, <span class="string">&quot;Thread-A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            localValue.set(<span class="number">20</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + localValue.get());</span><br><span class="line">        &#125;, <span class="string">&quot;Thread-B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰ç« juc-æ˜¾å¼é”-explicit-locks"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰ç« juc-æ˜¾å¼é”-explicit-locks"></a> ç¬¬ä¸‰ç« ï¼šJUC æ˜¾å¼é” (Explicit Locks)</h3><p>åœ¨ Java å¹¶å‘å·¥å…·åŒ…ï¼ˆJUCï¼‰ä¸­ï¼Œ<code>java.util.concurrent.locks</code> æä¾›äº†æ¯” <code>synchronized</code> æ›´çµæ´»ã€æ›´å¼ºå¤§çš„é”å®šæœºåˆ¶ã€‚<code>synchronized</code> åˆè¢«ç§°ä¸ºå†…ç½®é”ï¼Œå…¶ä¸éœ€è¦ç¨‹åºå‘˜è¿‡å¤šçš„æ‰‹åŠ¨æ“ä½œï¼Œè€ŒåŸºäº<code>Lock</code>æ¥å£å®ç°çš„ä¸ºæ˜¾å¼é”ï¼Œéœ€è¦ç¨‹åºå‘˜ä¸€äº›æ‰‹åŠ¨æ“ä½œæ‰èƒ½æ‰§è¡Œã€‚</p><h4 id="lock-æ¥å£ä¸-reentrantlock"><a class="markdownIt-Anchor" href="#lock-æ¥å£ä¸-reentrantlock"></a> <code>Lock</code> æ¥å£ä¸ <code>ReentrantLock</code></h4><p><code>ReentrantLock</code> æ˜¯æœ€å¸¸ç”¨çš„æ˜¾å¼é”ï¼Œå®ƒä¸ä»…å®Œå…¨è¦†ç›–äº† <code>synchronized</code> çš„åŠŸèƒ½ï¼Œè¿˜æä¾›äº†è®¸å¤šé«˜çº§ç‰¹æ€§:</p><ul><li><strong>æ‰‹åŠ¨è§„èŒƒ</strong>ï¼šä½¿ç”¨æ˜¾å¼é”å¿…é¡»éµå¾ªç‰¹å®šçš„æ¨¡æ¿ã€‚ç”±äºå®ƒä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œä¸ºäº†é˜²æ­¢æ­»é”ï¼Œ<strong>å¿…é¡»</strong>åœ¨ <code>finally</code> å—ä¸­è°ƒç”¨ <code>unlock()</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>å¯é‡å…¥æ€§</strong>ï¼šåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—åŒä¸€æŠŠé”ï¼Œå†…éƒ¨é€šè¿‡è®¡æ•°å™¨å®ç°ã€‚</p></li><li><p><strong>å¯ä¸­æ–­æ€§</strong>ï¼šä½¿ç”¨ <code>lockInterruptibly()</code> è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…é”ï¼Œå®ƒå¯ä»¥å“åº”ä¸­æ–­ä¿¡å·å¹¶åœæ­¢ç­‰å¾…ã€‚</p></li><li><p><strong>å…¬å¹³é”ä¸éå…¬å¹³é”</strong>ï¼šæ„é€ å‡½æ•°æ”¯æŒä¼ å…¥ <code>boolean</code> å€¼ã€‚å…¬å¹³é”ä¼šä¸¥æ ¼æŒ‰ç…§çº¿ç¨‹æ’é˜Ÿçš„é¡ºåºç»™é”ï¼Œè€Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰å…è®¸æ’é˜Ÿï¼Œé€šå¸¸æ‹¥æœ‰æ›´é«˜çš„ååé‡ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>); <span class="comment">// å…¬å¹³é”</span></span><br></pre></td></tr></table></figure><ul><li><strong>å¯è½®è¯¢è·å–é”ï¼ˆtryLockï¼‰</strong>: çº¿ç¨‹å¯ä»¥â€œè¯•ä¸€è¯•â€æ‹¿é”ï¼Œæ‹¿ä¸åˆ°ç›´æ¥èµ°ï¼Œä¸ä¼šé˜»å¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (lock.tryLock(<span class="number">2</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°é”æ‰æ‰§è¡Œ</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ‹¿ä¸åˆ°é”ï¼Œæ‰§è¡Œåˆ«çš„é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">lock.lock(); <span class="comment">// é˜»å¡å¼è·å–</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒºä»£ç </span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock(); <span class="comment">// å¿…é¡»åœ¨ finally ä¸­é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•è·å–é”ï¼šæ‹¿ä¸åˆ°å°±èµ°ï¼Œä¸é˜»å¡</span></span><br><span class="line"><span class="keyword">if</span> (lock.tryLock()) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">/* ä¸šåŠ¡é€»è¾‘ */</span> &#125; <span class="keyword">finally</span> &#123; lock.unlock(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="readwritelock-è¯»å†™é”"><a class="markdownIt-Anchor" href="#readwritelock-è¯»å†™é”"></a> <code>ReadWriteLock</code> è¯»å†™é”</h4><p>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæ•°æ®æ˜¯â€œè¯»å¤šå†™å°‘â€çš„ã€‚å¦‚æœç”¨æ™®é€šçš„äº’æ–¥é”ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ä¹Ÿä¼šäº’ç›¸æ’é˜Ÿï¼Œæ•ˆç‡ä½ä¸‹ã€‚<code>ReentrantReadWriteLock</code> å®ç°äº†â€œè¯»å†™åˆ†ç¦»â€ã€‚è¯»å†™é”æ˜¯å¯¹æ™®é€šäº’æ–¥é”çš„å‡çº§ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†å†™æ“ä½œåªèƒ½æœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”å†™æ—¶ä¸èƒ½è¯»ï¼Œå³ï¼š</p><ul><li><strong>è¯»è¯»ä¸äº’æ–¥</strong>ï¼ˆå¹¶å‘åº¦é«˜ï¼‰</li><li><strong>è¯»å†™äº’æ–¥</strong></li><li><strong>å†™å†™äº’æ–¥</strong></li></ul><p><strong>ReentrantReadWriteLock</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"><span class="type">Lock</span> <span class="variable">readLock</span> <span class="operator">=</span> rwLock.readLock();</span><br><span class="line"><span class="type">Lock</span> <span class="variable">writeLock</span> <span class="operator">=</span> rwLock.writeLock();</span><br></pre></td></tr></table></figure><p>å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‹¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">readLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å–å…±äº«æ•°æ®</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    readLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‹¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">writeLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿®æ”¹å…±äº«æ•°æ®</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    writeLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è¯»å†™é”çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReentrantReadWriteLockDEMO</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">readWriteLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">readLock</span> <span class="operator">=</span> readWriteLock.readLock();  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">writeLock</span>  <span class="operator">=</span> readWriteLock.writeLock();  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;  </span><br><span class="line">        readLock.lock();  </span><br><span class="line">        <span class="keyword">try</span>&#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> map.get(key);  </span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; get &quot;</span> + key + <span class="string">&quot; &quot;</span> + val);  </span><br><span class="line">            <span class="keyword">return</span> val;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            readLock.unlock();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String val)</span> &#123;  </span><br><span class="line">        writeLock.lock();  </span><br><span class="line">        <span class="keyword">try</span>&#123;  </span><br><span class="line">            map.put(key, val);  </span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; put &quot;</span> + key + <span class="string">&quot; &quot;</span> + val);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            writeLock.unlock();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        <span class="type">ReentrantReadWriteLockDEMO</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLockDEMO</span>();  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cache.get(<span class="string">&quot;name&quot;</span>);  </span><br><span class="line">                <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cache.get(<span class="string">&quot;name&quot;</span>);  </span><br><span class="line">                <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                cache.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;value-&quot;</span> + (cnt++));  </span><br><span class="line">                <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">500</span>); &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);  </span><br><span class="line">  </span><br><span class="line">        t1.start();  </span><br><span class="line">        t2.start();  </span><br><span class="line">        t3.start();  </span><br><span class="line">        t1.join();  </span><br><span class="line">        t2.join();  </span><br><span class="line">        t3.join();   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="condition-æœºåˆ¶"><a class="markdownIt-Anchor" href="#condition-æœºåˆ¶"></a> <code>Condition</code> æœºåˆ¶</h4><p><code>Condition</code> æ˜¯ä¸ºäº†é…åˆ <code>Lock</code> ä½¿ç”¨çš„ï¼Œå®ƒç”¨æ¥æ›¿ä»£ <code>Object.wait()/notify()</code>ã€‚å®ƒçš„æœ€å¤§ä¼˜åŠ¿åœ¨äºï¼š<strong>ä¸€ä¸ªé”å¯ä»¥å…³è”å¤šä¸ª Conditionï¼ˆæ¡ä»¶å˜é‡ï¼‰</strong>ã€‚</p><p>åœ¨ <code>synchronized</code> ä¸­ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æŒ¤åœ¨ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—é‡Œï¼Œè°ƒç”¨ <code>notifyAll()</code> ä¼šå”¤é†’æ‰€æœ‰äººã€‚è€Œ <code>Condition</code> å¯ä»¥å®ç°â€œç²¾å‡†å”¤é†’â€ã€‚</p><p>åœ¨ synchronized é‡Œæˆ‘ä»¬ç”¨ï¼š<br />â€¢wait()<br />â€¢notify()<br />â€¢notifyAll()</p><p>åœ¨ æ˜¾å¼é”ï¼ˆReentrantLockï¼‰ ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å†ç”¨å®ƒä»¬ï¼Œè¦ç”¨ï¼š<br />â€¢await() ä»£æ›¿ wait()<br />â€¢signal() ä»£æ›¿ notify()<br />â€¢signalAll() ä»£æ›¿ notifyAll()</p><p>ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯<strong>ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹</strong>ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸¤ä¸ªæ¡ä»¶ï¼š<code>notFull</code>ï¼ˆä¸æ»¡ï¼‰å’Œ <code>notEmpty</code>ï¼ˆä¸ç©ºï¼‰ã€‚ç”Ÿäº§è€…åªå”¤é†’ç­‰å¾… <code>notEmpty</code> çš„æ¶ˆè´¹è€…ï¼Œäº’ä¸å¹²æ‰°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Depot</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">notEmpty</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">notFull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == MAX) &#123;</span><br><span class="line">                notFull.await();   <span class="comment">// ç­‰å¾…ä»“åº“æœ‰ç©ºä½</span></span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§ï¼Œæ€»æ•° = &quot;</span> + count);</span><br><span class="line">            notEmpty.signal();     <span class="comment">// å”¤é†’ç­‰å¾…å–è´§çš„çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">take</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                notEmpty.await();  <span class="comment">// ç­‰å¾…ä»“åº“éç©º</span></span><br><span class="line">            &#125;</span><br><span class="line">            count--;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹ï¼Œæ€»æ•° = &quot;</span> + count);</span><br><span class="line">            notFull.signal();      <span class="comment">// å”¤é†’ç­‰å¾…ç”Ÿäº§çš„çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é”çš„é™çº§-å†™é”-è¯»é”"><a class="markdownIt-Anchor" href="#é”çš„é™çº§-å†™é”-è¯»é”"></a> é”çš„é™çº§ (å†™é” -&gt; è¯»é”)</h4><p>é”é™çº§æ˜¯æŒ‡ï¼š<strong>çº¿ç¨‹æŒæœ‰å†™é” -&gt; è·å–è¯»é” -&gt; é‡Šæ”¾å†™é”</strong>ã€‚</p><p>è¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„<strong>å¯è§æ€§</strong>å’Œ<strong>åŸå­æ€§</strong>ã€‚å¦‚æœä½ å…ˆé‡Šæ”¾å†™é”å†è·å–è¯»é”ï¼Œåœ¨ä¸­é—´çš„ç©ºéš™ï¼Œæ•°æ®å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†ã€‚é€šè¿‡é”é™çº§ï¼Œçº¿ç¨‹å¯ä»¥æ— ç¼åœ°ä»â€œä¿®æ”¹è€…â€åˆ‡æ¢ä¸ºâ€œè§‚å¯Ÿè€…â€ï¼Œä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä¸ä¼šè¢«ä»–äººç¯¡æ”¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">writeLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ä¿®æ”¹æ•°æ®</span></span><br><span class="line">    <span class="comment">// 2. é™çº§ï¼šåœ¨é‡Šæ”¾å†™é”å‰å…ˆè·å–è¯»é”</span></span><br><span class="line">    readLock.lock();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    writeLock.unlock(); <span class="comment">// 3. é‡Šæ”¾å†™é”ï¼Œæ­¤æ—¶ä¾ç„¶æŒæœ‰è¯»é”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 4. ä½¿ç”¨æ•°æ®</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    readLock.unlock(); <span class="comment">// 5. æœ€åé‡Šæ”¾è¯»é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬å››ç« å¹¶å‘åä½œå·¥å…·ç±»-synchronization-tools"><a class="markdownIt-Anchor" href="#ç¬¬å››ç« å¹¶å‘åä½œå·¥å…·ç±»-synchronization-tools"></a> ç¬¬å››ç« ï¼šå¹¶å‘åä½œå·¥å…·ç±» (Synchronization Tools)</h3><p>JUCï¼ˆJava å¹¶å‘å·¥å…·åŒ…ï¼‰é™¤äº†æä¾›é”ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€ç³»åˆ—éå¸¸æœ‰ç”¨çš„åä½œå·¥å…·ã€‚å¦‚æœè¯´é”æ˜¯è§£å†³èµ„æºç«äº‰çš„ï¼Œé‚£ä¹ˆè¿™äº›å·¥å…·å°±æ˜¯è§£å†³çº¿ç¨‹é…åˆçš„ã€‚</p><h4 id="å€’è®¡æ—¶å™¨-countdownlatch"><a class="markdownIt-Anchor" href="#å€’è®¡æ—¶å™¨-countdownlatch"></a> å€’è®¡æ—¶å™¨ <code>CountDownLatch</code></h4><p>CountDownLatch æ˜¯ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œç”¨æ¥è®©ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚<br />å°±åƒä¸€ä¸ªå€’è®¡æ—¶å™¨ï¼š<br />â€¢åˆå§‹æœ‰ä¸€ä¸ªè®¡æ•° count<br />â€¢æ¯æ¬¡è°ƒç”¨ countDown()ï¼Œè®¡æ•°å‡ 1<br />â€¢å½“è®¡æ•°å˜æˆ 0 æ—¶ï¼Œæ‰€æœ‰åœ¨ await() ç­‰å¾…çš„çº¿ç¨‹éƒ½ä¼šç»§ç»­æ‰§è¡Œ</p><p>å…¸å‹åœºæ™¯ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡éƒ½å®Œæˆåç»§ç»­æ‰§è¡Œ<br />ä¾‹å¦‚ï¼š<br />â€¢ä¸»çº¿ç¨‹å¯åŠ¨ 3 ä¸ªå­çº¿ç¨‹<br />â€¢æ¯ä¸ªå­çº¿ç¨‹å®Œæˆåæ‰§è¡Œ countDown()<br />â€¢ä¸»çº¿ç¨‹è°ƒç”¨ await()ï¼Œä¸€ç›´ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å®Œæˆ<br />â€¢æ‰€æœ‰å­çº¿ç¨‹å®Œæˆåï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">taskCount</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(taskCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; taskCount; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;å­çº¿ç¨‹ &quot;</span> + id + <span class="string">&quot; å¼€å§‹ä»»åŠ¡&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span> + id * <span class="number">500</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;å­çº¿ç¨‹ &quot;</span> + id + <span class="string">&quot; å®Œæˆä»»åŠ¡&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123; &#125;</span><br><span class="line">                <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown(); <span class="comment">// è®¡æ•° -1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ...&quot;</span>);</span><br><span class="line">        latch.await(); <span class="comment">// ç­‰å¾… count å˜ä¸º 0</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å­ä»»åŠ¡å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¾ªç¯æ …æ -cyclicbarrier"><a class="markdownIt-Anchor" href="#å¾ªç¯æ …æ -cyclicbarrier"></a> å¾ªç¯æ …æ  <code>CyclicBarrier</code></h4><p><strong>CyclicBarrier æ˜¯ä¸€ç§åŒæ­¥å±éšœï¼Œè®©ä¸€ç»„çº¿ç¨‹å¿…é¡»ç­‰åˆ°â€œå…¨éƒ¨éƒ½åˆ°è¾¾å±éšœç‚¹â€ï¼Œç„¶ååŒæ—¶ç»§ç»­æ‰§è¡Œã€‚</strong><br />ç‰¹ç‚¹ï¼š<br />â€¢å±éšœç‚¹ï¼ˆbarrierï¼‰å¯ä»¥é‡å¤ä½¿ç”¨ï¼ˆå¾ªç¯ cyclicï¼‰<br />â€¢çº¿ç¨‹åˆ°è¾¾ barrier åä¼šé˜»å¡<br />â€¢å½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾åï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰çº¿ç¨‹</p><p>å‡è®¾è¦ 3 ä¸ªçº¿ç¨‹åŒæ—¶å¼€å§‹ä¸‹ä¸€æ­¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + id + <span class="string">&quot; åˆ°è¾¾å±éšœç‚¹&quot;</span>);</span><br><span class="line">                    barrier.await(); <span class="comment">// é˜»å¡ï¼Œç›´åˆ° 3 ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + id + <span class="string">&quot; é€šè¿‡å±éšœï¼Œç»§ç»­æ‰§è¡Œ&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ 0 åˆ°è¾¾å±éšœç‚¹</span><br><span class="line">çº¿ç¨‹ 2 åˆ°è¾¾å±éšœç‚¹</span><br><span class="line">çº¿ç¨‹ 1 åˆ°è¾¾å±éšœç‚¹</span><br><span class="line">ï¼ˆæ»¡è¶³3ä¸ªçº¿ç¨‹åˆ°è¾¾ï¼‰</span><br><span class="line">çº¿ç¨‹ 2 é€šè¿‡å±éšœï¼Œç»§ç»­æ‰§è¡Œ</span><br><span class="line">çº¿ç¨‹ 1 é€šè¿‡å±éšœï¼Œç»§ç»­æ‰§è¡Œ</span><br><span class="line">çº¿ç¨‹ 0 é€šè¿‡å±éšœï¼Œç»§ç»­æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>CyclicBarrier ä¸ CountDownLatch çš„åŒºåˆ«</p><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>CyclicBarrier</strong></th><th><strong>CountDownLatch</strong></th></tr></thead><tbody><tr><td>ä½œç”¨</td><td>è®©å¤šä¸ªçº¿ç¨‹â€œé›†åˆï¼Œç„¶åä¸€èµ·ç»§ç»­â€</td><td>è®©çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå®ŒæŸä»¶äº‹</td></tr><tr><td>æ˜¯å¦å¯é‡ç”¨</td><td>âœ” å¯é‡å¤ä½¿ç”¨ï¼ˆcyclicï¼‰</td><td>âŒ ä¸èƒ½é‡ç½®ï¼ˆä¸€æ¬¡æ€§ï¼‰</td></tr><tr><td>æ˜¯å¦æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç­‰å¾…</td><td>âœ” æ˜¯</td><td>âŒ é€šå¸¸åªæœ‰ä¸€ä¸ªæˆ–å°‘é‡çº¿ç¨‹ç­‰å¾…</td></tr><tr><td>è°ƒç”¨æ–¹æ³•</td><td>await()</td><td>await() + countDown()</td></tr><tr><td>è°å‡è®¡æ•°</td><td>æ¯ä¸ªçº¿ç¨‹è°ƒç”¨ await() éƒ½ç®—ä¸€ä¸ªåˆ°è¾¾</td><td>è°ƒç”¨ countDown() çš„çº¿ç¨‹</td></tr><tr><td>ä¿¡å·æ–¹å‘</td><td>å¤§å®¶äº’ç›¸ç­‰å¾…</td><td>ä¸€äº›çº¿ç¨‹ç­‰å¾…ï¼Œå¦ä¸€äº›è´Ÿè´£ countDown</td></tr></tbody></table><h4 id="ä¿¡å·é‡-semaphore"><a class="markdownIt-Anchor" href="#ä¿¡å·é‡-semaphore"></a> ä¿¡å·é‡ <code>Semaphore</code></h4><p>**Semaphoreï¼ˆä¿¡å·é‡ï¼‰**æ˜¯Java å¹¶å‘ç¼–ç¨‹é‡Œä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„åŒæ­¥å·¥å…·ï¼Œä¸»è¦ç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚</p><p>Semaphore = ä¸€ä¸ªâ€œè®¸å¯è¯â€è®¡æ•°å™¨ï¼Œç”¨æ¥é™åˆ¶å¹¶å‘è®¿é—®æ•°é‡ã€‚<br />æ¯”å¦‚ä½ æœ‰ 3 å°æ‰“å°æœºï¼Œä½†æœ‰ 10 ä¸ªçº¿ç¨‹è¦æ‰“å°æ–‡ä»¶ã€‚<br />Semaphore(3) å°±ç›¸å½“äºå‘ 3 å¼ â€œè®¸å¯è¯â€ï¼ŒåŒæ—¶åªå…è®¸ 3 ä¸ªçº¿ç¨‹ä½¿ç”¨æ‰“å°æœºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>); <span class="comment">// æœ‰ 3 ä¸ªè®¸å¯è¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        semaphore.acquire(); <span class="comment">// è¯·æ±‚ä¸€ä¸ªè®¸å¯è¯ï¼Œå¦‚æœæ²¡æœ‰å°±é˜»å¡</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å¼€å§‹æ‰“å°...&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰“å°ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        semaphore.release(); <span class="comment">// é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Semaphore å¸¸ç”¨æ–¹æ³•</p><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>acquire()</td><td>è·å–ä¸€ä¸ªè®¸å¯è¯ï¼Œæ²¡æœ‰åˆ™é˜»å¡</td></tr><tr><td>acquire(int n)</td><td>ä¸€æ¬¡è·å– n ä¸ªè®¸å¯è¯</td></tr><tr><td>tryAcquire()</td><td>å°è¯•è·å–ï¼Œä¸é˜»å¡ï¼Œè·å–ä¸åˆ°è¿”å› false</td></tr><tr><td>release()</td><td>é‡Šæ”¾è®¸å¯è¯</td></tr><tr><td>availablePermits()</td><td>æŸ¥çœ‹å‰©ä½™è®¸å¯è¯æ•°é‡</td></tr></tbody></table><p>Semaphore vs Lock / synchronized</p><table><thead><tr><th><strong>å¯¹æ¯”å¯¹è±¡</strong></th><th><strong>Semaphore</strong></th><th><strong>Lock / synchronized</strong></th></tr></thead><tbody><tr><td>æ ¸å¿ƒç”¨é€”</td><td>é™åˆ¶å¹¶å‘æ•°é‡</td><td>åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼ˆäº’æ–¥ï¼‰</td></tr><tr><td>æ”¯æŒå¤šå°‘çº¿ç¨‹åŒæ—¶è¿›å…¥</td><td><strong>å¤šä¸ª</strong>ï¼ˆå–å†³äº permitsï¼‰</td><td><strong>åªèƒ½ 1 ä¸ª</strong></td></tr><tr><td>æ˜¯å¦å¯ä½œä¸ºé”ä½¿ç”¨</td><td>å¯ä»¥ï¼ˆpermits=1 æ—¶ç±»ä¼¼ mutexï¼‰</td><td>æ˜¯é”</td></tr></tbody></table><p>å…¬å¹³/éå…¬å¹³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>, <span class="literal">true</span>); <span class="comment">// å…¬å¹³ï¼ŒæŒ‰æ’é˜Ÿé¡ºåº</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>, <span class="literal">false</span>); <span class="comment">// éå…¬å¹³ï¼ˆé»˜è®¤ï¼‰ï¼Œé€Ÿåº¦æ›´å¿«</span></span><br></pre></td></tr></table></figure><h4 id="é˜¶æ®µåŒæ­¥-phaser"><a class="markdownIt-Anchor" href="#é˜¶æ®µåŒæ­¥-phaser"></a> é˜¶æ®µåŒæ­¥ <code>Phaser</code></h4><p>Phaser æ˜¯ Java å¹¶å‘é‡Œ <strong>æœ€çµæ´»ã€å¯é‡ç”¨ã€å¯åŠ¨æ€æ³¨å†Œçº¿ç¨‹çš„â€œé˜¶æ®µåŒæ­¥å™¨â€</strong><br />å¯ä»¥ç†è§£ä¸ºï¼šä¸€ä¸ªå¯ä»¥åˆ†æˆå¾ˆå¤šé˜¶æ®µï¼ˆphaseï¼‰çš„åŒæ­¥å™¨ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½è¦æ‰€æœ‰â€œå‚ä¸è€…â€åˆ°é½åæ‰èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œå¹¶ä¸”å‚ä¸è€…æ•°é‡è¿˜å¯ä»¥åŠ¨æ€å¢å‡ã€‚</p><table><thead><tr><th><strong>å·¥å…·</strong></th><th><strong>é—®é¢˜</strong></th></tr></thead><tbody><tr><td><strong>CountDownLatch</strong></td><td>ä¸€æ¬¡æ€§ç­‰å¾…ï¼Œä¸èƒ½å¤ç”¨ï¼Œä¸èƒ½åŠ¨æ€å¢åŠ çº¿ç¨‹</td></tr><tr><td><strong>CyclicBarrier</strong></td><td>å¯å¤ç”¨ï¼Œä½†æ˜¯å‚ä¸çº¿ç¨‹æ•°å›ºå®šï¼Œä¸èƒ½åŠ¨æ€å˜åŒ–</td></tr><tr><td><strong>Phaser</strong></td><td>âœ” å¯å¤ç”¨ âœ” å¯å¤šé˜¶æ®µ âœ” å¯åŠ¨æ€å¢åŠ /å‡å°‘çº¿ç¨‹ âœ” æ›´çµæ´»</td></tr></tbody></table><p>åŸºç¡€ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Phaser</span> <span class="variable">phaser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phaser</span>(<span class="number">3</span>); <span class="comment">// 3 ä¸ªå‚ä¸è€…</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œé˜¶æ®µ1&quot;</span>);</span><br><span class="line">        phaser.arriveAndAwaitAdvance();  <span class="comment">// ç­‰åˆ«äºº</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œé˜¶æ®µ2&quot;</span>);</span><br><span class="line">        phaser.arriveAndAwaitAdvance();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œé˜¶æ®µ3&quot;</span>);</span><br><span class="line">        phaser.arriveAndAwaitAdvance();</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">T1 æ‰§è¡Œé˜¶æ®µ1</span><br><span class="line">T2 æ‰§è¡Œé˜¶æ®µ1</span><br><span class="line">T3 æ‰§è¡Œé˜¶æ®µ1</span><br><span class="line">--- é˜¶æ®µ1ç»“æŸ ---</span><br><span class="line">T1 æ‰§è¡Œé˜¶æ®µ2</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ–¹æ³•ï¼š</p><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>æ„ä¹‰</strong></th></tr></thead><tbody><tr><td>arrive()</td><td>åˆ°è¾¾å½“å‰é˜¶æ®µï¼Œä¸ç­‰å¾…</td></tr><tr><td>arriveAndAwaitAdvance()</td><td>åˆ°è¾¾å¹¶ç­‰å¾…å…¶ä»–çº¿ç¨‹ï¼ˆæœ€å¸¸ç”¨ï¼‰</td></tr><tr><td>arriveAndDeregister()</td><td>åˆ°è¾¾åé€€å‡ºï¼Œä¸å†å‚åŠ åç»­é˜¶æ®µ</td></tr></tbody></table><p>phaserå¯ä»¥åŠ¨æ€æ³¨å†Œçº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phaser.register(); <span class="comment">// æ–°çº¿ç¨‹åŠ å…¥åŒæ­¥æ§åˆ¶</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Phaser</span> <span class="variable">phaser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phaser</span>(<span class="number">1</span>); <span class="comment">// main æ˜¯ 1 ä¸ªå‚ä¸è€…</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    Phaser ph;</span><br><span class="line">    Player(Phaser ph) &#123; <span class="built_in">this</span>.ph = ph; ph.register(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å‡†å¤‡è¿›å…¥æ¸¸æˆ&quot;</span>);</span><br><span class="line">        ph.arriveAndAwaitAdvance();</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; åŠ è½½åœ°å›¾&quot;</span>);</span><br><span class="line">        ph.arriveAndAwaitAdvance();</span><br><span class="line"></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; åŠ è½½è§’è‰²&quot;</span>);</span><br><span class="line">        ph.arriveAndAwaitAdvance();</span><br><span class="line">        </span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å®Œæˆæ‰€æœ‰åŠ è½½&quot;</span>);</span><br><span class="line">        ph.arriveAndDeregister();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Phaser</span> <span class="variable">ph</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phaser</span>(<span class="number">1</span>); <span class="comment">// main</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Player</span>(ph), <span class="string">&quot;ç©å®¶1&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Player</span>(ph), <span class="string">&quot;ç©å®¶2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    ph.arriveAndAwaitAdvance(); <span class="comment">// ä¸»çº¿ç¨‹åŒæ­¥å„é˜¶æ®µ</span></span><br><span class="line">    ph.arriveAndAwaitAdvance();</span><br><span class="line">    ph.arriveAndAwaitAdvance();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®äº¤æ¢-exchanger"><a class="markdownIt-Anchor" href="#æ•°æ®äº¤æ¢-exchanger"></a> æ•°æ®äº¤æ¢ <code>Exchanger</code></h4><p><code>Exchanger</code> ç”¨äºä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚å®ƒæä¾›ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œåœ¨è¿™ä¸ªç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚</p><ul><li><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>exchange()</code> æ—¶ï¼Œå®ƒä¼šé˜»å¡ç›´åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè°ƒç”¨è¯¥æ–¹æ³•ã€‚ç„¶åä¸¤ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®å¹¶è¿”å›ã€‚</li><li><strong>ç‰¹æ€§</strong>ï¼šåªèƒ½æˆå¯¹ä½¿ç”¨ï¼ˆ2ä¸ªçº¿ç¨‹ï¼‰ã€‚</li><li><strong>åœºæ™¯</strong>ï¼šä¸¤ä¸ªæµæ°´çº¿ç¯èŠ‚çš„æ•°æ®ä¼ é€’ï¼Œæˆ–è€…é—ä¼ ç®—æ³•ä¸­çš„äº¤å‰æ“ä½œã€‚</li></ul><p>ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> <span class="title class_">Exchanger</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;Açº¿ç¨‹æ•°æ®&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> exchanger.exchange(data);</span><br><span class="line">        System.out.println(<span class="string">&quot;A å¾—åˆ°ï¼š&quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;Bçº¿ç¨‹æ•°æ®&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> exchanger.exchange(data);</span><br><span class="line">        System.out.println(<span class="string">&quot;B å¾—åˆ°ï¼š&quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äº”ç« çº¿ç¨‹æ± æ¶æ„-executor-framework"><a class="markdownIt-Anchor" href="#ç¬¬äº”ç« çº¿ç¨‹æ± æ¶æ„-executor-framework"></a> ç¬¬äº”ç« ï¼šçº¿ç¨‹æ± æ¶æ„ (Executor Framework)</h3><p>åœ¨å®é™…ç”Ÿäº§å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹ä»ä¸æ‰‹åŠ¨ <code>new Thread()</code>ã€‚ä¸ºäº†èŠ‚çœç³»ç»Ÿèµ„æºå¹¶æé«˜å“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ã€‚</p><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± "><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± "></a> ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ï¼Ÿ</h4><p>åˆ›å»ºä¸€ä¸ª Java çº¿ç¨‹éœ€è¦è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸ APIï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œã€‚</p><ul><li><strong>é™ä½èµ„æºæ¶ˆè€—</strong>ï¼šé€šè¿‡æ± åŒ–æŠ€æœ¯é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼Œå‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„æ€§èƒ½å¼€é”€ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦</strong>ï¼šä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œæ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºå³å¯ç«‹å³æ‰§è¡Œã€‚</li><li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong>ï¼šçº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ï¼Œé˜²æ­¢æ— é™åˆ¶åˆ›å»ºçº¿ç¨‹å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼ˆOOMï¼‰ã€‚</li></ul><h4 id="threadpoolexecutor-æ ¸å¿ƒå‚æ•°"><a class="markdownIt-Anchor" href="#threadpoolexecutor-æ ¸å¿ƒå‚æ•°"></a> <code>ThreadPoolExecutor</code> æ ¸å¿ƒå‚æ•°</h4><p>æ‰€æœ‰çš„çº¿ç¨‹æ± åº•å±‚éƒ½æ˜¯ <code>ThreadPoolExecutor</code>ï¼ŒåŒ…å«ä¸ƒä¸ªæ ¸å¿ƒçš„å‚æ•°ï¼š</p><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>åç§°</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td><code>corePoolSize</code></td><td><strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong></td><td>çº¿ç¨‹æ± ä¸­å¸¸é©»çš„â€œä¿åº•â€çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿å®ƒä»¬é—²ç€ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚</td></tr><tr><td><code>maximumPoolSize</code></td><td><strong>æœ€å¤§çº¿ç¨‹æ•°</strong></td><td>çº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ€»é‡ã€‚</td></tr><tr><td><code>keepAliveTime</code></td><td><strong>å­˜æ´»æ—¶é—´</strong></td><td>å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹èƒ½æ´»å¤šä¹…ã€‚</td></tr><tr><td><code>unit</code></td><td><strong>æ—¶é—´å•ä½</strong></td><td><code>keepAliveTime</code> çš„æ—¶é—´å•ä½ï¼ˆç§’ã€æ¯«ç§’ç­‰ï¼‰ã€‚</td></tr><tr><td><code>workQueue</code></td><td><strong>ä»»åŠ¡é˜Ÿåˆ—</strong></td><td>å­˜æ”¾å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰ã€‚</td></tr><tr><td><code>threadFactory</code></td><td><strong>çº¿ç¨‹å·¥å‚</strong></td><td>ç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ï¼Œé€šå¸¸åœ¨è¿™é‡Œç»™çº¿ç¨‹èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ã€‚</td></tr><tr><td><code>handler</code></td><td><strong>æ‹’ç»ç­–ç•¥</strong></td><td>å½“é˜Ÿåˆ—æ»¡äº†ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æ—¶ï¼Œå¦‚ä½•å¤„ç†æ–°æ¥çš„ä»»åŠ¡ã€‚</td></tr></tbody></table><h4 id="çº¿ç¨‹æ± å·¥ä½œæµç¨‹ä¸æ‹’ç»ç­–ç•¥"><a class="markdownIt-Anchor" href="#çº¿ç¨‹æ± å·¥ä½œæµç¨‹ä¸æ‹’ç»ç­–ç•¥"></a> çº¿ç¨‹æ± å·¥ä½œæµç¨‹ä¸æ‹’ç»ç­–ç•¥</h4><p>çº¿ç¨‹æ± çš„å¤„ç†é€»è¾‘éµå¾ªâ€œ<strong>å…ˆæ ¸å¿ƒï¼Œå†é˜Ÿåˆ—ï¼Œåæœ€å¤§</strong>â€çš„åŸåˆ™ï¼š</p><ol><li><strong>æäº¤ä»»åŠ¡</strong>ï¼šå¦‚æœå½“å‰çº¿ç¨‹æ•° &lt; <code>corePoolSize</code>ï¼Œç›´æ¥åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œã€‚</li><li><strong>è¿›å…¥é˜Ÿåˆ—</strong>ï¼šå¦‚æœçº¿ç¨‹æ•° â‰¥ <code>corePoolSize</code>ï¼Œä»»åŠ¡è¿›å…¥ <code>workQueue</code> æ’é˜Ÿã€‚</li><li><strong>å°è¯•æ‰©å®¹</strong>ï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”çº¿ç¨‹æ•° &lt; <code>maximumPoolSize</code>ï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œã€‚</li><li><strong>è§¦å‘æ‹’ç»</strong>ï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”çº¿ç¨‹æ•° = <code>maximumPoolSize</code>ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li></ol><p><strong>JDK è‡ªå¸¦çš„å››ç§æ‹’ç»ç­–ç•¥ï¼š</strong></p><ul><li><strong>AbortPolicy</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šç›´æ¥æŠ›å‡º <code>RejectedExecutionException</code> å¼‚å¸¸ï¼Œé˜»æ­¢ç³»ç»Ÿæ­£å¸¸å·¥ä½œã€‚</li><li><strong>CallerRunsPolicy</strong>ï¼šâ€œè°æäº¤è°æ‰§è¡Œâ€ã€‚è®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼ˆæ¯”å¦‚ä¸»çº¿ç¨‹ï¼‰è‡ªå·±å»è·‘è¿™ä¸ªä»»åŠ¡ï¼Œä»è€Œé™ä½ä»»åŠ¡æäº¤é€Ÿåº¦ã€‚</li><li><strong>DiscardPolicy</strong>ï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ¥é”™ã€‚</li><li><strong>DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è€çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li></ul><h4 id="å·¥å‚ç±»-executors"><a class="markdownIt-Anchor" href="#å·¥å‚ç±»-executors"></a> å·¥å‚ç±» <code>Executors</code></h4><p>å¸¸ç”¨æ–¹æ³•ï¼š<br />â€¢Executors.newFixedThreadPool(n)ï¼šå›ºå®šå¤§å°çº¿ç¨‹æ± <br />â€¢Executors.newCachedThreadPool()ï¼šå¼¹æ€§çº¿ç¨‹æ± <br />â€¢Executors.newSingleThreadExecutor()ï¼šå•çº¿ç¨‹<br />â€¢Executors.newScheduledThreadPool(n)ï¼šå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </p><h5 id="executorserviceçº¿ç¨‹æ± æ¥å£"><a class="markdownIt-Anchor" href="#executorserviceçº¿ç¨‹æ± æ¥å£"></a> ExecutorServiceï¼ˆçº¿ç¨‹æ± æ¥å£ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Executor</span><br><span class="line">  â”‚</span><br><span class="line">  â”œâ”€â”€ ExecutorService</span><br><span class="line">  â”‚        â”‚</span><br><span class="line">  â”‚        â””â”€â”€ AbstractExecutorService</span><br><span class="line">  â”‚                â”‚</span><br><span class="line">  â”‚                â””â”€â”€ ThreadPoolExecutor  â† æ™®é€šçº¿ç¨‹æ± æ ¸å¿ƒ</span><br><span class="line">  â”‚</span><br><span class="line">  â””â”€â”€ ScheduledExecutorService</span><br><span class="line">           â”‚</span><br><span class="line">           â””â”€â”€ ScheduledThreadPoolExecutor â† å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± æ ¸å¿ƒ</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æ–¹æ³•ï¼š<br />â€¢submit()ï¼šæäº¤ä»»åŠ¡<br />â€¢shutdown()ï¼šä¼˜é›…å…³é—­<br />â€¢shutdownNow()ï¼šå¼ºåˆ¶ç»ˆæ­¢</p><h5 id="scheduledexecutorservice"><a class="markdownIt-Anchor" href="#scheduledexecutorservice"></a> <strong>ScheduledExecutorService</strong></h5><p>ç”¨äºæ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€å‘¨æœŸä»»åŠ¡ã€‚<br />åŒ…å«ï¼š<br /><code>schedule()</code><br /><code>scheduleAtFixedRate()</code><br /><code>scheduleWithFixedDelay()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå…·æœ‰2ä¸ªçº¿ç¨‹çš„å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. å»¶è¿Ÿ 3 ç§’æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</span></span><br><span class="line">        scheduler.schedule(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡ Aï¼šå»¶è¿Ÿ 3 ç§’æ‰§è¡Œ -&gt; &quot;</span> + System.currentTimeMillis());</span><br><span class="line">        &#125;, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. æ¯éš” 2 ç§’æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ˆå›ºå®šé¢‘ç‡ï¼‰</span></span><br><span class="line">        scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡ Bï¼šæ¯éš” 2 ç§’æ‰§è¡Œ -&gt; &quot;</span> + System.currentTimeMillis());</span><br><span class="line">        &#125;, <span class="number">1</span>, <span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¨‹åºä¸é€€å‡ºï¼Œä¿æŒæ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">// è‹¥æƒ³åœæ­¢ï¼Œç¨åè°ƒç”¨ scheduler.shutdown();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="forkjoinpool-åˆ†æ²»æ€æƒ³"><a class="markdownIt-Anchor" href="#forkjoinpool-åˆ†æ²»æ€æƒ³"></a> <code>ForkJoinPool</code> (åˆ†æ²»æ€æƒ³)</h4><p>ForkJoinPool æ˜¯ä¸€ç§ä¸“é—¨ç”¨äºâ€œåˆ†è€Œæ²»ä¹‹ï¼ˆForkï¼‰+ åˆå¹¶ç»“æœï¼ˆJoinï¼‰â€çš„é«˜æ•ˆå¹¶è¡Œè®¡ç®—çº¿ç¨‹æ± ï¼Œå®ƒç”¨æ¥å¤„ç†å¤§é‡å¯ä»¥æ‹†åˆ†çš„ä»»åŠ¡ï¼Œè‡ªåŠ¨è¿›è¡Œä»»åŠ¡çªƒå–ï¼ˆwork-stealingï¼‰ä»¥æå‡ CPU åˆ©ç”¨ç‡ã€‚</p><p>ä½ ä¸€èˆ¬åªéœ€è¦ç»§æ‰¿ï¼š<br />â€¢RecursiveActionï¼ˆvoid ä»»åŠ¡ï¼‰<br />â€¢RecursiveTaskï¼ˆæœ‰è¿”å›å€¼ä»»åŠ¡ï¼‰</p><p>å¤§æ•°ç»„æ±‚å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumTask</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span>[] arr;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> start, end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SumTask</span><span class="params">(<span class="type">long</span>[] arr, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.arr = arr;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> end - start;</span><br><span class="line">        <span class="keyword">if</span> (length &lt;= THRESHOLD) &#123; <span class="comment">// å°ä»»åŠ¡ç›´æ¥ç®—</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) sum += arr[i];</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> start + length / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(arr, start, mid);</span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(arr, mid, end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†è£‚</span></span><br><span class="line">        left.fork();</span><br><span class="line">        right.fork();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶</span></span><br><span class="line">        <span class="keyword">return</span> left.join() + right.join();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span>[] arr = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">1000000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) arr[i] = i;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> pool.invoke(<span class="keyword">new</span> <span class="title class_">SumTask</span>(arr, <span class="number">0</span>, arr.length));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ€»å’Œï¼š&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="future"><a class="markdownIt-Anchor" href="#future"></a> Future</h4><p>Future è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œä½ å¯ä»¥åœ¨æäº¤ä»»åŠ¡åç«‹å³å¾—åˆ° Future å¯¹è±¡ï¼Œä»¥åå†ä»è¿™ä¸ªå¯¹è±¡ä¸­å–ç»“æœã€‚<br />å…¶æ¥å£ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Future</span>&lt;V&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(<span class="type">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCancelled</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isDone</span><span class="params">()</span>;</span><br><span class="line">    V <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException;</span><br><span class="line">    V <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">         <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>futureçš„æœ€å¸¸è§æ¥æºï¼šçº¿ç¨‹æ± çš„ <strong>submit()</strong> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">Future&lt;Integer&gt; future = pool.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ future å°±æ˜¯å¼‚æ­¥ç»“æœå¥æŸ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">Future&lt;String&gt; future = pool.submit(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡</span></span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ä»»åŠ¡å®Œæˆ&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;æˆ‘å…ˆåšç‚¹åˆ«çš„äº‹...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾—åˆ°ç»“æœï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> future.get();</span><br><span class="line"></span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘å…ˆåšç‚¹åˆ«çš„äº‹...</span><br><span class="line">ä»»åŠ¡å®Œæˆ</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œfutureå¯ä»¥ é€šè¿‡ get() æ–¹æ³•è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼ˆé˜»å¡ç­‰å¾…ï¼‰ã€‚<br />åŒæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡cancelå–æ¶ˆä»»åŠ¡ï¼Œé€šè¿‡isDoneåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡get(timeout)ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡å®Œæˆï¼Œåˆ™æŠ› TimeoutExceptionã€‚</p><h3 id="ç¬¬å…­ç« å¼‚æ­¥ç¼–ç¨‹-asynchronous-programming"><a class="markdownIt-Anchor" href="#ç¬¬å…­ç« å¼‚æ­¥ç¼–ç¨‹-asynchronous-programming"></a> ç¬¬å…­ç« ï¼šå¼‚æ­¥ç¼–ç¨‹ (Asynchronous Programming)</h3><h4 id="future-çš„å±€é™æ€§"><a class="markdownIt-Anchor" href="#future-çš„å±€é™æ€§"></a> <code>Future</code> çš„å±€é™æ€§</h4><p>è™½ç„¶ <code>Future</code> å¼€å¯äº†å¼‚æ­¥æ‰§è¡Œçš„å…ˆæ²³ï¼Œä½†å®ƒåœ¨å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶éå¸¸ç¬¨æ‹™ï¼š</p><ul><li><strong>é˜»å¡ç­‰å¾…</strong>ï¼šè¦è·å–ç»“æœåªèƒ½è°ƒç”¨ <code>get()</code>ï¼Œå¦‚æœå­çº¿ç¨‹æ²¡è·‘å®Œï¼Œä¸»çº¿ç¨‹å¿…é¡»åœ¨æ­¤é˜»å¡ï¼Œè¿™å®é™…ä¸ŠæŠŠå¼‚æ­¥å˜æˆäº†åŒæ­¥ç­‰å¾…ã€‚</li><li><strong>è½®è¯¢è€—èƒ½</strong>ï¼šå¦‚æœä¸é˜»å¡ï¼Œå°±å¾—ç”¨ <code>isDone()</code> å¼€å¯æ­»å¾ªç¯è½®è¯¢ï¼Œæåº¦æ¶ˆè€— CPUã€‚</li><li><strong>æ— æ³•å›è°ƒ</strong>ï¼šæ— æ³•è¡¨è¾¾â€œä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€æ­¥â€çš„é€»è¾‘ã€‚</li><li><strong>ç¼–æ’å›°éš¾</strong>ï¼šå¾ˆéš¾å°†å¤šä¸ª <code>Future</code> çš„ç»“æœç»„åˆåœ¨ä¸€èµ·ï¼Œä»£ç ä¼šåµŒå¥—å¾—éå¸¸éš¾çœ‹ï¼ˆå›è°ƒåœ°ç‹±ï¼‰ã€‚</li></ul><h4 id="completablefuture"><a class="markdownIt-Anchor" href="#completablefuture"></a> <code>CompletableFuture</code></h4><p>JDK 8 å¼•å…¥çš„ <code>CompletableFuture</code> æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„é‡Œç¨‹ç¢‘ã€‚å®ƒå®ç°äº† <code>Future</code> å’Œ <code>CompletionStage</code> ä¸¤ä¸ªæ¥å£ï¼Œæ”¯æŒä»»åŠ¡çš„å›è°ƒã€ç»„åˆå’Œé“¾å¼ç¼–æ’ã€‚</p><h5 id="å¼‚æ­¥ä»»åŠ¡çš„å¯åŠ¨ä¸æ‰§è¡Œç­–ç•¥"><a class="markdownIt-Anchor" href="#å¼‚æ­¥ä»»åŠ¡çš„å¯åŠ¨ä¸æ‰§è¡Œç­–ç•¥"></a> å¼‚æ­¥ä»»åŠ¡çš„å¯åŠ¨ä¸æ‰§è¡Œç­–ç•¥</h5><p>ä»»åŠ¡çš„å¯åŠ¨é€šå¸¸ä¾èµ–äºé™æ€å·¥å‚æ–¹æ³•ã€‚<code>supplyAsync</code> ç”¨äºå¯åŠ¨å…·æœ‰è¿”å›å€¼çš„å¼‚æ­¥è®¡ç®—ï¼Œè€Œ <code>runAsync</code> åˆ™é€‚ç”¨äºä»…éœ€æ‰§è¡Œç‰¹å®šåŠ¨ä½œä¸”æ— éœ€è¿”å›ç»“æœçš„åœºæ™¯ã€‚åœ¨èµ„æºè°ƒåº¦å±‚é¢ï¼Œè‹¥ä¸æŒ‡å®š <code>Executor</code>ï¼Œè¿™äº›ä»»åŠ¡é»˜è®¤ç”± <code>ForkJoinPool.commonPool()</code> æ‰¿è½½ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œé€šå¸¸å»ºè®®ä¼ å…¥è‡ªå®šä¹‰çº¿ç¨‹æ± ä»¥å®ç°ä¸šåŠ¡é—´çš„èµ„æºéš”ç¦»ä¸ç›‘æ§ã€‚</p><h5 id="å¼‚æ­¥é“¾è·¯çš„å›è°ƒå¤„ç†æœºåˆ¶"><a class="markdownIt-Anchor" href="#å¼‚æ­¥é“¾è·¯çš„å›è°ƒå¤„ç†æœºåˆ¶"></a> å¼‚æ­¥é“¾è·¯çš„å›è°ƒå¤„ç†æœºåˆ¶</h5><p>åœ¨ä»»åŠ¡å®Œæˆåï¼Œ<code>CompletableFuture</code> æ”¯æŒé€šè¿‡é“¾å¼è°ƒç”¨å®šä¹‰å›è°ƒé€»è¾‘ã€‚<code>thenApply</code> æ–¹æ³•èƒ½å¤Ÿè·å–å‰ä¸€é˜¶æ®µçš„æ‰§è¡Œç»“æœå¹¶å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„è¿”å›å€¼ï¼Œä»è€Œæ„å»ºå‡ºæµæ°´çº¿å¼çš„å¤„ç†é“¾è·¯ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œ<code>thenAccept</code> ä»…ç”¨äºæ¶ˆè´¹å‰åºä»»åŠ¡çš„ç»“æœè€Œä¸äº§ç”Ÿæ–°çš„è¾“å‡ºï¼Œè€Œ <code>thenRun</code> åˆ™å®Œå…¨å¿½ç•¥ç»“æœï¼Œä»…åœ¨ä»»åŠ¡å®Œæˆè¿™ä¸€ç‰¹å®šæ—¶æœºè§¦å‘åç»­åŠ¨ä½œã€‚</p><h5 id="å¤šä»»åŠ¡çš„é€»è¾‘ç¼–æ’ä¸ååŒ"><a class="markdownIt-Anchor" href="#å¤šä»»åŠ¡çš„é€»è¾‘ç¼–æ’ä¸ååŒ"></a> å¤šä»»åŠ¡çš„é€»è¾‘ç¼–æ’ä¸ååŒ</h5><p>é’ˆå¯¹å¤æ‚çš„å¹¶å‘åœºæ™¯ï¼Œ<code>CompletableFuture</code> æä¾›äº†å¼ºå¤§çš„ç¼–æ’èƒ½åŠ›ã€‚å¯¹äºå­˜åœ¨å…ˆåä¾èµ–å…³ç³»çš„ä¸²è¡Œä»»åŠ¡ï¼Œ<code>thenCompose</code> å¯ä»¥å°†å‰ä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºå¹³æ»‘ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼›è€Œå¯¹äºäº’ä¸ä¾èµ–ã€éœ€å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡ï¼Œ<code>thenCombine</code> æ”¯æŒåœ¨ä¸¤ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆåå¯¹å…¶ç»“æœè¿›è¡Œèšåˆã€‚åœ¨æ›´å®è§‚çš„å±‚é¢ï¼Œ<code>allOf</code> æä¾›äº†é˜»å¡å¼åŒæ­¥æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰å¹¶è¡Œçš„å¼‚æ­¥ä»»åŠ¡å…¨éƒ¨å®Œæˆåå†å‘ä¸‹æ‰§è¡Œï¼Œè€Œ <code>anyOf</code> åˆ™å®ç°äº†ç«äº‰é€»è¾‘ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªä»»åŠ¡ç‡å…ˆå®Œæˆå³è¿”å›å…¶ç»“æœã€‚</p><h5 id="å¼‚æ­¥é“¾è·¯çš„å¼‚å¸¸æ•è·ä¸å®¹é”™"><a class="markdownIt-Anchor" href="#å¼‚æ­¥é“¾è·¯çš„å¼‚å¸¸æ•è·ä¸å®¹é”™"></a> å¼‚æ­¥é“¾è·¯çš„å¼‚å¸¸æ•è·ä¸å®¹é”™</h5><p>å¼‚æ­¥ç¼–ç¨‹ä¸­çš„å¼‚å¸¸ä¼ æ’­ä¸ä¼ ç»ŸåŒæ­¥ä»£ç æœ‰æ‰€ä¸åŒï¼Œéœ€è¦ä¸“é—¨çš„å…œåº•æœºåˆ¶ã€‚<code>exceptionally</code> æ–¹æ³•ç±»ä¼¼äºåŒæ­¥ä»£ç ä¸­çš„ catch å—ï¼Œèƒ½å¤Ÿåœ¨é“¾è·¯å‡ºç°å¼‚å¸¸æ—¶æ‹¦æˆªé”™è¯¯å¹¶è¿”å›ä¸€ä¸ªé¢„è®¾çš„é»˜è®¤å€¼ï¼Œç¡®ä¿åç»­é“¾è·¯ä¸ä¼šå› æœªæ•è·çš„å¼‚å¸¸è€Œä¸­æ–­ã€‚æ­¤å¤–ï¼Œ<code>handle</code> æ–¹æ³•æä¾›äº†æ›´å…¨é¢çš„æ§åˆ¶ï¼Œæ— è®ºå‰åºä»»åŠ¡æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒå‡èƒ½æ¥æ”¶åˆ°æ‰§è¡Œç»“æœæˆ–å¼‚å¸¸å¯¹è±¡ï¼Œå¹¶è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ä¸è½¬æ¢ã€‚</p><p>ä¸¾ä¸€ä¸ªé“¾å¼æµæ°´çº¿çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;æŸ¥è¯¢å•†å“ID:123&quot;</span>)</span><br><span class="line">    .thenApply(id -&gt; <span class="string">&quot;è·å–å•†å“ä»·æ ¼: $99&quot;</span>) <span class="comment">// é“¾å¼å¤„ç†</span></span><br><span class="line">    .thenCombine(CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;è·å–ä¼˜æƒ åˆ¸: -$10&quot;</span>), </span><br><span class="line">        (price, coupon) -&gt; price + <span class="string">&quot; &quot;</span> + coupon) <span class="comment">// ç»„åˆä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">    .thenAccept(finalResult -&gt; System.out.println(<span class="string">&quot;æœ€ç»ˆæŠ¥ä»·: &quot;</span> + finalResult))</span><br><span class="line">    .exceptionally(e -&gt; &#123; </span><br><span class="line">        System.err.println(<span class="string">&quot;å‡ºé”™: &quot;</span> + e.getMessage()); </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; </span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h4 id="completionservice"><a class="markdownIt-Anchor" href="#completionservice"></a> <code>CompletionService</code></h4><p><code>CompletionService&lt;V&gt;</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”¨äº æäº¤å¼‚æ­¥ä»»åŠ¡å¹¶æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœã€‚å®ƒç»“åˆäº† Executorï¼ˆçº¿ç¨‹æ± ï¼‰å’Œ BlockingQueue çš„åŠŸèƒ½ã€‚ä»»åŠ¡å®Œæˆé¡ºåºä¸æäº¤é¡ºåºå¯èƒ½ä¸åŒï¼Œä½¿ç”¨ CompletionService å¯ä»¥ æŒ‰ç…§å®Œæˆé¡ºåº è·å–ä»»åŠ¡ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletionServiceExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">        CompletionService&lt;String&gt; service = <span class="keyword">new</span> <span class="title class_">ExecutorCompletionService</span>&lt;&gt;(pool);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ä»»åŠ¡</span></span><br><span class="line">        service.submit(() -&gt; &#123; Thread.sleep(<span class="number">300</span>); <span class="keyword">return</span> <span class="string">&quot;Task 1&quot;</span>; &#125;);</span><br><span class="line">        service.submit(() -&gt; &#123; Thread.sleep(<span class="number">100</span>); <span class="keyword">return</span> <span class="string">&quot;Task 2&quot;</span>; &#125;);</span><br><span class="line">        service.submit(() -&gt; &#123; Thread.sleep(<span class="number">200</span>); <span class="keyword">return</span> <span class="string">&quot;Task 3&quot;</span>; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‰å®Œæˆé¡ºåºè·å–ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Future&lt;String&gt; future = service.take();  <span class="comment">// é˜»å¡ç›´åˆ°æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">            System.out.println(future.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸ƒç« å¹¶å‘å®¹å™¨-concurrent-collections"><a class="markdownIt-Anchor" href="#ç¬¬ä¸ƒç« å¹¶å‘å®¹å™¨-concurrent-collections"></a> ç¬¬ä¸ƒç« ï¼šå¹¶å‘å®¹å™¨ (Concurrent Collections)</h3><h4 id="concurrenthashmap-åŸç†"><a class="markdownIt-Anchor" href="#concurrenthashmap-åŸç†"></a> <code>ConcurrentHashMap</code> åŸç†</h4><p><code>ConcurrentHashMap</code> æ˜¯ä¸ºäº†è§£å†³ <code>Hashtable</code> å…¨å±€é”å®šå¯¼è‡´å¹¶å‘æ•ˆç‡ä½ä¸‹çš„é—®é¢˜è€Œè®¾è®¡çš„ã€‚åœ¨ Java 8 åŠå…¶åç»­ç‰ˆæœ¬ä¸­ï¼Œå®ƒèˆå¼ƒäº†æ—©æœŸç‰ˆæœ¬ä¸­çš„åˆ†æ®µé”ï¼ˆSegmentï¼‰è®¾è®¡ï¼Œè½¬è€Œé‡‡ç”¨ <strong>Node æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘</strong> çš„ç»“æ„ï¼Œå¹¶ç»“åˆ <strong>CASï¼ˆCompare-And-Swapï¼‰</strong> å’Œ <strong>synchronized</strong> å®ç°æ›´ç»†ç²’åº¦çš„é”æ§åˆ¶ã€‚</p><p>åœ¨æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œ<code>ConcurrentHashMap</code> å®Œå…¨ä¸åŠ é”ï¼Œé€šè¿‡ <code>volatile</code> å…³é”®å­—ä¿è¯äº†æ•°æ®çš„å¯è§æ€§ï¼Œè¿™ä½¿å¾—å®ƒåœ¨è¯»å–å¯†é›†çš„åœºæ™¯ä¸‹è¡¨ç°æä½³ã€‚åœ¨æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå®ƒä»…é”å®šå½“å‰æ­£åœ¨æ“ä½œçš„å“ˆå¸Œæ¡¶ï¼ˆå³ Node æ•°ç»„çš„å¤´èŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯æ•´ä¸ª Mapã€‚è¿™ç§â€œå±€éƒ¨é”å®šâ€çš„ç­–ç•¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸åŒçš„å“ˆå¸Œæ¡¶è¿›è¡Œå†™å…¥ã€‚æ­¤å¤–ï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ä¸”æ•°ç»„å®¹é‡å¤§äº 64 æ—¶ï¼Œé“¾è¡¨ä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥ä¿è¯åœ¨é«˜ç¢°æ’æƒ…å†µä¸‹çš„æŸ¥è¯¢æ•ˆç‡ä»èƒ½ç»´æŒåœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ã€‚</p><h4 id="copyonwritearraylist"><a class="markdownIt-Anchor" href="#copyonwritearraylist"></a> <code>CopyOnWriteArrayList</code></h4><p><code>CopyOnWriteArrayList</code> é‡‡ç”¨äº†ä¸€ç§æå…¶ç‹¬ç‰¹çš„â€œå†™æ—¶å¤åˆ¶â€ï¼ˆCopy-On-Writeï¼‰ç­–ç•¥ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå½“ä½ å¯¹å®¹å™¨è¿›è¡Œä¿®æ”¹ï¼ˆæ·»åŠ ã€åˆ é™¤ã€è®¾ç½®å…ƒç´ ï¼‰æ—¶ï¼Œå®ƒå¹¶ä¸ç›´æ¥ä¿®æ”¹å½“å‰æ•°ç»„ï¼Œè€Œæ˜¯å…ˆå°†åŸæ•°ç»„æ‹·è´ä¸€ä»½å‰¯æœ¬ï¼Œåœ¨å‰¯æœ¬ä¸Šå®Œæˆä¿®æ”¹æ“ä½œï¼Œæœ€åå†å°†åŸæ•°ç»„çš„å¼•ç”¨æŒ‡å‘è¿™ä¸ªæ–°å‰¯æœ¬ã€‚</p><p>è¿™ç§æœºåˆ¶å¸¦æ¥äº†æ˜¾è‘—çš„ç‰¹æ€§ï¼š<strong>è¯»æ“ä½œå®Œå…¨æ— é”ä¸”ä¸é˜»å¡</strong>ã€‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨éå†åˆ—è¡¨æ—¶ï¼Œå³ä½¿æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œä¿®æ”¹ï¼Œéå†çº¿ç¨‹çœ‹åˆ°çš„ä¾ç„¶æ˜¯ä¿®æ”¹å‰çš„æ—§æ•°ç»„é•œåƒï¼Œå› æ­¤å®ƒå¤©ç„¶åœ°è§£å†³äº†å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼ˆ<code>ConcurrentModificationException</code>ï¼‰ã€‚ç„¶è€Œï¼Œè¿™ç§è®¾è®¡ä¹Ÿå­˜åœ¨æ˜æ˜¾çš„æƒè¡¡ï¼Œå³æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šå¯¼è‡´æ•°ç»„æ‹·è´ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§ã€‚å› æ­¤ï¼Œå®ƒä»…é€‚ç”¨äº<strong>è¯»å¤šå†™æå°‘</strong>ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸æ˜¯æé«˜çš„åœºæ™¯ï¼ˆä¾‹å¦‚é…ç½®ç™½åå•æˆ–ç›‘å¬å™¨åˆ—è¡¨ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†™æ“ä½œç¤ºä¾‹ï¼šå†…éƒ¨ä¼šåŠ é”å¹¶å¤åˆ¶æ•°ç»„</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">&quot;data&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»æ“ä½œç¤ºä¾‹ï¼šç›´æ¥è¯»å–å¼•ç”¨ï¼Œæ€§èƒ½æé«˜</span></span><br><span class="line"><span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h4 id="é˜»å¡é˜Ÿåˆ—-blockingqueue-å…¨å®¶æ¡¶"><a class="markdownIt-Anchor" href="#é˜»å¡é˜Ÿåˆ—-blockingqueue-å…¨å®¶æ¡¶"></a> é˜»å¡é˜Ÿåˆ— <code>BlockingQueue</code> å…¨å®¶æ¡¶</h4><p><code>BlockingQueue</code> æ˜¯å®ç°â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹çš„çµé­‚ç»„ä»¶ã€‚å®ƒä¸æ™®é€šé˜Ÿåˆ—çš„åŒºåˆ«åœ¨äºæ”¯æŒ<strong>é˜»å¡æœºåˆ¶</strong>ï¼šå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå°è¯•å–å‡ºçš„çº¿ç¨‹ä¼šè¢«é˜»å¡ç›´åˆ°æœ‰æ•°æ®å¯ç”¨ï¼›å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå°è¯•å­˜å…¥çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ç›´åˆ°é˜Ÿåˆ—å‡ºç°ç©ºä½ã€‚</p><p>JUC æä¾›äº†å¤šç§ä¸åŒç‰¹æ€§çš„å®ç°ç±»ã€‚<code>ArrayBlockingQueue</code> åŸºäºå®šé•¿æ•°ç»„ï¼Œå¼ºåˆ¶è¦æ±‚è®¾ç½®åˆå§‹å®¹é‡ï¼Œé€‚åˆä»»åŠ¡é‡ç¨³å®šçš„ç³»ç»Ÿã€‚<code>LinkedBlockingQueue</code> åŸºäºé“¾è¡¨ï¼Œé»˜è®¤å®¹é‡ä¸º <code>Integer.MAX_VALUE</code>ï¼Œå¦‚æœä¸è®¾é™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚<code>SynchronousQueue</code> åˆ™æ›´ä¸ºç‰¹æ®Šï¼Œå®ƒä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œæ¯ä¸€ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç§»é™¤æ“ä½œï¼Œæ˜¯çº¿ç¨‹é—´â€œæ‰‹é€’æ‰‹â€ä¼ é€’æ•°æ®çš„æ¡¥æ¢ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰æ”¯æŒä¼˜å…ˆçº§çš„ <code>PriorityBlockingQueue</code> å’Œå¤„ç†å»¶è¿Ÿä»»åŠ¡çš„ <code>DelayQueue</code>ã€‚è¿™äº›é˜Ÿåˆ—é€šè¿‡å†…éƒ¨çš„ <code>ReentrantLock</code> å’Œ <code>Condition</code> æœºåˆ¶ï¼Œä¼˜é›…åœ°è§£å†³äº†çº¿ç¨‹é—´çš„åŒæ­¥è°ƒåº¦é—®é¢˜ã€‚</p><h3 id="ç¬¬å…«ç« -æ­»é”"><a class="markdownIt-Anchor" href="#ç¬¬å…«ç« -æ­»é”"></a> ç¬¬å…«ç«  æ­»é”</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ<strong>æ­»é”ï¼ˆDeadlockï¼‰</strong> æ˜¯æœ€ä»¤äººå¤´ç–¼çš„å¹¶å‘é—®é¢˜ä¹‹ä¸€ã€‚å®ƒå‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹æ‰€éœ€çš„èµ„æºï¼Œå¯¼è‡´æ‰€æœ‰ç›¸å…³çº¿ç¨‹éƒ½è¿›å…¥æ— é™æœŸçš„ç­‰å¾…çŠ¶æ€ã€‚</p><h4 id="æ­»é”çš„å››å¤§å¿…è¦æ¡ä»¶"><a class="markdownIt-Anchor" href="#æ­»é”çš„å››å¤§å¿…è¦æ¡ä»¶"></a> æ­»é”çš„å››å¤§å¿…è¦æ¡ä»¶</h4><p>æ ¹æ®ç»å…¸æ“ä½œç³»ç»Ÿç†è®ºï¼Œæ­»é”çš„å‘ç”Ÿå¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ã€‚å¦‚æœèƒ½ç ´åå…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿï¼š</p><ol><li><strong>äº’æ–¥æ¡ä»¶ï¼ˆMutual Exclusionï¼‰</strong>ï¼š<br />èµ„æºæ˜¯ç‹¬å çš„ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªèµ„æºï¼ˆå¦‚ä¸€ä¸ªå¯¹è±¡é”ï¼‰åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å¦‚æœå…¶ä»–çº¿ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œå¿…é¡»ç­‰å¾…ç›´åˆ°æŒæœ‰è€…é‡Šæ”¾ã€‚</li><li><strong>å æœ‰ä¸”ç­‰å¾…ï¼ˆHold and Waitï¼‰</strong>ï¼š<br />ä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºæ­£è¢«å…¶ä»–çº¿ç¨‹å æœ‰ã€‚æ­¤æ—¶è¯·æ±‚çº¿ç¨‹é˜»å¡ï¼Œä½†å¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li><strong>ä¸å¯å‰¥å¤ºï¼ˆNo Preemptionï¼‰</strong>ï¼š<br />çº¿ç¨‹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œåªèƒ½ç”±è¯¥çº¿ç¨‹åœ¨å®Œæˆä»»åŠ¡åä¸»åŠ¨é‡Šæ”¾ã€‚</li><li><strong>å¾ªç¯ç­‰å¾…ï¼ˆCircular Waitï¼‰</strong>ï¼š<br />å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹çš„èµ„æºå¾ªç¯é“¾ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">T1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">1</span></span></span></span> ç­‰å¾… <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">T2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">2</span></span></span></span> å æœ‰çš„èµ„æºï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">T2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">2</span></span></span></span> ç­‰å¾… <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">T3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">3</span></span></span></span> çš„èµ„æºâ€¦â€¦æœ€å <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">Tn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">n</span></span></span></span> åˆåœ¨ç­‰å¾… <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">T1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">1</span></span></span></span> å æœ‰çš„èµ„æºã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹ t1ï¼šå…ˆæ‹¿ Aï¼Œå†æ‹¿ B</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125; <span class="comment">// ç¡®ä¿ t2 æ‹¿åˆ°äº† B</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 1 acquired both locks&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹ t2ï¼šå…ˆæ‹¿ Bï¼Œå†æ‹¿ A</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125; <span class="comment">// ç¡®ä¿ t1 æ‹¿åˆ°äº† A</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 2 acquired both locks&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒThread.sleep(100) æ˜¯äº§ç”Ÿæ­»é”çš„å…³é”®å‚¬åŒ–å‰‚ã€‚å®ƒä¿è¯äº† t1 é”ä½ lockA çš„åŒæ—¶ï¼Œt2 æœ‰è¶³å¤Ÿçš„æ—¶é—´é”ä½ lockBã€‚æ­¤æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">t1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">1</span></span></span></span> è¯•å›¾è·å– lockB æ—¶ä¼šå› ä¸ºâ€œäº’æ–¥â€è¢«é˜»å¡ï¼ŒåŒæ—¶å®ƒâ€œå æœ‰ä¸”ç­‰å¾…â€ç€ lockAï¼›<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">t2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">2</span></span></span></span> åŒç†ã€‚ç”±äºé”æ˜¯â€œä¸å¯å‰¥å¤ºâ€çš„ï¼Œæœ€ç»ˆå½¢æˆäº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mn>1</mn><mo>â†’</mo><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>B</mi><mo>â†’</mo><mi>t</mi><mn>2</mn><mo>â†’</mo><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>A</mi><mo>â†’</mo><mi>t</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">t1 \rightarrow lockB \rightarrow t2 \rightarrow lockA \rightarrow t1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">1</span></span></span></span> çš„å¾ªç¯ç­‰å¾…ã€‚</p><p><strong>å¦‚ä½•æ’æŸ¥æ­»é”ï¼Ÿ</strong><br />å½“ç¨‹åºçªç„¶â€œå¡æ­»â€ä¸” CPU å ç”¨ç‡æä½æ—¶ï¼Œææœ‰å¯èƒ½æ˜¯å‘ç”Ÿäº†æ­»é”ã€‚ä½ å¯ä»¥ä½¿ç”¨ JDK è‡ªå¸¦çš„å·¥å…·è¿›è¡Œæ£€æµ‹ï¼š</p><ol><li><strong><code>jcmd / jps</code></strong>ï¼šè·å–è¿è¡Œä¸­çš„ Java è¿›ç¨‹ IDã€‚</li><li><strong><code>jstack &lt;pid&gt;</code></strong>ï¼šæ‰“å°çº¿ç¨‹å †æ ˆã€‚å¦‚æœå­˜åœ¨æ­»é”ï¼Œ<code>jstack</code> ä¼šåœ¨æœ«å°¾æ˜ç¡®æç¤º <code>Found one Java-level deadlock</code>ï¼Œå¹¶è¯¦ç»†åˆ—å‡ºæ˜¯å“ªäº›çº¿ç¨‹åœ¨å“ªä¸ªå¯¹è±¡ä¸Šäº’ç›¸æŠ˜ç£¨ã€‚</li></ol><p><strong>å¦‚ä½•é¢„é˜²æ­»é”ï¼Ÿ</strong></p><ol><li><strong>å›ºå®šåŠ é”é¡ºåº</strong>ï¼ˆç ´åå¾ªç¯ç­‰å¾…ï¼‰ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ¡ˆã€‚è®© <code>t1</code> å’Œ <code>t2</code> éƒ½æŒ‰ç…§â€œå…ˆæ‹¿ A å†æ‹¿ Bâ€çš„é¡ºåºå»ç«äº‰ï¼Œè¿™æ ·å°±ä¸ä¼šå½¢æˆç¯è·¯ã€‚</li><li><strong>å°è¯•æ€§è·å–é”</strong>ï¼ˆç ´åä¸å¯å‰¥å¤ºï¼‰ï¼šä½¿ç”¨ <code>ReentrantLock</code> çš„ <code>tryLock(long time, TimeUnit unit)</code> æ–¹æ³•ã€‚å¦‚æœçº¿ç¨‹åœ¨è§„å®šæ—¶é—´å†…æ‹¿ä¸åˆ°ä¸‹ä¸€æŠŠé”ï¼Œå°±ä¸»åŠ¨é‡Šæ”¾å·²ç»æ‹¿åˆ°çš„é”ï¼Œé€€å›å¹¶é‡è¯•ã€‚</li><li><strong>å‡å°é”ç²’åº¦</strong>ï¼šå°½é‡ä¸è¦åœ¨ä¸€ä¸ªåŒæ­¥å—ä¸­åµŒå¥—å¦ä¸€ä¸ªåŒæ­¥å—ã€‚</li></ol><h3 id="ç¬¬ä¹ç« -threadå†…å­˜æ³„æ¼"><a class="markdownIt-Anchor" href="#ç¬¬ä¹ç« -threadå†…å­˜æ³„æ¼"></a> ç¬¬ä¹ç«  Threadå†…å­˜æ³„æ¼</h3><p>åœ¨å¤šçº¿ç¨‹å¼€å‘ä¸­ï¼Œé™¤äº†æ­»é”ï¼Œå¦ä¸€ä¸ªéšè”½ä¸”é«˜å‘çš„é™·é˜±æ˜¯ <strong>ThreadLocal å¯¼è‡´çš„å†…å­˜æ³„æ¼</strong>ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨é•¿ç”Ÿå‘½å‘¨æœŸçš„çº¿ç¨‹ï¼ˆå¦‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼‰ä¸­ã€‚</p><h4 id="threadlocal-å†…å­˜æ³„æ¼çš„æ ¹æº"><a class="markdownIt-Anchor" href="#threadlocal-å†…å­˜æ³„æ¼çš„æ ¹æº"></a> ThreadLocal å†…å­˜æ³„æ¼çš„æ ¹æº</h4><p><code>ThreadLocal</code> çš„åŸç†æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªç§æœ‰çš„ <code>ThreadLocalMap</code>ã€‚è¿™ä¸ª Map çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒçš„å†…éƒ¨ç»“æ„ï¼šå…¶ <strong>Keyï¼ˆThreadLocal å®ä¾‹ï¼‰æ˜¯å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong>ï¼Œè€Œ <strong>Valueï¼ˆå­˜å‚¨çš„æ•°æ®ï¼‰æ˜¯å¼ºå¼•ç”¨</strong>ã€‚</p><p>è¿™ç§è®¾è®¡çš„åˆè¡·æ˜¯ä¸ºäº†ä¿æŠ¤å†…å­˜ï¼šå½“å¤–éƒ¨ä¸å†æŒæœ‰ <code>ThreadLocal</code> å®ä¾‹çš„å¼ºå¼•ç”¨æ—¶ï¼ŒKey ä¼šåœ¨ä¸‹ä¸€æ¬¡ GC æ—¶è¢«å›æ”¶ï¼Œå˜æˆ <code>null</code>ã€‚ç„¶è€Œï¼Œé—®é¢˜ä¹Ÿå°±æ­¤äº§ç”Ÿã€‚è™½ç„¶ Key æ¶ˆå¤±äº†ï¼Œä½† <strong>Value ä¾ç„¶è¢«çº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä»¥å¼ºå¼•ç”¨çš„æ–¹å¼æŒæœ‰</strong>ã€‚</p><p>å¦‚æœè¿™ä¸ªçº¿ç¨‹æ˜¯æ™®é€šçº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä»»åŠ¡å°±é”€æ¯äº†ï¼Œé‚£ä¹ˆæ•´ä¸ª Map éƒ½ä¼šè¢«å›æ”¶ã€‚ä½†ç°ä»£åº”ç”¨å‡ ä¹éƒ½åœ¨ä½¿ç”¨<strong>çº¿ç¨‹æ± </strong>ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯é«˜åº¦å¤ç”¨çš„ï¼Œè¿™æ„å‘³ç€ï¼š</p><ol><li>çº¿ç¨‹æ°¸è¿œä¸ä¼šç»“æŸã€‚</li><li><code>ThreadLocalMap</code> é‡Œçš„é‚£å— Value å†…å­˜ä¼šä¸€ç›´è¢«å ç”¨ã€‚</li><li>ç”±äº Key å˜æˆäº† <code>null</code>ï¼Œä½ å†ä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ­£å¸¸é€”å¾„è®¿é—®åˆ°è¿™å— Valueï¼Œå®ƒæˆäº†ä¸€å—â€œå¹½çµå†…å­˜â€ã€‚</li></ol><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalLeakDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;<span class="type">byte</span>[]&gt; localData = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªå›ºå®šå¤§å°ä¸º 5 çš„çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">            pool.execute(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// æ¯ä¸ªä»»åŠ¡å ç”¨ 5MB å†…å­˜</span></span><br><span class="line">                localData.set(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">5</span>]);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è®¾ç½®äº†æ•°æ®&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è°ƒç”¨ localData.remove()</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œè™½ç„¶ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œä½†ç”±äºçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ²¡æ­»ï¼Œæ¯ä¸ªçº¿ç¨‹æŒæœ‰çš„ 5MB å­—èŠ‚æ•°ç»„ä¼šä¸€ç›´é©»ç•™åœ¨å†…å­˜ä¸­ã€‚å¦‚æœä»»åŠ¡ä¸æ–­æäº¤ï¼Œå†…å­˜å ç”¨ä¼šæŒç»­æ”€å‡ï¼Œæœ€ç»ˆå¯¼è‡´ <code>OutOfMemoryError</code>ã€‚</p><p>ä½¿ç”¨ <code>jvisualvm</code> æˆ– <code>MAT</code> (Memory Analyzer Tool) æŸ¥çœ‹å †è½¬å‚¨ï¼ˆHeap Dumpï¼‰ã€‚å¦‚æœä½ å‘ç° <code>ThreadLocalMap</code> é‡Œçš„ <code>Entry</code> æ•°é‡å¼‚å¸¸å¤šï¼Œä¸”å…¶ <code>value</code> å­—æ®µå ç”¨äº†å¤§é‡å†…å­˜ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯æ³„æ¼ã€‚</p><p>åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>ThreadLocal</code> æ—¶ï¼ŒåŠ¡å¿…éµå¾ª <code>try-finally</code> æ¨¡å¼ï¼Œåœ¨ <code>finally</code> å—ä¸­è°ƒç”¨ <code>remove()</code> æ–¹æ³•ã€‚è¿™ä¼šæ¸…é™¤å½“å‰çº¿ç¨‹ Map ä¸­å¯¹åº”çš„ Entryã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    localData.set(value);</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// å…³é”®ï¼šä»»åŠ¡ç»“æŸå‰ä¸€å®šè¦æ¸…ç†ï¼Œå°¤å…¶æ˜¯åœ¨çº¿ç¨‹æ± ç¯å¢ƒä¸‹</span></span><br><span class="line">    localData.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸‡å­—é•¿æ–‡æ¢³ç†JAVAçº¿ç¨‹æ–¹æ³•çš„åŸºç¡€åº”ç”¨&lt;/p&gt;</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ -java" scheme="https://atffang.github.io/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-java/"/>
    
    
  </entry>
  
  <entry>
    <title>MTMCTæ–¹å‘çš„åº¦é‡å­¦ä¹ æ¢³ç†</title>
    <link href="https://atffang.github.io/2025/12/21/MTMCT%E6%96%B9%E5%90%91%E7%9A%84%E5%BA%A6%E9%87%8F%E5%AD%A6%E4%B9%A0%E6%A2%B3%E7%90%86/"/>
    <id>https://atffang.github.io/2025/12/21/MTMCT%E6%96%B9%E5%90%91%E7%9A%84%E5%BA%A6%E9%87%8F%E5%AD%A6%E4%B9%A0%E6%A2%B3%E7%90%86/</id>
    <published>2025-12-21T07:11:01.000Z</published>
    <updated>2026-01-10T14:28:46.194Z</updated>
    
    <content type="html"><![CDATA[<p>MTMCTæ–¹å‘çš„åº¦é‡å­¦ä¹ æ¢³ç†ã€‚</p><span id="more"></span><h3 id="èƒŒæ™¯"><a class="markdownIt-Anchor" href="#èƒŒæ™¯"></a> èƒŒæ™¯</h3><p>åœ¨ä»¥è¡Œäººé‡è¯†åˆ«ï¼ˆPerson Re-Identification, ReIDï¼‰ä¸ºä»£è¡¨çš„ä¸€äº›è§†è§‰ä»»åŠ¡ä¸­ï¼Œæµ‹è¯•é˜¶æ®µå‡ºç°çš„ç±»åˆ«ï¼ˆå³å…·ä½“çš„è¡Œäººèº«ä»½æˆ–ç›®æ ‡IDï¼‰åœ¨è®­ç»ƒé˜¶æ®µæ˜¯æœªçŸ¥çš„ã€‚è¿™ä»æ ¹æœ¬ä¸Šè¦æ±‚æ¨¡å‹å…·å¤‡æå–å…·å¤‡å¼ºåˆ¤åˆ«åŠ›ï¼ˆDiscriminativeï¼‰ä¸”é«˜æ³›åŒ–æ€§ç‰¹å¾çš„èƒ½åŠ›ï¼Œè€Œéå•çº¯åœ°è®°å¿†è®­ç»ƒé›†ä¸­çš„ç±»åˆ«æ ‡ç­¾ã€‚</p><p><strong>åº¦é‡å­¦ä¹ ï¼ŒMetric Learning</strong> æ­£æ˜¯è§£å†³è¿™ä¸€æ ¸å¿ƒçŸ›ç›¾çš„å…³é”®æŠ€æœ¯é€”å¾„ã€‚å…¶æœ¬è´¨æ—¨åœ¨é€šè¿‡æ·±åº¦ç¥ç»ç½‘ç»œæ„å»ºä¸€ä¸ªéçº¿æ€§çš„<strong>ç‰¹å¾æ˜ å°„å‡½æ•°</strong>ï¼Œå°†å­˜åœ¨äºé«˜ç»´åƒç´ ç©ºé—´çš„åŸå§‹æ•°æ®æŠ•å½±è‡³ä½ç»´çš„<strong>åµŒå…¥ç©ºé—´</strong>ï¼ˆEmbedding Spaceï¼‰æˆ–æµå½¢ï¼ˆManifoldï¼‰ä¸Šã€‚åœ¨æ­¤åº¦é‡ç©ºé—´ä¸­ï¼Œ<strong>è·ç¦»åº¦é‡</strong>ï¼ˆå¦‚æ¬§æ°è·ç¦»æˆ–ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ç›´æ¥å¯¹åº”äºæ ·æœ¬é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚</p><p>ç†æƒ³çš„åº¦é‡å­¦ä¹ æ¨¡å‹åº”å½“æ»¡è¶³ä¸¤ä¸ªåŸºæœ¬å‡ ä½•çº¦æŸï¼š</p><ul><li><strong>åŒç±»æ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­é«˜åº¦ç´§å‡‘</strong>ï¼ˆIntra-class Compactnessï¼‰</li><li><strong>å¼‚ç±»æ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­å°½å¯èƒ½åˆ†ç¦»</strong>ï¼ˆInter-class Separabilityï¼‰</li></ul><h4 id="é—®é¢˜å®šä¹‰"><a class="markdownIt-Anchor" href="#é—®é¢˜å®šä¹‰"></a> é—®é¢˜å®šä¹‰</h4><p>ä»æ•°å­¦è§’åº¦å½¢å¼åŒ–åœ°çœ‹ï¼Œåº¦é‡å­¦ä¹ çš„ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ä¸ªå‚æ•°åŒ–çš„æ˜ å°„å‡½æ•°ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>f</mi><mi>Î¸</mi></msub><mo>:</mo><mi mathvariant="script">X</mi><mo>â†’</mo><msup><mi mathvariant="double-struck">R</mi><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">f_\theta: \mathcal{X} \rightarrow \mathbb{R}^d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8991079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">X</mi></mrow><annotation encoding="application/x-tex">\mathcal{X}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span></span></span></span> ä¸ºè¾“å…¥å›¾åƒç©ºé—´ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span> ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span></span></span></span> ç»´ç‰¹å¾å‘é‡ç©ºé—´ã€‚</p><p>å¯¹äºä»»æ„ç»™å®šçš„ä¸‰å…ƒç»„æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>p</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_a, x_p, x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºé”šç‚¹æ ·æœ¬ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">x_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åŒä¸€èº«ä»½çš„æ­£æ ·æœ¬ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸ºä¸åŒèº«ä»½çš„è´Ÿæ ·æœ¬ï¼Œåº¦é‡å­¦ä¹ æ—¨åœ¨ä¼˜åŒ–å‚æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span>ï¼Œä½¿å¾—åœ¨æ˜ å°„åçš„ç‰¹å¾ç©ºé—´ä¸­æ»¡è¶³ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>p</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>â‰ª</mo><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D(f_\theta(x_a), f_\theta(x_p)) \ll D(f_\theta(x_a), f_\theta(x_n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ª</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo stretchy="false">(</mo><mo>â‹…</mo><mo separator="true">,</mo><mo>â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D(\cdot, \cdot)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">â‹…</span><span class="mclose">)</span></span></span></span> ä¸ºé¢„å®šä¹‰çš„è·ç¦»åº¦é‡å‡½æ•°ã€‚</p><h4 id="å½“å‰ä¼˜åŒ–çš„æ–¹å‘"><a class="markdownIt-Anchor" href="#å½“å‰ä¼˜åŒ–çš„æ–¹å‘"></a> å½“å‰ä¼˜åŒ–çš„æ–¹å‘</h4><p>é¦–å…ˆæ˜¯ä¼ ç»ŸæŸå¤±å‡½æ•°çš„ä¼˜åŒ–ç“¶é¢ˆï¼Œä»¥æœ€ç»å…¸çš„ Softmax ä¸ºä¾‹ï¼ŒSoftmax äº¤å‰ç†µæŸå¤±å‡½æ•°è™½ç„¶åœ¨æ¦‚ç‡ç©ºé—´èƒ½å¤Ÿæœ‰æ•ˆåŒºåˆ†è®­ç»ƒç±»åˆ«ï¼Œä½†åœ¨ç‰¹å¾ç©ºé—´å¹¶æœªæ–½åŠ æ˜¾å¼çš„è·ç¦»çº¦æŸï¼Œå¯¼è‡´å­¦ä¹ åˆ°çš„ç‰¹å¾åœ¨ç±»å†…åˆ†å¸ƒè¾ƒä¸ºæ¾æ•£ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒSoftmax çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–æ­£ç¡®ç±»åˆ«çš„åéªŒæ¦‚ç‡ã€‚åœ¨æ•°å­¦ä¸Šï¼Œåªè¦ç‰¹å¾å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">f</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{f}_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.10903em;">f</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åœ¨æ­£ç¡®ç±»åˆ«æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">w</mi><msub><mi>y</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">\mathbf{w}_{y_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.730548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ–¹å‘ä¸Šçš„æŠ•å½±æ¯”åœ¨å…¶ä»–ç±»åˆ«æ–¹å‘ä¸Šçš„æŠ•å½±ç¨å¾®å¤§ä¸€ç‚¹ï¼ŒLoss å°±ä¼šå‡å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> è¢«åˆ†åˆ°äº†ç±» Aï¼Œå“ªæ€•å®ƒä»…ä»…è·¨è¿‡äº†å†³ç­–è¾¹ç•Œä¸€ç‚¹ç‚¹ï¼Œæ¨¡å‹ä¹Ÿè®¤ä¸ºä»»åŠ¡å®Œæˆäº†ã€‚ä½†åœ¨åº¦é‡å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œä¸ä»… <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> è¦è¢«åˆ†åˆ°ç±» Aï¼Œè€Œä¸” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> å¿…é¡»å°½å¯èƒ½é è¿‘ç±» A çš„ä¸­å¿ƒï¼Œå¹¶ä¸”è¿œç¦»ç±» Bã€‚</p><p>å…¶æ¬¡æ˜¯<strong>å›°éš¾æ ·æœ¬æŒ–æ˜</strong>çš„ç­–ç•¥è®¾è®¡ã€‚åœ¨æµ·é‡è®­ç»ƒæ•°æ®ä¸­ï¼Œç»å¤§å¤šæ•°æ ·æœ¬å¯¹åŒ…å«çš„æ¢¯åº¦ä¿¡æ¯æå…¶å¾®å¼±ï¼Œå³æ¨¡å‹å·²èƒ½è½»æ˜“åŒºåˆ†å¤§éƒ¨åˆ†ä¸åŒç±»åˆ«ï¼Œåªæœ‰å°‘æ•°ä½äºå†³ç­–è¾¹ç•Œé™„è¿‘çš„<strong>å›°éš¾æ ·æœ¬</strong>å¯¹æ¨¡å‹çš„ä¼˜åŒ–å…·æœ‰å®è´¨æ€§è´¡çŒ®ã€‚å¦‚ä½•é«˜æ•ˆåœ°ç­›é€‰å‡ºè¿™äº›é«˜ä»·å€¼æ ·æœ¬ï¼ŒåŒæ—¶é¿å…å› æ ‡æ³¨å™ªå£°å¯¼è‡´çš„æ¨¡å‹åå¡Œï¼Œæ˜¯è®¾è®¡é«˜æ•ˆåº¦é‡å­¦ä¹ ç³»ç»Ÿçš„å…³é”®ã€‚</p><p>æ­¤å¤–ï¼Œç‰¹å¾ç©ºé—´çš„å‡ ä½•ç»“æ„é€‰æ‹©äº¦è‡³å…³é‡è¦ã€‚æ—©æœŸçš„ç ”ç©¶å¤šåŸºäºæ¬§æ°ç©ºé—´è¿›è¡Œåº¦é‡ï¼Œä½†è¿‘å¹´æ¥çš„ç ”ç©¶è¡¨æ˜ï¼Œå°†ç‰¹å¾å½’ä¸€åŒ–å¹¶çº¦æŸåœ¨è¶…çƒé¢ä¸Šï¼Œåˆ©ç”¨è§’åº¦è·ç¦»ä»£æ›¿æ¬§æ°è·ç¦»å¾€å¾€æ›´åŠ æœ‰æ•ˆã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ä¼ ç»Ÿçš„æ¬§æ°ç©ºé—´ï¼ˆæ¬§æ°è·ç¦»ï¼‰ä¸­ï¼Œç‰¹å¾å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">f</mi></mrow><annotation encoding="application/x-tex">\mathbf{f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.10903em;">f</span></span></span></span></span> çš„é•¿åº¦ï¼ˆèŒƒæ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="bold">f</mi><mi mathvariant="normal">âˆ¥</mi></mrow><annotation encoding="application/x-tex">\|\mathbf{f}\|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf" style="margin-right:0.10903em;">f</span></span><span class="mord">âˆ¥</span></span></span></span>ï¼‰ä»£è¡¨äº†æ¨¡å‹å¯¹è¯¥æ ·æœ¬çš„ç½®ä¿¡åº¦æˆ–æ˜¾è‘—æ€§ï¼Œåœ¨æŸä¸ªæ–¹é¢å¯ä»¥ç†è§£ä¸ºå›¾åƒçš„æ¸…æ™°åº¦ã€‚åœ¨è®¡ç®—æ¬§æ°è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ¥</mi><msub><mi mathvariant="bold">f</mi><mn>1</mn></msub><mo>âˆ’</mo><msub><mi mathvariant="bold">f</mi><mn>2</mn></msub><mi mathvariant="normal">âˆ¥</mi></mrow><annotation encoding="application/x-tex">\| \mathbf{f}_1 - \mathbf{f}_2 \|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.10903em;">f</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.10903em;">f</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ¥</span></span></span></span> æ—¶ï¼Œæ¨¡é•¿çš„å·®å¼‚ä¼šæ©ç›–æ–¹å‘çš„ç›¸ä¼¼æ€§ã€‚æ¨¡å‹å¯èƒ½ä¼šå› ä¸ºä¸¤å¼ å›¾ç‰‡çš„â€œæ¸…æ™°åº¦â€ç›¸è¿‘è€Œè®¤ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªäººã€‚</p><p>è€Œè¶…çƒé¢ï¼ˆHypersphereï¼‰çš„è§£æ³•ï¼šé€šè¿‡å½’ä¸€åŒ–ï¼Œå°†æ‰€æœ‰ç‰¹å¾æ˜ å°„åˆ°æ¨¡é•¿ä¸º 1 çš„è¶…çƒé¢ä¸Šã€‚æ¨¡å‹è¢«è¿«åªé€šè¿‡â€œæ–¹å‘â€æ¥åˆ¤åˆ«èº«ä»½ï¼Œæ¶ˆé™¤äº†å›¾åƒè´¨é‡ã€å…‰ç…§ç­‰å› ç´ å¸¦æ¥çš„å¹…å€¼å¹²æ‰°ã€‚</p><h3 id="ç›¸å…³å·¥ä½œreidä¸mtmctæ–¹å‘"><a class="markdownIt-Anchor" href="#ç›¸å…³å·¥ä½œreidä¸mtmctæ–¹å‘"></a> ç›¸å…³å·¥ä½œï¼ˆREIDä¸MTMCTæ–¹å‘ï¼‰</h3><h4 id="æ·±åº¦åº¦é‡å­¦ä¹ èŒƒå¼"><a class="markdownIt-Anchor" href="#æ·±åº¦åº¦é‡å­¦ä¹ èŒƒå¼"></a> æ·±åº¦åº¦é‡å­¦ä¹ èŒƒå¼</h4><p><strong>æ·±åº¦åº¦é‡å­¦ä¹ </strong>ï¼ˆDeep Metric Learning, <strong>DML</strong>ï¼‰æ—¨åœ¨é€šè¿‡æ·±åº¦ç¥ç»ç½‘ç»œå°†è¯­ä¹‰ç›¸ä¼¼çš„å›¾åƒæ˜ å°„åˆ°é‚»è¿‘çš„ç‰¹å¾ç©ºé—´ã€‚æ ¹æ®ä¼˜åŒ–ç›®æ ‡çš„æ„å»ºæ–¹å¼ï¼Œç°æœ‰çš„ä¸»æµæ–¹æ³•å¯å¤§è‡´åˆ’åˆ†ä¸ºåŸºäºæ ·æœ¬å¯¹ï¼ˆPair-basedï¼‰çš„æ–¹æ³•å’ŒåŸºäºä»£ç†ï¼ˆProxy-basedï¼‰çš„æ–¹æ³•ä¸¤å¤§ç±»ã€‚</p><p><strong>åŸºäºæ ·æœ¬å¯¹</strong>çš„æ–¹æ³•ç›´æ¥åœ¨æ ·æœ¬ä¹‹é—´æ„å»ºçº¦æŸã€‚æ—©æœŸçš„å¼€åˆ›æ€§å·¥ä½œå¦‚ <strong>Siamese Network</strong>ï¼ˆå­ªç”Ÿç½‘ç»œï¼‰å¼•å…¥äº†<strong>å¯¹æ¯”æŸå¤±</strong>ï¼ˆContrastive Lossï¼‰ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€å¯¹æ ·æœ¬ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡æ‹‰è¿‘æ­£æ ·æœ¬å¯¹è·ç¦»å¹¶æ¨è¿œè´Ÿæ ·æœ¬å¯¹è·ç¦»æ¥å­¦ä¹ ç‰¹å¾è¡¨ç¤ºã€‚</p><h5 id="contrastive-loss"><a class="markdownIt-Anchor" href="#contrastive-loss"></a> Contrastive Loss</h5><p>å‡è®¾æœ‰ä¸€å¯¹è¾“å…¥æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_i, x_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå…¶å¯¹åº”çš„ç‰¹å¾åµŒå…¥ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚æˆ‘ä»¬å®šä¹‰è¿™ä¸¤è€…åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„æ¬§æ°è·ç¦»ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi mathvariant="normal">âˆ¥</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><msub><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">d_{ij} = \| f(x_i) - f(x_j) \|_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ¥</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ä¸ºäº†åŒºåˆ†æ ·æœ¬å¯¹çš„å…³ç³»ï¼Œå®šä¹‰æ ‡ç­¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>âˆˆ</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">y \in \{0, 1\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span>ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> è¡¨ç¤ºåŒç±»æ ·æœ¬ï¼ˆPositive Pairï¼‰</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> è¡¨ç¤ºå¼‚ç±»æ ·æœ¬ï¼ˆNegative Pairï¼‰</li></ul><p>å¯¹æ¯”æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo stretchy="false">(</mo><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence="true">[</mo><mi>y</mi><mo>â‹…</mo><msubsup><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>y</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>m</mi><mo>âˆ’</mo><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(d_{ij}) = \frac{1}{2} \left[ y \cdot d_{ij}^2 + (1 - y) \cdot \max(m - d_{ij}, 0)^2 \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p><p>å…¶ä¸­ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">m &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æ˜¯ä¸€ä¸ªé¢„è®¾çš„é˜ˆå€¼ï¼ˆMarginï¼‰ã€‚</p><p>è¿™ä¸ªå…¬å¼ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬æ‹†è§£<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>çš„ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ—¶ï¼ŒåŒç±»æ‹‰è¿‘ï¼Œå…¬å¼ç®€åŒ–ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\mathcal{L} = \frac{1}{2} d_{ij}^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.2398799999999999em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span>ã€‚è¿™æ˜¯ä¸€ä¸ªäºŒæ¬¡å‡½æ•°ï¼Œå…¶æœ€å°å€¼åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d_{ij}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> å¤„å–å¾—ã€‚æ— è®ºæ­£æ ·æœ¬å¯¹é å¾—æœ‰å¤šè¿‘ï¼ŒæŸå¤±å‡½æ•°å§‹ç»ˆæ–½åŠ ä¸€ä¸ªå‘å¿ƒçš„æ‹‰åŠ›ï¼Œè®©ä»–ä»¬å¯ä»¥æ›´åŠ é è¿‘ã€‚</li><li>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> æ—¶ï¼ˆå¼‚ç±»æ¨è¿œï¼‰å…¬å¼ç®€åŒ–ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>m</mi><mo>âˆ’</mo><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mathcal{L} = \frac{1}{2} \max(m - d_{ij}, 0)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1002159999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†æ®µå‡½æ•°ã€‚åªæœ‰å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">d_{ij} &lt; m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span> æ—¶ï¼ŒæŸå¤±æ‰å¤§äº 0ã€‚å¦‚æœä¸¤ä¸ªä¸åŒç±»åˆ«çš„æ ·æœ¬ç¦»å¾—è¶³å¤Ÿè¿œï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>â‰¥</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">d_{ij} \ge m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span>ï¼‰ï¼Œæ¨¡å‹è®¤ä¸ºå®ƒä»¬å·²ç»å®‰å…¨ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">Loss</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span></span></span></span> å˜ä¸º 0ï¼Œä¸äº§ç”Ÿä»»ä½•æ–¥åŠ›ã€‚å¦‚æœå®ƒä»¬é å¾—å¤ªè¿‘ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">d_{ij} &lt; m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span>ï¼‰ï¼ŒæŸå¤±å‡½æ•°ä¼šäº§ç”Ÿä¸€ä¸ªæ–¥åŠ›ï¼Œå°†å®ƒä»¬æ¨å¼€ï¼Œç›´åˆ°è·ç¦»è‡³å°‘ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span>ã€‚</li></ul><h5 id="triplet-loss"><a class="markdownIt-Anchor" href="#triplet-loss"></a> Triplet Loss</h5><p>å¯¹æ¯”æŸå¤±æ˜¯äºŒå…ƒçš„ï¼Œå®ƒå­¤ç«‹åœ°çœ‹æ­£å¯¹ï¼ˆPositive Pairï¼‰æˆ–è´Ÿå¯¹ï¼ˆNegative Pairï¼‰ã€‚å…¶æ•°å­¦å±€é™åœ¨äºï¼š</p><ul><li>å®ƒè¿«ä½¿æ‰€æœ‰æ­£å¯¹çš„è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span> è¶‹è¿‘äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></li><li>å®ƒè¿«ä½¿æ‰€æœ‰è´Ÿå¯¹çš„è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> å¿…é¡»å¤§äºå›ºå®šå€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span></li></ul><p>FaceNet æå‡ºçš„<strong>ä¸‰å…ƒç»„æŸå¤±</strong>ï¼ˆTriplet Lossï¼‰å°†çº¦æŸå…³ç³»æ‰©å±•è‡³ä¸‰å…ƒç»„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mi>n</mi><mi>c</mi><mi>h</mi><mi>o</mi><mi>r</mi><mo separator="true">,</mo><mi>P</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mo separator="true">,</mo><mi>N</mi><mi>e</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(Anchor, Positive, Negative)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span>ï¼Œä¸å†å¼ºåˆ¶è¦æ±‚æ­£è´Ÿæ ·æœ¬å¯¹çš„ç»å¯¹è·ç¦»ï¼Œè€Œæ˜¯å…³æ³¨å®ƒä»¬ä¹‹é—´çš„ç›¸å¯¹è·ç¦»å·®ã€‚è¿™ç§ç›¸å¯¹çº¦æŸæå¤§åœ°æå‡äº†æ¨¡å‹åœ¨äººè„¸è¯†åˆ«å’Œè¡Œäººé‡è¯†åˆ«ç­‰å¼€é›†ä»»åŠ¡ä¸­çš„åˆ¤åˆ«èƒ½åŠ›ï¼Œæˆä¸ºè¯¥é¢†åŸŸçš„ç»å…¸åŸºå‡†ã€‚</p><p>ä¸‰å…ƒç»„æŸå¤±çš„å‡½æ•°å®šä¹‰ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Î±</mi><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L} = \max(d(a, p) - d(a, n) + \alpha, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p><p>åœ¨ä¸‰å…ƒç»„çº¦æŸä¸‹ï¼Œæ¨¡å‹ä¸å†å±€é™äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>â‰ˆ</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d(a, p) \approx 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ã€‚åªè¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span> æ¯” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> å°ä¸€ä¸ªé—´éš” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span> å³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœæŸäººçš„ç‰¹å¾æœ¬èº«è¾ƒåˆ†æ•£ï¼ˆä¾‹å¦‚å§¿æ€å¤šå˜ï¼‰ï¼Œæ¨¡å‹å…è®¸å…¶ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span> ç¨å¤§ï¼ˆå¦‚ 0.5ï¼‰ï¼Œåªè¦è´Ÿæ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(a, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> è¢«æ¨åˆ°æ›´è¿œï¼ˆå¦‚ 1.0ï¼‰å³å¯ã€‚</p><h4 id="å›°éš¾æ ·æœ¬æŒ–æ˜ç­–ç•¥"><a class="markdownIt-Anchor" href="#å›°éš¾æ ·æœ¬æŒ–æ˜ç­–ç•¥"></a> å›°éš¾æ ·æœ¬æŒ–æ˜ç­–ç•¥</h4><p>åœ¨åº¦é‡å­¦ä¹ çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ ·æœ¬çš„é€‰æ‹©ç­–ç•¥å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“å¾€å¾€å¤§äºæŸå¤±å‡½æ•°æœ¬èº«ã€‚ç”±äºæ·±åº¦ç½‘ç»œå…·æœ‰å¼ºå¤§çš„æ‹Ÿåˆèƒ½åŠ›ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œï¼Œç»å¤§å¤šæ•°éšæœºé‡‡æ ·çš„ä¸‰å…ƒç»„å‡æ»¡è¶³è·ç¦»çº¦æŸï¼Œè¿™äº›æ— æ•ˆæ ·æœ¬ä¸ä»…æµªè´¹è®¡ç®—èµ„æºï¼Œè¿˜ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ï¼Œä½¿å¾—æ¨¡å‹æ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–å†³ç­–è¾¹ç•Œã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€æ¢¯åº¦ç¨€ç–é—®é¢˜ï¼Œ<strong>å›°éš¾æ ·æœ¬æŒ–æ˜</strong>ï¼ˆHard Negative Miningï¼‰æˆä¸ºå¿…ç„¶é€‰æ‹©ã€‚ç»å…¸çš„æŒ–æ˜ç­–ç•¥å€¾å‘äºå¯»æ‰¾é‚£äº›ä½¿å¾—æŸå¤±å‡½æ•°å€¼æœ€å¤§çš„â€œæœ€éš¾â€æ ·æœ¬ã€‚Hermans ç­‰äººåœ¨è¡Œäººé‡è¯†åˆ«ä»»åŠ¡ä¸­ç³»ç»Ÿæ€§åœ°éªŒè¯äº†å¤šç§é‡‡æ ·ç­–ç•¥ï¼Œå¹¶æå‡ºäº† Batch Hardï¼ˆTriHardï¼‰é‡‡æ ·æ–¹æ³•ã€‚</p><p>è¯¥æ–¹æ³•ä¸å†ä¾èµ–å…¨æ•°æ®é›†çš„ç¦»çº¿æŒ–æ˜ï¼Œè€Œæ˜¯åŠ¨æ€åœ°åœ¨æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡ï¼ˆBatchï¼‰å†…ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ª Anchor æ ·æœ¬ï¼Œé€‰å–è·ç¦»æœ€è¿œçš„æ­£æ ·æœ¬å’Œè·ç¦»æœ€è¿‘çš„è´Ÿæ ·æœ¬æ„å»ºä¸‰å…ƒç»„ã€‚è¿™ç§åœ¨çº¿ï¼ˆOnlineï¼‰æŒ–æ˜ç­–ç•¥åœ¨ä¿è¯è®­ç»ƒç¨³å®šæ€§çš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡äº†æ¨¡å‹å¯¹å¤–è§‚ç›¸ä¼¼ä¸ªä½“çš„åŒºåˆ†èƒ½åŠ›ï¼Œç›®å‰å·²æˆä¸º ReID é¢†åŸŸçš„æ ‡å‡†é…ç½®ã€‚</p><h5 id="batch-hard-trihard"><a class="markdownIt-Anchor" href="#batch-hard-trihard"></a> Batch Hard (TriHard)</h5><p>å®šä¹‰ä¸€ä¸ª Batch çš„æ„æˆï¼šéšæœºæŠ½å– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> ä¸ªèº«ä»½ï¼ˆIDï¼‰ï¼Œæ¯ä¸ªèº«ä»½æŠ½å– <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¼ å›¾ç‰‡ã€‚Batch æ€»é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mi>P</mi><mo>Ã—</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">N = P \times K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ã€‚<br />å¯¹äº Batch ä¸­çš„ä»»æ„ä¸€ä¸ªé”šç‚¹æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">x_a^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.071664em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆå±äºèº«ä»½ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>ï¼‰ï¼ŒTriHard æŸå¤±å‡½æ•°çš„æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mrow><mi>B</mi><mi>H</mi></mrow></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>P</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mrow><mo fence="true">[</mo><mover><mover><mrow><munder><mo><mi>max</mi><mo>â¡</mo></mo><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo>â€¦</mo><mi>K</mi></mrow></munder><mi>d</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>p</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo stretchy="true">â</mo></mover><mtext>æœ€éš¾æ­£æ ·æœ¬è·ç¦»</mtext></mover><mo>âˆ’</mo><munder><munder><mrow><munder><mo><mi>min</mi><mo>â¡</mo></mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>â€¦</mo><mi>P</mi><mo separator="true">,</mo><mi>n</mi><mo>=</mo><mn>1</mn><mo>â€¦</mo><mi>K</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo mathvariant="normal">â‰ </mo><mi>i</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></munder><mi>d</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>n</mi><mi>j</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mo stretchy="true">âŸ</mo></munder><mtext>æœ€éš¾è´Ÿæ ·æœ¬è·ç¦»</mtext></munder><mo>+</mo><mi>Î±</mi><mo fence="true">]</mo></mrow><mo>+</mo></msub></mrow><annotation encoding="application/x-tex">\mathcal{L}_{BH} = \sum_{i=1}^{P} \sum_{a=1}^{K} \left[ \overbrace{\max_{p=1 \dots K} d(f(x_a^i), f(x_p^i))}^{\text{æœ€éš¾æ­£æ ·æœ¬è·ç¦»}} - \underbrace{\min_{\substack{j=1 \dots P, n=1 \dots K \\ j \neq i}} d(f(x_a^i), f(x_n^j))}_{\text{æœ€éš¾è´Ÿæ ·æœ¬è·ç¦»}} + \alpha \right]_+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:6.192007em;vertical-align:-2.937017em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2549900000000003em;"><span style="top:-1.0499800000000006em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.1999800000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-2.79598em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.39198em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-3.9879800000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.0139700000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-5.25499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.75004em;"><span></span></span></span></span></span></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.2009950000000003em;"><span style="top:-3.5226640000000002em;"><span class="pstrut" style="height:3.5226640000000002em;"></span><span class="mord mover"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5226640000000002em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em;"><span style="top:-2.3556690000000002em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="minner mtight">â€¦</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.880439em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span><span class="svg-align" style="top:-3.974664em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7 5-6 9-10 13-.7 1-7.3 1-20 1H6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M200428 334c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M400000 542l-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z'/></svg></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.880439em;"><span></span></span></span></span></span></span><span style="top:-5.245328000000001em;"><span class="pstrut" style="height:3.5226640000000002em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">æœ€éš¾æ­£æ ·æœ¬è·ç¦»</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.880439em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746640000000001em;"><span style="top:-0.171014em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">æœ€éš¾è´Ÿæ ·æœ¬è·ç¦»</span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746640000000001em;"><span class="svg-align" style="top:-0.849345em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678600000000001em;"><span style="top:-2.0406725000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.133325em;"><span style="top:-3.149995em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="minner mtight">â€¦</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="minner mtight">â€¦</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span><span style="top:-2.261115em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight">î€ </span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6333249999999999em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5026549999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.150655em;"><span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.828986em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2549900000000003em;"><span style="top:-1.0499800000000006em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.1999800000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-2.79598em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.39198em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-3.9879800000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.0139700000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-5.25499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.75004em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-2.470355em;"><span style="top:0.17868599999999982em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.937017em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>æˆ‘ä»¬åœ¨ä¹‹å‰ä¸€ç¯‡æ–‡ç« ä¸­è¯¦ç»†è§£é‡Šäº†è¿™ä¸€æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ¦‚å¿µä¸ºç±»å†…å·®å¼‚çš„æœ€å¤§åŒ–ï¼Œå’Œç±»é—´è·ç¦»çš„æœ€å°åŒ–ã€‚</p><ul><li><strong>æœ€å¤§åŒ–ç±»å†…å·®å¼‚</strong>ï¼ˆMax-Pooling in Positivesï¼‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>max</mi><mo>â¡</mo><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max d(a, p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span> æ‰¾åˆ°äº†å½“å‰ ID ä¸‹åˆ†å¸ƒæœ€æ•£çš„æ ·æœ¬ã€‚è¿™æ˜¯åœ¨ä¼˜åŒ–è¯¥ç±»åˆ«çš„åŠå¾„ï¼Œå¼ºåˆ¶å°†ç¦»ç¾¤ç‚¹ï¼ˆOutliersï¼‰æ‹‰å›ä¸­å¿ƒã€‚</li><li><strong>æœ€å°åŒ–ç±»é—´è·ç¦»</strong>ï¼ˆMin-Pooling in Negativesï¼‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>â¡</mo><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min d(a, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> æ‰¾åˆ°äº†è·ç¦»å½“å‰ç±»åˆ«æœ€è¿‘çš„å¼‚ç±»ã€‚è¿™æ˜¯åœ¨æ¢æµ‹å†³ç­–è¾¹ç•Œã€‚åªæœ‰é€šè¿‡æ¨å¼€è¿™äº›â€œæœ€è¿‘é‚»â€çš„å¼‚ç±»ï¼Œæ‰èƒ½åœ¨ç‰¹å¾ç©ºé—´ä¸­è…¾å‡ºè¶³å¤Ÿçš„ç¼“å†²åŒºã€‚</li></ul><h3 id="åºåˆ—æ·±åº¦åº¦é‡å­¦ä¹ æ–¹æ³•"><a class="markdownIt-Anchor" href="#åºåˆ—æ·±åº¦åº¦é‡å­¦ä¹ æ–¹æ³•"></a> åºåˆ—æ·±åº¦åº¦é‡å­¦ä¹ æ–¹æ³•</h3><h4 id="é›†åˆç©ºé—´çš„æ˜ å°„å½¢å¼åŒ–"><a class="markdownIt-Anchor" href="#é›†åˆç©ºé—´çš„æ˜ å°„å½¢å¼åŒ–"></a> é›†åˆç©ºé—´çš„æ˜ å°„å½¢å¼åŒ–</h4><p>åœ¨åŸºäºåºåˆ—çš„åº¦é‡å­¦ä¹ ä¸­ï¼Œè¾“å…¥å¯¹è±¡ä¸å†æ˜¯å•ä¸€çš„æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>âˆˆ</mo><mi mathvariant="script">X</mi></mrow><annotation encoding="application/x-tex">x \in \mathcal{X}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span></span></span></span>ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> å¸§å›¾åƒçš„åºåˆ—é›†åˆ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">S</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>T</mi></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{S} = \{x_1, x_2, \dots, x_T\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> ä¸ºå˜é‡ã€‚</p><p>æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ä¸ªéçº¿æ€§æ˜ å°„å‡½æ•°</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Î¦</mi><mo>:</mo><msup><mi mathvariant="script">X</mi><mi>T</mi></msup><mo>â†’</mo><msup><mi mathvariant="double-struck">R</mi><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">\Phi: \mathcal{X}^T \rightarrow \mathbb{R}^d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î¦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8913309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.14643em;">X</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8991079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></p><p>å°†é«˜ç»´çš„å›¾åƒåºåˆ—å¼ é‡æŠ•å½±ä¸ºä½ç»´çš„å›ºå®šé•¿åº¦åµŒå…¥å‘é‡ã€‚<br />è¿™ä¸€æ˜ å°„è¿‡ç¨‹å¿…é¡»æ»¡è¶³ä¸¤ä¸ªå…³é”®çš„æ•°å­¦æ€§è´¨ï¼š</p><ul><li><strong>ç½®æ¢ä¸å˜æ€§</strong>ï¼ˆPermutation Invarianceï¼‰ï¼š å¯¹äºé›†åˆæ¨¡å‹è€Œè¨€ï¼Œç‰¹å¾è¡¨ç¤ºä¸åº”å—è¾“å…¥å¸§é¡ºåºçš„å½±å“ï¼ˆé™¤éæ˜¾å¼å»ºæ¨¡åŠ¨ä½œä¿¡æ¯ï¼‰ï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Phi(x_1, x_2) = \Phi(x_2, x_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li><li><strong>å°ºå¯¸ä¸å˜æ€§</strong>ï¼ˆSize Invarianceï¼‰ï¼š æ— è®ºè¾“å…¥åºåˆ—é•¿åº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> æ˜¯ 5 å¸§è¿˜æ˜¯ 50 å¸§ï¼Œè¾“å‡ºç‰¹å¾å‘é‡çš„ç»´åº¦ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span></span></span></span> å¿…é¡»æ’å®šã€‚ä¸ºæ­¤ï¼Œåºåˆ—åº¦é‡å­¦ä¹ é€šå¸¸é‡‡ç”¨â€œ<strong>ç¼–ç -èšåˆ</strong>â€ï¼ˆEncode-Aggregateï¼‰çš„äºŒé˜¶æ®µæ•°å­¦èŒƒå¼ï¼šé¦–å…ˆé€šè¿‡ CNN éª¨å¹²ç½‘ç»œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>Î¸</mi></msub></mrow><annotation encoding="application/x-tex">f_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å°†æ¯ä¸€å¸§æ˜ å°„ä¸ºå¸§çº§ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub><mo>=</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v_t = f_\theta(x_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œéšåé€šè¿‡æ—¶åºèšåˆå‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mo>â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G(\cdot)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord">â‹…</span><span class="mclose">)</span></span></span></span> ç”Ÿæˆæœ€ç»ˆçš„åºåˆ—è¡¨å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">e</mi><mo>=</mo><mi>G</mi><mo stretchy="false">(</mo><mo stretchy="false">{</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>v</mi><mi>T</mi></msub><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{e} = G(\{v_1, \dots, v_T\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.44444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">e</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mclose">)</span></span></span></span>ã€‚</li></ul><h4 id="åŸºäºæ³¨æ„åŠ›çš„æ—¶åºèšåˆæœºåˆ¶"><a class="markdownIt-Anchor" href="#åŸºäºæ³¨æ„åŠ›çš„æ—¶åºèšåˆæœºåˆ¶"></a> åŸºäºæ³¨æ„åŠ›çš„æ—¶åºèšåˆæœºåˆ¶</h4><p>æœ€æœ´ç´ çš„èšåˆå‡½æ•°æ˜¯<strong>æ—¶é—´å¹³å‡æ± åŒ–</strong>ï¼ˆTemporal Average Pooling, TAPï¼‰ï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mrow><mi>a</mi><mi>v</mi><mi>g</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>T</mi></mfrac><mo>âˆ‘</mo><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">G_{avg} = \frac{1}{T}\sum v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚ç„¶è€Œï¼Œä»ä¿¡æ¯è®ºè§’åº¦çœ‹ï¼Œåºåˆ—ä¸­çš„æ¯ä¸€å¸§æ‰€å«æœ‰çš„â€œèº«ä»½ä¿¡æ¯é‡â€æ˜¯ä¸å‡åŒ€çš„ï¼ˆä¾‹å¦‚ï¼Œé®æŒ¡å¸§çš„ä¿¡æ¯ç†µæé«˜ï¼ŒåŒ…å«å¤§é‡å™ªå£°ï¼‰ã€‚</p><p>ä¸ºäº†æœ€å¤§åŒ–ç‰¹å¾ä¿¡å™ªæ¯”ï¼Œç°ä»£æ–¹æ³•ï¼ˆQuality Aware Network for Set to Set Recognitionï¼‰å¼•å…¥äº†**æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰**ä½œä¸ºä¸€ç§å¯å­¦ä¹ çš„åŠ æƒç®—å­ã€‚</p><p>æ•°å­¦ä¸Šï¼Œè¿™ç­‰ä»·äºå­¦ä¹ ä¸€ä¸ªè¯„åˆ†å‡½æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo stretchy="false">(</mo><msub><mi>v</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h(v_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œç”¨äºä¼°è®¡ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> å¸§çš„ç‰¹å¾è´¨é‡ã€‚åŠ æƒèšåˆè¿‡ç¨‹å®šä¹‰ä¸ºï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">e</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msub><mi>Î±</mi><mi>t</mi></msub><mo>â‹…</mo><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{e}_{att} = \sum_{t=1}^{T} \alpha_t \cdot v_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">e</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0954490000000003em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> éœ€æ»¡è¶³æ¦‚ç‡å•çº¯å½¢çº¦æŸï¼ˆSum-to-oneï¼‰ï¼Œé€šå¸¸é€šè¿‡ Softmax å‡½æ•°è·å¾—ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Î±</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mi>exp</mi><mo>â¡</mo><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi>T</mi></msup><mi>tanh</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi mathvariant="bold">W</mi><mi>a</mi></msub><msub><mi>v</mi><mi>t</mi></msub><mo>+</mo><msub><mi mathvariant="bold">b</mi><mi>a</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mi>exp</mi><mo>â¡</mo><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi>T</mi></msup><mi>tanh</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi mathvariant="bold">W</mi><mi>a</mi></msub><msub><mi>v</mi><mi>Ï„</mi></msub><mo>+</mo><msub><mi mathvariant="bold">b</mi><mi>a</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\alpha_t = \frac{\exp(\mathbf{w}^T \tanh(\mathbf{W}_a v_t + \mathbf{b}_a))}{\sum_{\tau=1}^{T} \exp(\mathbf{w}^T \tanh(\mathbf{W}_a v_\tau + \mathbf{b}_a))}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.689272em;vertical-align:-1.170941em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183309999999999em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.767331em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.1132em;">Ï„</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">b</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">exp</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">b</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.170941em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>æ­¤å¤„ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">W</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="bold">b</mi><mi>a</mi></msub><mo separator="true">,</mo><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}_a, \mathbf{b}_a, \mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathbf">b</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> å‡ä¸ºå‚ä¸åå‘ä¼ æ’­ä¼˜åŒ–çš„å‚æ•°ã€‚è¯¥æ•°å­¦ç»“æ„è¿«ä½¿æ¨¡å‹åœ¨ç‰¹å¾ç©ºé—´ä¸­è‡ªåŠ¨è¿›è¡Œâ€œå»å™ªâ€ï¼Œæ¢¯åº¦ä¸‹é™è¿‡ç¨‹ä¼šæŠ‘åˆ¶é‚£äº›ä¸èº«ä»½ä¸»å‘é‡æ­£äº¤çš„å™ªå£°åˆ†é‡çš„æƒé‡ã€‚</p><h4 id="é›†åˆé—´è·ç¦»åº¦é‡ä¸ä¼˜åŒ–ç›®æ ‡"><a class="markdownIt-Anchor" href="#é›†åˆé—´è·ç¦»åº¦é‡ä¸ä¼˜åŒ–ç›®æ ‡"></a> é›†åˆé—´è·ç¦»åº¦é‡ä¸ä¼˜åŒ–ç›®æ ‡</h4><p>å®šä¹‰äº†åºåˆ—ç‰¹å¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><mi mathvariant="script">S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Phi(\mathcal{S})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="mclose">)</span></span></span></span> åï¼Œæ ¸å¿ƒé—®é¢˜åœ¨äºå¦‚ä½•å®šä¹‰ä¸¤ä¸ªé›†åˆ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">S</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{S}_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">S</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{S}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä¹‹é—´çš„åº¦é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo stretchy="false">(</mo><msub><mi mathvariant="script">S</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="script">S</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D(\mathcal{S}_i, \mathcal{S}_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ã€‚</p><ul><li><strong>èšåˆåµŒå…¥è·ç¦»</strong>ï¼ˆAggregated Embedding Distanceï¼‰ï¼šæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯åœ¨èšåˆåçš„ç‰¹å¾å‘é‡ä¸Šè®¡ç®—æ¬§æ°è·ç¦»ï¼š</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mo stretchy="false">(</mo><msub><mi mathvariant="script">S</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="script">S</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><msub><mi mathvariant="script">S</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><msub><mi mathvariant="script">S</mi><mi>j</mi></msub><mo stretchy="false">)</mo><msub><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D(\mathcal{S}_i, \mathcal{S}_j) = \| \Phi(\mathcal{S}_i) - \Phi(\mathcal{S}_j) \|_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ¥</span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>è¿™ç§æ–¹æ³•è®¡ç®—æ•ˆç‡æœ€é«˜ï¼Œä¸”å®Œå…¨å…¼å®¹æ ‡å‡†çš„ Triplet Lossã€‚<br /></br></p><ul><li><strong>æœ€å°ç‚¹é›†è·ç¦»</strong>ï¼ˆMinimum Set Distanceï¼‰ï¼šä¸ºäº†è§£å†³èšåˆå¸¦æ¥çš„ä¿¡æ¯å¹³æ»‘é—®é¢˜ï¼Œå¯ä»¥ä¿ç•™å¸§çº§ç‰¹å¾ï¼Œå®šä¹‰ä¸¤ä¸ªé›†åˆçš„è·ç¦»ä¸ºâ€œæœ€ä½³åŒ¹é…å¸§â€ä¹‹é—´çš„è·ç¦»ï¼š</li></ul><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi mathvariant="script">S</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi mathvariant="script">S</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munder><mo><mi>min</mi><mo>â¡</mo></mo><mrow><msub><mi>v</mi><mi>n</mi></msub><mo>âˆˆ</mo><msub><mi mathvariant="script">S</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>m</mi></msub><mo>âˆˆ</mo><msub><mi mathvariant="script">S</mi><mi>j</mi></msub></mrow></munder><mi mathvariant="normal">âˆ¥</mi><msub><mi>v</mi><mi>n</mi></msub><mo>âˆ’</mo><msub><mi>v</mi><mi>m</mi></msub><msub><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D_{min}(\mathcal{S}_i, \mathcal{S}_j) = \min_{v_n \in \mathcal{S}_i, v_m \in \mathcal{S}_j} \| v_n - v_m \|_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.691651em;vertical-align:-0.941651em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-2.355669em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight" style="margin-right:0.075em;">S</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.941651em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>è¿™ç§éå‚æ•°åŒ–çš„åº¦é‡æ–¹å¼åœ¨æ•°å­¦ä¸Šå…è®¸åºåˆ—åœ¨å±€éƒ¨è¿›è¡Œå¯¹é½ï¼Œå¯¹äºå¤„ç†è§†è§’å‰§çƒˆå˜åŒ–ï¼ˆå¦‚ä»æ­£é¢é€æ¸è½¬åˆ°èƒŒé¢ï¼‰çš„åºåˆ—å…·æœ‰æ›´å¼ºçš„å‡ ä½•è§£é‡Šæ€§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;MTMCTæ–¹å‘çš„åº¦é‡å­¦ä¹ æ¢³ç†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://atffang.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>å®éªŒå®¤å®‰å…¨æ£€æµ‹ç³»ç»Ÿ2</title>
    <link href="https://atffang.github.io/2025/11/13/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F2/"/>
    <id>https://atffang.github.io/2025/11/13/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F2/</id>
    <published>2025-11-13T12:41:07.000Z</published>
    <updated>2026-01-10T14:28:01.846Z</updated>
    
    <content type="html"><![CDATA[<p>èŠ±äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ä¿®æ”¹äº†ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œç®€å•è®°å½•ä¸€ä¸‹</p><span id="more"></span><p>ä¸Šæ¬¡ä»‹ç»äº†ä¸€ä¸‹å‚ä¸çš„ä¸€ä¸ªæ¨ªå‘ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œæœ€è¿‘èŠ±äº†ä¸€ç‚¹æ—¶é—´æ¢³ç†äº†ä¸€ä¸‹ç»“æ„ï¼Œç®€å•è®°å½•ä¸€ä¸‹ã€‚åŠŸèƒ½å¹¶æ²¡æœ‰å¢åŠ ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p><h3 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h3><img src="https://atffang.github.io/2025/11/13/å®éªŒå®¤å®‰å…¨æ£€æµ‹ç³»ç»Ÿ2/ç»“æ„.png"/><p>ç³»ç»Ÿç”±ä¸‰ä¸ªåŠŸèƒ½å±‚ç»„æˆï¼š</p><ul><li><strong>infra</strong>ï¼šåŸºç¡€åŠŸèƒ½å±‚ï¼ŒåŒ…æ‹¬configï¼ˆé…ç½®åŠ è½½ï¼‰ã€loggingï¼ˆæ—¥å¿—æ‰“å°ï¼‰ã€messagequeuesï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li><li><strong>data</strong>ï¼šè´Ÿè´£æ•°æ®éƒ¨åˆ†åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬frameprocessorï¼ˆè§†é¢‘æµç›¸å…³ï¼‰ã€databaseï¼ˆminioä¸postgresqlæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼‰ã€‚è¿æ¥çš„psqlæ•°æ®åº“å’Œminioç”±dockerå®ç°ã€‚</li><li><strong>core</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡å±‚ï¼ŒåŒ…æ‹¬prepocessï¼ˆè´Ÿè´£åŠ è½½è¯†åˆ«æ¨¡å‹åŠ è½½å‰éœ€è¦é¢„åŠ è½½çš„æ•°æ®ï¼‰ã€modelloaderï¼ˆåŠ è½½è¯†åˆ«æ¨¡å‹ï¼Œå®šä¹‰è¯†åˆ«æ–¹æ³•ï¼ˆpridictï¼‰ã€è¾“å‡ºè¯†åˆ«ç»“æœã€postprocessï¼ˆåå¤„ç†ï¼Œä¸»è¦ä¸ºæ¯æ—¥æ•°æ®è¿ç§»ä»»åŠ¡ï¼‰ï¼‰</li></ul><h4 id="1-infra"><a class="markdownIt-Anchor" href="#1-infra"></a> 1. infra</h4><h5 id="11-config"><a class="markdownIt-Anchor" href="#11-config"></a> 1.1 config</h5><p>è¯»å–æ ¹ç›®å½•ä¸‹çš„<code>config.yaml</code>æ–‡ä»¶ï¼Œæä¾›åŠ è½½å„ç±»é…ç½®çš„æ¥å£ï¼Œ<code>config</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -------- æ•°æ®åº“é…ç½® --------</span></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">&quot;localhost&quot;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5434</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;postgres&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;postgres&quot;</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">&quot;labcamera&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- MinIOé…ç½® --------</span></span><br><span class="line"><span class="attr">minio:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">&quot;localhost:9000&quot;</span></span><br><span class="line">  <span class="attr">access_key:</span> <span class="string">&quot;minioadmin&quot;</span></span><br><span class="line">  <span class="attr">secret_key:</span> <span class="string">&quot;minioadmin&quot;</span></span><br><span class="line">  <span class="attr">bucket:</span> <span class="string">&quot;detection-results&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- äº‹ä»¶æ˜ å°„è¡¨ --------</span></span><br><span class="line"><span class="attr">event:</span></span><br><span class="line">  <span class="attr">event_dict:</span></span><br><span class="line">    <span class="attr">coat:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">nightsingle:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">channeloccupancy:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- æ¨¡å‹å‚æ•°é…ç½® --------</span></span><br><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">coatdetecter:</span> <span class="string">&quot;coatdetecter.json&quot;</span></span><br><span class="line">  <span class="attr">nightsingledetecter:</span> <span class="string">&quot;nightsingledetecter.json&quot;</span></span><br><span class="line">  <span class="attr">channeloccupancydetecter:</span> <span class="string">&quot;channeloccupancydetecter.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- ç›‘æ§æµé…ç½® --------</span></span><br><span class="line"><span class="attr">rtsp:</span></span><br><span class="line">  <span class="attr">server_ip:</span> <span class="string">&quot;***.***.***.***&quot;</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">&quot;***&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;***&quot;</span></span><br><span class="line">  <span class="attr">channel_num:</span> <span class="number">256</span></span><br><span class="line">  <span class="attr">stream_type:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------- å¯åŠ¨æ—¶é—´é…ç½® --------</span></span><br><span class="line"><span class="attr">scheduler:</span></span><br><span class="line">  <span class="attr">&quot;main_program&quot;:</span></span><br><span class="line">    <span class="attr">&quot;start&quot;:</span> <span class="string">&quot;05:00&quot;</span></span><br><span class="line">    <span class="attr">&quot;end&quot;:</span> <span class="string">&quot;03:00&quot;</span></span><br><span class="line">  <span class="attr">&quot;summary_program&quot;:</span></span><br><span class="line">    <span class="attr">&quot;start&quot;:</span> <span class="string">&quot;03:00&quot;</span></span><br><span class="line">    <span class="attr">&quot;end&quot;:</span> <span class="string">&quot;05:00&quot;</span></span><br></pre></td></tr></table></figure><h5 id="12-logging"><a class="markdownIt-Anchor" href="#12-logging"></a> 1.2 logging</h5><p>æ—¥å¿—æ¨¡å—</p><h5 id="13-messagequeues"><a class="markdownIt-Anchor" href="#13-messagequeues"></a> 1.3 messagequeues</h5><p>æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å—ï¼Œé¦–å…ˆåœ¨<code>PhotoMessage.py</code>ä¸­å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoMessage</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è¡¨ç¤ºè§†é¢‘æµå¤„ç†ç®¡çº¿ä¸­çš„å•å¸§æ¶ˆæ¯å¯¹è±¡ã€‚  </span></span><br><span class="line"><span class="string">    ç”¨äºå°è£…å•å¸§å›¾åƒåŠå…¶å…³è”çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å±æ€§è¯´æ˜ï¼š</span></span><br><span class="line"><span class="string">        photo_id (str): å¸§çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆé»˜è®¤ä½¿ç”¨ UUID è‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚</span></span><br><span class="line"><span class="string">        camera_id (str): æ‘„åƒå¤´è®¾å¤‡ç¼–å·æˆ–æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="string">        room_id (str): æ‹æ‘„å¸§æ‰€åœ¨çš„ç‰©ç†ä½ç½®æˆ–æˆ¿é—´æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="string">        photo_path (Path): å¸§å›¾åƒæ–‡ä»¶çš„è·¯å¾„æˆ–å†…å­˜å¼•ç”¨ã€‚</span></span><br><span class="line"><span class="string">        timestamp (datetime): å¸§æ•è·çš„æ—¶é—´æˆ³ï¼ˆè‹¥æœªæä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚</span></span><br><span class="line"><span class="string">        metadata (Dict[str, Any]): é™„åŠ çš„å¤„ç†ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    camera_id: <span class="built_in">str</span></span><br><span class="line">    room_id: <span class="built_in">str</span></span><br><span class="line">    photo_path: Path</span><br><span class="line">    task_id: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    photo_id: <span class="built_in">str</span> = field(default_factory=<span class="keyword">lambda</span>: <span class="built_in">str</span>(uuid.uuid4()))</span><br><span class="line">    timestamp: datetime = field(default_factory=datetime.now)</span><br><span class="line">    metadata: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = field(default_factory=<span class="built_in">dict</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DetectionResult</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è¡¨ç¤ºå•å¸§å›¾åƒæ£€æµ‹ï¼ˆè¯†åˆ«ï¼‰ç»“æœçš„æ•°æ®ç»“æ„ã€‚  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å±æ€§è¯´æ˜ï¼š</span></span><br><span class="line"><span class="string">        ifwarning (bool): æ˜¯å¦è§¦å‘å‘Šè­¦ï¼ˆTrue è¡¨ç¤ºå¼‚å¸¸æˆ–è­¦å‘Šï¼‰ã€‚</span></span><br><span class="line"><span class="string">        image (Optional[Image.Image]): æ£€æµ‹åçš„å¤„ç†å›¾åƒæˆ–æ ‡æ³¨ç»“æœã€‚</span></span><br><span class="line"><span class="string">        description (str): æ£€æµ‹ç»“æœçš„æ–‡æœ¬æè¿°ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="string">        timestamp (Optional[datetime]): æ£€æµ‹ç»“æœç”Ÿæˆçš„æ—¶é—´æˆ³ã€‚</span></span><br><span class="line"><span class="string">        task_id (int): å…³è”çš„ä»»åŠ¡æ ‡è¯†ç¬¦ã€‚</span></span><br><span class="line"><span class="string">        room_id (str): æ£€æµ‹å¸§æ‰€åœ¨çš„ç‰©ç†æˆ¿é—´æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="string">        camera_id (str): å¯¹åº”çš„æ‘„åƒå¤´ç¼–å·ã€‚</span></span><br><span class="line"><span class="string">        alarm_category (str): å‘Šè­¦ç±»å‹æˆ–ç±»åˆ«ï¼ˆé»˜è®¤å€¼ä¸º &#x27;unknow&#x27;ï¼‰ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, ifwarning: <span class="built_in">bool</span> = <span class="literal">False</span>, image: <span class="type">Optional</span>[Image.Image] = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">                 description: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>, timestamp: <span class="type">Optional</span>[datetime] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 task_id: <span class="built_in">int</span> = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">                 room_id: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>, camera_id: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>, alarm_category: <span class="built_in">str</span> = <span class="string">&quot;unknow&quot;</span></span>):</span><br><span class="line">        ifwarning = ifwarning</span><br><span class="line">        self.image = image</span><br><span class="line">        self.description = description</span><br><span class="line">        self.timestamp = timestamp</span><br><span class="line">        self.room_id = room_id</span><br><span class="line">        self.camera_id = camera_id</span><br><span class="line">        self.alarm_category = alarm_category</span><br><span class="line">        self.task_id = task_id</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨<code>MessageQueue.py</code>ä¸­å®šä¹‰äº†ä¸€ä¸ªå…¨å±€æ¶ˆæ¯é˜Ÿåˆ—<code>GlobalMessageQueue()</code>ï¼Œç”¨äºå­˜æ”¾<code>PhotoMessage</code>ï¼Œå¹¶ç¡®ä¿å…¶çº¿ç¨‹å®‰å…¨ã€‚å¹¶å®ç°ï¼š</p><ul><li><code>put_message(self, msg: PhotoMessage) -&gt; bool</code></li><li><code>get_message(self) -&gt; Optional[PhotoMessage]</code></li><li><code>persist_messages(self, file_path: Path) -&gt; int</code></li><li><code>load_messages(self, file_path: Path) -&gt; int</code></li><li>â€¦â€¦</li></ul><p>ç­‰æ–¹æ³•ã€‚</p><h4 id="2data"><a class="markdownIt-Anchor" href="#2data"></a> 2.Data</h4><h5 id="21-frameprocessor"><a class="markdownIt-Anchor" href="#21-frameprocessor"></a> 2.1 frameprocessor</h5><p>è´Ÿè´£è§†é¢‘æµå¤„ç†ã€‚é¦–å…ˆåœ¨<code>rtsp_client.py</code>ä¸­å®šä¹‰äº†å®ç°ï¼š</p><ul><li>ç™»å½•è§†é¢‘æœåŠ¡å™¨è·å– Token</li><li>å®šæ—¶ä¿æ´»</li><li>æ³¨å†Œæ’­æ”¾é€šé“</li><li>è·å–æŒ‡å®šæ‘„åƒå¤´çš„ RTSP URL</li><li>ç™»å‡ºé‡Šæ”¾ Token</li></ul><p>åŠŸèƒ½çš„RTSPClient ç±»ï¼Œå¹¶å®šä¹‰äº†å…¶çº¿ç¨‹å®ç°<code>RTSPServiceThread(threading.Thread)</code>ï¼Œè¯¥çº¿ç¨‹å¯åŠ¨åè¿è¡Œé€»è¾‘ä¸ºï¼š</p><ul><li>ç™»å½•å¹¶æ³¨å†Œæ’­æ”¾é€šé“</li><li>å¾ªç¯æ‰§è¡Œ keep_alive ä¿æ´»</li><li>å¼‚å¸¸å¤„ç†åè‡ªåŠ¨ç™»å‡º</li></ul><p>éšååœ¨<code>get_rtsp.py</code>å®šä¹‰äº†<code>CaptureThread(threading.Thread)</code>çš„æ‘„åƒå¤´æŠ“å¸§çº¿ç¨‹ï¼Œç®¡ç† RTSP æµä¿æ´»å’Œå¸§æ•è·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CaptureThread</span>(threading.Thread):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ‘„åƒå¤´æŠ“å¸§çº¿ç¨‹ï¼Œç®¡ç† RTSP æµä¿æ´»å’Œå¸§æ•è·ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        rtsp_config (dict): RTSP é…ç½®</span></span><br><span class="line"><span class="string">        rtsp_thread (RTSPServiceThread): RTSP æœåŠ¡çº¿ç¨‹</span></span><br><span class="line"><span class="string">        db_conn: æ•°æ®åº“è¿æ¥å¯¹è±¡</span></span><br><span class="line"><span class="string">        running (bool): çº¿ç¨‹è¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="string">        camera_list (List[Dict[str, Any]]): å½“å‰ä»»åŠ¡æ‘„åƒå¤´åˆ—è¡¨</span></span><br><span class="line"><span class="string">        wait_rtsp (int): ä¸¤æ¬¡æ‘„åƒå¤´æŠ“å¸§é—´éš”ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="string">        round_rtsp (int): æ¯è½®æŠ“å¸§æœ€å°æ€»é—´éš”ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(daemon=<span class="literal">True</span>)</span><br><span class="line">        self.rtsp_config = RTSP_CONFIG</span><br><span class="line">        self.rtsp_thread = RTSPServiceThread(RTSP_CONFIG)</span><br><span class="line">        self.db_conn = <span class="literal">None</span></span><br><span class="line">        self.running = <span class="literal">True</span></span><br><span class="line">        self.camera_list: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = []</span><br><span class="line">        self.wait_rtsp = <span class="number">1</span></span><br><span class="line">        self.round_rtsp = <span class="number">600</span></span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ä¸»é€»è¾‘ï¼š</p><ul><li>å¯åŠ¨ RTSP æœåŠ¡çº¿ç¨‹ï¼ˆè‡ªåŠ¨ä¿æ´»ï¼‰</li><li>è¿æ¥æ•°æ®åº“è·å–æ‘„åƒå¤´åˆ—è¡¨</li><li>å¾ªç¯æŠ“å–æ‘„åƒå¤´å•å¸§å›¾åƒå¹¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li></ul><h5 id="22-database"><a class="markdownIt-Anchor" href="#22-database"></a> 2.2 database</h5><p>databaseæ¨¡å—åŸºäºåˆ†å±‚å¼æ¶æ„æ¨¡å¼ï¼ˆentityã€repositoryã€serviceä¸‰å±‚ï¼‰</p><ul><li>entityï¼šå®ä½“å±‚ï¼Œå®šä¹‰äº†æ•°æ®åº“ä¸­å„ä¸ªè¡¨å¯¹åº”çš„å®ä½“ç±»ï¼Œå¦‚<code>Camera</code>ã€<code>Results</code>ã€<code>ResultsTemp</code>ã€‚</li><li>repositoryï¼šæ•°æ®è®¿é—®å±‚ï¼Œè´Ÿè´£ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæä¾›æ•°æ®æŒä¹…åŒ–å’Œæ£€ç´¢åŠŸèƒ½ï¼Œå¦‚<code>CameraRepository</code>ã€<code>ResultsRepository</code>ã€<code>ResultsTempRepository</code>ã€‚</li><li>serviceï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚<code>CameraService</code>ã€<code>ResultsMigrationService</code>ã€<code>ResultsNightService</code>ã€<code>ResultsTempSaverService</code>ï¼Œè¿™éƒ¨åˆ†è´Ÿè´£æä¾›æ•°æ®åº“éƒ¨åˆ†çš„å„ä¸ªæ¥å£ï¼Œç»™å…¶ä»–ç»„ä»¶è°ƒç”¨ï¼Œå®ç°è§£è€¦ã€‚</li></ul><p>æˆ‘ä»¬ä»¥æ•°æ®æš‚å­˜ä¸ºä¾‹ï¼Œå…¶éœ€æ±‚æ˜¯æ¯æ¬¡æ£€æµ‹å®Œæˆåï¼Œæš‚å­˜æ•°æ®åˆ°t_results_tempè¡¨ä¸­ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ª<strong>ResultsTemp</strong>çš„Entityï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ResultsEntity</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __tablename__ = <span class="string">&quot;t_results&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    task_id = Column(String(<span class="number">100</span>))</span><br><span class="line">    event_id = Column(Integer)</span><br><span class="line">    description = Column(Text)</span><br><span class="line">    time1 = Column(TIMESTAMP)</span><br><span class="line">    time2 = Column(TIMESTAMP)</span><br><span class="line">    picture1 = Column(String(<span class="number">255</span>))</span><br><span class="line">    picture2 = Column(String(<span class="number">255</span>))</span><br><span class="line">    picture3 = Column(String(<span class="number">255</span>))</span><br></pre></td></tr></table></figure><p>éšåï¼Œå®šä¹‰ä¸€å±‚æ•°æ®è®¿é—®å±‚<strong>ResultsTempRepository</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> entity.ResultsTemp <span class="keyword">import</span> ResultsTempEntity</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResultsTempRepository</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, session: Session</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self, entity: ResultsTempEntity</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_all</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_by_task</span>(<span class="params">self, task_id: <span class="built_in">str</span></span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_by_event_and_date</span>(<span class="params">self, event_ids, date_str</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_batch</span>(<span class="params">self, records</span>):</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå®šä¹‰ä¸€ä¸ªServiceï¼š<strong>ResultsTempSaverService</strong> æ¥æä¾›æœåŠ¡æ¥å£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataSaverService</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Service å±‚ï¼šå¤„ç†æ£€æµ‹ç»“æœä¿å­˜ï¼ˆæ•°æ®åº“ + MinIO ä¸Šä¼ ï¼‰&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_detection_result</span>(<span class="params">self, result: DetectionResult</span>):</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­è°ƒç”¨<code>save_detection_result</code>å³å¯ã€‚</p><h4 id="3-core"><a class="markdownIt-Anchor" href="#3-core"></a> 3. Core</h4><h5 id="31-preprocess"><a class="markdownIt-Anchor" href="#31-preprocess"></a> 3.1 preprocess</h5><p>é‡Œé¢æ”¾ä¸€äº›é¢„å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚ä»æ•°æ®åº“ä¸‹è½½é€šé“èŒƒå›´ã€‚ç„¶åæˆ‘ä»¬åœ¨<code>detect.py</code>ä¸­åœ¨å¯åŠ¨è¯†åˆ«çº¿ç¨‹å‰è°ƒç”¨å³å¯ã€‚æ¯”å¦‚è¯´æˆ‘åœ¨<code>detect.py</code>é‡Œé¢è°ƒç”¨çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> core.preprocess <span class="keyword">import</span> LoadChannelRange</span><br><span class="line"><span class="comment"># é¦–å…ˆä¸‹è½½æ‘„åƒå¤´èŒƒå›´æ•°æ®</span></span><br><span class="line">LoadChannelRange.save()</span><br></pre></td></tr></table></figure><h5 id="32-modelloader"><a class="markdownIt-Anchor" href="#32-modelloader"></a> 3.2 modelloader</h5><p><strong>é‡ç‚¹</strong></p><p>modelleréƒ¨åˆ†è´Ÿè´£åŠ è½½æ¨¡å‹ï¼Œå¹¶å®ç°è¯†åˆ«åŠŸèƒ½ã€‚<br />å¯¹äºä¸€ä¸ªè¯†åˆ«åŠŸèƒ½æ¨¡å—ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨modelloader/configä¸­æ·»åŠ ä¸€ä¸ªé…ç½®jsonæ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;coatdetecter&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yolo11s&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;weight_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;core/modelloader/model/yolo11s.pt&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mobilenet_v2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pth&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;weight_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;core/modelloader/model/coat_classifier_final.pth&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¹¶å°†å…¶æ·»åŠ åˆ°æ ¹ç›®å½•ä¸‹çš„<code>config.yaml</code>æ–‡ä»¶ä¸­çš„ æ¨¡å‹å‚æ•°é…ç½® éƒ¨åˆ†ã€‚<br />å¹¶ä¸”æŒ‰ç…§&quot;weight_path&quot;çš„è·¯å¾„æ­£ç¡®å°†æƒé‡æ¨¡å‹å­˜æ”¾åœ¨ç›¸åº”çš„è·¯å¾„ã€‚</p><p>éšåï¼Œæˆ‘ä»¬åœ¨åœ¨modelloader/functionmodelå®šä¹‰ä¸€ä¸ªæ¨¡å‹è¯†åˆ«ç±»ï¼Œæˆ‘åœ¨è¿™ä¸ªè·¯å¾„ä¸‹çš„<code>base_detector.py</code>æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseDetector</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Detector ç¤ºä¾‹æ¨¡æ¿</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    å­ç±»å¿…é¡»å®ç° load æ–¹æ³•ï¼Œè¿”å› predict å‡½æ•°ï¼š</span></span><br><span class="line"><span class="string">        predict(message: PhotoMessage, image_input: np.ndarray) -&gt; Optional[DetectionResult]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    predict å‡½æ•°å¿…é¡»ï¼š</span></span><br><span class="line"><span class="string">    1. æ¥å— PhotoMessage å’Œ np.ndarrayï¼ˆBGR å›¾åƒï¼‰</span></span><br><span class="line"><span class="string">    2. è¿”å› DetectionResult æˆ– None</span></span><br><span class="line"><span class="string">    3. å¯¹å›¾åƒæ“ä½œåº”ä½¿ç”¨ copy()ï¼Œé¿å…å¹¶è¡Œå†²çª</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">model_pipeline: <span class="built_in">list</span>, device</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åˆå§‹åŒ–æ¨¡å‹ï¼Œè¿”å› predict å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> åœ¨è¿™é‡Œå®ç°ä½ çš„æ¨¡å‹åˆå§‹åŒ–é€»è¾‘</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–é€»è¾‘ç¤ºä¾‹ï¼š</span></span><br><span class="line">        <span class="comment"># parent_dir = Path(__file__).resolve().parents[3]</span></span><br><span class="line">        <span class="comment"># yolo_path = parent_dir / model_pipeline[0][&quot;weight_path&quot;]</span></span><br><span class="line">        <span class="comment"># yolo_model = YOLO(yolo_path).to(device)</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">message: PhotoMessage, image_input: np.ndarray</span>) -&gt; <span class="type">Optional</span>[DetectionResult]:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            å¯¹è¾“å…¥å›¾åƒæ‰§è¡Œæ£€æµ‹ï¼Œè¿”å› DetectionResult æˆ– Noneã€‚</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            <span class="comment"># <span class="doctag">TODO:</span> åœ¨è¿™é‡Œå®ç°ä½ çš„æ£€æµ‹é€»è¾‘</span></span><br><span class="line">            image = image_input.copy()</span><br><span class="line">            <span class="comment"># æ£€æµ‹é€»è¾‘ç¤ºä¾‹ï¼š</span></span><br><span class="line">            <span class="comment"># for box in detected_boxes:</span></span><br><span class="line">            <span class="comment">#     crop = image[...]</span></span><br><span class="line">            <span class="comment">#     pred = classify(crop)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¦‚æœæœ‰å¼‚å¸¸æƒ…å†µ,åˆ™æ„é€ å¹¶è¿”å›DetectionResultï¼š</span></span><br><span class="line">            <span class="comment"># return DetectionResult(...)</span></span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰å¼‚å¸¸æƒ…å†µï¼Œè¿”å›None</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> predict</span><br></pre></td></tr></table></figure><p>åŸºäºè¿™ä¸ªæŠ½è±¡ç±»çš„è¦æ±‚ï¼Œå®ç°ä¸€ä¸ªå…·ä½“çš„è¯†åˆ«ç±»ï¼Œæ¯”å¦‚æˆ‘åœ¨<code>coat_detector.py</code>ä¸­å®ç°äº†ä¸€ä¸ª<code>CoatDetector(BaseDetector)</code>ç±»ã€‚</p><p>åŒæ—¶ï¼Œåœ¨<code>modelloader.py</code>ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå·¥å‚ç±»<code>ModelLoader</code>ï¼Œç”¨äºåŠ è½½æ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModelLoader</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ¨¡å‹åŠ è½½å·¥å‚ç±»ï¼Œç»Ÿä¸€æ ¹æ®æ¨¡å‹åç§°è¿”å›é¢„æµ‹å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    MODEL_MAP: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Callable</span>[[<span class="type">Any</span>, torch.device], <span class="type">Any</span>]] = &#123;</span><br><span class="line">        <span class="string">&quot;coatdetecter&quot;</span>: CoatDetector.load,</span><br><span class="line">        <span class="string">&quot;nightsingledetecter&quot;</span>: NightSingleDetector.load,</span><br><span class="line">        <span class="string">&quot;channeloccupancydetecter&quot;</span>: ChannelOccupancyDetector.load</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loader</span>(<span class="params">model_name: <span class="built_in">str</span>, model_pipeline: <span class="type">Any</span>, device: torch.device</span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æ ¹æ®æ¨¡å‹åç§°åŠ è½½å¯¹åº”çš„æ£€æµ‹æ¨¡å‹ï¼Œå¹¶è¿”å›é¢„æµ‹å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            model_name (str): æ¨¡å‹åç§°ï¼Œå¦‚ &quot;coatdetecter&quot;ã€‚</span></span><br><span class="line"><span class="string">            model_pipeline (Any): æ¨¡å‹æƒé‡è·¯å¾„æˆ–é…ç½®åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="string">            device (torch.device): æ¨¡å‹è¿è¡Œè®¾å¤‡ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Callable: ç”¨äºæ‰§è¡Œé¢„æµ‹çš„å‡½æ•°ï¼Œè¾“å…¥ä¸º image/messageï¼Œè¾“å‡º DetectionResultã€‚</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            ValueError: å¦‚æœæ¨¡å‹åç§°ä¸åœ¨æ”¯æŒåˆ—è¡¨ä¸­ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            load_func = ModelLoader.MODEL_MAP[model_name]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Model &#x27;<span class="subst">&#123;model_name&#125;</span>&#x27; is not supported.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> load_func(model_pipeline, device)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†åŠ è½½åˆšåˆšçš„æ¨¡å‹ï¼Œæˆ‘ä»¬æŠŠæ¨¡å‹åå­—å’Œæ¨¡å‹ç±».loadå‡½æ•°åŠ è½½åœ¨<code>MODEL_MAP</code>ä¸­</p><p>å†åŒæ—¶ï¼Œåœ¨<code>modelloader.py</code>ä¸­ï¼Œè¿˜æä¾›äº†ä¸€ä¸ª<code>IdentificationModel</code>ç±»ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IdentificationModel</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>):</span><br><span class="line">        self.device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">        self.name = config[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        self.pipeline = config[<span class="string">&quot;pipeline&quot;</span>]</span><br><span class="line">        self.predict = self._loadmodel()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>IdentificationModel</code>ç±»ï¼Œè°ƒç”¨äº†å·¥å‚ç±»<code>ModelLoader</code>çš„<code>loader</code>æ–¹æ³•ï¼Œå°†æ¨¡å‹åŠ è½½åˆ°<code>predict</code>ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è°ƒç”¨å®ä¾‹åŒ–åçš„<code>IdentificationModel</code>ç±»çš„<code>predict</code>æ–¹æ³•è¿›è¡Œè¯†åˆ«äº†ã€‚è¿™é‡Œå…¶å®é€»è¾‘æ¯”è¾ƒæ··ä¹±ï¼Œè¯»è€…å®Œå…¨å¯ä»¥å°†è¿™ä¸¤ä¸ªç±»åˆå¹¶ã€‚</p><p>äº†è§£å®Œè¿™äº›åï¼Œæˆ‘ä»¬æœ€ç»ˆå®šä¹‰ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ç±»ï¼Œè¯¥ç±»é¦–å…ˆåŸºäºconfigæ–‡ä»¶ï¼Œåˆå§‹åŒ–ä¸€ä¸ª<code>IdentificationModel</code>å®ä¾‹åˆ—è¡¨ï¼Œç„¶åå¯¹äº<code>messagequeue</code>ä¸­çš„æ¯ä¸ª<code>PhotoMessage</code>ï¼Œéå†è°ƒç”¨æ¯ä¸ª<code>IdentificationModel</code>å®ä¾‹çš„<code>pridict()</code>æ–¹æ³•è¿›è¡Œè¯†åˆ«ï¼Œå¹¶è°ƒç”¨<code>data.service</code>æš´éœ²çš„å­˜å‚¨æ¥å£è¿›è¡Œå­˜å‚¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoConsumer</span>(threading.Thread):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config_list: <span class="type">List</span>[<span class="built_in">dict</span>], poll_interval: <span class="built_in">float</span> = <span class="number">1</span>, max_workers: <span class="built_in">int</span> = <span class="number">4</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¤šçº¿ç¨‹æ¶ˆè´¹è€…ï¼šä» global_mq è·å–æ¶ˆæ¯ï¼Œè¯»å–å›¾ç‰‡ï¼Œæ‰§è¡Œæ¨¡å‹æ¨ç†ï¼Œå¹¶åˆ é™¤å›¾ç‰‡ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param config_list: ä¸€ç»„ config å­—å…¸ï¼ˆæ¯ä¸ªé…ç½®ä¸€ä¸ªæ¨¡å‹ï¼‰</span></span><br><span class="line"><span class="string">        :param poll_interval: è½®è¯¢é—´éš”ç§’æ•°</span></span><br><span class="line"><span class="string">        :param max_workers: å¹¶å‘å¤„ç†çš„æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(daemon=<span class="literal">True</span>)</span><br><span class="line">        self.poll_interval = poll_interval</span><br><span class="line">        self.running = <span class="literal">True</span></span><br><span class="line">        self.db = DataSaver()</span><br><span class="line">        self.executor = ThreadPoolExecutor(max_workers=max_workers)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–æ¨¡å‹åˆ—è¡¨</span></span><br><span class="line">        self.modellist = [IdentificationModel(config) <span class="keyword">for</span> config <span class="keyword">in</span> config_list]</span><br><span class="line">        <span class="keyword">for</span> model <span class="keyword">in</span> self.modellist:</span><br><span class="line">            logger.info(model)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">      <span class="string">&quot;&quot;&quot;åœæ­¢çº¿ç¨‹å¹¶å…³é—­çº¿ç¨‹æ± &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¸»çº¿ç¨‹å¾ªç¯è·å–æ¶ˆæ¯å¹¶äº¤ç”±çº¿ç¨‹æ± å¤„ç†&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_message</span>(<span class="params">self, message: PhotoMessage</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å•æ¡æ¶ˆæ¯çš„è¯†åˆ«ä¸å­˜å‚¨&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>æœ€åå®šä¹‰ä¸€ä¸ª<code>start_photo_consumer_concurrent()</code>å‡½æ•°ç”¨äºå¯åŠ¨æ¨¡å‹æ¶ˆè´¹è€…ï¼Œæœ‰detect.pyè°ƒç”¨ï¼Œå…¶ä¸­ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer = PhotoConsumer(config_list, max_workers=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>max_workers</code>ä¸ºå¯ç”¨çš„æ¶ˆè´¹è€…çº¿ç¨‹æ•°</p><h5 id="33-postprocess"><a class="markdownIt-Anchor" href="#33-postprocess"></a> 3.3 postprocess</h5><p>é‡Œé¢æ”¾ä¸€å¤©çš„è¯†åˆ«ç»“æŸåçš„æ“ä½œï¼Œæ¯”å¦‚è¯´å°†è¯†åˆ«ç»“æœæ•°æ®æ¢³ç†åä»t_results_tempè¡¨è¿ç§»åˆ°t_resultsè¡¨ï¼Œå¹¶åˆ é™¤t_results_tempè¡¨ä¸­çš„æ•°æ®ã€‚preprocesså’Œpostprocessé‡Œé¢çš„æ“ä½œå¤§å¤šæ•°è¢«å°è£…ä¸ºäº†data.database.serviceé‡Œé¢çš„æœåŠ¡æ¥å£ï¼Œåªè¦è°ƒç”¨å°±è¡Œäº†ã€‚å€¼å¾—å…³æ³¨çš„æ˜¯ï¼Œpreprocessåœ¨<code>detect.py</code>ä¸­è¢«è°ƒç”¨ï¼Œè€Œpostprocessåœ¨<code>main.py</code>ä¸­è¢«è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> core.postprocess.migration_runner <span class="keyword">import</span> DailyMigrationTask</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½’çº³ç¨‹åºæ§åˆ¶</span></span><br><span class="line">summary_start = str_to_time(config[<span class="string">&quot;summary_program&quot;</span>][<span class="string">&quot;start&quot;</span>])</span><br><span class="line">summary_end = str_to_time(config[<span class="string">&quot;summary_program&quot;</span>][<span class="string">&quot;end&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> in_time_range(summary_start, summary_end, now):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> started_summary:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[INFO] å¯åŠ¨å½’çº³ç¨‹åº&quot;</span>)</span><br><span class="line">        task = DailyMigrationTask()</span><br><span class="line">        task.run()</span><br><span class="line">        started_summary = <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> started_summary <span class="keyword">and</span> summary_proc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[INFO] å…³é—­å½’çº³ç¨‹åº&quot;</span>)</span><br><span class="line">        started_summary = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">60</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¶æ„"><a class="markdownIt-Anchor" href="#æ¶æ„"></a> æ¶æ„</h3><img src="https://atffang.github.io/2025/11/13/å®éªŒå®¤å®‰å…¨æ£€æµ‹ç³»ç»Ÿ2/æ¶æ„.png"/>ç°åœ¨æ²¡æœ‰è®¾è®¡å¤šGPUï¼Œä¹Ÿæš‚æ—¶æ²¡æœ‰å¿…è¦ã€‚]]></content>
    
    
    <summary type="html">&lt;p&gt;èŠ±äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´ä¿®æ”¹äº†ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œç®€å•è®°å½•ä¸€ä¸‹&lt;/p&gt;</summary>
    
    
    
    <category term="ä½œå“" scheme="https://atffang.github.io/categories/%E4%BD%9C%E5%93%81/"/>
    
    
  </entry>
  
  <entry>
    <title>DeepSort (SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRIC)</title>
    <link href="https://atffang.github.io/2025/11/12/deepsort/"/>
    <id>https://atffang.github.io/2025/11/12/deepsort/</id>
    <published>2025-11-12T05:23:19.000Z</published>
    <updated>2026-01-10T14:31:52.107Z</updated>
    
    <content type="html"><![CDATA[<p>æ¢³ç†æ‘„åƒå¤´è¡Œäººè¿½è¸ªç»å…¸è®ºæ–‡SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRICä¸­çš„æ–¹æ³•ã€‚</p><span id="more"></span><h1 id="simple-online-and-realtime-tracking-with-a-deep-association-metric"><a class="markdownIt-Anchor" href="#simple-online-and-realtime-tracking-with-a-deep-association-metric"></a> Simple online and realtime tracking with a deep association metric</h1><p><strong>ä½œè€…</strong>ï¼šNicolai Wojke, Alex Bewley, Dietrich Paulus</p><hr /><h3 id="abstract"><a class="markdownIt-Anchor" href="#abstract"></a> Abstract</h3><p>Simple Online and Realtime Tracking (SORT) is a pragmatic approach to multiple object tracking with a focus on simple, effective algorithms. In this paper, we integrate appearance information to improve the performance of SORT. Due to this extension we are able to track objects through longer periods of occlusions, effectively reducing the number of identity switches. In spirit of the original framework we place much of the computational complexity into an offline pre-training stage where we learn a deep association metric on a largescale person re-identification dataset. During online application, we establish measurement-to-track associations using nearest neighbor queries in visual appearance space. Experimental evaluation shows that our extensions reduce the number of identity switches by 45%, achieving overall competitive performance at high frame rates.</p><h3 id="1-è®­ç»ƒé˜¶æ®µ"><a class="markdownIt-Anchor" href="#1-è®­ç»ƒé˜¶æ®µ"></a> 1. è®­ç»ƒé˜¶æ®µ</h3><h4 id="11-æ•°æ®æ¥æº"><a class="markdownIt-Anchor" href="#11-æ•°æ®æ¥æº"></a> 1.1 æ•°æ®æ¥æº</h4><ul><li>ä½¿ç”¨ MARS æ•°æ®é›†ï¼š1.1 M å›¾åƒï¼Œ1261 åè¡Œäººï¼Œè·¨ç›¸æœºè·¨æ—¶æ®µã€‚</li><li>è®­ç»ƒé›†/éªŒè¯é›†æ‹†åˆ†ï¼šæŒ‰èº«ä»½åˆ’æˆ 631/630 ä¸¤ç»„ç”¨äºè®­ç»ƒå’ŒéªŒè¯ï¼Œä¿è¯ ID ä¸é‡å ã€‚</li><li>å¢å¹¿ï¼šæ°´å¹³ç¿»è½¬ã€éšæœºæ“¦é™¤ã€é¢œè‰²æ‰°åŠ¨ã€256Ã—128 LetterBoxã€‚</li></ul><h4 id="12-ç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#12-ç½‘ç»œç»“æ„"></a> 1.2 ç½‘ç»œç»“æ„</h4><img src="/2025/11/12/deepsort/deepsort1.jpg" class="" title="sucessful"><p>è¾“å…¥ (3,256,128) çš„å›¾åƒ</p><ul><li><strong>Conv1 3Ã—3/1 32 é€šé“</strong></li><li><strong>Conv2 3Ã—3/1 32 é€šé“</strong></li><li><strong>MaxPool 3Ã—3/2</strong></li><li><strong>6 ä¸ªæ®‹å·®å—ï¼ˆé€šé“ 32â†’64â†’128ï¼Œä¸‹é‡‡æ · 2 æ¬¡ï¼‰</strong></li><li><strong>GAPï¼ˆå…¨å±€å¹³å‡æ± åŒ–ï¼‰ (128,8,4) â†’ 128 ç»´å‘é‡</strong></li><li><strong>Dense10 128-D</strong></li><li><strong>BatchNorm1d + L2 å½’ä¸€åŒ– â†’ å•ä½çƒé¢è¾“å‡º</strong></li></ul><h4 id="13-æŸå¤±ä¸è®­ç»ƒåè®®"><a class="markdownIt-Anchor" href="#13-æŸå¤±ä¸è®­ç»ƒåè®®"></a> 1.3 æŸå¤±ä¸è®­ç»ƒåè®®</h4><p><strong>batch-hard ä¸‰å…ƒç»„æŸå¤±</strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåœ¨ä¸€ä¸ª mini-batch é‡Œï¼Œåªç•™æœ€éš¾çš„æ ·æœ¬å»æ¨/æ‹‰ç½‘ç»œï¼Œå¿½ç•¥å…¶ä½™è½»æ¾æ ·æœ¬ï¼Œé¿å…æ¢¯åº¦è¢«å¤§é‡ç®€å•å¯¹æ·¹æ²¡ã€‚batch-hardçš„ batch æ„é€ è¿‡ç¨‹å¦‚ä¸‹</p><ul><li>å…ˆéšæœºæŠ½ P=18 ä¸ªè¡Œäººèº«ä»½ï¼ˆå¯ä»¥ç†è§£ä¸º 18 ä¸ªäººï¼‰</li><li>å¯¹æ¯ä¸ªäººï¼Œå†ä»ä¸åŒç›¸æœºã€ä¸åŒå¸§é‡Œå„æŠ“ 4 å¼ å›¾ï¼Œå…± 18Ã—4=72 å¼ å›¾</li></ul><p>å¯¹ä»»æ„ä¸€å¼ <strong>é”šå›¾</strong>ï¼š</p><ul><li>æ‰¾å‡ºåŒèº«ä»½é‡Œå¤–è§‚æœ€ä¸åƒé”šçš„é‚£å¼ å›¾ï¼ˆåŒèº«ä»½ä¸­ä½™å¼¦è·ç¦»æœ€å¤§ï¼‰ï¼Œä½œä¸º<strong>æœ€éš¾æ­£æ ·æœ¬</strong></li><li>æ‰¾å‡ºå¼‚èº«ä»½é‡Œå¤–è§‚æœ€åƒé”šçš„é‚£å¼ å›¾ï¼ˆåŒèº«ä»½ä¸­ä½™å¼¦è·ç¦»æœ€å°ï¼‰ï¼Œä½œä¸º<strong>æœ€éš¾è´Ÿæ ·æœ¬</strong></li></ul><p>åªä¿ç•™è¿™ä¸€å¯¹éš¾æ ·æœ¬è®¡ç®—æŸå¤±ï¼Œå…¶ä½™å…¨éƒ¨å¿½ç•¥ã€‚æŸå¤±å‡½æ•°å¼•ç”¨äº†æ–‡ç«  <em>Simple online and realtime tracking with a deep association metric</em> ä¸­çš„è®¡ç®—æ–¹æ³•ã€‚</p><p><strong>æŸå¤±å‡½æ•°</strong>ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mrow><mi mathvariant="normal">B</mi><mi mathvariant="normal">H</mi></mrow></msub><mo stretchy="false">(</mo><mi>Î¸</mi><mo separator="true">;</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>P</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mrow><mo fence="true">[</mo><mi>m</mi><mo>+</mo><munder><mo><mi>max</mi><mo>â¡</mo></mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>K</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>p</mi><mo mathvariant="normal">â‰ </mo><mi>a</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></munder><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>p</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>âˆ’</mo><munder><mo><mi>min</mi><mo>â¡</mo></mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>P</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo mathvariant="normal">â‰ </mo><mi>i</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></munder><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>n</mi><mi>j</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>+</mo></msub></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\mathrm{BH}}(\theta; X) = \sum_{i=1}^{P} \sum_{a=1}^{K} \left[ m + \max_{\substack{p=1,\dots,K \\ p \neq a}} D(f_\theta(x_a^i), f_\theta(x_p^i)) - \min_{\substack{j=1,\dots,P \\ j \neq i}} D(f_\theta(x_a^i), f_\theta(x_n^j)) \right]_+ </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">B</span><span class="mord mathrm mtight">H</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.7090609999999997em;vertical-align:-1.658051em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43056000000000005em;"><span style="top:-2.0406725000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.133325em;"><span style="top:-3.149995em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="minner mtight">â€¦</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span><span style="top:-2.261115em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight">î€ </span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6333249999999999em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5026549999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6678600000000001em;"><span style="top:-2.0406725000000003em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.133325em;"><span style="top:-3.149995em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="minner mtight">â€¦</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span><span style="top:-2.261115em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight">î€ </span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6333249999999999em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5026549999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-1.191389em;"><span style="top:-1.1002800000000001em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.658051em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ï¼š<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>ï¼šbatch ä¸­èº«ä»½ï¼ˆpersonï¼‰æ•°é‡<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>ï¼šæ¯ä¸ªèº«ä»½çš„å›¾åƒæ•°<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">x_a^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.071664em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>ï¼šç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªèº«ä»½çš„ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> å¼ å›¾åƒï¼ˆanchorï¼‰<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>p</mi><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">x_p^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2077719999999998em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span></span></span></span>ï¼šä¸ anchor åŒèº«ä»½çš„æœ€è¿œæ­£æ ·æœ¬ï¼ˆhardest positiveï¼‰<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>n</mi><mi>j</mi></msubsup></mrow><annotation encoding="application/x-tex">x_n^j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.071664em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>ï¼šä¸ anchor å¼‚èº«ä»½çš„æœ€è¿‘è´Ÿæ ·æœ¬ï¼ˆhardest negativeï¼‰<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo stretchy="false">(</mo><mo separator="true">â‹…</mo><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D(Â·,Â·)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">)</span></span></span></span>ï¼šæ¬§æ°è·ç¦»ï¼ˆä½œè€…æ˜ç¡®ä½¿ç”¨ éå¹³æ–¹ æ¬§æ°è·ç¦»ï¼‰<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span>ï¼šmarginï¼Œå– 0.2<br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo separator="true">â‹…</mo><msub><mo stretchy="false">]</mo><mo>+</mo></msub></mrow><annotation encoding="application/x-tex">[Â·]_+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>ï¼šReLUï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">max(0, Â·)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">)</span></span></span></span></p><p>æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹è¿™ä¸ªå…¬å¼ã€‚</p><ol><li><strong>å¤–å±‚åŒé‡æ±‚å’Œ</strong><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>P</mi></msubsup><msubsup><mo>âˆ‘</mo><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{P} \sum_{a=1}^{K}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2809409999999999em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span></span></span></span><br />ä¸€æ¬¡ mini-batch é‡Œæœ‰ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> ä¸ªèº«ä»½ï¼Œæ¯äºº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¼ å›¾ï¼›å¯¹æ¯å¼ å›¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i,a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span> éƒ½å½“ä¸€æ¬¡é”šç‚¹ï¼Œå…± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>Ã—</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">PÃ—K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> ä¸ªé”šç‚¹ã€‚</li><li><strong>æœ€éš¾æ­£æ ·æœ¬é¡¹</strong><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo><mi>max</mi><mo>â¡</mo></mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>K</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>p</mi><mo mathvariant="normal">â‰ </mo><mi>a</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></msub><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>p</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\max_{\substack{p=1,\dots,K \\ p \neq a}} D(f_\theta(x_a^i), f_\theta(x_p^i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.716519em;vertical-align:-0.8918549999999998em;"></span><span class="mop"><span class="mop">max</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7933274999999997em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.133325em;"><span style="top:-3.149995em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="minner mtight">â€¦</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span><span style="top:-2.261115em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight">î€ </span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6333249999999999em;"><span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8918549999999998em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><br />åœ¨åŒèº«ä»½ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> çš„å…¶ä½™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> å¼ å›¾é‡Œï¼Œæ‰¾è·ç¦»æœ€å¤§çš„é‚£å¼ ä½œä¸ºç¡¬æ­£æ ·æœ¬ï¼ˆ<strong>hardest positive</strong>ï¼‰ã€‚ä½œç”¨æ˜¯æŠŠåŒèº«ä»½æœ€è¿œçš„ç‚¹æ‹‰è¿›æ¥ï¼Œé˜²æ­¢ç°‡å†…æ¾æ•£ã€‚</li><li><strong>æœ€éš¾è´Ÿæ ·æœ¬é¡¹</strong><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo><mi>min</mi><mo>â¡</mo></mo><mstyle scriptlevel="1"><mtable rowspacing="0.1em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>P</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mrow><mi>j</mi><mo mathvariant="normal">â‰ </mo><mi>i</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></msub><mi>D</mi><mo stretchy="false">(</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>a</mi><mi>i</mi></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>n</mi><mi>j</mi></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min_{\substack{j=1,\dots,P \\ j \neq i}} D(f_\theta(x_a^i), f_\theta(x_n^j))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.716519em;vertical-align:-0.8918549999999998em;"></span><span class="mop"><span class="mop">min</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7933274999999997em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.133325em;"><span style="top:-3.149995em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="minner mtight">â€¦</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span><span style="top:-2.261115em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel mtight">î€ </span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6333249999999999em;"><span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8918549999999998em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span><br />åœ¨ æ‰€æœ‰å¼‚èº«ä»½ å›¾é‡Œï¼Œæ‰¾è·ç¦»æœ€å°çš„é‚£å¼ ä½œä¸ºç¡¬è´Ÿæ ·æœ¬ï¼ˆ<strong>hardest negative</strong>ï¼‰ã€‚ä½œç”¨æ˜¯æŠŠæœ€è¿·æƒ‘äººçš„å¼‚ç±»æ¨è¿œï¼Œå¢å¤§ç±»é—´ marginã€‚</li><li><strong>Hingeé¡¹</strong><br /><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>m</mi><mo>+</mo><mo stretchy="false">(</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mo stretchy="false">)</mo><mtext>âˆ’</mtext><mo stretchy="false">(</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>e</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mo stretchy="false">)</mo><msub><mo stretchy="false">]</mo><mo>+</mo></msub></mrow><annotation encoding="application/x-tex">[m + (hardest positive) âˆ’ (hardest negative)]_+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><br />å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">hardest positive</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span></span></span></span> æ¯” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>e</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">hardest negative</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span></span></span></span> è¿œï¼ˆæˆ–è¿‘å¾—ä¸å¤Ÿï¼‰æ—¶ï¼Œ <strong>hinge</strong> é¡¹ä¸ºæ­£ï¼ŒæŸå¤±äº§ç”Ÿæ¢¯åº¦ï¼Œå¦åˆ™ä¸º 0ï¼ŒæŸå¤±ä¸º 0ã€‚</li></ol><p><strong>è®­ç»ƒåè®®</strong>ï¼š</p><ul><li>ä¼˜åŒ–å™¨ï¼šAdam</li><li>å­¦ä¹ ç‡ï¼š0.0001</li><li>mini-batchï¼š72</li><li>epochï¼š1000</li><li>ä¿å­˜é¢‘ç‡ï¼šæ¯ 100 ä¸ª epoch ä¿å­˜ä¸€æ¬¡</li></ul><hr /><h3 id="2-è¯†åˆ«æµç¨‹"><a class="markdownIt-Anchor" href="#2-è¯†åˆ«æµç¨‹"></a> 2. è¯†åˆ«æµç¨‹</h3><h4 id="21-è¾“å…¥æ£€æµ‹"><a class="markdownIt-Anchor" href="#21-è¾“å…¥æ£€æµ‹"></a> 2.1 è¾“å…¥æ£€æµ‹</h4><p>æ£€æµ‹å™¨ç»™å‡º (u,v,w,h) + ç½®ä¿¡ï¼›ç½®ä¿¡ &lt;0.3 çš„ç›´æ¥ä¸¢å¼ƒã€‚è¯¥æ–‡ç« çš„æ£€æµ‹å™¨æ¥è‡ªäº<em>Poi: Multiple object tracking with high performance detection and appearance feature</em>ï¼Œæ˜¯ä¸€ä¸ªFaster R-CNN åœ¨ç§æœ‰+å…¬å¼€è¡Œäººæ•°æ®é›†ä¸Šé‡æ–°è®­ç»ƒçš„ä¸€ä¸ªå¼ºæ£€æµ‹å™¨ã€‚</p><h4 id="22-ç‰¹å¾æå–"><a class="markdownIt-Anchor" href="#22-ç‰¹å¾æå–"></a> 2.2 ç‰¹å¾æå–</h4><ol><li>æ¡†å›¾ç­‰æ¯”ç¼©æ”¾åˆ° 256Ã—128ï¼Œä¾§è¡¥ç°æ¡ï¼›</li><li>æ¯ä¸ªé€šé“å‡å» ImageNet å‡å€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi></mrow><annotation encoding="application/x-tex">Î¼</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Î¼</span></span></span></span> ï¼Œå†é™¤ä»¥æ ‡å‡†å·® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">Ïƒ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span></span></span></span> ï¼Œå³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>r</mi></msub><mi>a</mi><mi>w</mi><mi mathvariant="normal">/</mi><mn>255.0</mn><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">x = (x_raw / 255.0 - Î¼) / Ïƒ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">/</span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span><span class="mord">.</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Î¼</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span></span></span></span>ï¼›</li><li>å‰å‘å†»ç»“ CNN â†’ 128-D â†’ L2 å½’ä¸€åŒ– â†’ å•ä½å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">r_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€‚æŠŠ RGB å›¾åƒå‹æˆ 128 ç»´å•ä½è¶…çƒé¢å‘é‡</li></ol><h4 id="23-è¿åŠ¨é¢„æµ‹ä¸é—¨æ§"><a class="markdownIt-Anchor" href="#23-è¿åŠ¨é¢„æµ‹ä¸é—¨æ§"></a> 2.3 è¿åŠ¨é¢„æµ‹ä¸é—¨æ§</h4><p>ç›®æ ‡ï¼šåœ¨ä¸‹ä¸€å¸§åˆ°æ¥ä¹‹å‰ï¼Œç”¨â€œå¸¸é€Ÿæ¨¡å‹â€ä¼°è®¡æ¯ä¸ªè½¨è¿¹çš„æ–°ä½ç½®ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªç½®ä¿¡æ¤­åœ†â€”â€”åªæœ‰æ£€æµ‹æ¡†è½åœ¨è¿™ä¸ªæ¤­åœ†å†…ï¼Œæ‰å…è®¸å‚ä¸åç»­åŒ¹é…ã€‚æ•´ä¸ªæµç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼šçŠ¶æ€å®šä¹‰ â†’ é¢„æµ‹ â†’ Mahalanobis é—¨æ§ã€‚</p><ol><li><strong>çŠ¶æ€å‘é‡ä¸è§‚æµ‹</strong><br />é‡‡ç”¨å›¾åƒå¹³é¢ä¸Šçš„ 8 ç»´å¸¸é€Ÿæ¨¡å‹ã€‚<br /><strong>çŠ¶æ€</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo stretchy="false">[</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>Î³</mi><mo separator="true">,</mo><mi>h</mi><mo separator="true">,</mo><mover accent="true"><mi>u</mi><mo>Ë™</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>v</mi><mo>Ë™</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>Î³</mi><mo>Ë™</mo></mover><mo separator="true">,</mo><mover accent="true"><mi>h</mi><mo>Ë™</mo></mover><mo stretchy="false">]</mo><mtext>áµ€</mtext></mrow><annotation encoding="application/x-tex">x = [u, v, Î³, h, uÌ‡, vÌ‡, Î³Ì‡, hÌ‡]áµ€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1813em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.11111000000000001em;"><span class="mord">Ë™</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.11111000000000001em;"><span class="mord">Ë™</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.13889em;"><span class="mord">Ë™</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9313em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">h</span></span><span style="top:-3.26344em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.13889em;"><span class="mord">Ë™</span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord">áµ€</span></span></span></span><br />â€“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>ï¼šæ¡†ä¸­å¿ƒåƒç´ åæ ‡<br />â€“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î³</mi><mo>=</mo><mi>w</mi><mi mathvariant="normal">/</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">Î³ = w/h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">/</span><span class="mord mathnormal">h</span></span></span></span>ï¼šå®½é«˜æ¯”<br />â€“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">h</span></span></span></span>ï¼šé«˜åº¦åƒç´ <br />â€“ å¸¦ç‚¹é¡¹ä¸ºå¯¹åº”ä¸€é˜¶å¯¼æ•°ï¼ˆé€Ÿåº¦ï¼‰</li></ol><p>1.2 <strong>è§‚æµ‹</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mo stretchy="false">[</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>Î³</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">]</mo><mtext>áµ€</mtext></mrow><annotation encoding="application/x-tex">z = [u, v, Î³, h]áµ€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">h</span><span class="mclose">]</span><span class="mord">áµ€</span></span></span></span></p><ol start="2"><li><strong>é¢„æµ‹é˜¶æ®µ</strong><br />å¯¹å·²å­˜åœ¨è½¨è¿¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ï¼š<br />ç”¨<strong>ä¸Šå¸§ä¼°è®¡</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mover accent="true"><mi>x</mi><mo>^</mo></mover><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>P</mi><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(xÌ‚_{k-1}, P_{k-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> åšå…ˆéªŒé¢„æµ‹</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>x</mi><mo>^</mo></mover><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo>=</mo><mi>F</mi><msub><mover accent="true"><mi>x</mi><mo>^</mo></mover><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">xÌ‚_k|k-1 = F xÌ‚_{k-1|k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.04964em;vertical-align:-0.3551999999999999em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo>=</mo><mi>F</mi><msub><mi>P</mi><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mi>F</mi><mtext>áµ€</mtext><mo>+</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">P_k|k-1 = F P_{k-1|k-1} Fáµ€ + Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord">áµ€</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span> ä¸ºçŠ¶æ€è½¬ç§»çŸ©é˜µï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span></span></span></span> ä¸ºè¿‡ç¨‹å™ªå£°åæ–¹å·®çŸ©é˜µã€‚<br /><strong>é¢„æµ‹è¾“å‡º</strong><br />å‡å€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>H</mi><msub><mover accent="true"><mi>x</mi><mo>^</mo></mover><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y_i = H xÌ‚_k|k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> â†’ 4-D æ¡† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">,</mo><mi>Î³</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u,v,Î³,h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">h</span><span class="mclose">)</span></span></span></span><br />åæ–¹å·® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mi>H</mi><msub><mi>P</mi><mi>k</mi></msub><mi mathvariant="normal">âˆ£</mi><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mi>H</mi><mtext>áµ€</mtext><mo>+</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">S_i = H P_k|k-1 Háµ€ + R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord">áµ€</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></p><ol start="3"><li><strong>é—¨æ§é˜¶æ®µ</strong><br />å¯¹æ–°æ£€æµ‹æ¡† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>j</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>u</mi><mi>j</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>j</mi></msub><mo separator="true">,</mo><msub><mi>Î³</mi><mi>j</mi></msub><mo separator="true">,</mo><msub><mi>h</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d_j = (u_j, v_j, Î³_j, h_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">Î³</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œè®¡ç®—åˆ°é¢„æµ‹åˆ†å¸ƒçš„ å¹³æ–¹ <strong>Mahalanobis</strong> è·ç¦»ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>d</mi><mo stretchy="false">(</mo></msup><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>d</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mtext>áµ€</mtext><msubsup><mi>S</mi><mi>i</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo stretchy="false">(</mo><msub><mi>d</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d^(1)(i,j) = (d_j - y_i)áµ€ S_i^{-1} (d_j - y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.150216em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">áµ€</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.433005em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>4-D è§‚æµ‹ç©ºé—´ä¸‹ï¼Œå¹³æ–¹ Mahalanobis è·ç¦»æœä» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï‡</mi><mtext>Â²</mtext></mrow><annotation encoding="application/x-tex">Ï‡Â²</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Ï‡</span><span class="mord">Â²</span></span></span></span> åˆ†å¸ƒï¼Œè·å–95 % ç½®ä¿¡åŒºåŸŸå¯¹åº”çš„é˜ˆå€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>95</mn></msub></mrow><annotation encoding="application/x-tex">t_{95}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè‹¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>d</mi><mo stretchy="false">(</mo></msup><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>&lt;</mo><msub><mi>t</mi><mn>95</mn></msub></mrow><annotation encoding="application/x-tex">d^(1)(i,j) &lt; t_{95}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åˆ™è®¤ä¸ºé€šè¿‡é—¨æ§ï¼Œå…è®¸è¿›å…¥åŒˆç‰™åˆ©æˆæœ¬çŸ©é˜µã€‚</p><h4 id="24-å¤–è§‚åŒ¹é…ä¸é—¨æ§"><a class="markdownIt-Anchor" href="#24-å¤–è§‚åŒ¹é…ä¸é—¨æ§"></a> 2.4 å¤–è§‚åŒ¹é…ä¸é—¨æ§</h4><p>ç›®çš„ï¼šæŠŠç¨‹åº¦ä½çš„é…å¯¹ç›´æ¥è¸¢æ‰ï¼Œå‡å°‘åŒˆç‰™åˆ©çŸ©é˜µçš„æ­§ä¹‰ï¼ŒåŒæ—¶è®©è½¨è¿¹åœ¨é®æŒ¡åé å¤–è²Œé‡æ–°æ‰¾å›èº«ä»½ã€‚<br /><strong>å¾ªç¯ç”»å»Š</strong>ï¼ˆCircular Galleryï¼‰<br />æ¯æ¡è½¨è¿¹ k ç»´æŠ¤ä¸€ä¸ª å›ºå®šé•¿åº¦ 100 çš„åˆ—è¡¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>k</mi></msub><mo>=</mo><mo stretchy="false">[</mo><msup><mi>r</mi><mo stretchy="false">(</mo></msup><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msup><mi>r</mi><mo stretchy="false">(</mo></msup><mn>100</mn><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">R_k = [r^(1), â€¦, r^(100)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span>ï¼Œå…ƒç´ æ˜¯ 128-D å•ä½å‘é‡ï¼ˆL2 å½’ä¸€åŒ–åï¼‰ï¼Œæ¥è‡ªè¿‡å» 100 æ¬¡æˆåŠŸåŒ¹é…çš„æ£€æµ‹ç‰¹å¾ã€‚æ¯æˆåŠŸåŒ¹é…ä¸€æ¬¡ï¼ŒæŠŠæ–°ç‰¹å¾ push è¿›é˜Ÿå°¾ï¼Œè¶…å‡º 100 åˆ™ pop é˜Ÿå¤´<br /><strong>æœ€å°ä½™å¼¦è·ç¦»è®¡ç®—</strong><br />å¯¹æ–°æ£€æµ‹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>ï¼Œå…ˆæå– 128-D å•ä½å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">r_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç„¶åä¸ç”»å»Šé€å‘é‡æ±‚ä½™å¼¦ç›¸ä¼¼åº¦</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>i</mi><mi>m</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi>r</mi><mi>j</mi><mi>T</mi></msubsup><msubsup><mi>r</mi><mi>k</mi><mo stretchy="false">(</mo></msubsup><mi>l</mi><mo stretchy="false">)</mo><mo>âˆˆ</mo><mo stretchy="false">[</mo><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">sim(l) = r_j^T r_k^(l)          âˆˆ [-1, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.427908em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>d</mi><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>i</mi><msub><mi>n</mi><mi>l</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><mi>s</mi><mi>i</mi><mi>m</mi><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><mo>âˆˆ</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d^{(2)}(i,j) = min_l { 1 - sim(l) } âˆˆ [0, 2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span></span></p><p>å–æœ€å°è·ç¦», å³æœ€åƒçš„é‚£ä¸ªå†å²å‘é‡ã€‚<br />3. <strong>ç¡¬é—¨æ§</strong>ï¼ˆHard Gatingï¼‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>b</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mi>d</mi><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>â‰¤</mo><mn>0.2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">b^{(2)}_{i,j}=\begin{cases}1,&amp;d^{(2)}(i,j)\leq0.2\\0,&amp;\text{otherwise}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">otherwise</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h4 id="25-æˆæœ¬çŸ©é˜µä¸çº§è”"><a class="markdownIt-Anchor" href="#25-æˆæœ¬çŸ©é˜µä¸çº§è”"></a> 2.5 æˆæœ¬çŸ©é˜µä¸çº§è”</h4><p>ä¸¤è½®é—¨æ§ï¼ˆè¿åŠ¨ + å¤–è§‚ï¼‰éƒ½é€šè¿‡åï¼Œè¯¥ (è½¨è¿¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>, æ£€æµ‹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>) å¯¹æ‰è¢«å…è®¸è¿›å…¥åŒˆç‰™åˆ©ç®—æ³•çš„æˆæœ¬çŸ©é˜µã€‚æ¥ä¸‹æ¥é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li><strong>æ„é€ æˆæœ¬çŸ©é˜µ C</strong><br />ä»…ä¿ç•™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b^{(1)}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ä¸” <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b^{(2)}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> çš„é…å¯¹<br />å…ƒç´  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">C_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> = å¤–è§‚ä½™å¼¦è·ç¦»<br />æœªé€šè¿‡é—¨æ§çš„ä½ç½®å¡« <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">âˆ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">âˆ</span></span></span></span>ï¼Œç¡®ä¿åŒˆç‰™åˆ©ä¸ä¼šé€‰ä¸­</li><li><strong>åŒˆç‰™åˆ©æœ€ä¼˜åˆ†é…</strong><br />åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> ä¸Šæ±‚è§£æœ€å°æˆæœ¬åŒ¹é…<br />è¾“å‡ºï¼šæœ€ä¼˜ (è½¨è¿¹â†’æ£€æµ‹) åˆ—è¡¨ + æœªåŒ¹é…è½¨è¿¹ + æœªåŒ¹é…æ£€æµ‹</li><li><strong>Kalman æ›´æ–° / æ–°å»ºè½¨è¿¹ / åˆ é™¤è½¨è¿¹</strong><br />åŒ¹é…æˆåŠŸçš„ï¼šç”¨å¯¹åº”æ£€æµ‹æ¡†åš Kalman æ›´æ–°ï¼Œå¹¶æŠŠå…¶ 128-D ç‰¹å¾å‹å…¥è½¨è¿¹ gallery<br />æœªåŒ¹é…æ£€æµ‹ï¼šåˆå§‹åŒ–æš‚å®šè½¨è¿¹ï¼Œéœ€è¿ç»­ 3 å¸§æˆåŠŸå…³è”æ‰è½¬æ­£<br />æœªåŒ¹é…è½¨è¿¹ï¼šage +1ï¼Œè¶…è¿‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{lost}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼ˆé»˜è®¤ 30ï¼‰å¸§å³åˆ é™¤<br />å¾ªç¯ç»“æŸï¼šä¸‹ä¸€å¸§åˆ°æ¥æ—¶ï¼Œç”¨æ›´æ–°åçš„è½¨è¿¹çŠ¶æ€å›åˆ°ç¬¬ 1 æ­¥é¢„æµ‹é˜¶æ®µã€‚</li></ol><hr />]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¢³ç†æ‘„åƒå¤´è¡Œäººè¿½è¸ªç»å…¸è®ºæ–‡SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRICä¸­çš„æ–¹æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://atffang.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>Features for Multi-Target Multi-Camera Tracking and Re-Identification</title>
    <link href="https://atffang.github.io/2025/11/11/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BBFMTMCRI/"/>
    <id>https://atffang.github.io/2025/11/11/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BBFMTMCRI/</id>
    <published>2025-11-11T03:33:07.000Z</published>
    <updated>2026-01-10T14:29:12.453Z</updated>
    
    <content type="html"><![CDATA[<p>æ¢³ç†MTMCé—®é¢˜ç»å…¸è®ºæ–‡Features for Multi-Target Multi-Camera Tracking and Re-Identificationä¸­çš„æ–¹æ³•ã€‚</p><span id="more"></span><h1 id="features-for-multi-target-multi-camera-tracking-and-re-identification"><a class="markdownIt-Anchor" href="#features-for-multi-target-multi-camera-tracking-and-re-identification"></a> Features for Multi-Target Multi-Camera Tracking and Re-Identification</h1><p><strong>ä½œè€…</strong>ï¼šErgys Ristani, Carlo Tomasi (Duke University)</p><h3 id="abstract"><a class="markdownIt-Anchor" href="#abstract"></a> Abstract</h3><p>Multi-Target Multi-Camera Tracking (MTMCT) tracks many people through video taken from several cameras. Person Re-Identification (Re-ID) retrieves from a gallery images of people similar to a person query image. We learn good features for both MTMCT and Re-ID with a convolutional neural network. Our contributions include an adaptive weighted triplet loss for training and a new technique for hard-identity mining. Our method outperforms the state of the art both on the DukeMTMC benchmarks for tracking, and on the Market-1501 and DukeMTMC-ReID benchmarks for Re-ID. We examine the correlation between good Re-ID and good MTMCT scores, and perform ablation studies to elucidate the contributions of the main components of our system.</p><h2 id="1-ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯"><a class="markdownIt-Anchor" href="#1-ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯"></a> 1. ä»»åŠ¡å®šä¹‰ä¸æ•´ä½“æ€è·¯</h2><p>MTMCT çš„ç›®æ ‡æ˜¯ï¼Œç»™å®š <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> è·¯æ— é‡å è§†åŸŸçš„è§†é¢‘æµ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mrow><mi>V</mi><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>V</mi><mi>n</mi></mrow></mrow><annotation encoding="application/x-tex">V={V1,â€¦,Vn}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal">n</span></span></span></span></span>ï¼Œè¾“å‡ºæ¯ä¸ªäººåœ¨å…¨å±€æ—¶ç©ºä¸­çš„å®Œæ•´è½¨è¿¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mrow><mi>T</mi><mn>1</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>T</mi><mi>l</mi></mrow></mrow><annotation encoding="application/x-tex">T={T1,â€¦,Tl}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></span>ã€‚<br />Re-ID çš„ç›®æ ‡æ˜¯ï¼šç»™å®šæŸ¥è¯¢å›¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œåœ¨è·¨ç›¸æœºå›¾åº“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">G</span></span></span></span> ä¸­æŒ‰ç›¸ä¼¼åº¦é™åºè¿”å›åŒèº«ä»½å›¾åƒã€‚</p><p>ä½œè€…æå‡ºåªå­¦ä¹ ç‰¹å¾ï¼Œä¸å­¦ä¹ å…³è”ï¼š</p><ul><li>è®­ç»ƒé˜¶æ®µï¼šç”¨æ”¹è¿›çš„åŠ æƒä¸‰å…ƒç»„æŸå¤±ï¼ˆAWTLï¼‰+ å›°éš¾èº«ä»½æŒ–æ˜ï¼ˆHNMï¼‰åœ¨çº¯ Re-ID åè®®ä¸‹è®­ç»ƒ 128-D å¤–è§‚ç‰¹å¾ï¼›</li><li>æµ‹è¯•é˜¶æ®µï¼šç”¨ç›¸å…³èšç±»ï¼ˆCorrelation Clusteringï¼‰ä¸€æ¬¡æ€§æŠŠå…¨éƒ¨æ£€æµ‹å…³è”æˆè·¨ç›¸æœºè½¨è¿¹ï¼›</li><li>æ£€æµ‹å™¨ä¸ç‰¹å¾è§£è€¦ï¼Œæ•´ä½“ pipeline é€šè¿‡ä¸‰é˜¶æ®µé€’è¿›ï¼Œå³æ£€æµ‹ â†’ å•ç›¸æœºè½¨è¿¹ â†’ è·¨ç›¸æœºè½¨è¿¹ã€‚</li></ul><hr /><h2 id="2-è®­ç»ƒå¤–è§‚ç‰¹å¾å­¦ä¹ "><a class="markdownIt-Anchor" href="#2-è®­ç»ƒå¤–è§‚ç‰¹å¾å­¦ä¹ "></a> 2. è®­ç»ƒï¼šå¤–è§‚ç‰¹å¾å­¦ä¹ </h2><h3 id="21-ä¸‰å…ƒç»„æŸå¤±çš„é€šç”¨å½¢å¼"><a class="markdownIt-Anchor" href="#21-ä¸‰å…ƒç»„æŸå¤±çš„é€šç”¨å½¢å¼"></a> 2.1 ä¸‰å…ƒç»„æŸå¤±çš„é€šç”¨å½¢å¼</h3><p>åœ¨è¡Œäºº Re-ID ä»»åŠ¡é‡Œï¼Œæˆ‘ä»¬æŠŠä¸€å¼ å«æœ‰æŸä¸ªäººå…¨èº«ï¼ˆæˆ–å¯è§å¤§éƒ¨åˆ†èº«ä½“ï¼‰çš„ bounding-box å›¾åƒå«åšä¸€ä¸ª æ ·æœ¬ï¼ˆæˆ– patchã€embeddingï¼‰ã€‚</p><p>è®­ç»ƒæ—¶ï¼Œè¾“å…¥ç½‘ç»œçš„å›¾åƒä¸‰å…ƒç»„å¦‚ä¸‹ï¼š<br />Â· å…ˆéšæœºé€‰ ä¸€ä¸ªèº«ä»½ ID-aï¼ˆæ¯”å¦‚å¼ ä¸‰ï¼‰ã€‚<br />Â· ä» ID-a å½“å¤©è¢«ä¸åŒç›¸æœºæ‹åˆ°çš„æ‰€æœ‰æ¡†å›¾é‡Œï¼ŒéšæœºæŠ½ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¼ ï¼ˆè®ºæ–‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">K=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>ï¼‰ã€‚è¿™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å¼ é‡Œçš„ä»»æ„ä¸€å¼ å°±å« é”šç‚¹å›¾åƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">xa</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">a</span></span></span></span>ï¼ˆanchorï¼‰ã€‚<br />Â· åŒå± ID-a çš„å…¶ä½™æ¡†å›¾éƒ½å« æ­£æ ·æœ¬å›¾åƒ xpï¼ˆpositiveï¼‰â€”â€”å®ƒä»¬å’Œ xa åŒèº«ä»½ï¼Œåªæ˜¯è§†è§’ã€å…‰ç…§ã€å§¿æ€æˆ–é®æŒ¡ä¸åŒã€‚<br />å†ä» å…¶å®ƒä»»ä½•èº«ä»½ï¼ˆæé›·ã€éŸ©æ¢…â€¦ï¼‰çš„æ¡†å›¾é‡ŒéšæœºæŠ½è‹¥å¹²å¼ ï¼Œå« è´Ÿæ ·æœ¬å›¾åƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>n</mi><mtext>ï¼ˆ</mtext><mi>n</mi><mi>e</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext>ï¼‰</mtext></mrow><annotation encoding="application/x-tex">xnï¼ˆnegativeï¼‰</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">ï¼ˆ</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">ï¼‰</span></span></span></span>ï¼Œå®ƒä»¬å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">xa</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">a</span></span></span></span> èº«ä»½ä¸åŒã€‚</p><p>å¯¹é”šç‚¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">xa</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord mathnormal">a</span></span></span></span>ï¼Œè®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span> ä¸ºæ­£æ ·æœ¬é›†ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span> ä¸ºè´Ÿæ ·æœ¬é›†ï¼Œå®šä¹‰</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mn>3</mn></msub><mo>=</mo><msub><mrow><mo fence="true">[</mo><mi>m</mi><mo>+</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>p</mi></msub><mo>âˆˆ</mo><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></munder><msub><mi>w</mi><mi>p</mi></msub><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>p</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>x</mi><mi>n</mi></msub><mo>âˆˆ</mo><mi>N</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></munder><msub><mi>w</mi><mi>n</mi></msub><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo fence="true">]</mo></mrow><mo>+</mo></msub></mrow><annotation encoding="application/x-tex">L_3=\left[m+\sum_{x_p\in P(a)}w_pd(x_a,x_p)-\sum_{x_n\in N(a)}w_nd(x_a,x_n)\right]_+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.7090609999999997em;vertical-align:-1.658051em;"></span><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â£</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¢</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¡</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.538325em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0510099999999998em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¦</span></span></span><span style="top:-2.8099900000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¥</span></span></span><span style="top:-4.05101em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â¤</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-1.191389em;"><span style="top:-1.1002800000000001em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.658051em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mo separator="true">â‹…</mo><mo separator="true">,</mo><mo separator="true">â‹…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(Â·,Â·)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">â‹…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mclose">)</span></span></span></span> ä¸ºæ¬§æ°è·ç¦»ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ã€‚å…³é”®åœ¨æƒé‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mtext>â‚š</mtext><mo separator="true">,</mo><mi>w</mi><mtext>â‚™</mtext></mrow><annotation encoding="application/x-tex">{wâ‚š, wâ‚™}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">â‚š</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">â‚™</span></span></span></span></span> çš„è®¾è®¡ã€‚</p><h3 id="22-è‡ªé€‚åº”æƒé‡awtl"><a class="markdownIt-Anchor" href="#22-è‡ªé€‚åº”æƒé‡awtl"></a> 2.2 è‡ªé€‚åº”æƒé‡ï¼ˆAWTLï¼‰</h3><p>ä¸ Batch-Hard ä»…ç»™æœ€éš¾æ ·æœ¬èµ‹ 1ã€å…¶ä½™ 0 ä¸åŒï¼Œä½œè€…æå‡º softmax å¼è¿ç»­æƒé‡ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mi>p</mi></msub><mo>=</mo><mfrac><msup><mi>e</mi><mrow><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>p</mi></msub><mo stretchy="false">)</mo></mrow></msup><mrow><munder><mo>âˆ‘</mo><mrow><mi>x</mi><mo>âˆˆ</mo><mi>P</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></munder><msup><mi>e</mi><mrow><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mo separator="true">,</mo><mspace width="1em"/><msub><mi>w</mi><mi>n</mi></msub><mo>=</mo><mfrac><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></msup><mrow><munder><mo>âˆ‘</mo><mrow><mi>x</mi><mo>âˆˆ</mo><mi>N</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></munder><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_p=\frac{e^{d(x_a,x_p)}}{\sum_{x\in P(a)}e^{d(x_a,x)}},\quad w_n=\frac{e^{-d(x_a,x_n)}}{\sum_{x\in N(a)}e^{-d(x_a,x)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.74371em;vertical-align:-1.17871em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.2960000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.17871em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.74371em;vertical-align:-1.17871em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.2960000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.17871em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>Batch-Hardçš„ç¼ºç‚¹ï¼š</p><ul><li>æ¢¯åº¦åªæ¥è‡ªä¸¤å¼ å›¾ï¼Œå…¶ä½™æ ·æœ¬è¢«æµªè´¹ï¼›</li><li>å¦‚æœâ€œæœ€éš¾â€æ ·æœ¬æ˜¯ç¦»ç¾¤å¸§ï¼ˆé®æŒ¡ã€è¯¯æ£€ï¼‰ï¼Œç½‘ç»œä¼šè¢«å¼ºè¡Œæ‹‰å‘é”™è¯¯æ–¹å‘ï¼›</li><li>æƒé‡æ˜¯ 0/1 ç¡¬åˆ†é…ï¼Œæ— æ³•å…¼é¡¾å¤šä¸ªéš¾æ ·æœ¬ã€‚</li></ul><p>è‡ªé€‚åº”æƒé‡çš„ä¼˜åŠ¿ï¼š</p><ul><li>hardest æ ·æœ¬è‹¥æ˜¯ç¦»ç¾¤ï¼Œæƒé‡ä¸ä¼šç‹¬å¤§ï¼›</li><li>å¤šä¸ªéš¾åˆ†æ ·æœ¬åŒæ—¶è·å¾—æ¢¯åº¦ï¼Œè®­ç»ƒæ›´ç¨³å®šã€‚</li></ul><h3 id="23-å›°éš¾èº«ä»½æŒ–æ˜hnm"><a class="markdownIt-Anchor" href="#23-å›°éš¾èº«ä»½æŒ–æ˜hnm"></a> 2.3 å›°éš¾èº«ä»½æŒ–æ˜ï¼ˆHNMï¼‰</h3><p>è®­ç»ƒé›†èº«ä»½æ•°å¤§æ—¶ï¼Œéšæœº PK é‡‡æ ·å¾ˆéš¾ç¢°åˆ°çœŸæ­£å›°éš¾çš„èº«ä»½ã€‚ä½œè€…ç»´æŠ¤ä¸¤ä¸ªæ± ï¼š</p><ul><li>Hard-Identity-Pool Hï¼šå¯¹å½“å‰é”šç‚¹ï¼Œå…¨å±€ç‰¹å¾è·ç¦»æœ€å¤§çš„ H=50 ä¸ªèº«ä»½ï¼›</li><li>Random-Poolï¼šå…¶ä½™èº«ä»½ã€‚</li></ul><p>æ¯ä¸ª mini-batch ä¸­ï¼Œé™¤é”šèº«ä»½å¤–çš„ Pâ€“1 ä¸ªèº«ä»½ä»¥ 0.5/0.5 æ¦‚ç‡ä»ä¸Šè¿°ä¸¤æ± æŠ½å–ï¼Œå†å„éšæœºé€‰ K=4 å¼ å›¾ã€‚<br />å®è·µï¼šç½‘ç»œå…ˆ warm-up 5 k æ¬¡è¿­ä»£ï¼Œç”¨æ­¤åˆ»ç‰¹å¾ç¦»çº¿è®¡ç®—ä¸€æ¬¡ Hï¼Œä¹‹åå›ºå®šåˆ°è®­ç»ƒç»“æŸã€‚</p><h3 id="24-ç½‘ç»œç»“æ„ä¸å¢å¼º"><a class="markdownIt-Anchor" href="#24-ç½‘ç»œç»“æ„ä¸å¢å¼º"></a> 2.4 ç½‘ç»œç»“æ„ä¸å¢å¼º</h3><p>è®­ç»ƒæ ·æœ¬ï¼šå«è¡Œäººçš„è¾¹æ¡†å›¾ + èº«ä»½ç¼–å·</p><ol><li><strong>éª¨æ¶ï¼šImageNet é¢„è®­ç»ƒ ResNet-50</strong>ï¼š</li></ol><ul><li>è¾“å…¥å½¢çŠ¶ï¼š(B, 3, 256, 128)</li><li>è¾“å‡ºï¼š<strong>pool5</strong> ç‰¹å¾å›¾ (B, 2048, 8, 4)ï¼ˆåŸå§‹ ImageNet æ˜¯ 7Ã—7ï¼Œè¿™é‡Œæ˜¯ 8Ã—4ï¼Œå› ä¸ºè¡Œäººå›¾é«˜å®½æ¯” 2:1ï¼‰</li><li>åªä¿ç•™â€œå·ç§¯+BN+ReLUâ€éƒ¨åˆ†ï¼ŒæŠŠå…¨å±€å¹³å‡æ± åŒ–ï¼ˆGAPï¼‰å’Œ 1000-D fc å…¨éƒ¨ä¸¢æ‰ï¼›ç¡®ä¿å¾—åˆ°ç©ºé—´ç»´åº¦ 8Ã—4 çš„ 2048 é€šé“å·ç§¯ç‰¹å¾ã€‚</li></ul><ol start="2"><li><strong>å…¨å±€æœ€å¤§æ± åŒ–ï¼ˆGMPï¼‰æˆ–å¹³å‡æ± åŒ–ï¼ˆGAPï¼‰</strong></li></ol><ul><li>ä½¿ç”¨Global Average Poolingï¼ˆGAPï¼‰æˆ–è€… Global Max Poolingï¼ˆGMPï¼‰æŠŠ (B, 2048, 8, 4) çš„ç‰¹å¾å›¾å‹æˆ (B, 2048, 1, 1)ï¼Œå† flatten æˆ (B, 2048) å‘é‡ã€‚æŠŠç©ºé—´ä¿¡æ¯å‹æˆå›ºå®šé•¿åº¦å‘é‡</li></ul><ol start="3"><li><strong>ç¬¬ä¸€å…¨è¿æ¥</strong></li></ol><ul><li>å…¨è¿æ¥å±‚ï¼šæŠŠ 2048 ç»´å‘é‡æ˜ å°„åˆ° 1024 ç»´ã€‚</li><li>åŠ  BatchNorm1d(ç¼“è§£å†…éƒ¨åå˜é‡åç§»)</li><li>åŠ  ReLU(å¼•å…¥éçº¿æ€§)</li></ul><ol start="4"><li><strong>ç¬¬äºŒå…¨è¿æ¥</strong></li></ol><ul><li>1024 â†’ 128ï¼ˆåµŒå…¥å±‚ï¼‰</li><li>ç›´æ¥è¾“å‡º 128-D å‘é‡ï¼Œä¿è¯åµŒå…¥ç©ºé—´æ˜¯çº¿æ€§çš„ï¼Œæ–¹ä¾¿åé¢ç®—æ¬§æ°è·ç¦»</li></ul><ol start="5"><li><strong>Lâ‚‚ å½’ä¸€åŒ–</strong></li></ol><ul><li>æŠŠæ¯ä¸ª 128-D å‘é‡æ‹‰æˆå•ä½çƒé¢ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>â€–</mtext><mi>x</mi><mtext>â€–â‚‚</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">â€–xâ€–â‚‚ = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">â€–</span><span class="mord mathnormal">x</span><span class="mord">â€–</span><span class="mord">â‚‚</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></li></ul><ol start="6"><li><strong>æœ€ç»ˆè¾“å‡º</strong></li></ol><ul><li>æŠŠç½‘ç»œè¾“å‡ºçš„ 128-D å•ä½å‘é‡ç»„ç»‡æˆä¸‰å…ƒç»„$ (xa, xp, xn)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ï¼Œç®—æ¬§æ°è·ç¦»</mtext></mrow><annotation encoding="application/x-tex">ï¼Œç®—æ¬§æ°è·ç¦»</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ç®—</span><span class="mord cjk_fallback">æ¬§</span><span class="mord cjk_fallback">æ°</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">ç¦»</span></span></span></span> d(Â·,Â·)$ï¼Œå†ä»£å…¥è‡ªé€‚åº”åŠ æƒä¸‰å…ƒç»„æŸå¤±ï¼Œå¾—åˆ°æ¢¯åº¦å¹¶å›ä¼ ã€‚</li></ul><p>ä¸Šè¿°æ–¹æ³•çš„ä¼ªä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">model.train()</span><br><span class="line">optim.zero_grad()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 1. å‰å‘æ‹¿åˆ° 128-D å•ä½å‘é‡ =====</span></span><br><span class="line">embs = model(imgs)          <span class="comment"># (B, 128)  å·²åœ¨æ¨¡å‹é‡Œ L2-normalize</span></span><br><span class="line">embs = embs.view(P, K, <span class="number">128</span>) <span class="comment"># (P, K, 128) æ–¹ä¾¿æŒ‰èº«ä»½åˆ‡ç‰‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 2. é€èº«ä»½æ„é€ ä¸‰å…ƒç»„ =====</span></span><br><span class="line">loss_batch = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(P):               <span class="comment"># æ¯ä¸ªèº«ä»½å½“ä¸€æ¬¡é”š</span></span><br><span class="line">    xa = embs[i, <span class="number">0</span>]              <span class="comment"># é€‰è¯¥èº«ä»½ç¬¬ 1 å¼ å½“é”šï¼ˆå¯éšæœºï¼‰</span></span><br><span class="line">    xp = embs[i, <span class="number">1</span>:]             <span class="comment"># åŒèº«ä»½å…¶ä½™ K-1 å¼  = æ­£</span></span><br><span class="line">    xn = embs[torch.arange(P)!=i] <span class="comment"># å…¶ä½™ (P-1) ä¸ªèº«ä»½ = è´Ÿ</span></span><br><span class="line">    xn = xn.view(-<span class="number">1</span>, <span class="number">128</span>)        <span class="comment"># æ‹‰å¹³æˆ ((P-1)*K, 128)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ===== 3. ç®—æ¬§æ°è·ç¦» =====</span></span><br><span class="line">    d_ap = torch.cdist(xa.unsqueeze(<span class="number">0</span>), xp)  <span class="comment"># (1, K-1)</span></span><br><span class="line">    d_an = torch.cdist(xa.unsqueeze(<span class="number">0</span>), xn)  <span class="comment"># (1, (P-1)*K)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ===== 4. è‡ªé€‚åº”æƒé‡ =====</span></span><br><span class="line">    w_p = F.softmax(d_ap, dim=<span class="number">1</span>)             <span class="comment"># æ­£æ ·æœ¬æƒé‡ (1, K-1)</span></span><br><span class="line">    w_n = F.softmax(-d_an, dim=<span class="number">1</span>)            <span class="comment"># è´Ÿæ ·æœ¬æƒé‡ (1, (P-1)*K)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ===== 5. åŠ æƒä¸‰å…ƒç»„æŸå¤± =====</span></span><br><span class="line">    pos_term = (w_p * d_ap).<span class="built_in">sum</span>()</span><br><span class="line">    neg_term = (w_n * d_an).<span class="built_in">sum</span>()</span><br><span class="line">    loss_i = F.relu(m + pos_term - neg_term) <span class="comment"># m=1 è®ºæ–‡è®¾ç½®</span></span><br><span class="line">    loss_batch += loss_i</span><br><span class="line"></span><br><span class="line">loss = loss_batch / P          <span class="comment"># å¹³å‡åˆ°æ¯ä¸ªé”š</span></span><br><span class="line">loss.backward()</span><br><span class="line">optim.step()</span><br></pre></td></tr></table></figure><hr /><h2 id="3-æµ‹è¯•mtmc-è·Ÿè¸ª-pipeline"><a class="markdownIt-Anchor" href="#3-æµ‹è¯•mtmc-è·Ÿè¸ª-pipeline"></a> 3. æµ‹è¯•ï¼šMTMC è·Ÿè¸ª pipeline</h2><p>æ•´ä½“æµç¨‹è§ä¸‹å›¾</p><img src="/2025/11/11/%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BBFMTMCRI/image.png" class="" title="sucessful"><h3 id="31-è¾“å…¥æ£€æµ‹"><a class="markdownIt-Anchor" href="#31-è¾“å…¥æ£€æµ‹"></a> 3.1 è¾“å…¥æ£€æµ‹</h3><p>é‡‡ç”¨å…¬å¼€ OpenPose äººä½“æ£€æµ‹å™¨ï¼ˆåŸºäº PAFï¼Œåœ¨ Part Affinity ä¸Šç›´æ¥ç›‘ç£ï¼‰ï¼Œè¾“å‡ºæ¯å¸§è¾¹ç•Œæ¡†ã€‚</p><h3 id="32-ç‰¹å¾æå–"><a class="markdownIt-Anchor" href="#32-ç‰¹å¾æå–"></a> 3.2 ç‰¹å¾æå–</h3><p>æ£€æµ‹ç»™å‡ºçš„ä»»æ„é«˜å®½æ¯”æ¡†å…ˆè¢«ç­‰æ¯”ç¼©æ”¾åˆ°é«˜ 256 åƒç´ ã€å®½ 128 åƒç´ ï¼ˆä¸è¶³ä¸¤ä¾§è¡¥ç°æ¡ï¼‰ï¼Œå†åš ImageNet å‡å€¼-æ–¹å·®å½’ä¸€åŒ–ï¼›å›ºå®šæƒé‡çš„ ResNet-50 å·ç§¯åŸºæå– 2048-D å…¨å±€ç‰¹å¾ï¼Œç» 2048â†’1024â†’128 ä¸¤å±‚å…¨è¿æ¥ï¼ˆå¸¦ BN ä¸ ReLUï¼‰å¹¶ Lâ‚‚ å½’ä¸€åŒ–åï¼Œè¾“å‡º 128 ç»´å•ä½å‘é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mtext>áµ¢</mtext></mrow><annotation encoding="application/x-tex">xáµ¢</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mord">áµ¢</span></span></span></span>ï¼Œä¾›åç»­å…³è”ä½¿ç”¨ã€‚</p><h3 id="33-ç›¸ä¼¼åº¦è®¡ç®—"><a class="markdownIt-Anchor" href="#33-ç›¸ä¼¼åº¦è®¡ç®—"></a> 3.3 ç›¸ä¼¼åº¦è®¡ç®—</h3><ol><li><strong>å¤–è§‚ç›¸å…³åº¦</strong>ï¼š</li></ol><ul><li>å…ˆç¦»çº¿åœ¨è®­ç»ƒé›†ä¸Šç»Ÿè®¡æ‰€æœ‰æ­£/è´Ÿå¯¹çš„å¹³å‡è·ç¦» <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mtext>â‚š</mtext><mo separator="true">,</mo><mi>Î¼</mi><mtext>â‚™</mtext></mrow><annotation encoding="application/x-tex">Î¼â‚š, Î¼â‚™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Î¼</span><span class="mord">â‚š</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">Î¼</span><span class="mord">â‚™</span></span></span></span>ï¼Œä»¤é˜ˆå€¼<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mtext>â‚</mtext><mo>=</mo><mo stretchy="false">(</mo><mi>Î¼</mi><mtext>â‚š</mtext><mo>+</mo><mi>Î¼</mi><mtext>â‚™</mtext><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">tâ‚ = (Î¼â‚š + Î¼â‚™)/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mord">â‚</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">Î¼</span><span class="mord">â‚š</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Î¼</span><span class="mord">â‚™</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span></span>â€ƒâ€ƒ(â‰¤1)</li><li>åˆ™å¯¹ä»»æ„ä¸€å¯¹æ£€æµ‹,å¤–è§‚ç›¸å…³åº¦ä¸ºï¼š<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>A</mi></msubsup><mo>=</mo><mo stretchy="false">(</mo><mi>t</mi><mtext>â‚â€“</mtext><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mtext>áµ¢</mtext><mo separator="true">,</mo><mi>x</mi><mtext>â±¼</mtext><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>t</mi><mtext>â‚</mtext></mrow><annotation encoding="application/x-tex">w_{ij}^{A} = (tâ‚ â€“ d(xáµ¢,xâ±¼))/tâ‚</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.236103em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord">â‚</span><span class="mord">â€“</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">áµ¢</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">x</span><span class="mord">â±¼</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">t</span><span class="mord">â‚</span></span></span></span>â€ƒ<br />å€¼åŸŸ (âˆ’âˆ,1]ï¼ŒåŒèº«ä»½æœŸæœ›ä¸ºæ­£ï¼Œå¼‚èº«ä»½æœŸæœ›ä¸ºè´Ÿã€‚</li></ul><ol start="2"><li><strong>è¿åŠ¨ç›¸å…³åº¦</strong>ï¼š</li></ol><ul><li>ç¦»çº¿ï¼šç”¨è®­ç»ƒé›†é‡Œå·²çŸ¥çš„çŸ­è½¨è¿¹ï¼ŒæŒ‰â€œå¸¸é€Ÿæ¨¡å‹â€å‘å‰ã€å‘åå„é¢„æµ‹ 10 å¸§ï¼Œå¾—åˆ°é¢„æµ‹æ¡†ä¸çœŸå®æ¡†çš„ IoU è¯¯å·®ï¼Œç»Ÿè®¡å‡ºèƒ½æŠŠâ€œåŒä¸€è½¨è¿¹å¯¹â€ä¸â€œä¸åŒè½¨è¿¹å¯¹â€åˆ†å¼€çš„è¯¯å·®é˜ˆå€¼$ t_m$ å’Œç¼©æ”¾å› å­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">Î±</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span></li><li>åœ¨çº¿ï¼šå¯¹ä¸¤æ¡å¾…å…³è”è½¨è¿¹ï¼Œç”¨å„è‡ªæœ€è¿‘ 5 å¸§ä¼°é€Ÿåº¦ï¼Œé‡‡ç”¨çº¿æ€§åŒ€é€Ÿæ¨¡å‹,å‰å‘-åå‘åŒå‘é¢„æµ‹ï¼Œå¾—è¯¯å·® <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>m</mi></msub><mo>=</mo><msub><mi>e</mi><mi>f</mi></msub><mo>+</mo><msub><mi>e</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">e_m = e_f + e_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<br />åœ¨è®­ç»ƒé›†ä¸Šæ‹Ÿåˆé˜ˆå€¼ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">t_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> åŠç¼©æ”¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi></mrow><annotation encoding="application/x-tex">Î±</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span>ï¼Œä»¤<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>M</mi></msubsup><mo>=</mo><mi>Î±</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>m</mi></msub><mtext>â€“</mtext><msub><mi>e</mi><mi>m</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_{ij}^{M} = Î±(t_m â€“ e_m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.236103em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">â€“</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>â€ƒâ€ƒè‹¥ e_m å¯è®¡ç®—ï¼›å¦åˆ™$ â€“âˆ$<br />ä¸ºæ­£ï¼Œé¼“åŠ±å…³è”ï¼Œä¸ºè´Ÿï¼Œæ‹’ç»ä¸å¯èƒ½è·³è·ƒ</li></ul><ol start="3"><li><p>æ—¶é—´æŠ˜æ‰£ï¼š<br />å¯¹æ—¶é—´å·® Î”t çš„ä¸¤æ£€æµ‹ï¼Œå¼•å…¥æŒ‡æ•°è¡°å‡ï¼Œ æƒ©ç½šâ€œæ—¶é—´éš”å¾—å¤ªè¿œâ€çš„è¾¹<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mtext>â€“</mtext><mi>Î²</mi><mi mathvariant="normal">Î”</mi><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{ij} = exp(â€“Î²Î”t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">â€“</span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mord">Î”</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></p></li><li><p>æœ€ç»ˆè¾¹æƒ<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>W</mi><mi>A</mi></msup><mo>+</mo><msup><mi>W</mi><mi>M</mi></msup><mo stretchy="false">)</mo><mo>âŠ™</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">W = (W^{A} + W^{M}) âŠ™ D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âŠ™</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>â€ƒ<br />å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âŠ™</mo></mrow><annotation encoding="application/x-tex">âŠ™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">âŠ™</span></span></span></span> ä¸ºé€å…ƒç´ ä¹˜ã€‚</p></li></ol><h3 id="34-ç›¸å…³èšç±»ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#34-ç›¸å…³èšç±»ä¼˜åŒ–"></a> 3.4 ç›¸å…³èšç±»ä¼˜åŒ–</h3><ol><li><p><strong>æ„é€ æ— å‘å›¾</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo separator="true">,</mo><mi>W</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G=(V,E,W)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mclose">)</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> ä¸ºæ‰€æœ‰æ£€æµ‹èŠ‚ç‚¹(æ¯ä¸€å¸§çš„æ¯ä¸ªæ£€æµ‹æ¡†å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¸¦å±æ€§ âŸ¨t, x, y, w, h, 128-D å‘é‡âŸ©ã€‚)ï¼Œè¾¹æƒ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> å¦‚ä¸Š(æ­£å€¼ â†’ é¼“åŠ±åŒç°‡ï¼›è´Ÿå€¼ â†’ é¼“åŠ±å¼‚ç°‡)ã€‚</p></li><li><p><strong>ç›®æ ‡å‡½æ•°</strong>ï¼šæœ€å¤§åŒ–ä¸€è‡´è¾¹çš„æ€»æƒé‡ï¼Œç»™æ¯æ¡è¾¹ä¸€ä¸ªäºŒè¿›åˆ¶å˜é‡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mi>j</mi><mo>âˆˆ</mo><mrow><mn>0</mn><mo separator="true">,</mo><mn>1</mn></mrow></mrow><annotation encoding="application/x-tex">x_ij âˆˆ {0,1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span></span></span></span></span></p></li></ol><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x_{ij} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>â€ƒâ‡’â€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> åŒèº«ä»½ï¼ˆæ”¾åœ¨åŒä¸€ç°‡ï¼‰</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x_{ij} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>â€ƒâ‡’â€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> ä¸åŒèº«ä»½ï¼ˆåˆ†å±ä¸¤ç°‡ï¼‰<br />æ•´æ•°è§„åˆ’å°±æ˜¯</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mi mathvariant="normal">Î£</mi><msub><mi>w</mi><mi>i</mi></msub><mi>j</mi><msub><mi>x</mi><mi>i</mi></msub><mi>j</mi></mrow><annotation encoding="application/x-tex">max Î£ w_ij x_ij</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord">Î£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><br />å°½é‡å¤šåœ°æŠŠæ­£å€¼è¾¹æ”¶è¿›ç°‡é‡Œï¼ŒæŠŠè´Ÿå€¼è¾¹è¸¢åˆ°ç°‡å¤–</li></ul><ol start="3"><li><strong>çº¦æŸæ¡ä»¶</strong>ï¼š</li></ol><ul><li>ä¼ é€’æ€§ï¼š<br />â€ƒâ€ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>â‰¤</mo><mn>1</mn><mo>+</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{ij} + x_{jk} â‰¤ 1 + x_{ik}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.922078em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br />å³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">i,j,k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ä¸‰è€…ä¸­ï¼Œè‹¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i,j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> åŒèº«ä»½ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i,k,j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> åŒèº«ä»½ï¼Œå¿…é¡»æ»¡è¶³ä¼ é€’æ€§ã€‚</li></ul><ol start="4"><li><strong>æ±‚è§£æ–¹æ³•</strong>ï¼š<br />æ±‚è§£æ•´æ•°è§„åˆ’ï¼š</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>âˆ—</mo><mo>=</mo><mi>a</mi><mi>r</mi><mi>g</mi><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆˆ</mo><mrow><mn>0</mn><mo separator="true">,</mo><mn>1</mn></mrow></mrow></msub><munder><mo>âˆ‘</mo><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mo>âˆˆ</mo><mi>E</mi></mrow></munder><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mtext>â€ƒ</mtext><mi>s</mi><mi mathvariant="normal">.</mi><mi>t</mi><mi mathvariant="normal">.</mi><mtext>â€ƒ</mtext><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>â‰¤</mo><mn>1</mn><mo>+</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X* = argmax_{x_{ij}âˆˆ{0,1}} âˆ‘_{(i,j)âˆˆE} w_{ij}x_{ij}  â€ƒs.t.â€ƒx_{ij}+x_{jk} â‰¤ 1+x_{ik}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord">âˆ—</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.5660100000000003em;vertical-align:-1.516005em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110800000000004em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">)</span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">â€ƒ</span><span class="mord mathnormal">s</span><span class="mord">.</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord">â€ƒ</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.922078em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ç­‰ä»·äºæœ€å¤§ä¸€è‡´å­å›¾é—®é¢˜ï¼ŒNP-hardï¼Œä½†ç°æœ‰å¯å‘å¼ï¼ˆå¦‚ SAã€Greedy Agglomerativeï¼‰åœ¨åƒçº§èŠ‚ç‚¹ä¸Šè¶³å¤Ÿé«˜æ•ˆã€‚  è§£ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>=1 è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i,j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> åŒèº«ä»½ï¼Œç”±æ­¤å¾—åˆ°å…¨å±€èº«ä»½æ ‡ç­¾ã€‚</p><h3 id="35-åå¤„ç†"><a class="markdownIt-Anchor" href="#35-åå¤„ç†"></a> 3.5 åå¤„ç†</h3><ul><li>çº¿æ€§æ’å€¼ï¼šå¯¹åŒä¸€è½¨è¿¹ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><msub><mi>t</mi><mi>g</mi></msub><mi>a</mi><mi>p</mi><mo>â‰¤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">0 &lt; t_gap â‰¤ 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.922078em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> s çš„æ¼æ£€åšçº¿æ€§æ’è¡¥ï¼›</li><li>ä½ç½®ä¿¡ä¿®å‰ªï¼šè‹¥è½¨è¿¹æ£€æµ‹ç½®ä¿¡å‡å€¼ &lt; 0 æˆ–é•¿åº¦ &lt; 5 å¸§ï¼Œåˆ™ä¸¢å¼ƒã€‚</li></ul><h3 id="36-ä¸‰çº§å±‚æ¬¡æ¨ç†é™ä½å¤æ‚åº¦"><a class="markdownIt-Anchor" href="#36-ä¸‰çº§å±‚æ¬¡æ¨ç†é™ä½å¤æ‚åº¦"></a> 3.6 ä¸‰çº§å±‚æ¬¡æ¨ç†é™ä½å¤æ‚åº¦</h3><ol><li>Tracklet çº§ï¼š1 s ä¸é‡å æ»‘åŠ¨çª—å†…ç”¨è´ªå¿ƒæœ€è¿‘é‚»ç”ŸæˆçŸ­è½¨è¿¹ï¼›</li><li>å•ç›¸æœºçº§ï¼š10 s æ»‘åŠ¨çª—ï¼ˆ50 % é‡å ï¼‰å†…æŠŠ tracklet ä½œä¸ºèŠ‚ç‚¹ï¼Œé‡å¤ 3.3-3.4 æ­¥éª¤ï¼›</li><li>è·¨ç›¸æœºçº§ï¼š1.5 min æ»‘åŠ¨çª—ï¼ŒæŠŠå•ç›¸æœºè½¨è¿¹ä½œä¸ºèŠ‚ç‚¹ï¼Œé‡å¤ 3.3-3.4 æ­¥éª¤ï¼Œå¾—åˆ°æœ€ç»ˆè·¨ç›¸æœº IDã€‚</li></ol><hr />]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¢³ç†MTMCé—®é¢˜ç»å…¸è®ºæ–‡Features for Multi-Target Multi-Camera Tracking and Re-Identificationä¸­çš„æ–¹æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://atffang.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘</title>
    <link href="https://atffang.github.io/2025/11/05/%E5%9F%BA%E4%BA%8E%E4%B8%89%E7%BB%B4%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9B%91%E6%8E%A7%E7%94%BB%E9%9D%A2%E6%A8%A1%E6%8B%9F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E6%A0%87%E5%AE%9A%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/"/>
    <id>https://atffang.github.io/2025/11/05/%E5%9F%BA%E4%BA%8E%E4%B8%89%E7%BB%B4%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9B%91%E6%8E%A7%E7%94%BB%E9%9D%A2%E6%A8%A1%E6%8B%9F%E4%B8%8E%E6%B7%B1%E5%BA%A6%E6%A0%87%E5%AE%9A%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/</id>
    <published>2025-11-05T11:07:07.000Z</published>
    <updated>2026-01-10T14:27:45.719Z</updated>
    
    <content type="html"><![CDATA[<p>åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘ã€‚åŸºäºVue + vite + electron + cesiumçš„æ¡Œé¢ç«¯è½¯ä»¶ã€‚</p><span id="more"></span><p>æœ€è¿‘åšçš„æ–¹å‘æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šè®¡ç®—ç ”ç©¶åŒºåŸŸçš„ä¼—å¤šç›‘æ§æ‘„åƒå¤´ç”»é¢å¯¹åº”çš„æ·±åº¦å›¾ï¼Œå³èƒ½å¤Ÿå¾—åˆ°ç”»é¢ä¸Šåƒç´ ç‚¹å¯¹åº”çš„çœŸå®ä¸–ç•Œåæ ‡ã€‚å› æ­¤ï¼Œå¼€å‘äº†ä¸€æ¬¾åŸºäºElectron+Vueçš„ï¼Œä¾èµ–Cesiumå¯è§†åŒ–ç ”ç©¶åŒºåŸŸä¸‰ç»´æ¨¡å‹ï¼ˆ3dtilesï¼‰çš„æ¡Œé¢ç«¯è½¯ä»¶Oculusï¼Œå¹¶æ¨¡æ‹Ÿç›‘æ§ç”»é¢ä¸è§†é”¥ï¼Œä»¥æ­¤åšåˆ°çœŸå®ç”»é¢ä¸ä¸‰ç»´æ¨¡å‹åŒ¹é…ï¼Œä»è€Œå¾—åˆ°çœŸå®ç”»é¢æ·±åº¦ã€‚</p><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/æ“ä½œè¿‡ç¨‹.gif"/><p>Oculusçš„ä¸»é¡µé¢å¦‚ä¸‹ï¼š<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/ä¸»é¡µ.jpg"/></p><p>é€šè¿‡æŸ¥è¯¢å¹¶ç‚¹å‡»å³ä¾§çš„æ‘„åƒå¤´ä¿¡æ¯æ»šåŠ¨æ æˆ–è€…ç‚¹å‡»å·¦ä¾§åœ°å›¾ä¸­çš„æ‘„åƒå¤´å›¾æ ‡ï¼Œå¯ä»¥ç´¢å¼•åˆ°è¯¥æ‘„åƒå¤´çš„ä½ç½®ï¼Œå¹¶åœ¨åœ°å›¾å³ä¸Šè§’å¼¹å‡ºå…·ä½“ä¿¡æ¯ï¼Œè½¯ä»¶å³ä¸Šè§’å‡ºç°æ‘„åƒå¤´ç”»é¢ã€‚</p><p>ç»§ç»­ç‚¹å‡»å³ä¾§æ çš„ç›¸åº”æ‘„åƒå¤´ç¼–è¾‘æŒ‰é’®ï¼Œæ‰“å¼€ç¼–è¾‘çª—å£å¦‚ä¸‹ã€‚<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/è§†é”¥ç”»é¢.png"/></p><p>å·¦ä¾§ä¸ºæ‘„åƒå¤´åŸºç¡€å‚æ•°ç¼–è¾‘åŒºåŸŸï¼ŒåŒ…æ‹¬ç»çº¬åº¦ä¸é«˜ç¨‹ï¼Œèˆªå‘è§’ã€ä¿¯ä»°è§’ï¼Œå‚ç›´è§†åœºè§’ï¼Œå®½é«˜æ¯”ï¼Œè¿œè¿‘å¹³é¢è·ç¦»ã€‚ä¿®æ”¹åï¼Œå³ä¾§è§†é”¥ä¹Ÿä¼šéšç€å‚æ•°å˜åŒ–å®æ—¶æ¸²æŸ“ã€‚</p><p>ç‚¹å‡»åˆ‡æ¢ä¸ºç›‘æ§è§†è§’ï¼Œå³å¯è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿç›‘æ§è§†è§’ç”»é¢ï¼Œé€šè¿‡è°ƒæ•´å‚æ•°ï¼Œè¾¾åˆ°å’Œç›‘æ§ç”»é¢å‡ ä¹ä¸€æ ·çš„è§†åŸŸï¼ŒåŒæ—¶ï¼Œä¸ºäº†è¾…åŠ©å¯¹æ¯”ï¼ŒçœŸå®ç”»é¢ä¸æ¨¡æ‹Ÿç”»é¢ç›¸åº”çš„ä½ç½®å­˜åœ¨äº”ä¸ªè¾…åŠ©é”šå®šç‚¹ã€‚<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/æ¨¡æ‹Ÿç”»é¢.png"/></p><p>åœ¨è°ƒæ•´å¥½å‚æ•°åï¼Œå¯ä»¥ç‚¹å‡»ç”Ÿæˆç¨€ç–æ·±åº¦æŒ‰é’®ï¼Œè½¯ä»¶å°†é€‰å–ç”»é¢ä¸Š2000ä¸ªç‚¹ï¼Œè®¡ç®—å…¶çœŸå®çš„ä¸‰ç»´åæ ‡ï¼Œå¹¶ä¸‹è½½ï¼ŒåŒæ—¶ä¸‹è½½çš„è¿˜æœ‰çœŸå®æ‘„åƒå¤´ç”»é¢ã€‚<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/æ·±åº¦æ ‡å®š.png"/></p><p>ä¸ºäº†æ£€æµ‹ç”Ÿæˆçš„ç‚¹æ˜¯å¦æ­£ç¡®ï¼Œæˆ‘ä»¬å°†å…¶å€’å…¥cesiumä¸­ï¼ŒåŒæ—¶åŠ è½½å’Œä¸Šæ–‡ç›¸åŒçš„ä¸‰ç»´æ¨¡å‹ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/æ ‡å®šç‚¹01.png"/></p><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/æ ‡å®šç‚¹02.png"/><p>è¿™æ ·çš„æ•ˆæœè¯æ˜ï¼Œæˆ‘ä»¬æ ‡å®šçš„åæ ‡åŸºæœ¬ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œåç»­å¯ä»¥é€šè¿‡é«˜ç¨‹ç­›é€‰zå€¼ï¼Œæˆ–è€…é€šè¿‡åˆ†å¸ƒç­›é€‰ï¼Œä»¥é€‰å–ç¬¦åˆç›®çš„çš„ç‚¹ã€‚<br /><img src="https://atffang.github.io/2025/11/05/åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘/zå€¼åŒºé—´.png"/></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åŸºäºä¸‰ç»´æ¨¡å‹çš„ç›‘æ§ç”»é¢æ¨¡æ‹Ÿä¸æ·±åº¦æ ‡å®šå·¥å…·å¼€å‘ã€‚åŸºäºVue + vite + electron + cesiumçš„æ¡Œé¢ç«¯è½¯ä»¶ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="å·¥å…·" scheme="https://atffang.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Datahader.Networks ç»˜åˆ¶bundling flow</title>
    <link href="https://atffang.github.io/2025/11/01/Datahader.Networks%20%E7%BB%98%E5%88%B6bundling%20flow/"/>
    <id>https://atffang.github.io/2025/11/01/Datahader.Networks%20%E7%BB%98%E5%88%B6bundling%20flow/</id>
    <published>2025-11-01T11:16:07.000Z</published>
    <updated>2026-01-10T14:27:40.383Z</updated>
    
    <content type="html"><![CDATA[<p>Datahader.Networks ç»˜åˆ¶bundling flow</p><span id="more"></span><p>è¯¦ç»†æ–‡æ¡£å‚è§ <a href="https://datashader.org/user_guide/Networks.html">https://datashader.org/user_guide/Networks.html</a></p><p>æˆ‘ä»¬æ›¾ç»ä»‹ç»äº†ç»˜åˆ¶æ™®é€šæµçš„æ–¹å¼ï¼Œå®é™…ä¸Šä»…ä»…æ˜¯åŸºäºè´å¡å°”æ›²çº¿åšäº†æ’å€¼ï¼Œç»˜åˆ¶äº†ç±»ä¼¼äºâ€œé£æœºèˆªçº¿â€çš„æµçº¿ã€‚ä½¿ç”¨ç®€å•çš„arcgisæ’ä»¶ï¼Œä¹Ÿå¯ä»¥ç»˜åˆ¶å¾ˆä¸é”™ç›´è§‚çš„æµå›¾ï¼Œæ¯”å¦‚ä¸‹é¢æˆ‘ç”»çš„ä¸­å›½äººå£æµåŠ¨å›¾ï¼š<br /><img src="https://atffang.github.io/2025/11/01/Datahader.Networks ç»˜åˆ¶bundling flow/ä¸­å›½äººå£æµåŠ¨.png"/></p><p>ä½†æ˜¯è¿™ç§æµç»˜åˆ¶æ–¹å¼è™½ç„¶æœ€ä¸ºç›´è§‚ã€è¡¨è¾¾æœ€ä¸ºå‡†ç¡®ï¼Œä½†æœ‰æ—¶å€™ï¼ˆç‰¹åˆ«æ˜¯è¾¹æƒå·®å¼‚ä¸å¤§çš„æ—¶å€™ï¼‰åƒè¿›äº†ç›˜ä¸æ´ï¼Œä»å›¾ä¸Šæ— æ³•æç‚¼å‡ºå¤ªå¤šçš„ä¿¡æ¯ï¼Œå› æ­¤ï¼Œç”²æ–¹è¦æ±‚æˆ‘å¯¹å°çº¢ä¹¦ä¸Šä¸€ä¸ªåšä¸»ç»˜åˆ¶çš„å…·æœ‰èšé›†æ•ˆåº”çš„æµå›¾è¿›è¡Œå¤ç°ï¼Œæˆ‘å…ˆè¯•äº†jsåº“d3:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">generateSegments</span>(<span class="params">nodes, links</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> bundle = &#123; <span class="attr">nodes</span>: [], <span class="attr">links</span>: [], <span class="attr">paths</span>: [] &#125;;</span><br><span class="line">  bundle.<span class="property">nodes</span> = nodes.<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> &#123; d.<span class="property">fx</span> = d.<span class="property">x</span>; d.<span class="property">fy</span> = d.<span class="property">y</span>; <span class="keyword">return</span> d; &#125;);</span><br><span class="line"></span><br><span class="line">  links.<span class="title function_">forEach</span>(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> length = <span class="title function_">distance</span>(d.<span class="property">source</span>, d.<span class="property">target</span>);</span><br><span class="line">    <span class="keyword">let</span> total = <span class="title class_">Math</span>.<span class="title function_">round</span>(scales.<span class="title function_">segments</span>(length));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> xscale = d3.<span class="title function_">scaleLinear</span>().<span class="title function_">domain</span>([<span class="number">0</span>, total + <span class="number">1</span>]).<span class="title function_">range</span>([d.<span class="property">source</span>.<span class="property">x</span>, d.<span class="property">target</span>.<span class="property">x</span>]);</span><br><span class="line">    <span class="keyword">let</span> yscale = d3.<span class="title function_">scaleLinear</span>().<span class="title function_">domain</span>([<span class="number">0</span>, total + <span class="number">1</span>]).<span class="title function_">range</span>([d.<span class="property">source</span>.<span class="property">y</span>, d.<span class="property">target</span>.<span class="property">y</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> source = d.<span class="property">source</span>;</span><br><span class="line">    <span class="keyword">let</span> local = [source];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt;= total; j++) &#123;</span><br><span class="line">      <span class="keyword">let</span> target = &#123; <span class="attr">x</span>: <span class="title function_">xscale</span>(j), <span class="attr">y</span>: <span class="title function_">yscale</span>(j) &#125;;</span><br><span class="line">      local.<span class="title function_">push</span>(target);</span><br><span class="line">      bundle.<span class="property">nodes</span>.<span class="title function_">push</span>(target);</span><br><span class="line">      bundle.<span class="property">links</span>.<span class="title function_">push</span>(&#123; source, target &#125;);</span><br><span class="line">      source = target;</span><br><span class="line">    &#125;</span><br><span class="line">    local.<span class="title function_">push</span>(d.<span class="property">target</span>);</span><br><span class="line">    bundle.<span class="property">links</span>.<span class="title function_">push</span>(&#123; source, <span class="attr">target</span>: d.<span class="property">target</span> &#125;);</span><br><span class="line">    bundle.<span class="property">paths</span>.<span class="title function_">push</span>(local);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> bundle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚å®ç°äº†ä¸‹é¢çš„åœºæ™¯ï¼š<br /><img src="https://atffang.github.io/2025/11/01/Datahader.Networks ç»˜åˆ¶bundling flow/js.png"/></p><p>ä¸è¿‡è¿™ç§ç»˜åˆ¶æ–¹æ³•ä»ç„¶æ— æ³•è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œé‚æŠ›å¼ƒä¹‹ï¼Œæ‰¾åˆ°äº†è¯¥åšä¸»å¤„ç†æµæ•°æ®çš„åº“ï¼š<strong>datashader</strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è®²è®²å¦‚ä½•åˆ©ç”¨datashader.Networksè¿›è¡Œç»˜åˆ¶ï¼Œå…ˆçœ‹çœ‹user guideä¸­å¯¹è¯¥éƒ¨åˆ†çš„ç®€ä»‹ï¼š</p><p>The point and line-segment plotting provided by Datashader can be put together in different ways to visualize specific types of data. For instance, network graph data, i.e., networks of nodes connected by edges, can very naturally be represented by points and lines. Here we will show examples of using Datashaderâ€™s graph-specific plotting tools, focusing on how to visualize very large graphs while allowing any portion of the rendering pipeline to replaced with components suitable for specific problems.</p><p>Datashader ä½¿ç”¨ <strong>Hammer et al. (2009)</strong> æå‡ºçš„ â€œForce-Directed Edge Bundling (FDEB)â€ ç®—æ³•çš„æ”¹è¿›ç‰ˆï¼Œè®©ç›¸ä¼¼æˆ–ç©ºé—´ä¸Šé‚»è¿‘çš„è¾¹â€œé æ‹¢â€æˆå¹³æ»‘çš„æµçº¿ï¼ˆbundlesï¼‰ï¼Œæ—¢ä¿æŒç»“æ„å…³ç³»ï¼Œåˆæå‡å¯è¯»æ€§ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¯¹äºæ¯æ¡è¾¹ï¼Œä»–ä»¬ä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªå°æ®µï¼ˆsegmentsï¼‰ï¼Œæ¯ä¸ª segment æ˜¯ä¸€ä¸ªå¯ç§»åŠ¨çš„æ§åˆ¶ç‚¹ã€‚æ¯ä¸ªæ§åˆ¶ç‚¹ä¼šå—åˆ°å‡ ç§åŠ›çš„ä½œç”¨ï¼š</p><ul><li><ol><li><strong>å†…éƒ¨å¼ åŠ› (Tension)</strong></li></ol></li><li><ol start="2"><li><strong>ç›¸ä¼¼è¾¹å¸å¼•åŠ› (Attractive force)</strong></li></ol></li><li><ol start="3"><li><strong>å¸¦å®½æ§åˆ¶ (Bandwidth)</strong></li></ol></li></ul><p>é€šè¿‡å¤šæ¬¡è¿­ä»£ï¼Œæ–¹æ³•ä½¿å¾—å¸¦å®½é€æ¬¡å˜å°ï¼Œä½¿å¾—æµäº’ç›¸é è¿‘ï¼Œå½¢æˆæŸçŠ¶ç»“æ„ã€‚</p><p>æˆ‘ä»¬æ¥å¤ç°ä¸€ä¸‹user guideæä¾›çš„ç¤ºä¾‹ä»£ç <br />å¯¼å…¥åŒ…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datashader <span class="keyword">as</span> ds</span><br><span class="line"><span class="keyword">import</span> datashader.transfer_functions <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> datashader.layout <span class="keyword">import</span> random_layout, circular_layout, forceatlas2_layout</span><br><span class="line"><span class="keyword">from</span> datashader.bundling <span class="keyword">import</span> connect_edges, hammer_bundle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br></pre></td></tr></table></figure><p>éšæœºç”Ÿæˆè¾¹ä¸èŠ‚ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">n=<span class="number">100</span></span><br><span class="line">m=<span class="number">20000</span></span><br><span class="line"></span><br><span class="line">nodes = pd.DataFrame([<span class="string">&quot;node&quot;</span>+<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)], columns=[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">edges = pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="built_in">len</span>(nodes), size=(m, <span class="number">2</span>)), columns=[<span class="string">&#x27;source&#x27;</span>, <span class="string">&#x27;target&#x27;</span>])</span><br><span class="line"></span><br><span class="line">circular = circular_layout(nodes, uniform=<span class="literal">False</span>)</span><br><span class="line">randomloc = random_layout(nodes)</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¸ƒå±€ä¸å®šä¹‰ä¸€äº›ç»˜åˆ¶å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cvsopts = <span class="built_in">dict</span>(plot_height=<span class="number">400</span>, plot_width=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nodesplot</span>(<span class="params">nodes, name=<span class="literal">None</span>, canvas=<span class="literal">None</span>, cat=<span class="literal">None</span></span>):</span><br><span class="line">    canvas = ds.Canvas(**cvsopts) <span class="keyword">if</span> canvas <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> canvas</span><br><span class="line">    aggregator=<span class="literal">None</span> <span class="keyword">if</span> cat <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> ds.count_cat(cat)</span><br><span class="line">    agg=canvas.points(nodes,<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,aggregator)</span><br><span class="line">    <span class="keyword">return</span> tf.spread(tf.shade(agg, cmap=[<span class="string">&quot;#FF3333&quot;</span>]), px=<span class="number">3</span>, name=name)</span><br><span class="line">    </span><br><span class="line">forcedirected = forceatlas2_layout(nodes, edges)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edgesplot</span>(<span class="params">edges, name=<span class="literal">None</span>, canvas=<span class="literal">None</span></span>):</span><br><span class="line">    canvas = ds.Canvas(**cvsopts) <span class="keyword">if</span> canvas <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> canvas</span><br><span class="line">    <span class="keyword">return</span> tf.shade(canvas.line(edges, <span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>, agg=ds.count()), name=name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">graphplot</span>(<span class="params">nodes, edges, name=<span class="string">&quot;&quot;</span>, canvas=<span class="literal">None</span>, cat=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> canvas <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        xr = nodes.x.<span class="built_in">min</span>(), nodes.x.<span class="built_in">max</span>()</span><br><span class="line">        yr = nodes.y.<span class="built_in">min</span>(), nodes.y.<span class="built_in">max</span>()</span><br><span class="line">        canvas = ds.Canvas(x_range=xr, y_range=yr, **cvsopts)</span><br><span class="line"></span><br><span class="line">    np = nodesplot(nodes, name + <span class="string">&quot; nodes&quot;</span>, canvas, cat)</span><br><span class="line">    ep = edgesplot(edges, name + <span class="string">&quot; edges&quot;</span>, canvas)</span><br><span class="line">    <span class="keyword">return</span> tf.stack(ep, np, how=<span class="string">&quot;over&quot;</span>, name=name)</span><br></pre></td></tr></table></figure><p>ç»˜åˆ¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd = circular</span><br><span class="line">fd = forcedirected</span><br><span class="line"></span><br><span class="line">cd_d = graphplot(cd, connect_edges(cd,edges), <span class="string">&quot;Circular layout&quot;</span>)</span><br><span class="line">fd_d = graphplot(fd, connect_edges(fd,edges), <span class="string">&quot;Force-directed&quot;</span>)</span><br><span class="line">cd_b = graphplot(cd, hammer_bundle(cd,edges), <span class="string">&quot;Circular layout, bundled&quot;</span>)</span><br><span class="line">fd_b = graphplot(fd, hammer_bundle(fd,edges), <span class="string">&quot;Force-directed, bundled&quot;</span>)</span><br><span class="line"></span><br><span class="line">tf.Images(cd_d,fd_d,cd_b,fd_b).cols(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><img src="https://atffang.github.io/2025/11/01/Datahader.Networks ç»˜åˆ¶bundling flow/exam.png"/><p>è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è‡ªå·±çš„æ•°æ®è¿›è¡Œç»˜åˆ¶ã€‚å¿…è¦çš„æ•°æ®åŒ…æ‹¬nodeï¼ˆåŒ…å«nameä¸xyåæ ‡ï¼‰å’Œedgeï¼ˆåŒ…å«ä»£è¡¨odçš„sourceå’Œtargetï¼Œå¯è‡ªè¡Œé€‰æ‹©æ˜¯å¦åŠ ä¸Šweightï¼‰ã€‚<br />å¯¼å…¥åŒ…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> datashader.bundling <span class="keyword">import</span> hammer_bundle</span><br><span class="line"><span class="keyword">import</span> pyproj</span><br><span class="line"><span class="keyword">import</span> geopandas <span class="keyword">as</span> gpd</span><br><span class="line"><span class="keyword">from</span> shapely.geometry <span class="keyword">import</span> LineString</span><br></pre></td></tr></table></figure><p>åŠ è½½æ•°æ®ï¼Œå¹¶æ˜ å°„ä¸€ä¸‹å­—æ®µååˆ°å…¶è¦æ±‚çš„å€¼ï¼Œå¹¶ä¸”æŠ•å½±åæ ‡ä»¥ç»˜åˆ¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å‘çš„è¦ç‚¹ï¼š<br /><strong>node çš„ indexï¼ˆpandas.dataframeçš„indexï¼‰æ‰æ˜¯å’Œ edge çš„ source ä¸ target åŒ¹é…çš„ key ï¼Œè€Œä¸æ˜¯ name å­—æ®µã€‚</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">china_edge = pd.read_csv(<span class="string">&quot;/Users/fangtianyao/Desktop/å…¶ä»–/flowdata/edge_1.csv&quot;</span>)</span><br><span class="line">china_node = pd.read_csv(<span class="string">&quot;/Users/fangtianyao/Desktop/å…¶ä»–/flowdata/node_with_name.csv&quot;</span>)</span><br><span class="line">nodes = china_node[[<span class="string">&#x27;iata&#x27;</span>, <span class="string">&#x27;longitude&#x27;</span>, <span class="string">&#x27;latitude&#x27;</span>]].rename(</span><br><span class="line">    columns=&#123;<span class="string">&#x27;iata&#x27;</span>: <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;longitude&#x27;</span>: <span class="string">&#x27;x84&#x27;</span>, <span class="string">&#x27;latitude&#x27;</span>: <span class="string">&#x27;y84&#x27;</span>&#125;</span><br><span class="line">)</span><br><span class="line">edges = china_edge[[<span class="string">&#x27;origin&#x27;</span>, <span class="string">&#x27;destination&#x27;</span>, <span class="string">&#x27;count&#x27;</span>]].rename(</span><br><span class="line">    columns=&#123;<span class="string">&#x27;origin&#x27;</span>: <span class="string">&#x27;source&#x27;</span>, <span class="string">&#x27;destination&#x27;</span>: <span class="string">&#x27;target&#x27;</span>, <span class="string">&#x27;count&#x27;</span>: <span class="string">&#x27;weight&#x27;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">proj = pyproj.Transformer.from_crs(<span class="string">&quot;EPSG:4326&quot;</span>, <span class="string">&quot;EPSG:3857&quot;</span>, always_xy=<span class="literal">True</span>)</span><br><span class="line">nodes[<span class="string">&#x27;x&#x27;</span>], nodes[<span class="string">&#x27;y&#x27;</span>] = proj.transform(nodes[<span class="string">&#x27;x84&#x27;</span>], nodes[<span class="string">&#x27;y84&#x27;</span>])</span><br><span class="line">layout = nodes.copy()</span><br><span class="line">layout.index = layout[<span class="string">&#x27;name&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">layout.index.name = <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>hammer_bundle</code>è®¡ç®—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundled_edges = hammer_bundle(layout, edges, decay=decay, initial_bandwidth=bw)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>decay</code> å’Œ <code>bw</code> æ˜¯ä¸¤ä¸ª0-1çš„å‚æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆåˆ†åˆ«å–0.5ã€‚</p><p>è®¡ç®—å¾—åˆ°çš„ <code>bundled_edges </code> æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰­æ›²è¿‡åçš„è¾¹çš„æ‰€æœ‰æ„æˆç‚¹çš„dfï¼Œæ¯æ¡è¾¹çš„ç‚¹ä¹‹é—´ç”¨ä¸€ä¸ªç©ºè¡Œç›¸éš”ã€‚æ‰“å°ç»™ä½ çœ‹çœ‹ã€‚</p><table><thead><tr><th></th><th>x</th><th>y</th><th>weight</th></tr></thead><tbody><tr><td>1301138</td><td>1.257390e+07</td><td>2.951534e+06</td><td>7.0</td></tr><tr><td>1301139</td><td>1.258085e+07</td><td>2.914048e+06</td><td>7.0</td></tr><tr><td>1301140</td><td>1.258971e+07</td><td>2.877599e+06</td><td>7.0</td></tr><tr><td>1301141</td><td>1.264494e+07</td><td>2.852891e+06</td><td>7.0</td></tr><tr><td>1301142</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><p>ä¸ºäº†ç»˜åˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥æ•°æ®åˆ›å»º GeoDataFrameï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">lines = []</span><br><span class="line">current_points = []</span><br><span class="line">current_weight = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, row <span class="keyword">in</span> bundled_edges.iterrows():</span><br><span class="line">    <span class="keyword">if</span> pd.isna(row[<span class="string">&#x27;x&#x27;</span>]) <span class="keyword">or</span> pd.isna(row[<span class="string">&#x27;y&#x27;</span>]):</span><br><span class="line">        <span class="comment"># é‡åˆ°ç©ºè¡Œï¼Œç”Ÿæˆä¸Šä¸€æ¡è¾¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(current_points) &gt;= <span class="number">2</span>:</span><br><span class="line">            line = LineString(current_points)</span><br><span class="line">            lines.append(&#123;<span class="string">&#x27;weight&#x27;</span>: current_weight, <span class="string">&#x27;geometry&#x27;</span>: line&#125;)</span><br><span class="line">        current_points = []</span><br><span class="line">        current_weight = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        current_points.append((row[<span class="string">&#x27;x&#x27;</span>], row[<span class="string">&#x27;y&#x27;</span>]))</span><br><span class="line">        <span class="comment"># å‡è®¾ weight ç›¸åŒï¼Œå–ç¬¬ä¸€ä¸ªç‚¹çš„ weight</span></span><br><span class="line">        <span class="keyword">if</span> current_weight <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            current_weight = row[<span class="string">&#x27;weight&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(current_points) &gt;= <span class="number">2</span>:</span><br><span class="line">    line = LineString(current_points)</span><br><span class="line">    lines.append(&#123;<span class="string">&#x27;weight&#x27;</span>: current_weight, <span class="string">&#x27;geometry&#x27;</span>: line&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º GeoDataFrame</span></span><br><span class="line">gdf = gpd.GeoDataFrame(lines, crs=<span class="string">&quot;EPSG:3857&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨è¿™ä¸ªæ•°æ®ç»˜åˆ¶æµåœ¨åœ°å›¾ä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> geopandas <span class="keyword">as</span> gpd</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> shapely.geometry <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">import</span> contextily <span class="keyword">as</span> ctx</span><br><span class="line"></span><br><span class="line">nodes_gdf = gpd.GeoDataFrame(</span><br><span class="line">    nodes,</span><br><span class="line">    geometry=[Point(xy) <span class="keyword">for</span> xy <span class="keyword">in</span> <span class="built_in">zip</span>(nodes[<span class="string">&#x27;x&#x27;</span>], nodes[<span class="string">&#x27;y&#x27;</span>])],</span><br><span class="line">    crs=<span class="string">&quot;EPSG:3857&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">edges_gdf = gdf.copy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—çº¿å®½</span></span><br><span class="line">min_width = <span class="number">0.2</span></span><br><span class="line">max_width = <span class="number">5.0</span></span><br><span class="line">weights = edges_gdf[<span class="string">&#x27;weight&#x27;</span>].astype(<span class="built_in">float</span>)</span><br><span class="line">line_widths = min_width + (weights - weights.<span class="built_in">min</span>()) / (weights.<span class="built_in">max</span>() - weights.<span class="built_in">min</span>()) * (max_width - min_width)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜å›¾</span></span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">12</span>, <span class="number">10</span>), dpi=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»è¾¹</span></span><br><span class="line">edges_gdf.plot(ax=ax, linewidth=line_widths, edgecolor=<span class="string">&#x27;#305669&#x27;</span>, alpha=<span class="number">0.6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»èŠ‚ç‚¹</span></span><br><span class="line">nodes_gdf.plot(ax=ax, color=<span class="string">&#x27;#0C2B4E&#x27;</span>, markersize=<span class="number">15</span>, alpha=<span class="number">0.9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ åº•å›¾</span></span><br><span class="line">ctx.add_basemap(ax, source=ctx.providers.OpenStreetMap.Mapnik, crs=nodes_gdf.crs)</span><br><span class="line"></span><br><span class="line">ax.set_title(<span class="string">&quot;fty&quot;</span>, fontsize=<span class="number">16</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Longitude&quot;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Latitude&quot;</span>)</span><br><span class="line">plt.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://atffang.github.io/2025/11/01/Datahader.Networks ç»˜åˆ¶bundling flow/part.png"/><p>ä¸ºäº†æ¯”è¾ƒä¸åŒ <code>decay</code> å’Œ <code>bw</code> å‚æ•°ç»„åˆçš„æ•ˆæœï¼Œæˆ‘åšäº†ä¸€ä¸ªå°ç»„åˆæµ‹è¯•ï¼Œè¯»è€…å¯ä»¥è‡ªå·±è¿›è¡Œæµ‹è¯•ï¼Œäº¦å¯ä»¥å‚è€ƒä¸‹user guideé‡Œé¢åŸºäºéšæœºæ•°æ®åšçš„æµ‹è¯•ã€‚<br /><img src="https://atffang.github.io/2025/11/01/Datahader.Networks ç»˜åˆ¶bundling flow/final.png"/></p><p>è¿˜æ˜¯ä¸é”™çš„å§ğŸ˜Œ</p><p>æœ€åç»™å‡ºå°è£…å¥½çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºå¯¹ç©ºé—´ç½‘ç»œæ•°æ®æ‰§è¡ŒåŸºäº Hammer ç®—æ³• çš„è¾¹æ†ç»‘ï¼ˆEdge Bundlingï¼‰æ“ä½œï¼Œä»¥å‡å°‘è¾¹çš„è§†è§‰äº¤å‰å¹¶å¢å¼ºæ•´ä½“ç»“æ„çš„ç©ºé—´å¯è¯»æ€§ã€‚<br />è¾“å…¥å‚æ•°<br />â€¢edge_path (str)ï¼šè¾¹æ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œè¦æ±‚ä¸º CSV æ ¼å¼ï¼ŒåŒ…å«æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹åŠæƒé‡ç­‰å­—æ®µã€‚<br />â€¢node_path (str)ï¼šèŠ‚ç‚¹æ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œè¦æ±‚ä¸º CSV æ ¼å¼ï¼ŒåŒ…å«èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†åŠç»çº¬åº¦åæ ‡å­—æ®µã€‚<br />â€¢nodes_id_col (str)ï¼šèŠ‚ç‚¹æ–‡ä»¶ä¸­è¡¨ç¤ºèŠ‚ç‚¹å”¯ä¸€ç¼–å·çš„åˆ—åï¼Œé»˜è®¤ â€œnode_idâ€ <strong>åŠ¡å¿…æ˜¯intç±»å‹ï¼ï¼ï¼</strong>ã€‚<br />â€¢node_lon_col (str)ï¼šèŠ‚ç‚¹ç»åº¦åˆ—åï¼Œé»˜è®¤ â€œlonâ€ã€‚<br />â€¢node_lat_col (str)ï¼šèŠ‚ç‚¹çº¬åº¦åˆ—åï¼Œé»˜è®¤ â€œlatâ€ã€‚<br />â€¢edge_source_col (str)ï¼šè¾¹æ–‡ä»¶ä¸­è¡¨ç¤ºèµ·ç‚¹èŠ‚ç‚¹çš„åˆ—åï¼Œé»˜è®¤ â€œsourceâ€ å’Œä¸Šé¢çš„node_idåŒ¹é…ï¼Œ<strong>åŠ¡å¿…æ˜¯intç±»å‹ï¼ï¼ï¼</strong>ã€‚<br />â€¢edge_target_col (str)ï¼šè¾¹æ–‡ä»¶ä¸­è¡¨ç¤ºç»ˆç‚¹èŠ‚ç‚¹çš„åˆ—åï¼Œé»˜è®¤ â€œtargetâ€ å’Œä¸Šé¢çš„node_idåŒ¹é…ï¼Œ<strong>åŠ¡å¿…æ˜¯intç±»å‹ï¼ï¼ï¼</strong>ã€‚<br />â€¢weight_col (str)ï¼šè¾¹æ–‡ä»¶ä¸­è¡¨ç¤ºæƒé‡ï¼ˆå¦‚æµé‡ã€å¼ºåº¦ï¼‰çš„åˆ—åï¼Œé»˜è®¤ â€œweightâ€ã€‚<br />â€¢decay (float)ï¼šHammer ç®—æ³•çš„è¡°å‡å‚æ•°ï¼Œæ§åˆ¶è¾¹çš„æ”¶æ•›é€Ÿåº¦ï¼ˆ0â€“1ä¹‹é—´ï¼‰ã€‚<br />â€¢bw (float)ï¼šåˆå§‹å¸¦å®½å‚æ•°ï¼Œæ§åˆ¶æ†ç»‘çš„ç´§å¯†ç¨‹åº¦ï¼ˆ0â€“1ä¹‹é—´ï¼‰ã€‚<br />â€¢input_crs (str)ï¼šè¾“å…¥æ•°æ®çš„åæ ‡å‚è€ƒç³»ï¼Œé»˜è®¤ â€œEPSG:4326â€ï¼ˆWGS84ï¼‰ã€‚<br />â€¢output (bool)ï¼šæ˜¯å¦è¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤ Trueã€‚<br />â€¢output_format (Literal[â€œgeojsonâ€, â€œshpâ€])ï¼šè¾“å‡ºæ–‡ä»¶æ ¼å¼ï¼Œé»˜è®¤ â€œgeojsonâ€ã€‚<br />â€¢output_path (Optional[str])ï¼šè¾“å‡ºæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œè‹¥ä¸º Noneï¼Œåˆ™ä»…è¿”å›ç»“æœä¸ä¿å­˜ã€‚<br />è¾“å‡ºç»“æœ<br />â€¢è¿”å›å€¼ (geopandas.GeoDataFrame)ï¼š<br />å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«è¾¹æ†ç»‘åå‡ ä½•ç»“æœçš„ GeoDataFrameï¼Œå…¶å±æ€§åŒ…æ‹¬åŸå§‹è¾¹çš„å…¨éƒ¨å­—æ®µåŠå¯¹åº”çš„ç©ºé—´å‡ ä½• (LineString)ã€‚ç»“æœçš„åæ ‡å‚è€ƒç³»ä¸º â€œEPSG:4326â€ï¼Œå¯ç›´æ¥ç”¨äº GIS å¯è§†åŒ–æˆ–ç©ºé—´åˆ†æã€‚<br />è‹¥è®¾ç½® output=Trueï¼Œåˆ™å‡½æ•°è¿˜ä¼šåœ¨æŒ‡å®šè·¯å¾„ä¸‹å¯¼å‡ºç›¸åº”çš„ GeoJSON æˆ– Shapefile æ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> geopandas <span class="keyword">as</span> gpd</span><br><span class="line"><span class="keyword">import</span> pyproj</span><br><span class="line"><span class="keyword">from</span> datashader.bundling <span class="keyword">import</span> hammer_bundle</span><br><span class="line"><span class="keyword">from</span> shapely.geometry <span class="keyword">import</span> LineString</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">perform_edge_bundling</span><span class="params">(</span></span><br><span class="line"><span class="params">    edge_path: str,</span></span><br><span class="line"><span class="params">    node_path: str,</span></span><br><span class="line"><span class="params">    nodes_id_col: str = <span class="string">&quot;node_id&quot;</span>,</span></span><br><span class="line"><span class="params">    node_lon_col: str = <span class="string">&quot;lon&quot;</span>,</span></span><br><span class="line"><span class="params">    node_lat_col: str = <span class="string">&quot;lat&quot;</span>,</span></span><br><span class="line"><span class="params">    edge_source_col: str = <span class="string">&quot;source&quot;</span>,</span></span><br><span class="line"><span class="params">    edge_target_col: str = <span class="string">&quot;target&quot;</span>,</span></span><br><span class="line"><span class="params">    weight_col: str = <span class="string">&quot;weight&quot;</span>,</span></span><br><span class="line"><span class="params">    decay: <span class="type">float</span> = <span class="number">0.5</span>,</span></span><br><span class="line"><span class="params">    bw: <span class="type">float</span> = <span class="number">0.5</span>,</span></span><br><span class="line"><span class="params">    input_crs: str = <span class="string">&quot;EPSG:4326&quot;</span>,</span></span><br><span class="line"><span class="params">    output: bool = True,</span></span><br><span class="line"><span class="params">    output_format: Literal[<span class="string">&quot;geojson&quot;</span>, <span class="string">&quot;shp&quot;</span>] = <span class="string">&quot;geojson&quot;</span>,</span></span><br><span class="line"><span class="params">    output_path: Optional[str] = None,</span></span><br><span class="line"><span class="params">)</span> -&gt; gpd.GeoDataFrame:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Perform force-directed edge bundling using the Hammer algorithm</span></span><br><span class="line"><span class="string">    on spatial graph data, and export the result as a geospatial file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    edge_path : str</span></span><br><span class="line"><span class="string">        Path to the CSV file containing edge data.</span></span><br><span class="line"><span class="string">    node_path : str</span></span><br><span class="line"><span class="string">        Path to the CSV file containing node data.</span></span><br><span class="line"><span class="string">    nodes_id_col : str, default &quot;node_id&quot;</span></span><br><span class="line"><span class="string">        Column name for node identifiers in the node CSV.</span></span><br><span class="line"><span class="string">    node_lon_col : str, default &quot;lon&quot;</span></span><br><span class="line"><span class="string">        Column name for node longitude.</span></span><br><span class="line"><span class="string">    node_lat_col : str, default &quot;lat&quot;</span></span><br><span class="line"><span class="string">        Column name for node latitude.</span></span><br><span class="line"><span class="string">    edge_source_col : str, default &quot;source&quot;</span></span><br><span class="line"><span class="string">        Column name for edge source node ID.</span></span><br><span class="line"><span class="string">    edge_target_col : str, default &quot;target&quot;</span></span><br><span class="line"><span class="string">        Column name for edge target node ID.</span></span><br><span class="line"><span class="string">    weight_col : str, default &quot;weight&quot;</span></span><br><span class="line"><span class="string">        Column name for edge weights.</span></span><br><span class="line"><span class="string">    decay : float, default 0.5</span></span><br><span class="line"><span class="string">        Decay parameter of the hammer_bundle algorithm (0 &lt; decay &lt; 1).</span></span><br><span class="line"><span class="string">    bw : float, default 0.5</span></span><br><span class="line"><span class="string">        Initial bandwidth parameter of hammer_bundle (controls bundle tightness).</span></span><br><span class="line"><span class="string">    input_crs : str, default &quot;EPSG:4326&quot;</span></span><br><span class="line"><span class="string">        Coordinate reference system (CRS) of the input node coordinates.</span></span><br><span class="line"><span class="string">        Usually &quot;EPSG:4326&quot; for WGS84 or &quot;EPSG:3857&quot; for Web Mercator.</span></span><br><span class="line"><span class="string">    output : bool, default True</span></span><br><span class="line"><span class="string">        Whether to save the output file.</span></span><br><span class="line"><span class="string">    output_format : &#123;&quot;geojson&quot;, &quot;shp&quot;&#125;, default &quot;geojson&quot;</span></span><br><span class="line"><span class="string">        Desired output file format.</span></span><br><span class="line"><span class="string">    output_path : str, optional</span></span><br><span class="line"><span class="string">        Path to save the output file. If None, the file will not be written.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    gdf : geopandas.GeoDataFrame</span></span><br><span class="line"><span class="string">        GeoDataFrame containing bundled edge geometries and their weights,</span></span><br><span class="line"><span class="string">        projected in WGS84 (EPSG:4326).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises</span></span><br><span class="line"><span class="string">    ------</span></span><br><span class="line"><span class="string">    FileNotFoundError</span></span><br><span class="line"><span class="string">        If either `edge_path` or `node_path` does not exist.</span></span><br><span class="line"><span class="string">    ValueError</span></span><br><span class="line"><span class="string">        If required columns are missing in the provided CSVs.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[1/6] è¯»å–èŠ‚ç‚¹ä¸è¾¹æ–‡ä»¶...&quot;</span>)</span><br><span class="line">    edges = pd.read_csv(edge_path)</span><br><span class="line">    edges_copy = copy.deepcopy(edges)</span><br><span class="line">    nodes = pd.read_csv(node_path)</span><br><span class="line"></span><br><span class="line">    print(f<span class="string">&quot;èŠ‚ç‚¹æ•°: &#123;len(nodes)&#125;, è¾¹æ•°: &#123;len(edges)&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[2/6] æ£€æŸ¥è¾“å…¥å­—æ®µæœ‰æ•ˆæ€§...&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> col in [nodes_id_col, node_lon_col, node_lat_col]:</span><br><span class="line">        <span class="keyword">if</span> col not in nodes.columns:</span><br><span class="line">            raise <span class="title function_">ValueError</span><span class="params">(f<span class="string">&quot;Missing required column &#x27;&#123;col&#125;&#x27; in node file.&quot;</span>)</span></span><br><span class="line">    <span class="keyword">for</span> col in [edge_source_col, edge_target_col, weight_col]:</span><br><span class="line">        <span class="keyword">if</span> col not in edges.columns:</span><br><span class="line">            raise <span class="title function_">ValueError</span><span class="params">(f<span class="string">&quot;Missing required column &#x27;&#123;col&#125;&#x27; in edge file.&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">    edges = edges[[edge_source_col, edge_target_col, weight_col]].rename(</span><br><span class="line">        columns=&#123;edge_source_col: <span class="string">&#x27;source&#x27;</span>, edge_target_col: <span class="string">&#x27;target&#x27;</span>, weight_col: <span class="string">&#x27;weight&#x27;</span>&#125;</span><br><span class="line">    )</span><br><span class="line">    nodes = nodes[[nodes_id_col, node_lon_col, node_lat_col]]</span><br><span class="line"></span><br><span class="line">    edges[<span class="string">&quot;source&quot;</span>] = edges[<span class="string">&quot;source&quot;</span>].astype(<span class="type">int</span>)</span><br><span class="line">    edges[<span class="string">&quot;target&quot;</span>] = edges[<span class="string">&quot;target&quot;</span>].astype(<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[3/6] åæ ‡è½¬æ¢ä¸º EPSG:3857 ...&quot;</span>)</span><br><span class="line">    proj_to_3857 = pyproj.Transformer.from_crs(input_crs, <span class="string">&quot;EPSG:3857&quot;</span>, always_xy=True)</span><br><span class="line">    nodes[<span class="string">&quot;x&quot;</span>], nodes[<span class="string">&quot;y&quot;</span>] = proj_to_3857.transform(nodes[node_lon_col], nodes[node_lat_col])</span><br><span class="line"></span><br><span class="line">    layout = nodes.rename(columns=&#123;nodes_id_col: <span class="string">&quot;name&quot;</span>&#125;)[[<span class="string">&quot;name&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>]]</span><br><span class="line">    layout.index = layout[<span class="string">&quot;name&quot;</span>].astype(<span class="type">int</span>)</span><br><span class="line">    layout.index.name = None</span><br><span class="line"></span><br><span class="line">    <span class="title function_">print</span><span class="params">(<span class="string">&quot;[4/6] æ‰§è¡Œ Hammer è¾¹æ†ç»‘ç®—æ³• ...&quot;</span>)</span></span><br><span class="line">    bundled = hammer_bundle(layout, edges, decay=decay, initial_bandwidth=bw)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;[5/6] æ„é€ æ†ç»‘çº¿æ®µ ...&quot;</span>)</span><br><span class="line">    lines = []</span><br><span class="line">    current_points = []</span><br><span class="line">    edge_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, row in bundled.iterrows():</span><br><span class="line">        <span class="keyword">if</span> pd.isna(row[<span class="string">&quot;x&quot;</span>]) or pd.isna(row[<span class="string">&quot;y&quot;</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="title function_">len</span><span class="params">(current_points)</span> &gt;= <span class="number">2</span> and edge_index &lt; len(edges_copy):</span><br><span class="line">                edge_attrs = edges_copy.iloc[edge_index].to_dict()</span><br><span class="line">                edge_attrs[<span class="string">&quot;geometry&quot;</span>] = LineString(current_points)</span><br><span class="line">                lines.append(edge_attrs)</span><br><span class="line">            current_points = []</span><br><span class="line">            edge_index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            current_points.append((row[<span class="string">&quot;x&quot;</span>], row[<span class="string">&quot;y&quot;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">len</span><span class="params">(current_points)</span> &gt;= <span class="number">2</span> and edge_index &lt; len(edges_copy):</span><br><span class="line">        edge_attrs = edges_copy.iloc[edge_index].to_dict()</span><br><span class="line">        edge_attrs[<span class="string">&quot;geometry&quot;</span>] = LineString(current_points)</span><br><span class="line">        lines.append(edge_attrs)</span><br><span class="line"></span><br><span class="line">    gdf = gpd.GeoDataFrame(lines, crs=<span class="string">&quot;EPSG:3857&quot;</span>)</span><br><span class="line">    gdf = gdf.to_crs(<span class="string">&quot;EPSG:4326&quot;</span>)</span><br><span class="line"></span><br><span class="line">    print(f<span class="string">&quot;ç”Ÿæˆ GeoDataFrameï¼Œå…± &#123;len(gdf)&#125; æ¡è¾¹ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> output:</span><br><span class="line">        print(<span class="string">&quot;[6/6] è¾“å‡ºç»“æœæ–‡ä»¶&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> output_path:</span><br><span class="line">            <span class="keyword">if</span> output_format == <span class="string">&quot;geojson&quot;</span>:</span><br><span class="line">                gdf.to_file(output_path, driver=<span class="string">&quot;GeoJSON&quot;</span>)</span><br><span class="line">            elif output_format == <span class="string">&quot;shp&quot;</span>:</span><br><span class="line">                gdf.to_file(output_path, driver=<span class="string">&quot;ESRI Shapefile&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                raise <span class="title function_">ValueError</span><span class="params">(<span class="string">&quot;Unsupported output format. Use &#x27;geojson&#x27; or &#x27;shp&#x27;.&quot;</span>)</span></span><br><span class="line">            </span><br><span class="line">            print(f<span class="string">&quot;æ–‡ä»¶å·²ä¿å­˜è‡³: &#123;output_path&#125;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;æœªæä¾›è¾“å‡ºè·¯å¾„ï¼Œæœªä¿å­˜æ–‡ä»¶ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> gdf</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Datahader.Networks ç»˜åˆ¶bundling flow&lt;/p&gt;</summary>
    
    
    
    <category term="å·¥å…·" scheme="https://atffang.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>obsidainåŸºäºs3çš„å¤šç«¯åŒæ­¥</title>
    <link href="https://atffang.github.io/2025/10/18/obsidain%E5%9F%BA%E4%BA%8Es3%E7%9A%84%E5%A4%9A%E7%AB%AF%E5%90%8C%E6%AD%A5/"/>
    <id>https://atffang.github.io/2025/10/18/obsidain%E5%9F%BA%E4%BA%8Es3%E7%9A%84%E5%A4%9A%E7%AB%AF%E5%90%8C%E6%AD%A5/</id>
    <published>2025-10-18T13:44:05.000Z</published>
    <updated>2026-01-10T14:27:36.246Z</updated>
    
    <content type="html"><![CDATA[<p>obsidainåŸºäºs3çš„å¤šç«¯åŒæ­¥ã€‚</p><span id="more"></span><p>å®‰åˆ©å¤§å®¶ä¸€ä¸ªobsidianéå¸¸å¥½ç”¨çš„æ’ä»¶ <strong>Remotely save</strong> ï¼Œä»–å¯ä»¥åŸºäºå¤šä¸ªäº‘æœåŠ¡å‚å•†ï¼Œæ¯”å¦‚ onedrive ä¸ google drvie è¿›è¡Œå¤šç«¯åŒæ­¥ï¼Œå°±ä¸éœ€è¦ä¹°obsidianè‡ªå·±çš„äº‘æœåŠ¡äº†ã€‚ä¸è¿‡æˆ‘åœ¨ä½¿ç”¨å­¦æ ¡é‚®ç®±çš„onedriveè¿›è¡ŒéªŒè¯çš„æ—¶å€™å‡ºç°äº†ä¸€äº›é—®é¢˜å¯¼è‡´æ— æ³•ç»§ç»­ï¼Œä¸å¾—å·²ä½¿ç”¨æœ€åŸºç¡€çš„s3æœåŠ¡ã€‚</p><p>é¦–å…ˆï¼Œåœ¨obsidiançš„ç¬¬ä¸‰æ–¹åº“ä»“åº“ä¸­ä¸‹è½½Remotely saveï¼ŒæŸ¥çœ‹å…¶è®¾ç½®ï¼Œåœ¨ç¬¬ä¸€ä¸ªé€‰æ‹©è¿œç¨‹é€‰é¡¹ä¸­å¯ä»¥é€‰æ‹©å¤šç§äº‘å­˜å‚¨çš„æ–¹å¼ï¼Œç”±äºæˆ‘ä½¿ç”¨è‡ªå·±çš„äº‘æœåŠ¡å™¨è¿›è¡Œå­˜å‚¨ä¸åŒæ­¥ï¼Œé€‰æ‹©ç¬¬ä¸€é¡¹S3æˆ–å…¼å®¹S3çš„æœåŠ¡ã€‚</p><p>å­˜å‚¨ä½ç½®æˆ‘ä½¿ç”¨äº†ä¹‹å‰99ä¸€å¹´ä¹°çš„é˜¿é‡Œäº‘æŒ‚å£å¤§å­¦ç”ŸæœåŠ¡å™¨ï¼Œé˜¿é‡Œå¯¹å¤§å­¦ç”Ÿæ²¡å¾—è¯´ï¼Œä»æœåŠ¡å™¨åˆ°å¤§æ¨¡å‹tokené¢åº¦ï¼Œéƒ½å¯¹å­¦ç”Ÿå¼€æ”¾äº†ä¼˜æƒ ç”šè‡³éƒ¨åˆ†å…è´¹çš„ç¦åˆ©ã€‚</p><p>åœ¨linuxäº‘æœåŠ¡å™¨ä¸Šå®‰è£…minioï¼Œå¼€æ”¾9000ç«¯å£ï¼Œå¹¶æ–°å»ºbucketï¼Œä¿å­˜IDå’ŒKeyï¼Œå°†ä¸Šè¿°ä¿¡æ¯å¡«å…¥Remotely saveçš„ï¼ŒåŒ…æ‹¬æœåŠ¡åœ°å€ï¼ˆ<a href="http://xxx.xxx.xxx.xxx:9000">http://xxx.xxx.xxx.xxx:9000</a>ï¼‰ï¼ŒåŒºåŸŸï¼ˆå¡«us-east-1å°±okï¼‰ï¼ŒAccess Key IDï¼ŒSecret Access Keyï¼ŒBucket nameï¼Œç‚¹å‡»æ£€æŸ¥æµ‹è¯•è¿æ¥å³å¯ã€‚</p><p>ç‚¹å‡»Remotely saveçš„åˆ·æ–°æŒ‰é’®ï¼Œå³å¯ä¾¿æ·çš„ä¸Šä¼ æˆ–ä¸‹æ‹‰è¿™ä¸ªä»“åº“äº†ï¼Œè¶…çº§æ–¹ä¾¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é€‰é¡¹ä¸­è®¾ç½®æ‰“å¼€è‡ªåŠ¨æ›´æ–°ï¼Œå…³é—­è‡ªåŠ¨æ›´æ–°å’Œæ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ›´æ–°ã€‚</p><img src="https://atffang.github.io/2025/10/18/obsidainåŸºäºs3çš„å¤šç«¯åŒæ­¥/å¤šç«¯åŒæ­¥.jpg"/>]]></content>
    
    
    <summary type="html">&lt;p&gt;obsidainåŸºäºs3çš„å¤šç«¯åŒæ­¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æˆ–è®¸ç”¨å¾—åˆ°çš„tips" scheme="https://atffang.github.io/categories/%E6%88%96%E8%AE%B8%E7%94%A8%E5%BE%97%E5%88%B0%E7%9A%84tips/"/>
    
    
  </entry>
  
  <entry>
    <title>åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯</title>
    <link href="https://atffang.github.io/2025/08/29/%E5%9F%BA%E4%BA%8EAIS%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E8%88%B9%E8%88%B6%E8%BD%A8%E8%BF%B9%E5%88%86%E6%AE%B5%E5%90%88%E6%88%90%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%B7%AF/"/>
    <id>https://atffang.github.io/2025/08/29/%E5%9F%BA%E4%BA%8EAIS%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E8%88%B9%E8%88%B6%E8%BD%A8%E8%BF%B9%E5%88%86%E6%AE%B5%E5%90%88%E6%88%90%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%B7%AF/</id>
    <published>2025-08-29T02:33:07.000Z</published>
    <updated>2026-01-10T14:27:28.116Z</updated>
    
    <content type="html"><![CDATA[<p>ä»‹ç»ä¸€ä¸‹æœ¬ç§‘æ¯•è®¾é‡Œå…³äºåŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆæˆéƒ¨åˆ†çš„ä¸€ç‚¹æ€è·¯ï¼Œéä¸“ä¸šï¼Œä»…åˆ†äº«</p><span id="more"></span><h3 id="å†™åœ¨å‰é¢"><a class="markdownIt-Anchor" href="#å†™åœ¨å‰é¢"></a> å†™åœ¨å‰é¢</h3><p>å¥‘æœºæ˜¯æˆ‘ä¸€ä½è€å¸ˆæœ€è¿‘ä¸­äº†å…³äºæµ·è¿çš„é¢ä¸Šï¼Œçªç„¶æƒ³èµ·æˆ‘æœ¬ç§‘æ¯•ä¸šè®ºæ–‡åšçš„ä¹Ÿæ˜¯ç›¸å…³çš„æ•°æ®åˆ†æã€‚å½“ç„¶åªæ˜¯ä¸€ç‚¹å¾ˆç®€å•çš„å·¥ä½œï¼Œæ¯•ç«Ÿåªæ˜¯æœ¬ç§‘çš„æ¯•ä¸šè®¾è®¡ã€‚</p><h3 id="aisæ•°æ®è·å–"><a class="markdownIt-Anchor" href="#aisæ•°æ®è·å–"></a> AISæ•°æ®è·å–</h3><p>è‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿï¼ˆAutomatic Identification Systemï¼ŒAISï¼‰æ˜¯å®‰è£…åœ¨èˆ¹èˆ¶ä¸Šçš„ä¸€å¥—è‡ªåŠ¨è¿½è¸ªç³»ç»Ÿï¼Œé€šè¿‡å²¸åŸºæˆ–æ˜ŸåŸºè®¾å¤‡æ¥æ”¶èˆ¹èˆ¶å”¯ä¸€æ ‡è¯†ç¬¦å·ã€åæ ‡ã€ç±»å‹ä»¥åŠèˆªè¡ŒçŠ¶æ€ç­‰æ•°æ®ï¼Œå¹¶ä¸”ç”±è¿ç»­çš„èˆ¹èˆ¶AISæ•°æ®å¯åˆæˆèˆ¹èˆ¶è½¨è¿¹ã€‚</p><p>ç¬¬ä¸€æ­¥æ•°æ®è·å–å°±å¡äº†å¾ˆä¹…ã€‚å®šæ¯•è®¾é¢˜ç›®é‚£ä¼šå„¿ï¼Œå³2023å¹´å†¬å¤©ï¼Œæœ‰å¹¸å‚åŠ äº†ç¬¬ä¸€å±Šçš„ä¿¡æ¯åœ°ç†å­¦å¤§ä¼šï¼Œå¬äº†ä¸‰å››ä¸ªå…³äºAISæ•°æ®å’Œèˆ¹èˆ¶è½¨è¿¹åˆ†æçš„æŠ¥å‘Šï¼Œéƒ½æœ‰æåˆ°ä»–ä»¬è·å–çš„AISæ•°æ®ï¼Œä¸€äº›ç ”ç©¶äººå‘˜æ‰‹é‡Œä¸€å¹´çš„æ•°æ®é‡éƒ½æ˜¯åäº¿çº§åˆ«çš„ï¼Œè®©æˆ‘æœ‰ç§è«åçš„é”™è§‰ï¼Œè§‰å¾—è·å–å±€éƒ¨ä¸€æ®µæ—¶é—´å†…çš„AISæ•°æ®å¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/001.jpg"/><br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/002.jpg"/><br />äº‹å®è¯æ˜ï¼Œæˆ‘æƒ³çš„å¤ªç®€å•äº†ã€‚å…ˆæ˜¯å°è¯•å¯»æ‰¾å¼€æºæ•°æ®æœªæœï¼Œå¼€å§‹å’¨è¯¢æ•°æ®ä¾›åº”å•†ã€‚ä½†æ˜¯è¿™äº›å•†ä¸šå…¬å¸çš„æœåŠ¡å¯¹è±¡ä¸€èˆ¬æ˜¯èˆ¹è¿ç›¸å…³ä¼ä¸šå’Œå°‘é‡çš„ç§‘ç ”äººå‘˜ï¼Œå¯¹æˆ‘è¿™æ ·çš„ä¸ªä½“æˆ·ï¼Œä¸Šåƒä¸Šä¸‡çš„èµ·æ­¥ä»·å°šä¸”ä¸èƒ½æ¥å—ï¼Œä½•å†µæ•°æ®éœ€æ±‚åœ¨èµ·æ­¥ä»·å†…æ— æ³•æ»¡è¶³ã€‚å…œå…œè½¬è½¬åå¤©ï¼Œç»ˆäºè®©æˆ‘æ‰¾åˆ°äº†æ´»è©è¨ç½‘ç«™<a href="https://datalastic.com/">https://datalastic.com/</a></p><p>å…¶å®ä»–ä»¬çš„å®šä»·åŒæ ·è´µçš„ç¦»è°±ï¼Œæœˆè®¢é˜…è´¹ç”¨é«˜è¾¾æ•°åƒæ¬§å…ƒï¼Œä½†ä»–æä¾›äº†ä¸€ä¸ªå‡ åæ¬§å…ƒçš„ä¸€å‘¨ä½“éªŒè®¡åˆ’ï¼Œæˆ‘æ²¡æœ‰çŠ¹è±«å°±ä¹°äº†è¿™æ ¹æ•‘å‘½ç¨»è‰ã€‚æœ‰äº†apiä¸€åˆ‡éƒ½å¥½è¯´ï¼Œå”¯ä¸€çš„é—®é¢˜æ˜¯å…¶ç›¸å…³APIåªèƒ½è¯·æ±‚ä¸€ä¸ªåæ ‡ç‰¹å®šèŒƒå›´å†…çš„AISæ•°æ®ï¼Œè¿™ç»™æ•°æ®è·å–çš„ç­–ç•¥ä¸åæœŸæ•°æ®åˆæˆéƒ½å¢åŠ äº†ä¸å°çš„éš¾åº¦ã€‚æˆ‘åªèƒ½å…ˆå°†ç ”ç©¶åŒºåŸŸåˆ’åˆ†ä¸ºå‡ åä¸ªåœ†ï¼Œåœ¨è·å–è¿™äº›åœ†å¿ƒèŒƒå›´å†…çš„æ•°æ®ã€‚å¤§æ¦‚çˆ¬å–äº†3-4å¤©åï¼Œä»datalasticç½‘ç«™è·å–äº†åŒºåŸŸå†…AISè®°å½•72,9499æ¡ï¼ŒåŒ…å«èˆ¹èˆ¶çš„uuidï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ã€mmsiã€åæ ‡ä»¥åŠé€Ÿåº¦ç­‰æœ‰æ•ˆä¿¡æ¯ï¼Œå¹¶æ±‡æ€»æ•°æ®é›†åŒ…å«çš„èˆ¹èˆ¶ï¼Œè·å–äº†æ¯æ¡èˆ¹èˆ¶çš„å›½ç±ã€ç±»å‹ã€æ’æ°´é‡ç­‰ä¿¡æ¯ï¼Œå…·ä½“ä¸‹è¡¨æ‰€ç¤ºã€‚</p><table><thead><tr><th>AISè®°å½•å­—æ®µ</th><th>AISè®°å½•å­—æ®µå«ä¹‰</th><th><strong>èˆ¹èˆ¶ä¿¡æ¯å­—æ®µ</strong></th><th><strong>èˆ¹èˆ¶ä¿¡æ¯å­—æ®µå«ä¹‰</strong></th></tr></thead><tbody><tr><td>uuid</td><td>é€šç”¨å”¯ä¸€è¯†åˆ«ç </td><td>uuid</td><td>é€šç”¨å”¯ä¸€è¯†åˆ«ç </td></tr><tr><td>lat</td><td>çº¬åº¦ï¼ˆåº¦ï¼‰</td><td>name</td><td>åç§°</td></tr><tr><td>lon</td><td>ç»åº¦ï¼ˆåº¦ï¼‰</td><td>mmsi</td><td>æµ·äº‹æœåŠ¡èº«ä»½ç </td></tr><tr><td>speed</td><td>é€Ÿåº¦ï¼ˆèŠ‚ï¼‰</td><td>imo</td><td>å›½é™…æµ·äº‹ç»„ç»‡å·ç </td></tr><tr><td>course</td><td>èˆªå‘</td><td>country_iso</td><td>æ³¨å†Œå›½ä»£ç </td></tr><tr><td>heading</td><td>èˆ¹é¦–å‘</td><td>type</td><td>ç±»å‹</td></tr><tr><td>destination</td><td>ç›®çš„åœ°</td><td>gross_tonnage</td><td>æ€»å¨ä½</td></tr><tr><td>last_pos_epoch</td><td>æ—¶é—´æˆ³</td><td>deadweight</td><td>æœ€å¤§è½½è¿é‡</td></tr><tr><td>last_pos_utc</td><td>æ—¶é—´æˆ³ï¼ˆä¸–ç•Œæ—¶é—´ï¼‰</td><td>length</td><td>èˆ¹ä½“é•¿åº¦</td></tr><tr><td></td><td></td><td>speed_max</td><td>æœ€å¤§èˆªé€Ÿï¼ˆèŠ‚ï¼‰</td></tr><tr><td>navstat</td><td>å¯¼èˆªçŠ¶æ€</td><td>home_port</td><td>æ³¨å†Œæ¸¯</td></tr><tr><td>distance_nm</td><td>è·ç›®çš„åœ°è·ç¦»ï¼ˆæµ·é‡Œï¼‰</td><td>year_built</td><td>å»ºé€ å¹´ä»½</td></tr><tr><td></td><td></td><td>breadth</td><td>èˆ¹ä½“å®½åº¦</td></tr></tbody></table><p>å¤§æ¦‚åˆ†å¸ƒå¦‚ä¸‹å›¾ï¼š<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/003.jpg"/><br />å°†å…¶æ³¨å…¥æ•°æ®åº“ï¼Œå¹¶é€šè¿‡uuidå­—æ®µä¸èˆ¹èˆ¶ä¿¡æ¯æ•°æ®åº“å»ºç«‹è¿æ¥ã€‚</p><h3 id="èˆ¹èˆ¶è½¨è¿¹åˆæˆ"><a class="markdownIt-Anchor" href="#èˆ¹èˆ¶è½¨è¿¹åˆæˆ"></a> èˆ¹èˆ¶è½¨è¿¹åˆæˆ</h3><p>ç”±äºç”¨äºåˆæˆèˆ¹èˆ¶è½¨è¿¹çš„AISè®°å½•æ—¶é—´è·¨åº¦è¾ƒé•¿ï¼Œç»å¤§å¤šæ•°èˆ¹èˆ¶åœ¨åŒºåŸŸå†…å¹¶ä¸ä»…å®Œæˆäº†ä¸€æ¬¡èˆªè¡Œä»»åŠ¡ï¼Œè€Œæ˜¯æ¶µç›–äº†å¤šæ¡èˆªçº¿ã€‚å› æ­¤ï¼Œé€šè¿‡AISè®°å½•ç›´æ¥åˆæˆçš„èˆ¹èˆ¶è½¨è¿¹å­˜åœ¨èˆªè¿¹å¤æ‚ã€é‡å¤ç­‰é—®é¢˜ã€‚ä¸ºäº†æ›´å¥½åœ°è·å¾—èˆªè¡Œç‰¹å¾ï¼Œç ”ç©¶å°†è½¨è¿¹ä»æ¸¯å£å‡ºå‘ï¼Œç›´è‡³åˆ°è¾¾å¦ä¸€æ¸¯å£çš„èˆªæ®µå®šä¹‰ä¸ºèˆ¹èˆ¶çš„ä¸€æ¡åˆ†æ®µè½¨è¿¹ã€‚è€Œåœ¨ç»™å®šçš„æ—¶é—´å†…ï¼Œå¯èƒ½æ— æ³•æ•æ‰åˆ°ä¸€äº›èˆ¹èˆ¶çš„èµ·å§‹æ¸¯å£æˆ–ç»ˆç‚¹æ¸¯å£ï¼Œå› æ­¤è¢«èµ·å§‹æ—¶é—´æˆ–ç»ˆæ­¢æ—¶é—´æˆªæ–­çš„è½¨è¿¹ï¼Œä¹Ÿè¢«ç§°ä¸ºè¯¥èˆ¹èˆ¶çš„ä¸€æ¡åˆ†æ®µè½¨è¿¹ã€‚</p><p>å› æ­¤ï¼Œé€šè¿‡AISè®°å½•åˆæˆåˆ†æ®µè½¨è¿¹çš„å‰ææ˜¯åŒºåˆ†èˆ¹èˆ¶çš„çŠ¶æ€ï¼Œå³èˆªè¡ŒçŠ¶æ€æˆ–é©»ç•™çŠ¶æ€ã€‚åœ¨æŸä¸€èˆ¹èˆ¶çš„ä¸€ç»„æ ¹æ®æ—¶é—´æ’åºçš„AISè®°å½•ä¸­ï¼Œæœ‰å››ç§å¯èƒ½çš„åˆ†æ®µè½¨è¿¹ï¼š</p><ul><li>ç”±è¯¥ç»„æ•°æ®æœ€æ—©çš„AISè®°å½•ç‚¹å¼€å§‹ï¼Œè‡³ä¸‹ä¸€ä¸ªå¤„äºé©»ç•™çŠ¶æ€çš„AISè®°å½•ç‚¹ç»“æŸçš„åˆ†æ®µè½¨è¿¹ã€‚</li><li>ç”±è¯¥ç»„æ•°æ®æœ€æ—©çš„AISè®°å½•ç‚¹å¼€å§‹ï¼Œè‡³è¯¥ç»„æ•°æ®æœ€æ™šçš„AISè®°å½•ç‚¹ç»“æŸçš„åˆ†æ®µè½¨è¿¹ã€‚</li><li>è¯¥ç»„æŸä¸ªå¤„äºé©»ç•™çŠ¶æ€ï¼Œä¸”ä¸‹ä¸€ä¸ªè®°å½•ç‚¹å¤„äºèˆªè¡ŒçŠ¶æ€çš„AISè®°å½•ç‚¹å¼€å§‹ï¼Œè‡³ä¸‹ä¸€ä¸ªå¤„äºé©»ç•™çŠ¶æ€çš„AISè®°å½•ç‚¹ç»“æŸçš„åˆ†æ®µè½¨è¿¹ã€‚</li><li>è¯¥ç»„æŸä¸ªå¤„äºé©»ç•™çŠ¶æ€ï¼Œä¸”ä¸‹ä¸€ä¸ªè®°å½•ç‚¹å¤„äºèˆªè¡ŒçŠ¶æ€çš„AISè®°å½•ç‚¹å¼€å§‹ï¼Œè‡³è¯¥ç»„æ•°æ®æœ€æ™šçš„AISè®°å½•ç‚¹ç»“æŸçš„åˆ†æ®µè½¨è¿¹ã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/004.jpg"/><br />ä¸Šå›¾å±•ç¤ºäº†é€šè¿‡åˆ¤æ–­æŸä¸€èˆ¹èˆ¶AISè®°å½•ç‚¹èˆªè¡ŒçŠ¶æ€ï¼Œä»è€Œåˆæˆèˆ¹èˆ¶åˆ†æ®µè½¨è¿¹çš„æ­¥éª¤ã€‚è™½ç„¶AISè®°å½•æä¾›äº†å¯¼èˆªçŠ¶æ€å­—æ®µï¼Œç”¨ä»¥åˆ¤æ–­èˆ¹èˆ¶æ˜¯å¦å¤„äºèˆªè¡ŒçŠ¶æ€ï¼Œä½†è¯¥å­—æ®µå­˜åœ¨å¤§é‡æ•°æ®ç¼ºå¤±ã€é”™è¯¯é—®é¢˜ã€‚æ­¤å¤–ï¼Œç ”ç©¶è®¤ä¸ºï¼Œè™½ç„¶åœ¨æ¸¯å£é™„è¿‘çš„ä¸Šä¼ çš„AISè®°å½•ç‚¹æ˜¾ç¤ºèˆ¹èˆ¶å¤„äºèˆªè¡ŒçŠ¶æ€ï¼Œä½†è¯¥èˆ¹èˆ¶çš„å®é™…è¡Œä¸ºå¤šè¡¨ç°ä¸ºåœç•™æˆ–åœ¨è¾ƒå°çš„èŒƒå›´å†…å¾˜å¾Šï¼Œå› æ­¤åº”å½“è¢«å½’ç±»ä¸ºé©»ç•™ã€‚å› æ­¤ï¼ŒAISè®°å½•çš„å¯¼èˆªçŠ¶æ€å­—æ®µå¹¶ä¸èƒ½æä¾›å‡†ç¡®çš„åˆ¤åˆ«ä¾æ®ï¼Œç ”ç©¶é‡‡ç”¨æ”¯æŒå‘é‡æœºï¼ˆSupport Vector Machine, ä¸‹æ–‡ç®€ç§°SVMï¼‰æ–¹æ³•åˆ¤å®šAISè®°å½•ç‚¹çš„çŠ¶æ€ã€‚</li></ul><p>SVMæ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå¤„ç†åˆ†ç±»é—®é¢˜çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œç›®æ ‡æ˜¯åœ¨æ•°æ®é›†ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„å†³ç­–è¾¹ç•Œï¼ˆäº¦ç§°ä¸ºè¶…å¹³é¢ï¼‰ï¼Œè¿™ä¸ªå†³ç­–è¾¹ç•Œèƒ½å¤Ÿä»¥æœ€å¤§é—´éš”åˆ†å¼€ä¸åŒç±»åˆ«çš„æ•°æ®ç‚¹ã€‚</p><p>ç”±äºSVMæ˜¯ä¸€ç§ç›‘ç£åˆ†ç±»æ–¹æ³•ï¼Œå› æ­¤ï¼Œç ”ç©¶æ‰‹åŠ¨æ ‡æ³¨äº†2000ä¸ªAISæ•°æ®ç‚¹çš„èˆªè¡ŒçŠ¶æ€ï¼Œå¹¶ä½¿ç”¨åæ ‡ã€èˆªé€Ÿã€èˆªå‘ä»¥åŠèˆ¹é¦–å‘ä½œä¸ºç‰¹å¾å‘é‡ï¼Œä½¿ç”¨70%çš„æ ‡æ³¨æ•°æ®é›†ä½œä¸ºè®­ç»ƒé›†è®­ç»ƒSVMæ¨¡å‹ï¼ŒåŒæ—¶é€šè¿‡æ¯”è¾ƒå‰©ä¸‹30%çš„æ•°æ®æ„æˆçš„æµ‹è¯•é›†æ£€æµ‹å„ä¸ªæ ¸å‡½æ•°çš„åŒºåˆ†æ•ˆæœï¼ŒåŒ…æ‹¬çº¿æ€§æ ¸å‡½æ•°ã€å¤šé¡¹å¼æ ¸å‡½æ•°ã€å¾„å‘åŸºå‡½æ•°æ ¸ä»¥åŠSigmoidæ ¸å‡½æ•°ï¼Œå¹¶ç¡®å®šäº†æœ€ä½³æ ¸å‡½æ•°ã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/005.jpg"/><br />ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œèˆ¹èˆ¶é©»ç•™è®°å½•ç‚¹å¤šèšé›†äºæµ·å²¸æ¸¯å£ï¼Œä¸å®é™…æƒ…å†µç›¸ç¬¦ã€‚ç„¶è€Œï¼Œç”±äºæ¨¡å‹ä»å­˜åœ¨ä¸€äº›è¯¯å·®ï¼Œå¯èƒ½å°†ä¸€äº›å¤„äºèˆªè¡ŒçŠ¶æ€çš„AISè®°å½•ç‚¹è¢«è¯†åˆ«ä¸ºé©»ç•™çŠ¶æ€ï¼Œè€Œä¸€äº›å¤„äºé©»ç•™çŠ¶æ€çš„èˆªè¡Œç‚¹è¢«è¯†åˆ«ä¸ºèˆªè¡ŒçŠ¶æ€ï¼Œå¯¼è‡´åŸæœ¬è¿ç»­çš„èˆªè¡ŒAISè®°å½•è¢«æ‰“æ–­ï¼Œå¯¼è‡´èˆ¹èˆ¶çš„åˆ†æ®µè½¨è¿¹é”™è¯¯åœ°åœ¨è¯¥èŠ‚ç‚¹ä¸Šåˆ†è£‚ï¼Œæˆ–æ˜¯ä»èˆ¹èˆ¶é©»ç•™åœ¨æ¸¯å£åŠå‘¨è¾¹åŒºåŸŸæ—¶è¯†åˆ«å‡ºå¤šä½™è½¨è¿¹ã€‚å› æ­¤ï¼Œç ”ç©¶éœ€è¦è¯†åˆ«å¹¶ä¿®æ­£è¿™äº›é”™è¯¯çš„çŠ¶æ€ç‚¹ã€‚ç ”ç©¶ä½¿ç”¨ä¸€ä¸ªå¤§å°ä¸º3x1çš„æ»‘åŠ¨çª—å£éå†æŒ‰æ—¶é—´æ’åºçš„èˆ¹èˆ¶çŠ¶æ€è®°å½•ç‚¹ï¼Œå¦‚æœçª—å£å†…ç¬¬ä¸€ä¸ªçŠ¶æ€è®°å½•ä¸ç¬¬ä¸‰ä¸ªçŠ¶æ€è®°å½•ç›¸åŒï¼Œä½†ç¬¬äºŒä¸ªçŠ¶æ€è®°å½•ä¸å‰åéƒ½ä¸åŒï¼Œåˆ™ä¿®æ­£è¯¥è®°å½•ã€‚</p><p>åœ¨å®Œæˆæ•°æ®ä¿®æ­£åï¼Œå³å¯åˆæˆèˆ¹èˆ¶è½¨è¿¹,å³åˆ†æ®µçš„åæ ‡æ—¶é—´åºåˆ—ã€‚å›¾ä¸­Â©å±•ç¤ºäº†æŸèˆ¹èˆ¶çš„AISè®°å½•åˆ†æ®µè½¨è¿¹åˆæˆï¼Œåœ¨åˆæˆè¿‡ç¨‹ä¸­ï¼Œç ”ç©¶åˆ é™¤äº†èˆ¹èˆ¶çŠ¶æ€ä¸ºé©»ç•™çš„è®°å½•ï¼Œå¹¶è¿æ¥è¿ç»­çš„èˆ¹èˆ¶çŠ¶æ€ä¸ºèˆªè¡Œçš„è®°å½•ï¼Œå®Œæˆäº†ä¸€æ®µå®Œæ•´è½¨è¿¹çš„åˆ†å‰²ã€‚ä½¿ç”¨è¯¥æ–¹æ³•å®Œæˆ2023å¹´9æœˆ27æ—¥è‡³10æœˆ6æ—¥ï¼Œä»¥åŠ10æœˆ10æ—¥è‡³10æœˆ19æ—¥åŒºåŸŸçš„å…¨éƒ¨AISè®°å½•åˆ†æ®µè½¨è¿¹åˆæˆï¼Œå…¶æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/006.png"/></p><h3 id="èˆ¹èˆ¶è½¨è¿¹å‹ç¼©"><a class="markdownIt-Anchor" href="#èˆ¹èˆ¶è½¨è¿¹å‹ç¼©"></a> èˆ¹èˆ¶è½¨è¿¹å‹ç¼©</h3><p>Douglas-Peuckerç®—æ³•ï¼ˆä»¥ä¸‹ç®€ç§°DPç®—æ³•ï¼‰æ˜¯ä¸€ç§ç”¨äºæ›²çº¿è¿‘ä¼¼å’ŒæŠ½ç¨€çš„ç®—æ³•ã€‚å®ƒçš„ä¸»è¦æ€æƒ³æ˜¯åœ¨ç»™å®šçš„æ›²çº¿ä¸­ï¼Œé€šè¿‡ä¿ç•™ä¸€äº›é‡è¦çš„æ•°æ®ç‚¹ï¼Œæ¥è¿‘ä¼¼è¡¨ç¤ºåŸå§‹æ›²çº¿ï¼Œä»è€Œå®ç°æ›²çº¿çš„ç®€åŒ–ã€‚ç”±äºç ”ç©¶æä¾›çš„è½¨è¿¹æ•°æ®é›†æ•°æ®é‡è¾ƒå¤§ï¼Œè½¨è¿¹èŠ‚ç‚¹è¾ƒå¤šï¼Œå› æ­¤åœ¨è½¨è¿¹èšç±»å‰ï¼Œå¯¹è½¨è¿¹æ•°æ®é›†è¿›è¡Œå‹ç¼©å¤„ç†èƒ½å¤Ÿæœ‰æ•ˆæé«˜èšç±»æ•ˆç‡ï¼Œè€Œå¤§é‡å®éªŒè¯æ˜ï¼ŒDPç®—æ³•é€‚ç”¨äºè½¨è¿¹æ•°æ®çš„å‹ç¼©ã€‚ä¸‹å›¾å±•ç¤ºäº†DPç®—æ³•å¯¹äºä¸€æ¡è½¨è¿¹å‹ç¼©çš„è¿‡ç¨‹ã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/007.png"/><br />DPç®—æ³•çš„åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>åœ¨ç›®æ ‡æ›²çº¿çš„èµ·ç‚¹å’Œç»ˆç‚¹ä¹‹é—´ï¼Œæ‰¾åˆ°ä¸€æ¡ç›´çº¿ï¼Œä½œä¸ºæ›²çº¿çš„åˆå§‹è¿‘ä¼¼ã€‚</li><li>è®¡ç®—å…¶ä»–æ‰€æœ‰ç‚¹åˆ°è¯¥ç›´çº¿çš„è·ç¦»ï¼Œæ‰¾åˆ°è·ç¦»æœ€å¤§çš„ç‚¹ï¼ˆå³å‚ç›´è·ç¦»æœ€å¤§çš„ç‚¹ï¼‰ã€‚</li><li>å¦‚æœè¿™ä¸ªæœ€å¤§è·ç¦»è¶…è¿‡äº†é¢„å…ˆè®¾å®šçš„é˜ˆå€¼ï¼ˆå³æ‰€è°“çš„æŠ½ç¨€é˜ˆå€¼ï¼‰ï¼Œåˆ™å°†è¯¥ç‚¹åŠ å…¥åˆ°ç»“æœé›†åˆä¸­ï¼Œå¹¶å°†æ›²çº¿åˆ’åˆ†ä¸ºä¸¤ä¸ªå­æ›²çº¿ã€‚</li><li>å¯¹ä¸¤ä¸ªå­æ›²çº¿åˆ†åˆ«é€’å½’åœ°åº”ç”¨ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰ç‚¹éƒ½è¢«å¤„ç†å®Œæ¯•ã€‚</li><li></li></ul><p>é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼ŒDPç®—æ³•å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿ç•™æ›²çº¿çš„å½¢çŠ¶ç‰¹å¾ï¼ŒåŒæ—¶å‡å°‘æ•°æ®ç‚¹çš„æ•°é‡ï¼Œä»è€Œå®ç°æ›²çº¿çš„ç®€åŒ–ã€‚DPç®—æ³•çš„é˜ˆå€¼å†³å®šäº†ç®€åŒ–åçš„æ›²çº¿ä¸åŸå§‹æ›²çº¿ä¹‹é—´çš„æœ€å¤§å…è®¸è¯¯å·®ï¼Œæ˜¯å½±å“ç®—æ³•å‹ç¼©ç»“æœçš„å”¯ä¸€å‚æ•°ã€‚</p><p>Zhaoç­‰äººçš„å®éªŒ]è¡¨æ˜ï¼Œå¯¹äºç»Ÿä¸€é˜ˆå€¼å‹ç¼©è€Œè¨€ï¼Œåœ¨ä»¥ä¸€ä¸ªå›ºå®šçš„æ­¥é•¿å¢åŠ é˜ˆå€¼çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨è½¨è¿¹èŠ‚ç‚¹æ•°å˜åŒ–ç‡ç›¸å¯¹è¾ƒä½ã€è¾ƒä¸ºå¹³ç¨³çš„ä¸€å®šèŒƒå›´å†…çš„é˜ˆå€¼ï¼Œå¯¹ç›¸ä¼¼åº¦é‡æ€§èƒ½æœ‰ä¸€å®šç¨‹åº¦çš„æå‡ï¼Œä»–ä»¬ç§°è¯¥èŒƒå›´ä¸ºâ€œç¨³å®šé˜¶æ®µâ€ã€‚ä¸ºæ­¤ï¼Œç ”ç©¶è®¡ç®—äº†0-1000ç±³é˜ˆå€¼èŒƒå›´å†…ï¼Œä»¥10ç±³ä¸ºæ­¥é•¿çš„è½¨è¿¹å¹³å‡èŠ‚ç‚¹æ•°è´Ÿå¢é•¿ç‡ä»¥åŠè½¨è¿¹å¹³å‡é•¿åº¦è´Ÿå¢é•¿ç‡ï¼Œå¾—åˆ°æ•°æ®é›†çš„6ä¸ªâ€œç¨³å®šé˜¶æ®µâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br /><img src="https://atffang.github.io/2025/08/29/åŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆ†æ®µåˆæˆçš„ä¸€ç‚¹æ€è·¯/008.jpg"/><br />ä¸ºäº†å°½å¯èƒ½ä¿å…¨è½¨è¿¹ç»“æ„ï¼Œç ”ç©¶é€‰å–äº†å¤„äºç¬¬ä¸€ä¸ªç¨³å®šé˜¶æ®µçš„å‹ç¼©é˜ˆå€¼350mã€‚åœ¨è¯¥é˜ˆå€¼ä¸‹ï¼Œç»å‹ç¼©ï¼Œæ•°æ®é›†ä¸­æ¯æ¡è½¨è¿¹çš„å¹³å‡èŠ‚ç‚¹æ•°å‡å°‘è‡³åŸæ¥çš„44%ï¼Œä½†å¹³å‡è½¨è¿¹é•¿åº¦ä»ä¿æŒåœ¨åŸæ¥çš„98%ï¼Œè¿™è¯´æ˜è¯¥å‹ç¼©ç®—æ³•åœ¨å¤§å¹…åº¦å‡å°‘è½¨è¿¹èŠ‚ç‚¹æ•°é‡çš„åŒæ—¶ï¼Œè¾ƒå¥½åœ°ä¿å­˜äº†è½¨è¿¹åŸæœ‰çš„å½¢æ€ç‰¹å¾ã€‚</p><h3 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h3><p>ä¸Šè¿°çš„AISæ•°æ®è·å–-åˆ†æ®µè½¨è¿¹åˆæˆ-è½¨è¿¹å‹ç¼©æ„æˆæ˜¯å½“æ—¶æ¯•ä¸šè®¾è®¡çš„æ•°æ®é¢„å¤„ç†éƒ¨åˆ†ï¼Œåç»­ç»§ç»­è¿›è¡Œäº†èšç±»ã€åˆ†æç­‰æ“ä½œï¼Œè¿™éƒ¨åˆ†ä»¥åæœ‰æœºä¼šå†è®²å§ã€‚ç°åœ¨å›çœ‹æˆ‘çš„æ¯•ä¸šè®¾è®¡çš„åç»­éƒ¨åˆ†ä¹Ÿæ˜¯ç¨€å¥‡å¤æ€ªçš„ï¼Œè­¬å¦‚ä¿®æ”¹DTWè·ç¦»è®¡ç®—æ–¹å¼æ¥æ¶ˆé™¤é•¿åº¦å¯¼è‡´çš„ç›¸å…³æ€§ï¼Œç”¨ä¸€å †æ¦‚ç‡åˆ†å¸ƒæ‹Ÿåˆè®¡ç®—æœ€ä¼˜èšç±»å‚æ•°ç­‰ç­‰ï¼Œç°åœ¨è§‰å¾—ä¼¼ä¹ä¸å¤Ÿä¸¥è°¨ï¼Œä½†ä¹Ÿä¸å¤ªæ¸…æ¥šæœ‰ä»€ä¹ˆæ›´å¥½çš„æ”¹è¿›æ–¹æ³•ï¼Œçœ‹æ¥æ°´å¹³æ²¡æœ‰è¿›æ­¥ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»‹ç»ä¸€ä¸‹æœ¬ç§‘æ¯•è®¾é‡Œå…³äºåŸºäºAISæ•°æ®è¿›è¡Œèˆ¹èˆ¶è½¨è¿¹åˆæˆéƒ¨åˆ†çš„ä¸€ç‚¹æ€è·¯ï¼Œéä¸“ä¸šï¼Œä»…åˆ†äº«&lt;/p&gt;</summary>
    
    
    
    <category term="ä½œå“" scheme="https://atffang.github.io/categories/%E4%BD%9C%E5%93%81/"/>
    
    
  </entry>
  
  <entry>
    <title>å®éªŒå®¤å®‰å…¨æ£€æµ‹ç³»ç»Ÿ</title>
    <link href="https://atffang.github.io/2025/07/19/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/"/>
    <id>https://atffang.github.io/2025/07/19/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F/</id>
    <published>2025-07-19T02:25:37.000Z</published>
    <updated>2026-01-10T14:27:32.073Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‚ä¸äº†ä¸€ä¸ªæ¨ªå‘ï¼Œé¡¹ç›®æ¶æ„ä¸åŸºç¡€ä»£ç å¤§æ¦‚ç¨³å®šä¸‹æ¥äº†ï¼Œæµ…æµ…è®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h3 id="å†™åœ¨å‰é¢"><a class="markdownIt-Anchor" href="#å†™åœ¨å‰é¢"></a> å†™åœ¨å‰é¢</h3><p>å®é™…ä¸Šè¿™ä¸ªé¡¹ç›®åœ¨æŠ€æœ¯ä¸Šå¹¶ä¸éš¾ï¼Œç”šè‡³æ¯”è®¸å¤šå·¥ä½œç®€å•çš„å¤šï¼Œä½†è®©äººå¤´ç–¼çš„ä¸»è¦æ˜¯ä¸‰ç‚¹ï¼š</p><ul><li>å…¸å‹å°ä½œåŠåšæ´¾ï¼Œå‰ç«¯ã€æ•°æ®åº“ã€è¯†åˆ«ç³»ç»Ÿã€æ¨¡å‹å…¨è¦åšï¼Œæ²¡æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥</li><li>å†…ç½‘å¼€å‘ï¼Œæµ‹è¯•ä¹Ÿå¾ˆå›°éš¾ï¼Œæ¯å¤©è¦éª‘ä¸ªç”µç“¶è½¦å»update</li><li>éœ€æ±‚å«æ··ä¸æ¸…ï¼Œä¸€ä¼šè¯´ç”¨è¿™ä¸ªä¸€ä¼šè¯´ç”¨é‚£ä¸ªï¼Œä¸ºæ­¤æ¥å…¥æ•°æ®çš„é€»è¾‘æ”¹äº†né</li></ul><h3 id="ç³»ç»Ÿéœ€æ±‚ä¸æ¶æ„"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿéœ€æ±‚ä¸æ¶æ„"></a> ç³»ç»Ÿéœ€æ±‚ä¸æ¶æ„</h3><p>é¢†å¯¼éœ€è¦ä¸€ä¸ªæ¥å…¥ç›‘æ§ç³»ç»Ÿï¼Œå®æ–½ç›‘æµ‹å„ä¸ªå®éªŒå®¤å®éªŒäººå‘˜æ“ä½œè§„èŒƒæ€§ï¼Œå¹¶å½’çº³æ€»ç»“çš„ç³»ç»Ÿï¼Œç°åœ¨å·²åœ¨æ¥å…¥äº†ä¸€ç™¾ä½™ä¸ªç›‘æ§è®¾å¤‡ï¼Œåç»­å°†æ¨å¹¿è‡³ä¸€åƒä½™ä¸ªè®¾å¤‡ï¼Œå…¶å¤§è‡´æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br /><img src="https://atffang.github.io/2025/07/19/å®éªŒå®¤å®‰å…¨æ£€æµ‹ç³»ç»Ÿ/æ¶æ„.png"/><br />æŒ‰ç…§è¯¥æ¶æ„ï¼Œé‡ç‚¹çš„å†…å®¹ä¸ºç›‘æ§è½®è¯¢ä¸å¸§è¯†åˆ«ä¸¤éƒ¨åˆ†ï¼Œç¨‹åºå°†ä»¥è®¾å®šçš„è½®è¯¢é—´éš”ä¾æ¬¡é€šè¿‡å‚å•†æä¾›çš„SDKè®¿é—®æ‘„åƒå¤´å¹¶æˆªå›¾ï¼Œå°†æˆªå›¾ä¸åŒ…æ‹¬æ‘„åƒå¤´åŸºç¡€ä¿¡æ¯ã€æ—¶é—´ç­‰çš„å…ƒæ•°æ®äº¤äºˆæ¶ˆæ¯é˜Ÿåˆ—å¹¶åˆ†å‘ç»™å¤šä¸ªè¯†åˆ«è®¾å¤‡è¿›è¡Œå›¾åƒè¯†åˆ«ã€‚åœ¨è¯•è¿è¡Œç‰ˆæœ¬ä¸­ï¼Œæ•´ä¸ªä½“ç³»éƒ½åœ¨ä¸€å°ä¸€å¼ gpuçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚å›¾åƒè¯†åˆ«å®Œæˆåï¼Œå°†è¯†åˆ«ç»“æœæ±‡æ€»åå­˜å…¥æ•°æ®åº“ä¸­ã€‚</p><h3 id="ä»»åŠ¡æ¨¡å‹è®­ç»ƒ"><a class="markdownIt-Anchor" href="#ä»»åŠ¡æ¨¡å‹è®­ç»ƒ"></a> ä»»åŠ¡æ¨¡å‹è®­ç»ƒ</h3><p>ç”²æ–¹æå‡ºäº†è¯†åˆ«å®éªŒå®¤å®éªŒäººå‘˜ä¸ç©¿ç™½å¤§è¤‚ã€å¤œé—´å•äººåšå®éªŒã€æ¶ˆé˜²é€šé“å ç”¨ã€åºŸæ¶²æ¡¶æ˜¯å¦ç›–ç›–å­ã€é€šé£æ©±å¼€å¯æ˜¯å¦è§„èŒƒç­‰ç­‰ã€‚è¿™äº›éœ€æ±‚æœ‰çš„å¯ä»¥ç›´æ¥è°ƒç”¨YOLOæ¨¡å‹ï¼Œæœ‰çš„åˆ™éœ€è¦è‡ªè¡Œè®­ç»ƒæ¨¡å‹ã€‚</p><p>ä»¥<strong>å®éªŒäººå‘˜ç©¿ç€</strong>ä¸ºä¾‹ï¼Œé¦–å…ˆåŸºäºYOLOv11æ¨¡å‹æå–å¤šå¼ ç›‘æ§æˆªå›¾ä¸­çš„äººç‰©è¾¹æ¡†å¹¶è£å‡ï¼Œä½¿ç”¨è‡ªå·±è®¾è®¡çš„æ ‡æ³¨å·¥å…·è¿›è¡Œæ˜¯å¦ç©¿ç€å®éªŒæœè£…çš„æ­£è´Ÿæ ·æœ¬æ ‡æ³¨ï¼Œçº¦ä¸¤åƒä½™å¼ ã€‚ä½¿ç”¨è¯¥æ•°æ®ï¼ŒåŸºäº<strong>MobileNetV2</strong>æ¨¡å‹è®­ç»ƒæˆ‘ä»¬éœ€æ±‚çš„åˆ†ç±»æ¨¡å‹ã€‚</p><p><strong>MobileNetV2</strong> æ˜¯ Google åœ¨ 2018 å¹´æå‡ºçš„ä¸€ç§è½»é‡çº§å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼Œæˆ‘ä»¬å°†å…¶è¿ç§»è‡³æˆ‘ä»¬çš„ä»»åŠ¡ä¸Šã€‚å…·ä½“ä»»åŠ¡æµç¨‹ä¸è¦ç‚¹å¦‚ä¸‹ï¼š</p><ol><li>æŒ‰ç…§8ï¼š2åˆ’åˆ†æ•°æ®é›†</li><li>åŠ è½½ ImageNet ä¸Šé¢„è®­ç»ƒå¥½çš„æƒé‡</li><li>å°†MobileNetV2 çš„æœ€åä¸€å±‚ <code>nn.Sequential</code>æ›¿æ¢ä¸ºè¾“å‡º 2 ç±»</li><li>ä»»åŠ¡é‡‡ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œ Adamä¼˜åŒ–å™¨ï¼Œè®­ç»ƒ epochs=10, batchsize=32, lr=1e-4<br />æœ€ç»ˆï¼Œåˆ†ç±»æ¨¡å‹çš„Accuracyä¸º0.9850ï¼Œè¾¾åˆ°äº†é¢„æœŸéœ€æ±‚ã€‚</li></ol><p>æ•´ä½“æ¨¡å‹é¦–å…ˆä½¿ç”¨yolo11sè¯†åˆ«äººï¼Œç½®ä¿¡é˜ˆå€¼è®¾ç½®ä¸º0.4ï¼Œéšåä½¿ç”¨è‡ªå·±è®­ç»ƒçš„äºŒåˆ†ç±»æ¨¡å‹è¿›è¡Œæ˜¯å¦ç©¿ç™½å¤§è¤‚çš„åˆ¤åˆ«ï¼Œåœ¨åç»­çš„æµ‹è¯•ä¸­ï¼Œå‘ç°å…¶åŸºæœ¬å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œä½†ä»å¯¹ç©¿ç€ç™½è‰²Tæ¤çš„å®éªŒäººå‘˜æœ‰æ¼æ£€æƒ…å†µï¼Œéœ€è¦åç»­å¯¹æ¨¡å‹è¿›è¡Œæ”¹è¿›ã€‚</p><h3 id="produceræ¨¡å—è®¾è®¡"><a class="markdownIt-Anchor" href="#produceræ¨¡å—è®¾è®¡"></a> Produceræ¨¡å—è®¾è®¡</h3><p>è¯»å–æ•°æ®åº“ä¸­å½“æ—¥éœ€è¦è®¿é—®çš„æ‘„åƒå¤´çš„idï¼ŒåŸºäºæ‘„åƒå¤´å‚å•†æä¾›çš„ç›‘æ§rtspè§†é¢‘æµPython SDKï¼Œè½®è¯¢æ‘„åƒå¤´è·å–rtsp urlã€‚ä¸€å¼€å§‹ä½¿ç”¨opencvé“¾æ¥æµå¹¶æˆªå–å¸§ï¼Œä½†æ˜¯æˆªå–æ•ˆç‡å’Œå†…å­˜å ç”¨éƒ½å¾ˆä¸ç†æƒ³ï¼Œåæ¥å°±ç›´æ¥æ”¹ç”¨äº†<strong>ffmpeg</strong>æˆªå–ï¼Œåœ¨å¤„ç†é€Ÿåº¦å’Œå†…å­˜å ç”¨ä¸Šéƒ½ä¼˜åŒ–äº†è®¸å¤šã€‚</p><p>ç”±äºä»å­˜åœ¨ä¸€å®šçš„ç­‰å¾…æ—¶é—´ï¼Œé‡‡ç”¨çº¿ç¨‹æ± æäº¤ä»»åŠ¡ï¼Œå¤§æ¦‚é€»è¾‘å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨çº¿ç¨‹æ± æäº¤ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">4</span>) <span class="keyword">as</span> executor:</span><br><span class="line">Â  Â  futures = [executor.submit(ffmpeg_cut, *task) <span class="keyword">for</span> task <span class="keyword">in</span> tasks]</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">for</span> future <span class="keyword">in</span> concurrent.futures.as_completed(futures):</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  result = future.result()Â </span><br><span class="line">Â  Â  Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">print</span>(<span class="string">f&quot;Task raised an exception: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨æˆªå–å®Œæˆå›¾åƒåï¼Œä¿å­˜è‡³æœ¬åœ°å¹¶å°†å…ƒæ•°æ®åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡"><a class="markdownIt-Anchor" href="#æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡"></a> æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡</h3><p>åœ¨å•æœºä»»åŠ¡ä¸­ï¼Œä»»åŠ¡é˜Ÿåˆ—ç”±Pythonç»´æŠ¤ï¼Œè®¾è®¡ä¸€ä¸ªPhotoMessageç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoMessage</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        photo_id: å¸§çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆé»˜è®¤ä½¿ç”¨ UUIDï¼‰</span></span><br><span class="line"><span class="string">camera_id: æ‘„åƒå¤´çš„æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="string">room_id: ç‰©ç†ä½ç½®çš„æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="string">photo_path: å¸§åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„æˆ–å†…å­˜å¼•ç”¨</span></span><br><span class="line"><span class="string">timestamp: å¸§çš„æ•è·æ—¶é—´ï¼ˆå¦‚æœæœªæä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰</span></span><br><span class="line"><span class="string">metadata: é™„åŠ çš„å¤„ç†ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚æ¨¡å‹è¾“å‡ºç­‰ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    camera_id: <span class="built_in">str</span></span><br><span class="line">    room_id: <span class="built_in">str</span></span><br><span class="line">    photo_path: Path</span><br><span class="line">    photo_id: <span class="built_in">str</span> = field(default_factory=<span class="keyword">lambda</span>: <span class="built_in">str</span>(uuid.uuid4()))</span><br><span class="line">    timestamp: datetime = field(default_factory=datetime.now)</span><br><span class="line">    metadata: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = field(default_factory=<span class="built_in">dict</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_json</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œæœ‰å¦‚ photo_id æ˜¯è¿è¡Œæ—¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€å€¼ï¼ˆä¸èƒ½æå‰å›ºå®šæˆæŸä¸ªé»˜è®¤å­—ç¬¦ä¸²ï¼‰ã€‚å¦‚æœä½ å†™ photo_id: str = str(uuid.uuid4())ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹è±¡éƒ½ä¼šé»˜è®¤ç”¨<strong>åŒä¸€ä¸ª UUID</strong>ï¼ˆå› ä¸ºé»˜è®¤å€¼åªä¼šåœ¨ç±»å®šä¹‰æ—¶æ±‚ä¸€æ¬¡å€¼ï¼‰ã€‚è€Œdefault_factory ä¼šåœ¨æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶è°ƒç”¨ lambda ç”Ÿæˆæ–°çš„å€¼ã€‚åœ¨ dataclass ä¸­ï¼Œ<strong>å‡¡æ˜¯å¸¦å‰¯ä½œç”¨çš„é»˜è®¤å€¼ï¼ˆå½“å‰æ—¶é—´ã€UUIDã€åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰éƒ½åº”ä½¿ç”¨ default_factory</strong>ï¼Œå¦åˆ™ä¼šå¼•å‘ä¸å¯é¢„æµ‹çš„è¡Œä¸ºæˆ–å…±äº«çŠ¶æ€ã€‚</p><p>ä¸ºäº†è¡¨ç¤ºé˜Ÿåˆ—ï¼Œè®¾è®¡ä¸€ä¸ªGlobalMessageQueueç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GlobalMessageQueue</span>():</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">            cls._instance._queue = queue.LifoQueue(maxsize=<span class="number">10000</span>)</span><br><span class="line">            cls._instance._persist_file = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put_message</span>(<span class="params">self, msg: PhotoMessage</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å­˜å…¥æ¶ˆæ¯åˆ°é˜Ÿåˆ—</span></span><br><span class="line"><span class="string">        :param msg: PhotoMessageå®ä¾‹</span></span><br><span class="line"><span class="string">        :return: æ˜¯å¦æˆåŠŸå…¥é˜Ÿ</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._queue.put_nowait(msg)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> queue.Full:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;WARNING: æ¶ˆæ¯é˜Ÿåˆ—å·²æ»¡ï¼Œä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self._queue.get_nowait()  <span class="comment"># ä¸¢å¼ƒæœ€æ—§æ¶ˆæ¯</span></span><br><span class="line">                self._queue.put_nowait(msg)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_message</span>(<span class="params">self</span>) -&gt; <span class="type">Optional</span>[PhotoMessage]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        éé˜»å¡è·å–æ¶ˆæ¯</span></span><br><span class="line"><span class="string">        :return: PhotoMessageå®ä¾‹æˆ–None</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self._queue.get_nowait()</span><br><span class="line">        <span class="keyword">except</span> queue.Empty:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">persist_messages</span>(<span class="params">self, file_path: Path</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æŒä¹…åŒ–é˜Ÿåˆ—åˆ°ç£ç›˜</span></span><br><span class="line"><span class="string">        :param file_path: å­˜å‚¨æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">        :return: æŒä¹…åŒ–çš„æ¶ˆæ¯æ•°é‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_messages</span>(<span class="params">self, file_path: Path</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ä»ç£ç›˜åŠ è½½æ¶ˆæ¯åˆ°é˜Ÿåˆ—</span></span><br><span class="line"><span class="string">        :param file_path: å­˜å‚¨æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">        :return: åŠ è½½çš„æ¶ˆæ¯æ•°é‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_persist_file</span>(<span class="params">self, file_path: Path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®è‡ªåŠ¨æŒä¹…åŒ–æ–‡ä»¶è·¯å¾„&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ææ„æ—¶è‡ªåŠ¨æŒä¹…åŒ–&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è·å–å½“å‰é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line"><span class="string">        :return: é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„æ•°é‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br></pre></td></tr></table></figure><p>è¯¥ç±» GlobalMessageQueue å®ç°äº†çº¿ç¨‹å®‰å…¨çš„<strong>å…¨å±€å•ä¾‹æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œä½¿ç”¨ LifoQueue å­˜å‚¨ PhotoMessage å®ä¾‹ï¼Œæ”¯æŒæ¶ˆæ¯çš„å…¥é˜Ÿã€å‡ºé˜Ÿã€ç£ç›˜æŒä¹…åŒ–å’ŒåŠ è½½ï¼Œå¹¶åœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨ä¿å­˜é˜Ÿåˆ—å†…å®¹ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</p><p>å½“ç„¶ï¼Œåœ¨å¤šè®¾å¤‡å¹¶è¡Œå¤„ç†ä¸­ï¼Œå¯ä½¿ç”¨Redisä½œä¸ºå¤šè®¾å¤‡å…±äº«çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><h3 id="consumeræ¨¡å—è®¾è®¡"><a class="markdownIt-Anchor" href="#consumeræ¨¡å—è®¾è®¡"></a> Consumeræ¨¡å—è®¾è®¡</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªçˆ¶ç±»BaseModelï¼Œè§„èŒƒäº†æ¨¡å‹å¯¹äºå›¾åƒè¾“å…¥çš„é¢„å¤„ç†æ–¹å¼ã€‚é…ç½®ä»æŒ‡å®šconfigä¸­è¯»å–ï¼Œè§„èŒƒæ¨¡å‹çš„åç§°ã€æƒé‡æ–‡ä»¶ä½ç½®ã€é¢„å¤„ç†æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseModel</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>):</span><br><span class="line">        self.device = torch.device(<span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">        self.name = config[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        self.preprocess = config[<span class="string">&quot;preprocess&quot;</span>]</span><br><span class="line">        self.pipeline = config[<span class="string">&quot;pipeline&quot;</span>]</span><br><span class="line"></span><br><span class="line">        self._build_preprocess_method()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†ç±»</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_preprocess_method</span>(<span class="params">self</span>):</span><br><span class="line">        preprocess = self.preprocess</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">preprocess_image</span>(<span class="params">self, message: PhotoMessage</span>):</span><br><span class="line">            <span class="comment"># è°ƒç”¨_cropå’Œ_resizeçš„é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> image</span><br><span class="line">        </span><br><span class="line">        self.preprocess_image = MethodType(preprocess_image, self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_crop</span>(<span class="params">self, message: PhotoMessage, image: Image.Image</span>):</span><br><span class="line">        <span class="comment"># â€¦â€¦</span></span><br><span class="line">        <span class="keyword">return</span> image</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_resize</span>(<span class="params">self, message: PhotoMessage, image: Image.Image</span>):</span><br><span class="line">        <span class="keyword">return</span> image.resize(self.preprocess[<span class="string">&quot;size&quot;</span>])</span><br></pre></td></tr></table></figure><p>éšåç»§æ‰¿è¯¥ç±»ï¼Œå®šä¹‰ä¸€ä¸ªIdentificationModelå­ç±»ï¼Œæ–°å¢ä¸€ä¸ª_loadmodelåŠŸèƒ½ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªpredictæ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IdentificationModel</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(config)</span><br><span class="line">        self.predict = self._loadmodel()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_loadmodel</span>(<span class="params">self</span>):</span><br><span class="line">        predict = ModelLoader.loader(self.name, self.pipeline, self.device)</span><br><span class="line">        <span class="keyword">return</span> predict</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure><p>ç”±äºå½“å‰æ¨¡å‹éƒ½æš‚æ—¶åªéœ€è¦ä¸€ä¸ªpredictæ–¹æ³•ï¼Œå› æ­¤ï¼Œæš‚æ—¶åªä½¿ç”¨è¯¥å­ç±»ã€‚å¯ä»¥æ³¨æ„åˆ°ï¼ŒIdentificationModelç±»ä½¿ç”¨äº†ä¸€ä¸ªModelLoaderç±»ï¼Œè¯¥ç±»è´Ÿè´£æ¯ä¸ªå…·ä½“çš„è¯†åˆ«æ¨¡å‹çš„predicté€»è¾‘ï¼Œè¿”å›æ¯ä¸ªæ¨¡å‹ä¸­æˆ‘ä»¬éœ€è¦çš„predictå‡½æ•°ï¼Œç”±äºè¿‡äºå†—é•¿ï¼Œä¸åšå±•ç¤ºã€‚</p><p>åŸºäºä¸Šè¿°ç±»ï¼Œconsumerçº¿ç¨‹å¯ä»¥å¾ˆè½»æ¾çš„ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½æ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.modellist = []</span><br><span class="line"><span class="keyword">for</span> config <span class="keyword">in</span> config_list:</span><br><span class="line">    self.modellist.append(IdentificationModel(config))</span><br></pre></td></tr></table></figure><p>å¹¶é€ä¸ªè°ƒç”¨æ¨¡å‹å¯¹å›¾ç‰‡è¿›è¡Œè¯†åˆ«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> model <span class="keyword">in</span> self.modellist:                </span><br><span class="line">    photo = model.preprocess_image(message)</span><br><span class="line">    output = model.predict(message, photo)</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œåœ¨consumerå†…éƒ¨ä¹Ÿé‡‡ç”¨äº†å¤šçº¿ç¨‹çš„è®¾è®¡ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p><h3 id="å­˜å‚¨æ¨¡å—è®¾è®¡"><a class="markdownIt-Anchor" href="#å­˜å‚¨æ¨¡å—è®¾è®¡"></a> å­˜å‚¨æ¨¡å—è®¾è®¡</h3><p>å­˜å‚¨æ¨¡å—è´Ÿè´£å°†è¯†åˆ«ç»“æœæ•´ç†åå­˜å…¥Postgresqlæ•°æ®åº“ï¼Œè¯†åˆ«ç»“æœå›¾ç‰‡å­˜å…¥Minioæ¡¶å®¹å™¨ï¼Œä¹‹é—´é€šè¿‡å”¯ä¸€çš„uuidç›¸å…³è”ï¼Œæ­¤å¤„ä¸å¤šèµ˜è¿°ã€‚</p><h3 id="å®¹å™¨åŒ–éƒ¨ç½²"><a class="markdownIt-Anchor" href="#å®¹å™¨åŒ–éƒ¨ç½²"></a> å®¹å™¨åŒ–éƒ¨ç½²</h3><p>ç”±äºæœ¬é¡¹ç›®æ¶‰åŠåˆ°æ·±åº¦å­¦ä¹ ç¯å¢ƒä»¥åŠredisã€minioã€psqlç­‰å·¥å…·ï¼Œå› æ­¤ï¼Œä½¿ç”¨dockeréƒ¨ç½²æ˜¯æœ€å¿«é€Ÿæœ€å®‰å…¨çš„æ–¹å¼ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå¤§å‘ï¼æˆ‘åŸæœ¬åŸºäºdockerfileæ„å»ºäº†å¸¦cudaé©±åŠ¨ã€nvccã€pythonç¯å¢ƒä»¥åŠffmpegç­‰çš„å®¹å™¨ï¼Œä½†æ˜¯å‘ç°ï¼Œç”±äºwindowsä¸Šçš„dockeræ˜¯æœºé‡wslå®ç°çš„ï¼Œå’Œæœ¬æœºä¹‹é—´å­˜åœ¨ç½‘ç»œçš„éš”ç¦»ï¼Œåœ¨å®¹å™¨å†…è¿è¡Œçš„pythonç¨‹åºè¯»ä¸åˆ°å±€åŸŸç½‘ä¸‹çš„rtspæµã€‚æœ¬äººå½“å³è¡¨ç¤ºçƒ¦ã€‚<br />æ— å¥ˆï¼Œåªèƒ½æš‚æ—¶çº¿æŠŠä¸»è¦ç¨‹åºæ”¾åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼Œredisã€minioã€psqlä½¿ç”¨dockeréƒ¨ç½²ã€‚è¯¥é¡¹ç›®çš„docker-composeå¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_minio</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9001:9001&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINIO_ROOT_USER:</span> <span class="string">minioadmin</span></span><br><span class="line">      <span class="attr">MINIO_ROOT_PASSWORD:</span> <span class="string">minioadmin</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">/data</span> <span class="string">--console-address</span> <span class="string">&quot;:9001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_data:/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio-init:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/mc</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      /bin/sh -c &quot;</span></span><br><span class="line"><span class="string">      sleep 5;</span></span><br><span class="line"><span class="string">      mc alias set local http://minio:9000 minioadmin minioadmin;</span></span><br><span class="line"><span class="string">      mc mb -p local/detection-results;</span></span><br><span class="line"><span class="string">      mc policy set public local/detection-results;</span></span><br><span class="line"><span class="string">      exit 0;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="attr">postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:17</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_postgres</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">labcamera</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5434:5432&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./initdb:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">pgdata:</span></span><br><span class="line">  <span class="attr">minio_data:</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œåœ¨labsecurity_postgreså®¹å™¨ä¸­ï¼Œæˆ‘æŒ‡å®šäº†æ•°æ®åº“åˆå§‹åŒ–çš„æ–‡ä»¶ä½ç½®ï¼Œå³/initdbï¼Œåªè¦åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ”¾ç½®.sqlï¼Œå®¹å™¨åˆå§‹åŒ–æ—¶å³å¯æ ¹æ®è¯¥sqlæ–‡ä»¶å»ºç«‹æ•°æ®åº“ï¼Œä¸è¦å¤ªæ–¹ä¾¿ã€‚è€Œå®¹å™¨é—´ã€å®¿ä¸»æœºå’Œå®¹å™¨é—´ä¹Ÿå¯ä»¥é€šè¿‡ç«¯å£ç›¸äº’è®¿é—®ï¼Œä¾‹å¦‚ï¼Œåœ¨å…¶ä»–å®¹å™¨å†…é€šè¿‡<code>minio:9000</code>ï¼Œåœ¨æœ¬æœºä¸­å¯ä»¥é€šè¿‡<code>http://localhost:9001/</code>è®¿é—®ã€‚</p><p>é€šè¿‡ <code>docker compose up -d</code> å¯ä»¥ä¸€é”®éƒ¨ç½²å®¹å™¨ï¼Œé€šè¿‡ <code>docker ps` -a</code> æŸ¥çœ‹éƒ¨ç½²æƒ…å†µã€‚æ­¤å¤–ï¼ŒæŒ‰ç…§åŸè®¡åˆ’ï¼Œæ·±åº¦å­¦ä¹ ç¯å¢ƒä¹Ÿä¼šéƒ¨ç½²åœ¨å®¹å™¨å†…ï¼Œè¿™é‡Œåšä¸ªè®°å½•ï¼Œé¦–å…ˆï¼Œæ„å»º .Dockerfile:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nvidia/cuda:<span class="number">12.8</span>.<span class="number">0</span>-cudnn-runtime-ubuntu22.<span class="number">04</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y python3 python3-pip</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install torch==2.6.0 torchvision==0.21.0 torchaudio==2.6.0 --index-url https://download.pytorch.org/whl/cu126</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./app /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;main.py&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–‡ä»¶æŒ‡å®šäº†å®‰è£…cudaé©±åŠ¨å’Œpythonï¼Œå¹¶æ ¹æ®requirementså®‰è£…å¥½éœ€è¦çš„pythonåŒ…ã€‚åœ¨docker- composeä¸­åŠ ä¸Šï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span>  </span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">nvidia</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_app</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgres</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./app:/app</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/app</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8888:8888&quot;</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;tail&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;/dev/null&quot;</span>]</span><br></pre></td></tr></table></figure><p>å®¹å™¨èƒ½çœ‹åˆ°æœ¬æœºçš„ <code>./app</code> ç›®å½•ï¼Œç‚¹å‡»vscodeå·¦ä¸‹æ–¹çš„&gt;&lt;ï¼Œé€‰æ‹©Attach to Running Containerï¼Œè¿›å…¥pythonå®¹å™¨ï¼Œå°±å¯ä»¥æ„‰å¿«çš„å¼€å‘äº†ã€‚</p><h3 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h3><p>è¿™ç®—æ˜¯æˆ‘å‚ä¸çš„ç®—æ˜¯æ¯”è¾ƒå®Œæ•´çš„æ¨ªå‘äº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡ä»€ä¹ˆå¥½æ€»ç»“çš„ï¼Œæ‡’å¾—æ€»ç»“ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘å‚ä¸äº†ä¸€ä¸ªæ¨ªå‘ï¼Œé¡¹ç›®æ¶æ„ä¸åŸºç¡€ä»£ç å¤§æ¦‚ç¨³å®šä¸‹æ¥äº†ï¼Œæµ…æµ…è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä½œå“" scheme="https://atffang.github.io/categories/%E4%BD%9C%E5%93%81/"/>
    
    
  </entry>
  
  <entry>
    <title>ä»0å¼€å§‹å­¦java 03 ï¼šè§‚å¯Ÿè€…æ¨¡å¼</title>
    <link href="https://atffang.github.io/2025/07/09/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6java3/"/>
    <id>https://atffang.github.io/2025/07/09/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6java3/</id>
    <published>2025-07-09T08:24:45.000Z</published>
    <updated>2026-01-10T14:21:20.746Z</updated>
    
    <content type="html"><![CDATA[<p>ç”Ÿæ´»æ‰€è¿«å‘€ã€‚</p><span id="more"></span><p><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§<strong>å¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»</strong>ï¼Œä½¿å¾—å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨æ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–°ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿæˆ‘ä»¬æœ‰ä¸‹é¢å‡ ä¸ªåŸå› ï¼š</p><ul><li><strong>è§£è€¦é€šçŸ¥é€»è¾‘</strong>ï¼šè§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š<strong>å‘å¸ƒè€…ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å’Œè®¢é˜…è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰ä¹‹é—´æ˜¯è§£è€¦çš„</strong>ã€‚  å‘å¸ƒè€…æ— éœ€çŸ¥é“è§‚å¯Ÿè€…æ˜¯è°ã€åšä»€ä¹ˆï¼Œåªéœ€è¦åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶â€œé€šçŸ¥å¤§å®¶â€ï¼›è§‚å¯Ÿè€…åˆ™åªå…³å¿ƒâ€œæ˜¯å¦è®¢é˜…äº†è¯¥å¯¹è±¡â€ï¼Œæ— éœ€çŸ¥é“å‘å¸ƒè€…çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>è‡ªåŠ¨é€šçŸ¥ï¼Œé¿å…è½®è¯¢</strong>ï¼šåœ¨æ²¡æœ‰è§‚å¯Ÿè€…æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®©æ¯ä¸ªç»„ä»¶ä¸æ–­æ£€æŸ¥ï¼ˆè½®è¯¢ï¼‰çŠ¶æ€çš„å˜åŒ–ã€‚è¿™ä¸ä»…æ•ˆç‡ä½ï¼Œè¿˜å®¹æ˜“å†™å‡ºé‡å¤ã€æ··ä¹±çš„ä»£ç ã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨æ¶æ„çš„åŸºç¡€</strong>ï¼šç°ä»£å‰åç«¯æ¡†æ¶ï¼ˆå¦‚ Reactã€Vueã€Java Swingã€Springï¼‰ä¸­å¤§é‡ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æˆ–å…¶å˜ç§ï¼ˆå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰æ¥æ„å»ºå“åº”å¼ç³»ç»Ÿã€‚</li></ul><h3 id="ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#ç¤ºä¾‹"></a> ç¤ºä¾‹</h3><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥å®é™…çš„éœ€æ±‚å…¥æ‰‹ï¼Œä¸¾ä¸€ä¸ªæœ€ç»å…¸çš„ä¾‹å­ï¼š</p><p>ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ°”è±¡ç«™ç³»ç»Ÿï¼Œå®ƒèƒ½å®æ—¶ç›‘æµ‹æ¸©åº¦ã€æ¹¿åº¦ã€æ°”å‹ç­‰æ•°æ®ã€‚ç°åœ¨æœ‰å¤šä¸ªå¸ƒå‘Šæ¿ï¼ˆæ˜¾ç¤ºé¢æ¿ï¼‰å¸Œæœ›<strong>è‡ªåŠ¨æ¥æ”¶åˆ°æœ€æ–°çš„å¤©æ°”æ•°æ®å¹¶æ˜¾ç¤º</strong>ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å½“å‰å¤©æ°”å¸ƒå‘Šæ¿ï¼ˆCurrentConditionsDisplayï¼‰</li><li>ç»Ÿè®¡å¸ƒå‘Šæ¿ï¼ˆStatisticsDisplayï¼‰</li><li>é¢„æŠ¥å¸ƒå‘Šæ¿ï¼ˆForecastDisplayï¼‰<br />ä¸€æ—¦æ°”è±¡ç«™æ›´æ–°æ•°æ®ï¼Œ<strong>æ‰€æœ‰å¸ƒå‘Šæ¿éƒ½åº”ç«‹å³æ›´æ–°å¹¶å±•ç¤ºæœ€æ–°ä¿¡æ¯</strong>ã€‚</li></ul><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªè¢«è§‚å¯Ÿè€…æ¥å£<strong>Subject</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer o)</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer o)</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶è§„èŒƒäº†ä¸‰é¡¹åŠŸèƒ½ï¼š</p><ul><li>æ³¨å†Œè§‚å¯Ÿè€…</li><li>åˆ é™¤è§‚å¯Ÿè€…</li><li>é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…</li></ul><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å®šä¹‰å¸ƒå‘Šæ¿è§‚å¯Ÿè€…æ¥å£<strong>Observer</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temp, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢å¤–çš„ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå±•ç¤ºæ¥å£<strong>DisplayElement</strong>ï¼Œå½“å¸ƒå‘Šæ¿éœ€è¦æ˜¾ç¤ºæ—¶ï¼Œè°ƒç”¨æ–¹æ³•<strong>display()</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DisplayElement</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å®Œæ¥å£åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ç±»æ¥å®ç°ä¸»é¢˜äº†ã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå®ç°<strong>è¢«è§‚å¯Ÿè€…</strong>æ¥å£<strong>Subject</strong>çš„ç±»<strong>WeatherData</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherData</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> ArrayList observers;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeatherData</span><span class="params">()</span>&#123;  </span><br><span class="line">        observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerObserver</span><span class="params">(Observer o)</span>&#123;  </span><br><span class="line">        observers.add(o);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer o)</span>&#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> observers.indexOf(o);  </span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>)&#123;  </span><br><span class="line">            observers.remove(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;observers.size(); i++)&#123;  </span><br><span class="line">            <span class="type">Observer</span> <span class="variable">observer</span> <span class="operator">=</span> (Observer) observers.get(i);  </span><br><span class="line">            observer.update(temperature, humidity, pressure);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä¸€æ—¦æ–°æ•°æ®æ¥äº†ï¼Œè°ƒç”¨æ­¤æ–¹æ³•  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMeasurements</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span>&#123;  </span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;  </span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;  </span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;  </span><br><span class="line">        notifyObservers();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšåï¼Œå®šä¹‰<strong>å¸ƒå‘Šæ¿ï¼ˆè§‚å¯Ÿè€…ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CurrentConditionsDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>, DisplayElement &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CurrentConditionsDisplay</span><span class="params">(Subject weatherData)</span> &#123;</span><br><span class="line">        weatherData.registerObserver(<span class="built_in">this</span>); <span class="comment">// æ³¨å†Œè‡ªå·±</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰å¤©æ°”ï¼šæ¸©åº¦ = &quot;</span> + temperature + <span class="string">&quot;Â°Cï¼Œæ¹¿åº¦ = &quot;</span> + humidity + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherStation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WeatherData</span> <span class="variable">weatherData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherData</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">CurrentConditionsDisplay</span> <span class="variable">currentDisplay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CurrentConditionsDisplay</span>(weatherData);</span><br><span class="line"></span><br><span class="line">        weatherData.setMeasurements(<span class="number">30.4f</span>, <span class="number">65.2f</span>, <span class="number">1013.1f</span>);</span><br><span class="line">        weatherData.setMeasurements(<span class="number">28.9f</span>, <span class="number">70.1f</span>, <span class="number">1012.5f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="javaå†…ç½®å†™æ³•"><a class="markdownIt-Anchor" href="#javaå†…ç½®å†™æ³•"></a> javaå†…ç½®å†™æ³•</h3><p>Java åœ¨æ—©æœŸï¼ˆJDK 1.0ï¼‰å°±å†…ç½®äº†å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒï¼š</p><ul><li><code>java.util.Observable</code>ï¼šè¢«è§‚å¯Ÿè€…ï¼ˆSubjectï¼‰</li><li><code>java.util.Observer</code>ï¼šè§‚å¯Ÿè€…ï¼ˆObserverï¼‰</li></ul><p>è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢æ°”è±¡ç«™çš„ä¾‹å­ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ç»§æ‰¿å†…ç½®çš„ç±»<strong>Observable</strong>å®šä¹‰ä¸€ä¸ª<strong>è¢«è§‚å¯Ÿè€…ï¼ˆWeatherDataï¼‰</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Observable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherData</span> <span class="keyword">extends</span> <span class="title class_">Observable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> humidity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMeasurements</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line"></span><br><span class="line">        setChanged(); <span class="comment">// æ ‡è®°çŠ¶æ€å·²æ›´æ–°</span></span><br><span class="line">        notifyObservers(); <span class="comment">// é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ï¼ˆæ— å‚æ•°ç‰ˆæœ¬ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getTemperature</span><span class="params">()</span> &#123; <span class="keyword">return</span> temperature; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getHumidity</span><span class="params">()</span> &#123; <span class="keyword">return</span> humidity; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getPressure</span><span class="params">()</span> &#123; <span class="keyword">return</span> pressure; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>setChanged()</code>æ˜¯ <code>Observable</code> æä¾›çš„æ–¹æ³•ï¼Œ<strong>å¿…é¡»è°ƒç”¨</strong>è¿™ä¸ªæ–¹æ³•ï¼Œå‘Šè¯‰ç³»ç»Ÿâ€œæˆ‘å‡†å¤‡å¥½é€šçŸ¥åˆ«äººäº†â€ã€‚å¦‚æœä¸è°ƒç”¨ <code>setChanged()</code>ï¼Œåç»­çš„ <code>notifyObservers()</code> ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚<br /><code>notifyObservers()</code>ï¼šéå†å½“å‰æ³¨å†Œçš„æ‰€æœ‰è§‚å¯Ÿè€…ï¼ˆé€šè¿‡ <code>addObserver()</code> æ·»åŠ çš„ï¼‰ï¼Œå¹¶ä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„ <code>update()</code> æ–¹æ³•ã€‚é»˜è®¤å‚æ•°ä¸º <code>null</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>notifyObservers(Object arg)</code> ä¼ é€’æ•°æ®ã€‚</p><p>éšåï¼Œç»§æ‰¿å†…ç½®ç±»<strong>Observer</strong>å®šä¹‰ä¸€ä¸ª<strong>è§‚å¯Ÿè€…ï¼ˆå¸ƒå‘Šæ¿ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Observer;</span><br><span class="line"><span class="keyword">import</span> java.util.Observable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CurrentConditionsDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Observable o, Object arg)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> WeatherData) &#123;</span><br><span class="line">            <span class="type">WeatherData</span> <span class="variable">wd</span> <span class="operator">=</span> (WeatherData) o;</span><br><span class="line">            System.out.println(<span class="string">&quot;å½“å‰å¤©æ°”ï¼šæ¸©åº¦ = &quot;</span> + wd.getTemperature() + <span class="string">&quot;Â°Cï¼Œæ¹¿åº¦ = &quot;</span> + wd.getHumidity() + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>update(Observable o, Object arg)</code>ï¼š å½“è¢«è§‚å¯Ÿè€…è°ƒç”¨ <code>notifyObservers()</code> æ—¶ï¼Œ<strong>æ¯ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…çš„ <code>update()</code> æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œ</strong>ã€‚å‚æ•° <code>o</code> æ˜¯è¢«è§‚å¯Ÿè€…å¯¹è±¡æœ¬èº«ï¼ˆå³ <code>WeatherData</code>ï¼‰ã€‚å‚æ•° <code>arg</code> æ˜¯é€šè¿‡ <code>notifyObservers(arg)</code> ä¼ é€’çš„é™„åŠ æ•°æ®ï¼ˆå¦‚æœè°ƒç”¨çš„æ˜¯ <code>notifyObservers()</code>ï¼Œåˆ™ä¸º <code>null</code>ï¼‰ã€‚</p><p>æ³¨å†Œè§‚å¯Ÿè€…ã€æ›´æ–°æ•°æ®ã€è§¦å‘é€šçŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherStation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WeatherData</span> <span class="variable">weatherData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherData</span>();  <span class="comment">// åˆ›å»ºè¢«è§‚å¯Ÿè€…</span></span><br><span class="line">        <span class="type">CurrentConditionsDisplay</span> <span class="variable">display</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CurrentConditionsDisplay</span>(); <span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…</span></span><br><span class="line"></span><br><span class="line">        weatherData.addObserver(display);  <span class="comment">// æ³¨å†Œè§‚å¯Ÿè€…åˆ°è¢«è§‚å¯Ÿè€…å†…éƒ¨åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä¸€æ¬¡å¤©æ°”æ•°æ®æ›´æ–°</span></span><br><span class="line">        weatherData.setMeasurements(<span class="number">25.6f</span>, <span class="number">65.0f</span>, <span class="number">1012.0f</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ Java æä¾›äº†è¿™ä¸ªå†…ç½®æœºåˆ¶ï¼Œä½†å®ƒæœ‰ä¸€äº›æ˜æ˜¾ç¼ºé™·ï¼Œå› æ­¤åœ¨ JDK 9 åå·²æ ‡è®°ä¸ºè¿‡æ—¶ï¼ˆDeprecatedï¼‰ã€‚ ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul><li><code>Observable</code> æ˜¯ä¸€ä¸ªç±»ï¼Œä¸æ˜¯æ¥å£ï¼Œ<strong>é™åˆ¶äº†ç»§æ‰¿</strong>ï¼ˆJava ä¸æ”¯æŒå¤šç»§æ‰¿ï¼‰</li><li>å†…éƒ¨æ–¹æ³•å¦‚ <code>setChanged()</code> å¹¶éè‡ªåŠ¨è°ƒç”¨ï¼Œå®¹æ˜“é—æ¼</li><li><code>update()</code> æ–¹æ³•ä¼ å‚è®¾è®¡ä¸çµæ´»</li><li>ä¸æ”¯æŒæ³›å‹</li></ul><p>å› æ­¤ï¼Œå®é™…ä¸Šç”¨æˆ‘ä»¬ä¸€å¼€å§‹å†™çš„æ–¹å¼è‡ªå®šä¹‰ <code>Subject</code> å’Œ <code>Observer</code> æ¥å£æ˜¯æœ€æ¸…æ™°å’Œé€šç”¨çš„æ–¹å¼ã€‚å“ˆå“ˆã€‚<br />å½“æˆ‘ä»¬åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œé¢ä¸´è¶Šæ¥è¶Šå¤æ‚çš„æ¨¡å—é€šä¿¡ã€å¼‚æ­¥å“åº”ã€æ•°æ®æµå¤„ç†éœ€æ±‚æ—¶ï¼Œä¼ ç»Ÿçš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆæ— è®ºæ˜¯è‡ªå®šä¹‰æ¥å£è¿˜æ˜¯ Java åŸç”Ÿçš„ <code>Observer/Observable</code>ï¼‰éƒ½å¯èƒ½æ˜¾å¾—ä¸å¤Ÿçµæ´»ã€ä¸å¤Ÿå¼ºå¤§ï¼Œå¯èƒ½éœ€è¦æ¶‰åŠåˆ°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–å“åº”å¼ç¼–ç¨‹ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šè®²åˆ°ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç”Ÿæ´»æ‰€è¿«å‘€ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ -java" scheme="https://atffang.github.io/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-java/"/>
    
    
  </entry>
  
  <entry>
    <title>è¿›ç¨‹å®ˆæŠ¤</title>
    <link href="https://atffang.github.io/2025/07/08/%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4/"/>
    <id>https://atffang.github.io/2025/07/08/%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4/</id>
    <published>2025-07-08T07:34:03.000Z</published>
    <updated>2026-01-10T14:27:23.716Z</updated>
    
    <content type="html"><![CDATA[<p>æŒä¹…åŒ–çš„pythonæœåŠ¡</p><span id="more"></span><p><strong>è¿›ç¨‹å®ˆæŠ¤</strong>æŒ‡çš„æ˜¯è®©ä¸€ä¸ªç¨‹åº<strong>åœ¨åå°æŒç»­è¿è¡Œ</strong>ï¼Œ<strong>å…·æœ‰è‡ªæˆ‘æ¢å¤èƒ½åŠ›</strong>ï¼ˆå´©æºƒè‡ªåŠ¨é‡å¯ï¼‰ï¼Œ<strong>éšç³»ç»Ÿå¯åŠ¨è‡ªåŠ¨å¯åŠ¨</strong>ï¼Œå¹¶å¯é€šè¿‡å‘½ä»¤è¿›è¡Œæ§åˆ¶ã€‚</p><h3 id="1-linuxä¸‹systemd-æŒä¹…å®ˆæŠ¤-python-ç¨‹åº"><a class="markdownIt-Anchor" href="#1-linuxä¸‹systemd-æŒä¹…å®ˆæŠ¤-python-ç¨‹åº"></a> 1. linuxä¸‹systemd æŒä¹…å®ˆæŠ¤ Python ç¨‹åº</h3><p>åˆ›å»ºsystemdæœåŠ¡é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/systemd/system/myscript.service</span><br></pre></td></tr></table></figure><p>å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Persistent Python Script</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/python3 /home/user/run_my_job.py</span><br><span class="line">WorkingDirectory=/home/user</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line">User=your_linux_username</span><br><span class="line">StandardOutput=append:/var/log/myscript.log</span><br><span class="line">StandardError=append:/var/log/myscript.err</span><br><span class="line">Environment=PYTHONUNBUFFERED=1</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reexec</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable myscript.service</span><br><span class="line">sudo systemctl start myscript.service</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—å’ŒçŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status myscript.service</span><br><span class="line">sudo <span class="built_in">tail</span> -f /var/log/myscript.log</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤è¿›è¡Œæ§åˆ¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop myscript.service</span><br><span class="line">sudo systemctl restart myscript.service</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> myscript.service</span><br></pre></td></tr></table></figure><h3 id="2-è·¨å¹³å°pythonè¿›ç¨‹ç®¡ç†å·¥å…·supervisord"><a class="markdownIt-Anchor" href="#2-è·¨å¹³å°pythonè¿›ç¨‹ç®¡ç†å·¥å…·supervisord"></a> 2. è·¨å¹³å°pythonè¿›ç¨‹ç®¡ç†å·¥å…·supervisord</h3><p><strong>supervisord</strong> æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œ å®ƒå¯ä»¥ç›‘æ§ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯ä½ pythonè„šæœ¬åœ¨å†…çš„è¿›ç¨‹ã€‚å¯ä»¥ç›´æ¥åˆ©ç”¨pipä¸‹è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure><p>Supervisor ç”±ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š</p><ul><li>supervisordå®ˆæŠ¤è¿›ç¨‹ï¼šè´Ÿè´£è¯»å–é…ç½®ã€å¯åŠ¨/ç›‘æ§ä»»åŠ¡</li><li>supervisorctlå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šç”¨äºæŸ¥çœ‹çŠ¶æ€ã€é‡å¯ä»»åŠ¡ç­‰</li></ul><p>ä½¿ç”¨æ—¶ï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; supervisord.conf</span><br></pre></td></tr></table></figure><p>å°†éœ€è¦å®ˆæŠ¤çš„è¿›ç¨‹æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:my_script]</span></span><br><span class="line"><span class="attr">command</span>=python3 /home/user/scripts/my_script.py</span><br><span class="line"><span class="attr">directory</span>=/home/user/scripts</span><br><span class="line"><span class="attr">autostart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">autorestart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">startsecs</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">stdout_logfile</span>=/var/log/my_script.out.log</span><br><span class="line"><span class="attr">stderr_logfile</span>=/var/log/my_script.err.log</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>command</td><td>è¦æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td>directory</td><td>å·¥ä½œç›®å½•</td></tr><tr><td>autostart</td><td>å¯åŠ¨ supervisord æ—¶è‡ªåŠ¨å¯åŠ¨</td></tr><tr><td>autorestart</td><td>å¼‚å¸¸é€€å‡ºåæ˜¯å¦è‡ªåŠ¨é‡å¯</td></tr><tr><td>startsecs</td><td>å¯åŠ¨åè¿è¡Œå¤šå°‘ç§’æ‰ç®—æˆåŠŸ</td></tr><tr><td>stdout_logfile</td><td>æ ‡å‡†è¾“å‡ºæ—¥å¿—è·¯å¾„</td></tr><tr><td>stderr_logfile</td><td>é”™è¯¯æ—¥å¿—è·¯å¾„</td></tr><tr><td>å¯åŠ¨supervisordå®ˆæŠ¤è¿›ç¨‹ï¼š</td><td></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c supervisord.conf</span><br></pre></td></tr></table></figure><p>å’Œsystemdä¸€æ ·ï¼Œsupervisordä¹Ÿæœ‰ä¸€äº›ç®¡ç†ä»»åŠ¡çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c supervisord.conf status</span><br><span class="line">supervisorctl -c supervisord.conf restart my_script</span><br><span class="line">supervisorctl -c supervisord.conf stop my_script</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åˆ©ç”¨supervisordè¿›è¡Œä¸åŒgpuä»»åŠ¡åˆ†å‘ï¼Œä¸åŒgpuä¸Šè¿è¡Œä¸åŒè¿›ç¨‹å¹¶å®ˆæŠ¤çš„éªšæ“ä½œï¼Œé¦–å…ˆï¼Œåœ¨ä½ çš„æ¨¡å‹ä»»åŠ¡ä»£ç ä¸­åŠ ä¸Šé€šè¿‡å‚æ•°æŒ‡å®šgpuçš„é€»è¾‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&#x27;--gpu&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">f&quot;cuda:<span class="subst">&#123;args.gpu&#125;</span>&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">model.to(device)</span><br></pre></td></tr></table></figure><p>ç„¶åï¼ŒæŒ‡å®šä¸åŒçš„gpuè¿›è¡Œè¿›ç¨‹å®ˆæŠ¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[program:worker1]</span><br><span class="line"><span class="built_in">command</span>=python3 /opt/scripts/train_model.py --gpu 0</span><br><span class="line"></span><br><span class="line">[program:worker2]</span><br><span class="line"><span class="built_in">command</span>=python3 /opt/scripts/train_model.py --gpu 1</span><br></pre></td></tr></table></figure><h3 id="3-docker-restart-policy"><a class="markdownIt-Anchor" href="#3-docker-restart-policy"></a> 3. Docker + restart policy</h3><p>Docker æä¾›äº†ä¸€ç§æœºåˆ¶å«åš restart policyï¼ˆé‡å¯ç­–ç•¥ï¼‰ï¼Œç”¨æ¥æ§åˆ¶å½“å®¹å™¨é€€å‡ºæˆ–ç³»ç»Ÿé‡å¯æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ã€‚<br />å¯¹äºä¸€ä¸ªDockerfileï¼Œå¯ä»¥åŠ ä¸Š --restart alwaysè¿è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-capture .</span><br><span class="line">docker run -d --name my_capture_container --restart always my-capture</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®¹å™¨ä¸­çš„ Python è„šæœ¬å´©æºƒæ—¶è‡ªåŠ¨é‡å¯ã€‚</p><p>å½“ç„¶ï¼Œåœ¨docker-compose.yml ä¸­å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">camera_worker:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/app/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœæƒ³è¦åœ¨linuxä¸­å¼€æœºè‡ªå¯åŠ¨å®¹å™¨ï¼Œé™¤äº†ä¸Šé¢çš„ï¼Œåªè¦å†ä½¿å¾—dockerè‡ªåŠ¨å¯åŠ¨å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šæŠŠ Docker æœåŠ¡æ³¨å†Œåˆ° systemd ä¸­ï¼Œä¸‹æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨ Docker æœåŠ¡, ä¹Ÿå°±è‡ªåŠ¨æ‹‰èµ·äº† --restart always çš„å®¹å™¨ã€‚</p><p>è®¾ç½®å®Œä¹‹åï¼Œä½ å¯ä»¥æ£€æŸ¥ä¸€ä¸‹é‡å¯ç­–ç•¥æ˜¯å¦é…ç½®å¥½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect your_container_name | grep -i restart</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æŒä¹…åŒ–çš„pythonæœåŠ¡&lt;/p&gt;</summary>
    
    
    
    <category term="å…¶ä»–" scheme="https://atffang.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>æµ…è¯•dockerï¼šä¸º AI é¡¹ç›®æ„å»ºé«˜å¯ç»´æŠ¤çš„å¼€å‘ç¯å¢ƒ</title>
    <link href="https://atffang.github.io/2025/06/30/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%BB%B4%E6%8A%A4%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <id>https://atffang.github.io/2025/06/30/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%BB%B4%E6%8A%A4%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</id>
    <published>2025-06-30T12:49:55.000Z</published>
    <updated>2026-01-10T14:27:14.888Z</updated>
    
    <content type="html"><![CDATA[<p>æµ…è¯•dockerï¼šä¸º AI é¡¹ç›®æ„å»ºé«˜å¯ç»´æŠ¤çš„å¼€å‘ç¯å¢ƒ</p><span id="more"></span><p>æˆ‘çš„éœ€æ±‚æ˜¯ä¸€ä¸ªå¸¦cudaé©±åŠ¨çš„pythonå®¹å™¨ï¼Œrediså®¹å™¨ã€psqlå®¹å™¨ã€minioå®¹å™¨ï¼Œå› æ­¤ï¼Œæˆ‘æŒ‡å®šdocker-composeå’Œdockerfileï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>æ–¹é¢</th><th>Dockerfile</th><th>Docker Compose</th></tr></thead><tbody><tr><td>æ ¸å¿ƒä½œç”¨</td><td>å®šä¹‰å•ä¸ªé•œåƒçš„æ„å»ºè¿‡ç¨‹ï¼Œæè¿°ä»åŸºç¡€é•œåƒå¼€å§‹ï¼Œå®‰è£…è½¯ä»¶ã€æ‹·è´æ–‡ä»¶ã€é…ç½®ç¯å¢ƒç­‰æ­¥éª¤ï¼Œç”Ÿæˆè‡ªå®šä¹‰é•œåƒã€‚</td><td>å®šä¹‰å¤šä¸ªå®¹å™¨çš„ç¼–æ’å’Œè¿è¡Œï¼ŒæŒ‡å®šå“ªäº›é•œåƒæˆ– Dockerfile è¦å¯åŠ¨ï¼Œå®¹å™¨ä¹‹é—´å¦‚ä½•è¿æ¥ã€æŒ‚è½½å·ã€ç«¯å£æ˜ å°„ç­‰ã€‚</td></tr><tr><td>å·¥ä½œæ–¹å¼</td><td>é€šè¿‡ docker build ä» Dockerfile æ„å»ºé•œåƒã€‚</td><td>é€šè¿‡ docker-compose up æ ¹æ®é…ç½®å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚</td></tr><tr><td>æ˜¯å¦æ‹‰å–é•œåƒ</td><td>å¯ä»¥åŸºäºå·²æœ‰é•œåƒï¼ˆFROM xxxï¼‰ï¼Œä¹Ÿå¯ä»¥ä»å¤´å¼€å§‹æ„å»ºã€‚</td><td>å¯ä»¥ä½¿ç”¨å·²æœ‰é•œåƒï¼ˆimage: xxxï¼‰æˆ–åŸºäº Dockerfile æ„å»ºé•œåƒï¼ˆbuild: xxxï¼‰ã€‚</td></tr><tr><td>åŠŸèƒ½èŒƒå›´</td><td>åªè´Ÿè´£é•œåƒæ„å»ºï¼ˆé™æ€ï¼‰ï¼Œé•œåƒé‡ŒåŒ…å«è¿è¡Œç¯å¢ƒå’Œæ–‡ä»¶ã€‚</td><td>è´Ÿè´£å¤šå®¹å™¨åº”ç”¨çš„å¯åŠ¨ä¸ç®¡ç†ï¼ˆåŠ¨æ€ï¼‰ï¼ŒåŒ…æ‹¬ç½‘ç»œã€ä¾èµ–å…³ç³»ã€ç¯å¢ƒå˜é‡ç­‰ã€‚</td></tr><tr><td>ç¤ºä¾‹</td><td>å†™ä¸€ä¸ª Python é•œåƒï¼Œå®‰è£…ä¾èµ–ï¼Œæ‹·è´ä»£ç ã€‚</td><td>å¯åŠ¨æ•°æ®åº“ã€ç¼“å­˜ã€Python æœåŠ¡å®¹å™¨ï¼Œå¹¶è®©å®ƒä»¬ååŒå·¥ä½œã€‚</td></tr></tbody></table><p>ç¼–å†™<strong>Docker-compose:</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span>  </span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">nvidia</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_app</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">postgres</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./app:/app</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/app</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8888:8888&quot;</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;tail&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;/dev/null&quot;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_minio</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9001:9001&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINIO_ROOT_USER:</span> <span class="string">minioadmin</span></span><br><span class="line">      <span class="attr">MINIO_ROOT_PASSWORD:</span> <span class="string">minioadmin</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">/data</span> <span class="string">--console-address</span> <span class="string">&quot;:9001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_data:/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:17</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">labsecurity_postgres</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">labdb</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">labuser</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">labpass</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pgdata:/var/lib/postgresql/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">pgdata:</span></span><br><span class="line">  <span class="attr">minio_data:</span></span><br></pre></td></tr></table></figure><p>ç¼–å†™<strong>Dockerfile:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nvidia<span class="operator">/</span>cuda:<span class="number">12.8</span><span class="number">.0</span><span class="operator">-</span>cudnn<span class="operator">-</span>runtime<span class="operator">-</span>ubuntu22<span class="number">.04</span></span><br><span class="line"></span><br><span class="line">RUN apt<span class="operator">-</span><span class="keyword">get</span> <span class="keyword">update</span> <span class="operator">&amp;&amp;</span> apt<span class="operator">-</span><span class="keyword">get</span> install <span class="operator">-</span>y python3 python3<span class="operator">-</span>pip</span><br><span class="line"></span><br><span class="line">WORKDIR <span class="operator">/</span>app</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span> requirements.txt .</span><br><span class="line"></span><br><span class="line">RUN pip install torch<span class="operator">=</span><span class="operator">=</span><span class="number">2.6</span><span class="number">.0</span> torchvision<span class="operator">=</span><span class="operator">=</span><span class="number">0.21</span><span class="number">.0</span> torchaudio<span class="operator">=</span><span class="operator">=</span><span class="number">2.6</span><span class="number">.0</span> <span class="comment">--index-url https://download.pytorch.org/whl/cu126</span></span><br><span class="line">RUN pip install <span class="comment">--no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span> .<span class="operator">/</span>app <span class="operator">/</span>app</span><br><span class="line"></span><br><span class="line">CMD [&quot;python3&quot;, &quot;main.py&quot;]</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåœ¨pythonä¸­é€šè¿‡<code>minio:9000</code>ï¼Œåœ¨æœ¬æœºä¸­å¯ä»¥é€šè¿‡<code>http://localhost:9001/</code>è®¿é—®ã€‚</p><h3 id="dockerå¿«é€Ÿæ„å»º"><a class="markdownIt-Anchor" href="#dockerå¿«é€Ÿæ„å»º"></a> dockerå¿«é€Ÿæ„å»º</h3><ol><li>ä¸‹è½½docker desktopï¼Œå¯¹äºåˆ†ç›˜çš„windowsç”µè„‘ï¼Œå»ºè®®è¿ç§»ä¸€ä¸‹dockerä½ç½®</li><li>æ¢æºï¼Œæˆ‘è¿™é‡Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ºï¼š</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;gc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;defaultKeepStorage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20GB&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;experimental&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://docker.xuanyuan.me&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>æ„å»ºé•œåƒï¼š<code>docker compose build</code></p></li><li><p>å¯åŠ¨å®¹å™¨æœåŠ¡ï¼š<code>docker compose up -d</code> æ²¡æœ‰ä¸‹è½½è¿‡dockert-composeä¸­çš„å®¹å™¨çš„ä¼šå…ˆä¸‹è½½</p></li><li><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š<code>docker ps</code> -a<br /><img src="https://gcnaq17oc64n.feishu.cn/space/api/box/stream/download/asynccode/?code=NGI2NTJlZWU1OTExOGMzODgwMjAzZTM1NGJiMjhkNWNfZnA5ZE9tZHlwdWdhT3BOZjVtcVhzckd2Uk9Ma2pwdVRfVG9rZW46T2hBc2JGaHRHbzAyMEV4ZjAwZWMzSFYxbkloXzE3NTEyODkwNzk6MTc1MTI5MjY3OV9WNA" alt="" /></p></li><li><p>è¿›å…¥pythonå®¹å™¨ï¼š<code>docker exec -it labsecurity_app bash</code></p></li><li><p>æµ‹è¯•ä¸€ä¸‹cudaç¯å¢ƒæ˜¯å¦å¯ç”¨ï¼Œè¿è¡Œè„šæœ¬ï¼š</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.get_device_name(<span class="number">0</span>))</span><br></pre></td></tr></table></figure><ol start="8"><li>ç»“æŸæ‰€æœ‰æœåŠ¡ï¼š <code>docker-compose stop</code> å¼€å§‹æ‰€æœ‰æœåŠ¡ï¼š<code>docker-compose start</code></li><li>æˆ‘åœ¨docker-composeé‡Œé¢æŒ‚è½½äº†ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">    - ./app:/app</span><br></pre></td></tr></table></figure><p>å®¹å™¨èƒ½çœ‹åˆ°æœ¬æœºçš„ <code>./app</code> ç›®å½•ï¼Œç‚¹å‡»vscodeå·¦ä¸‹æ–¹çš„&gt;&lt;ï¼Œé€‰æ‹©Attach to Running Containerï¼Œè¿›å…¥pythonå®¹å™¨ï¼Œå°±å¯ä»¥æ„‰å¿«çš„å¼€å‘äº†</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æµ…è¯•dockerï¼šä¸º AI é¡¹ç›®æ„å»ºé«˜å¯ç»´æŠ¤çš„å¼€å‘ç¯å¢ƒ&lt;/p&gt;</summary>
    
    
    
    <category term="å…¶ä»–" scheme="https://atffang.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>ä»0å¼€å§‹å­¦java 02 ï¼šå§”æ‰˜ä¸ç­–ç•¥æ¨¡å¼</title>
    <link href="https://atffang.github.io/2025/06/29/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6java2/"/>
    <id>https://atffang.github.io/2025/06/29/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6java2/</id>
    <published>2025-06-29T07:46:42.000Z</published>
    <updated>2026-01-10T14:21:11.230Z</updated>
    
    <content type="html"><![CDATA[<p>ç”Ÿæ´»æ‰€è¿«å‘€ã€‚</p><span id="more"></span><p>ä¸Šä¸€æœŸä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ¥å£ï¼ˆinterfaceï¼‰å’ŒæŠ½è±¡ç±»ï¼ˆabstract classï¼‰ç†è§£äº†å¦‚ä½•å®šä¹‰è¡Œä¸ºè§„èŒƒã€å¦‚ä½•å®ç°å¤šæ€ç­‰ç­‰ã€‚ç„¶è€Œï¼Œåœ¨ä¼ ç»Ÿçš„ç»§æ‰¿æ–¹å¼ä¸­ï¼Œå­ç±»é€šè¿‡è¦†ç›–æ–¹æ³•æ¥æ”¹å˜è¡Œä¸ºï¼Œä½†è¿™ç§æ–¹å¼åœ¨é¢å¯¹è¡Œä¸ºåˆ‡æ¢ã€è¡Œä¸ºå¤ç”¨æ—¶æ˜¾å¾—åƒµç¡¬ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ç§æ–¹å¼ï¼Œä¸ç”¨ç»§æ‰¿ï¼Œä¹Ÿèƒ½æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºï¼Œæ›´é€‚åˆâ€œæ’ä»¶å¼â€çš„è¡Œä¸ºç»“æ„ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ä¸€ç§æ–°çš„æ¨¡å¼<strong>å§”æ‰˜</strong>ï¼ŒæŠŠè¡Œä¸ºäº¤ç»™å¦ä¸€ä¸ªå¯¹è±¡æ¥å®Œæˆã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œæ¥è§„èŒƒè¦å¹²çš„äº‹æƒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FlyBehavior</span>&#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°æ¥å£çš„ç±»å¿…é¡»è¦å®ç°flyè¿™ä¸€ä¸ªåŠ¨ä½œï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®ç°FlyBehavioræ¥å£çš„ç±»FlyWithWingsï¼Œæ¥å®ç°æœ‰ç¿…è†€å¯ä»¥é£çš„åŠ¨ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyWithWings</span> <span class="keyword">implements</span> <span class="title class_">FlyBehavior</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;fly!!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªå®ç°FlyBehavioræ¥å£çš„ç±»FlyNoWingsï¼Œæ¥å®ç°æ²¡ç¿…è†€ä¸èƒ½é£çš„åŠ¨ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyNoWings</span> <span class="keyword">implements</span> <span class="title class_">FlyBehavior</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;cannot fly!!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰ç©æ¥å£å’Œæ¥å£çš„å®ç°ä¹‹åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªé£è¡ŒåŠ¨ä½œï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æ¥å®šä¹‰å®ç°é£è¡ŒåŠ¨ä½œçš„å¯¹è±¡ã€‚<br />æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé¸­å­æŠ½è±¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line"><span class="comment">// å£°æ˜å¼•ç”¨å˜é‡</span></span><br><span class="line">FlyBehavior flyBehavior;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Duck</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠ½è±¡ç±»çš„å‡½æ•°ï¼Œå­ç±»å¿…é¡»å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å§”æ‰˜ç»™è¡Œä¸ºç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performFly</span><span class="params">()</span> &#123;</span><br><span class="line">flyBehavior.fly();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¦–å…ˆå£°æ˜äº†ä¸€ä¸ªFlyBehaviorç±»å‹çš„å¼•ç”¨å˜é‡ï¼Œè¡¨ç¤ºé¸­å­çš„é£è¡Œè¡Œä¸ºï¼Œå½“è°ƒç”¨performFly()æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯flyBehaviorå¯¹è±¡çš„fly()æ–¹æ³•ã€‚</p><p>å¥½çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªå­ç±»äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MallardDuck</span> <span class="keyword">extends</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MallardDuck</span><span class="params">()</span>&#123;</span><br><span class="line">flyBehavior = <span class="keyword">new</span> <span class="title class_">FlyNoWings</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;im MallardDuck&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ MallardDuck æ„é€ å‡½æ•°é‡Œï¼Œç»™ç»§æ‰¿è‡ªçˆ¶ç±»çš„ flyBehavior å˜é‡èµ‹å€¼ä¸º new FlyWithWings() å®ä¾‹ã€‚è¿™æ ·è°ƒç”¨ performFly() å°±ä¼šè°ƒç”¨ FlyWithWings ç±»çš„ fly() æ–¹æ³•ï¼Œå®ç°â€œé£â€çš„åŠ¨ä½œã€‚<br />å…¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunDuck</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line"><span class="type">Duck</span> <span class="variable">mallard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MallardDuck</span>();</span><br><span class="line">mallard.performFly();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š cannot fly!!!</p><p><strong>ä½†æ˜¯</strong>ï¼Œè¿™æ ·è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦è®©é¸­å­å…·æœ‰åŠ¨æ€è¡Œä¸ºã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æŠ½è±¡ç±»ä¸­åŠ å…¥ä¸€ä¸ªè®¾å®šæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Duck</span>&#123;</span><br><span class="line">FlyBehavior flyBehavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Duck</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performFly</span><span class="params">()</span> &#123;</span><br><span class="line">flyBehavior.fly();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°åŠ å…¥çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlyBehavior</span><span class="params">(FlyBehavior fb)</span>&#123;</span><br><span class="line">flyBehavior = fb;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšåï¼Œåœ¨å®ç°æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunDuck</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line"><span class="type">Duck</span> <span class="variable">mallard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MallardDuck</span>();</span><br><span class="line">mallard.performFly();</span><br><span class="line">mallard.setFlyBehavior(<span class="keyword">new</span> <span class="title class_">FlyWithWings</span>());</span><br><span class="line">mallard.performFly();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³å¯åŠ¨æ€è®¾å®šå…¶è¡Œä¸ºï¼Œè¾“å‡ºä¸ºï¼š<br />cannot fly!!!<br />fly!!!</p><p><strong>è¿™ç§é€šè¿‡ç»„åˆè¡Œä¸ºæ¥å£çš„æ–¹å¼å®ç°åŠ¨æ€åˆ‡æ¢è¡Œä¸ºçš„è®¾è®¡æ¨¡å¼ï¼Œç§°ä¸ºç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„é‡è¦æ€æƒ³</strong>ã€‚<br /><img src="https://atffang.github.io/2025/06/29/ä»0å¼€å§‹å­¦java2/ç­–ç•¥æ¨¡å¼.png"/></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç”Ÿæ´»æ‰€è¿«å‘€ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¼–ç¨‹å­¦ä¹ -java" scheme="https://atffang.github.io/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-java/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›</title>
    <link href="https://atffang.github.io/2025/06/25/%E7%BE%8E%E5%9B%A2%E5%95%86%E4%B8%9A%E5%88%86%E6%9E%90%E7%B2%BE%E8%8B%B1%E5%A4%A7%E8%B5%9B%E4%BA%9A%E5%86%9B/"/>
    <id>https://atffang.github.io/2025/06/25/%E7%BE%8E%E5%9B%A2%E5%95%86%E4%B8%9A%E5%88%86%E6%9E%90%E7%B2%BE%E8%8B%B1%E5%A4%A7%E8%B5%9B%E4%BA%9A%E5%86%9B/</id>
    <published>2025-06-25T01:29:59.000Z</published>
    <updated>2026-01-10T14:27:04.453Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€èµ·èšâ€”â€”é¢å‘èšé¤åœºæ™¯çš„æ™ºèƒ½é¤å…æ¨èç³»ç»Ÿ</p><span id="more"></span><p>ä»1206æ”¯é˜Ÿä¼é‡Œæ€åˆ°äº†ç¬¬äºŒï¼Œè·æ­¤æ®Šè£ç¡®å®åœ¨æˆ‘ä»¬æ„æ–™ä¹‹å¤–ã€‚æ„Ÿè°¢ç¾å›¢æä¾›çš„æœºä¼šä¸moneyã€‚<br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_01.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_02.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_03.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_04.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_05.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_06.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_07.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_08.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_09.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_10.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_11.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_12.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_13.png"/><br /><img src="https://atffang.github.io/2025/06/25/ç¾å›¢å•†ä¸šåˆ†æç²¾è‹±å¤§èµ›äºšå†›/å†³èµ›-ç»ˆç¨¿2.5_14.png"/></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€èµ·èšâ€”â€”é¢å‘èšé¤åœºæ™¯çš„æ™ºèƒ½é¤å…æ¨èç³»ç»Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="ä½œå“" scheme="https://atffang.github.io/categories/%E4%BD%9C%E5%93%81/"/>
    
    
  </entry>
  
  <entry>
    <title>ijgis online</title>
    <link href="https://atffang.github.io/2025/06/14/online%E5%BC%80%E9%A6%99%E6%A7%9F/"/>
    <id>https://atffang.github.io/2025/06/14/online%E5%BC%80%E9%A6%99%E6%A7%9F/</id>
    <published>2025-06-14T01:59:02.000Z</published>
    <updated>2026-01-10T14:26:55.965Z</updated>
    
    <content type="html"><![CDATA[<p>ç¥è´ºèˆ’å§çš„ijgisä¸Šçº¿ã€‚</p><span id="more"></span><p>ä»ideaåˆ°onlineï¼Œå‰å‰ååèŠ±äº†ä¸€å¹´å¤šçš„æ—¶é—´ï¼Œæˆ‘åœ¨å…¶ä¸­ä¹Ÿåªèƒ½æä¾›ä¸€äº›å¾®è–„çš„å¸®åŠ©ã€‚ä½œè€…çœŸçš„å¤ªä¸å®¹æ˜“äº†ã€‚<br />è™½ç„¶ç°åœ¨æ²¡æœ‰æœºä¼šä¸»å¯¼æ’°å†™è®ºæ–‡ï¼Œä½†çœ‹åˆ°æœ‹å‹çš„æˆåŠŸä¹Ÿä¼šå®½æ…°ä¸å°‘ï¼Œå…±å‹‰å§ã€‚</p><p>Xu, Y., Gong, Z., Fang, T., Zhang, H., &amp; Tang, G. (2025). Intercity human dynamics during holidays through the lens of travel movementâ€“intention interactions in the hybrid physicalâ€“virtual space.Â <em>International Journal of Geographical Information Science</em>, 1â€“29. <a href="https://doi.org/10.1080/13658816.2025.2515200">https://doi.org/10.1080/13658816.2025.2515200</a></p><p><strong>Abstract</strong>:<br />Intercity human dynamics has involved increasing interactions between the physical world and cyberspace with the boom of the Internet and social media, expanding traditional intercity activities from a single dimension of physical space to a multidimensional hybrid space. Revealing the dynamics of intercity activities in a hybrid physicalâ€“virtual space requires considering interactions between human activities in both the physical world and cyberspace. However, existing studies often overlook cross-space interactions, failing to adequately model interactions between virtual and physical spaces in terms of the network structure and spatial effects. To address these gaps, this study investigates intercity human dynamics through travel movementâ€“intention interactions. A multilayer network framework is proposed to represent the hybrid space, where travel movementâ€“intention interactions can be conceptualized and measured. Using travel and search flows in China during the â€˜Labor Dayâ€™ holiday periods in a three-year period of the pandemic, we demonstrate the proposed approachâ€™s utility through an analysis of city centrality of multilayer networks. Results find that travel movementâ€“intention interactions exhibit dynamic patterns that vary with city size and geographic distance. This approach is broadly applicable to studies of hybrid physicalâ€“virtual spaces, aiding the evaluation of human dynamics beyond intercity activities.</p><p>ä»£ç å¼€æºè‡³ï¼š<br /><a href="https://doi.org/10.6084/m9.figshare.27929466">https://doi.org/10.6084/m9.figshare.27929466</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¥è´ºèˆ’å§çš„ijgisä¸Šçº¿ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä½œå“" scheme="https://atffang.github.io/categories/%E4%BD%9C%E5%93%81/"/>
    
    
  </entry>
  
</feed>
